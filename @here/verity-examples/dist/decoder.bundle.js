!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=91)}([function(e,t){e.exports=THREE},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(113)),n(r(114)),n(r(119)),n(r(120)),n(r(121)),n(r(122)),n(r(123)),n(r(124)),n(r(125)),n(r(126))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(93)),n(r(94)),n(r(47)),n(r(24)),n(r(127)),n(r(128))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(45)),n(r(105)),n(r(106)),n(r(107)),n(r(108)),n(r(109)),n(r(110)),n(r(46)),n(r(111)),n(r(112))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(9)),n(r(95)),n(r(6)),n(r(13)),n(r(38)),n(r(96)),n(r(97)),n(r(21)),n(r(39)),n(r(40)),n(r(41)),n(r(22)),n(r(98)),n(r(42)),n(r(99)),n(r(8)),n(r(43)),n(r(44)),n(r(14)),n(r(100)),n(r(101)),n(r(102)),n(r(103)),n(r(104)),n(r(10))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(55)),n(r(135))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=180/Math.PI,i=Math.PI/180,o=function(){function e(e,t,r){this.latitude=e,this.longitude=t,this.altitude=r}return e.fromDegrees=function(t,r,n){return new e(t,r,n)},e.fromRadians=function(t,r,i){return new e(t*n,r*n,i)},Object.defineProperty(e.prototype,"latitudeInRadians",{get:function(){return this.latitude*i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeInRadians",{get:function(){return this.longitude*i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeInDegrees",{get:function(){return this.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeInDegrees",{get:function(){return this.longitude},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){return!isNaN(this.latitude)&&!isNaN(this.longitude)},e.prototype.normalized=function(){var t,r=this.latitude,n=this.longitude;if(isNaN(r)||isNaN(n))return this;r>90&&((t=(r+90)%360)>=180&&(n+=180,t=360-t),r=t-90);r<-90&&((t=(r-90)%360)<=-180&&(n+=180,t=-360-t),r=t+90);return(n<-180||n>180)&&(n=(n+180)%360-180),r===this.latitude&&n===this.longitude?this:new e(r,n,this.altitude)},e.prototype.equals=function(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude},e.prototype.copy=function(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this},e.prototype.clone=function(){return new e(this.latitude,this.longitude,this.altitude)},e}();t.GeoCoordinates=o},function(e,t,r){"use strict";(function(e){var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(169),n.base64=r(170),n.EventEmitter=r(171),n.float=r(172),n.inquire=r(173),n.utf8=r(174),n.pool=r(175),n.LongBits=r(176),n.global="undefined"!=typeof window&&window||void 0!==e&&e||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=o,n.ProtocolError=o("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,r(34))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,9007199254740992,0x8000000000000],i=function(){function e(e,t,r){this.row=e,this.column=t,this.level=r}return e.fromRowColumnLevel=function(t,r,n){return new e(t,r,n)},e.fromQuadKey=function(t){for(var r=t.length,n=0,i=0,o=0;o<t.length;++o){var a=1<<o,s=parseInt(t.charAt(r-o-1),10);1&s&&(i|=a),2&s&&(n|=a)}return e.fromRowColumnLevel(n,i,r)},e.fromMortonCode=function(t){for(var r=0,n=0,i=0,o=t;o>1;){var a=1<<r;1&o&&(i|=a),2&o&&(n|=a),r++,o=(o-(3&o))/4}var s=e.fromRowColumnLevel(n,i,r);return s.m_mortonCode=t,s},e.fromHereTile=function(t){var r=e.fromMortonCode(parseInt(t,10));return r.m_hereTile=t,r},e.columnsAtLevel=function(e){return Math.pow(2,e)},e.rowsAtLevel=function(e){return Math.pow(2,e)},e.atCoords=function(t,r,n,i,o){return e.fromRowColumnLevel(Math.floor(n/(o/e.rowsAtLevel(t))),Math.floor(r/(i/e.columnsAtLevel(t))),t)},e.parentMortonCode=function(e){return Math.floor(e/4)},e.prototype.parent=function(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return e.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)},e.prototype.changedLevelBy=function(t){var r=Math.max(0,this.level+t),n=this.row,i=this.column;return t>=0?(n<<=t,i<<=t):(n>>>=-t,i>>>=-t),e.fromRowColumnLevel(n,i,r)},e.prototype.changedLevelTo=function(e){return this.changedLevelBy(e-this.level)},e.prototype.mortonCode=function(){if(void 0===this.m_mortonCode){for(var e=this.column,t=this.row,r=n[this.level<<1],i=0;i<this.level;++i)1&e&&(r+=n[2*i]),1&t&&(r+=n[2*i+1]),e>>>=1,t>>>=1;this.m_mortonCode=r}return this.m_mortonCode},e.prototype.toHereTile=function(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile},e.prototype.toQuadKey=function(){for(var e="",t=this.level;t>0;--t){var r=1<<t-1,n=0!=(this.column&r),i=0!=(this.row&r);e+=n&&i?"3":i?"2":n?"1":"0"}return e},e.prototype.equals=function(e){return this.row===e.row&&this.column===e.column&&this.level===e.level},e.prototype.addedSubKey=function(t){var r=e.fromQuadKey(0===t.length?"-":t),n=this.changedLevelBy(r.level);return e.fromRowColumnLevel(n.row+r.row,n.column+r.column,n.level)},e.prototype.addedSubHereTile=function(t){var r=e.fromHereTile(t),n=this.changedLevelBy(r.level);return e.fromRowColumnLevel(n.row+r.row,n.column+r.column,n.level)},e.prototype.getSubHereTile=function(e){var t=1<<2*e;return(this.mortonCode()&t-1|t).toString()},e.prototype.rowCount=function(){return e.rowsAtLevel(this.level)},e.prototype.columnCount=function(){return e.columnsAtLevel(this.level)},e}();t.TileKey=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=Math.PI/180,o=function(){function e(e,t){this.southWest=e,this.northEast=t}return e.fromCoordinates=function(t,r){return new e(t,r)},Object.defineProperty(e.prototype,"minAltitude",{get:function(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAltitude",{get:function(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"south",{get:function(){return this.southWest.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"north",{get:function(){return this.northEast.latitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"west",{get:function(){return this.southWest.longitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"east",{get:function(){return this.northEast.longitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){var e,t=.5*(this.south+this.north),r=this.west,i=this.east,o=this.minAltitude,a=this.altitudeSpan;if(void 0!==o&&void 0!==a&&(e=o+.5*a),r<i)return new n.GeoCoordinates(t,.5*(r+i),e);var s=.5*(360+i+r);return s>360&&(s-=360),new n.GeoCoordinates(t,s,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpanInRadians",{get:function(){return this.latitudeSpan*i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpanInRadians",{get:function(){return this.longitudeSpan*i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpan",{get:function(){return this.north-this.south},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altitudeSpan",{get:function(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpan",{get:function(){var e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latitudeSpanInDegrees",{get:function(){return this.latitudeSpan},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longitudeSpanInDegrees",{get:function(){return this.longitudeSpan},enumerable:!0,configurable:!0}),e.prototype.contains=function(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);var t=this.minAltitude===this.maxAltitude,r=this.minAltitude===e.altitude,n=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!(t?!r:!n)&&this.containsHelper(e)},e.prototype.clone=function(){return new e(this.southWest,this.northEast)},e.prototype.containsHelper=function(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;var t=this.west,r=this.east;return r>t?e.longitude>=t&&e.longitude<r:e.longitude>r||e.longitude<=t},e}();t.GeoBox=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Math.PI/180,i=180/Math.PI;!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function r(e,r){var n=(e=t(e))-(r=t(r));return n>180?n-360:n<=-180?n+360:n}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.degToRad=function(e){return e*n},e.radToDeg=function(e){return e*i},e.clamp=function(e,t,r){return e<t?t:e>r?r:e},e.normalizeAngleDeg=t,e.angleDistanceDeg=r,e.interpolateAnglesDeg=function(e,t,n){return(e+r(t,e)*n)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=!1),this.url=e,this.hasQuery=t}return e.stringifyQuery=function(t){var r="";for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];void 0!==i&&(r=e.appendQueryString(r,"",n,i))}return r},e.toString=function(e){return"string"==typeof e?e:e.toString()},e.appendQueryString=function(e,t,r,n){return e+=t,e+=encodeURIComponent(r)+"=",e+="number"==typeof n?n.toString():"string"==typeof n?encodeURIComponent(n):n.map(function(e){return encodeURIComponent(e)}).join(",")},e.prototype.appendQuery=function(t,r){void 0!==r&&(this.url=e.appendQueryString(this.url,this.hasQuery?"&":"?",t,r),this.hasQuery=!0)},e}();t.UrlBuilder=n;var i=function(){function e(e){this.baseUrl=e}return e.prototype.request=function(e,t){return this.download(e.url,t)},e}();t.RequestBuilder=i},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(148)),n(r(66)),n(r(31)),n(r(32)),n(r(67))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,e}();t.EarthConstants=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(40),i=r(43),o=r(44),a=function(){function e(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new n.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new o.TileTreeTraverse(e)}return e.prototype.getSubTileKeys=function(e){return this.tileTreeTraverse.subTiles(e)},e.prototype.getTileKey=function(e,t){return i.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)},e.prototype.getTileKeys=function(e,t){return i.TileKeyUtils.geoRectangleToTileKeys(this,e,t)},e.prototype.getGeoBox=function(e){return this.boundingBoxGenerator.getGeoBox(e)},e.prototype.getWorldBox=function(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)},e}();t.TilingScheme=a},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(57)),n(r(138))},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),o=r(13),a=r(0);!function(e){var t=new a.Plane(new a.Vector3(0,0,1)),r=new a.Vector3(0,0,0),s=new a.Matrix4,u=new a.Matrix4,l=new a.Raycaster,c=new a.Quaternion,d=new a.Quaternion,h=new a.Vector3(0,0,1),f=new a.Vector3(1,0,0);function p(e,n,i){var o=new a.Vector3(n,i,.5),c=e.worldCenter;r.copy(e.camera.position),s.extractRotation(e.camera.matrixWorld),u.multiplyMatrices(s,u.getInverse(e.camera.projectionMatrix));var d=o.applyMatrix4(u);l.set(r,d.normalize());var h=new a.Vector3,f=l.ray.intersectPlane(t,h);return f?(f.setX(f.x+c.x),f.setY(f.y+c.y),f):null}function m(e,t){var r=Math.pow(2,t);return o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/r/(2*Math.tan(.5*i.MathUtils.degToRad(e.camera.fov))*e.zoomLevelBias)}function y(e,t,r){var n=e.worldCenter;n.setX(n.x+t),n.setY(n.y+r),e.update()}function v(e){return e.substring(0,2)}e.zoomOnTargetPosition=function(e,t,r,n){var i=p(e,t,r);e.camera.position.setZ(m(e,n)),e.camera.matrixWorldNeedsUpdate=!0;var o=p(e,t,r);if(i&&o){var a=i.sub(o);y(e,a.x,a.y)}},e.rayCastWorldCoordinates=p,e.calculateDistanceToGroundFromZoomLevel=m,e.pan=y,e.setRotation=function(e,t,r){c.setFromAxisAngle(h,i.MathUtils.degToRad(t)),d.setFromAxisAngle(f,i.MathUtils.degToRad(r)),c.multiply(d),e.camera.quaternion.copy(c),e.camera.matrixWorldNeedsUpdate=!0},e.extractYawPitchRoll=function(e){var t=e.y*e.y,r=2*(e.w*e.x+e.y*e.z),n=1-2*(e.x*e.x+t),i=Math.atan2(r,n),o=2*(e.w*e.y-e.z*e.x);o=(o=o>1?1:o)<-1?-1:o;var a=Math.asin(o),s=2*(e.w*e.z+e.x*e.y),u=1-2*(t+e.z*e.z);return{yaw:Math.atan2(s,u),pitch:i,roll:a}},e.rayCastGeoCoordinates=function(e,t,r){var n=p(e,t,r);return n?e.projection.unprojectPoint(n):null},e.calculateZoomLevelFromHeight=function(e,t){var r=e*t.zoomLevelBias*2*Math.tan(i.MathUtils.degToRad(t.camera.fov/2)),n=o.EarthConstants.EQUATORIAL_CIRCUMFERENCE/2,a=r/2,s=Math.log2(n/a);return i.MathUtils.clamp(s,t.minZoomLevel,t.maxZoomLevel)},e.calculateDepthFromClipDistance=function(e,t){var r=t,n=r.far-r.near,i=e*r.far;return(1-r.near/i)*(r.far/n)},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)*t)},e.estimateObjectSize=function(e){if("function"==typeof e)return 0;for(var t=new Map,r=[e],n=0;r.length>0;){var i=r.pop();if(Array.isArray(i)&&i.length>0&&"object"!=typeof i[0])"boolean"==typeof i[0]?n+=4*i.length:"string"==typeof i[0]?i.forEach(function(e){void 0!==e.length&&(n+=2*e.length)}):"number"==typeof i[0]&&(n+=8*i.length);else if("boolean"==typeof i)n+=4;else if("string"==typeof i)n+=2*i.length;else if("number"==typeof i)n+=8;else if(void 0!==i&&null!==i&&void 0!==i.byteLength)n+=i.byteLength;else if("object"==typeof i&&null!==i&&!1===t.has(i)){t.set(i,"");var o=i;for(var a in o)void 0!==o[a]&&"function"!=typeof o[a]&&r.push(o[a])}}return n},e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){var e=[];try{for(var t=n(navigator.languages),r=t.next();!r.done;r=t.next()){var i=r.value;e.push(v(i))}}catch(e){o={error:e}}finally{try{r&&!r.done&&(a=t.return)&&a.call(t)}finally{if(o)throw o.error}}return e}if(void 0!==navigator.language)return[v(navigator.language)];var o,a}}(t.MapViewUtils||(t.MapViewUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(){this.m_map=new Map}return Object.defineProperty(e,"instance",{get:function(){return this.m_instance},enumerable:!0,configurable:!0}),e.prototype.getColor=function(e){var t=this.m_map.get(e);return void 0!==t?t:(t=new n.Color(e),this.m_map.set(e,t),t)},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_map.size},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.m_map.clear()},e.m_instance=new e,e}();t.ColorCache=i},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i,o=r(12),a=r(0);!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(i=t.FadingState||(t.FadingState={})),t.DEFAULT_FADE_TIME=800;var s=function(){function e(e,r,n,o,a,s){void 0===e&&(e=i.Undefined),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=1),void 0===a&&(a=Number.MIN_SAFE_INTEGER),void 0===s&&(s=t.DEFAULT_FADE_TIME),this.state=e,this.value=r,this.startTime=n,this.opacity=o,this.lastFrameNumber=a,this.fadingTime=s}return e.prototype.reset=function(){this.state=i.Undefined,this.value=0,this.startTime=0,this.opacity=1,this.lastFrameNumber=Number.MIN_SAFE_INTEGER},e.prototype.isFading=function(){return this.state===i.FadingIn||this.state===i.FadingOut},e.prototype.isFadingIn=function(){return this.state===i.FadingIn},e.prototype.isFadingOut=function(){return this.state===i.FadingOut},e.prototype.isFadedOut=function(){return this.state===i.FadedOut},e.prototype.isVisible=function(){return this.state===i.FadingIn||this.state===i.FadedIn||this.state===i.FadingOut},e}();t.RenderState=s;var u=function(){function e(e,t,r,n,i,a,s,u){void 0===r&&(r=0),void 0===n&&(n=1),this.text=e,this.points=t,this.priority=r,this.scale=n,this.xOffset=i,this.yOffset=a,this.featureId=s,this.style=u,this.distanceScale=.5,this.renderOrder=0,this.sortPriority=0,this.allGlyphsLoaded=!1,this.textWidth=0,this.horizontalAlignment=o.TextHorizontalAlignment.Center,this.verticalAlignment=o.TextVerticalAlignment.Center}return Object.defineProperty(e.prototype,"position",{get:function(){return this.points instanceof Array?this.points[0]:this.points instanceof a.Vector3?new a.Vector2(this.points.x,this.points.y):this.points},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position3",{get:function(){return this.points instanceof a.Vector3?this.points:this.points instanceof Array?new a.Vector3(this.points[0].x,this.points[0].y,0):new a.Vector3(this.points.x,this.points.y,0)},enumerable:!0,configurable:!0}),e.prototype.path=function(){if(this.points instanceof Array)return this.points},Object.defineProperty(e.prototype,"textMayOverlap",{get:function(){return!0===this.mayOverlap},set:function(e){this.mayOverlap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textReservesSpace",{get:function(){return!1!==this.reserveSpace},set:function(e){this.reserveSpace=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bold",{get:function(){return this.isBold},set:function(e){this.isBold=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tracking",{get:function(){return this.trackingFactor},set:function(e){this.trackingFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oblique",{get:function(){return this.isOblique},set:function(e){this.isOblique=e},enumerable:!0,configurable:!0}),e.prototype.getCodePoints=function(e){if(void 0===this.m_codepoints){this.m_codepoints=[],this.m_convertedToUpperCase=[];try{for(var t=n(this.text),r=t.next();!r.done;r=t.next())for(var i=r.value,o=i.toUpperCase(),a=!0===e?o:i,s=i!==a,u=0;u<a.length;u++)this.m_codepoints.push(a.codePointAt(u)),this.m_convertedToUpperCase.push(s)}catch(e){l={error:e}}finally{try{r&&!r.done&&(c=t.return)&&c.call(t)}finally{if(l)throw l.error}}}return this.m_codepoints;var l,c},Object.defineProperty(e.prototype,"convertedToUpperCase",{get:function(){return this.m_convertedToUpperCase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLineMarker",{get:function(){return void 0!==this.points&&void 0!==this.m_poiInfo&&"line-marker"===this.m_poiInfo.technique.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderDistance",{get:function(){return!0===this.alwaysOnTop?0:void 0!==this.currentViewDistance?-this.currentViewDistance:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poiInfo",{get:function(){return this.m_poiInfo},set:function(e){if(this.m_poiInfo=e,void 0!==e){var t=void 0!==this.renderOrder?o.BG_TEXT_RENDER_ORDER+this.renderOrder:0;e.renderOrder=t}},enumerable:!0,configurable:!0}),e}();t.TextElement=u},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(12),s=r(1),u=r(0),l=r(17),c=r(20),d=r(149),h=r(70),f=r(154),p=r(18),m=!0,y=!1,v=500;t.DEFAULT_TEXT_DISTANCE_SCALE=.5;var g=300,b=.99,_=.4,x=s.LoggerManager.instance.create("TextElementsRenderer"),w=1,T=new Array,S=new u.Matrix4,O=new u.Matrix4,E=new u.Matrix4,P=new u.Vector3,C=new u.Box2,A=new s.Math2D.Box,I=new u.Vector3,M=new u.Vector3,L=new u.Vector3,j=new u.Vector2,F=new u.Vector2,R=new u.Vector2,D=new u.Vector2,B=new u.Matrix4,U=new s.Math2D.Box,k=new u.Vector3,G={x:1/0,y:1/0,width:-1/0,height:-1/0},V=new u.Box2,q=new u.Vector3(0,0,0),N=new u.Vector4,z=new s.Math2D.Box,H=function(){return function(e,t){this.tile=e,this.textElements=t}}(),W=function(){return function(e,t){this.priority=e,this.textElementLists=t}}(),X=function(){function e(e,t,r,n,i,o,s,l,c){if(this.m_mapView=e,this.m_screenCollisions=t,this.m_screenProjector=r,this.m_theme=n,this.m_maxNumVisibleLabels=i,this.m_numSecondChanceLabels=o,this.m_maxDistanceRatioForLabels=s,this.m_labelStartScaleDistance=l,this.m_textMaterialConstructor=c,this.m_positionCount=0,this.m_indexCount=0,this.m_fontCatalogs=new Map,this.m_textStyles=[],this.m_defaultStyle={name:a.DEFAULT_STYLE_NAME,fontCatalogName:a.DEFAULT_FONT_CATALOG_NAME,color:"#6d7477",bgMode:a.TextBackgroundModeStrings.Outline,bgColor:"#F7FBFD",bgFactor:5,bgAlpha:.5,allCaps:!1,smallCaps:!1},this.m_lastRenderedTextElements=[],this.m_secondChanceTextElements=[],this.m_firstGlyphLoaded=!1,void 0===this.m_maxNumVisibleLabels&&(this.m_maxNumVisibleLabels=v),void 0===this.m_numSecondChanceLabels&&(this.m_numSecondChanceLabels=g),void 0===this.m_maxDistanceRatioForLabels&&(this.m_maxDistanceRatioForLabels=b),void 0===this.m_labelStartScaleDistance&&(this.m_labelStartScaleDistance=_),this.initTextRenderer(),m){var d=new u.PlaneGeometry(a.GLYPH_CACHE_TEXTURE_SIZE/2.5,a.GLYPH_CACHE_TEXTURE_SIZE/2.5,a.GLYPH_CACHE_WIDTH,a.GLYPH_CACHE_WIDTH),h=new u.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheMesh=new u.Mesh(d,h),this.m_debugGlyphTextureCacheMesh.renderOrder=1e4,this.m_debugGlyphTextureCacheMesh.visible=!1,this.m_debugGlyphTextureCacheMesh.name="glyphDebug";var f=new u.WireframeGeometry(d),p=new u.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheWireMesh=new u.LineSegments(f,p),this.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,this.m_debugGlyphTextureCacheWireMesh.visible=!1,this.m_debugGlyphTextureCacheWireMesh.name="glyphDebug"}y&&(this.m_debugPositions=new u.BufferAttribute(new Float32Array(10240),3),this.m_debugPositions.setDynamic(!0),this.m_debugIndex=new u.BufferAttribute(new Uint32Array(10240),1),this.m_debugIndex.setDynamic(!0),this.m_debugGeometry=new u.BufferGeometry,this.m_debugGeometry.addAttribute("position",this.m_debugPositions),this.m_debugGeometry.setIndex(this.m_debugIndex),this.m_debugMesh=new u.Mesh(this.m_debugGeometry,new u.MeshBasicMaterial({color:"#f00"})),this.m_debugMesh.renderOrder=1e3,this.m_debugPositions.count=0,this.m_debugIndex.count=0)}return e.prototype.end=function(){y&&void 0!==this.m_debugPositions&&void 0!==this.m_debugIndex&&(this.m_positionCount>0&&(this.m_debugPositions.updateRange.count=this.m_positionCount*this.m_debugPositions.itemSize,this.m_debugPositions.needsUpdate=!0),this.m_debugPositions.count=this.m_positionCount*this.m_debugPositions.itemSize,this.m_indexCount>0&&(this.m_debugIndex.updateRange.count=this.m_indexCount,this.m_debugIndex.needsUpdate=!0),this.m_debugIndex.count=this.m_indexCount,this.m_positionCount=0,this.m_indexCount=0)},Object.defineProperty(e.prototype,"debugMesh",{get:function(){return this.m_debugMesh},enumerable:!0,configurable:!0}),e.prototype.renderText=function(e,t){void 0!==this.m_textRenderer&&this.m_textRenderer.render(e,t,this.m_mapView.cameraIsMoving||this.m_mapView.animating||this.m_mapView.updatePending)},e.prototype.reset=function(){if(w=window.devicePixelRatio,this.m_screenCollisions.reset(),void 0!==this.m_textRenderer){this.m_textRenderer.reset(),this.m_poiRenderer.reset();try{for(var e=i(this.m_textRenderer.fontCatalogs),t=e.next();!t.done;t=e.next()){var r=t.value,n=this.m_textRenderer.getGlyphTextureCacheForFontCatalog(r);if(void 0===n)return void x.error("FontCatalog not used by text renderer: "+r);n.resetBuffer()}}catch(e){o={error:e}}finally{try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(o)throw o.error}}}var o,a},e.prototype.update=function(e){if(void 0!==this.m_textRenderer){this.m_textRenderer.update(),this.m_poiRenderer.update();try{for(var t=i(this.m_textRenderer.fontCatalogs),r=t.next();!r.done;r=t.next()){var n=r.value,o=this.m_textRenderer.getGlyphTextureCacheForFontCatalog(n);if(void 0===o)return void x.error("FontCatalog not used by text renderer: "+n);o.updateBuffer(),o.updateTexture(e)}}catch(e){a={error:e}}finally{try{r&&!r.done&&(s=t.return)&&s.call(t)}finally{if(a)throw a.error}}}var a,s},e.prototype.placeAllTileLabels=function(){this.placeAllLabels()},e.prototype.movementStarted=function(){},e.prototype.movementFinished=function(){this.placeAllLabels()},Object.defineProperty(e.prototype,"debugGlyphTextureCache",{set:function(e){m&&(this.m_debugGlyphTextureCacheMesh.visible=e,this.m_debugGlyphTextureCacheWireMesh.visible=e)},enumerable:!0,configurable:!0}),e.prototype.renderUserTextElements=function(e,t){var r=this,n=new Map,o=this.m_mapView.visibleTileSet.dataSourceTileList,a=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position);o.forEach(function(o){try{for(var s=i(o.visibleTiles),u=s.next();!u.done;u=s.next()){var l=u.value;try{for(var c=i(l.userTextElements),d=c.next();!d.done;d=c.next()){var h=d.value;h.tileCenterX=l.center.x,h.tileCenterY=l.center.y,r.updateViewDistance(a,h)}}catch(e){m={error:e}}finally{try{d&&!d.done&&(y=c.return)&&y.call(c)}finally{if(m)throw m.error}}r.renderTextElements(l.userTextElements,e,t,n)}}catch(e){f={error:e}}finally{try{u&&!u.done&&(p=s.return)&&p.call(s)}finally{if(f)throw f.error}}var f,p,m,y})},e.prototype.renderAllTileText=function(e,t){var r=this,n=new Map,i=this.m_mapView.visibleTileSet.dataSourceTileList;if(0===this.m_lastRenderedTextElements.length)i.forEach(function(i){r.renderTileList(i.renderedTiles,e,t,n,r.m_lastRenderedTextElements,r.m_secondChanceTextElements)});else{var o=this.m_lastRenderedTextElements.concat(this.m_secondChanceTextElements);this.renderTextElements(o,e,t,n)}},e.prototype.renderOverlay=function(e){void 0!==e&&0!==e.length&&this.renderOverlayTextElements(e)},e.prototype.pickTextElements=function(e,t){var r=function(r,n){var i=r;if(void 0!==i){if(void 0!==i.featureId&&!t.some(function(e){return void 0!==e&&n===e.type&&(void 0!==e.featureId&&e.featureId===i.featureId||void 0!==e.userData&&e.userData===i.userData)})){var o={type:n,point:e,distance:0,featureId:i.featureId,userData:i.userData,text:i.text};t.push(o)}}};void 0!==this.m_textRenderer&&this.m_textRenderer.pickTextElements(e,function(e){r(e,c.PickObjectType.Text)}),void 0!==this.m_poiRenderer&&this.m_poiRenderer.pickTextElements(e,function(e){r(e,c.PickObjectType.Icon)})},Object.defineProperty(e.prototype,"loading",{get:function(){if(!this.m_firstGlyphLoaded)return!0;var e,t,r=!1;try{for(var n=i(this.m_fontCatalogs),a=n.next();!a.done;a=n.next()){var s=o(a.value,2),u=(s[0],s[1]);r=r||u.loading}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},enumerable:!0,configurable:!0}),e.prototype.renderOverlayTextElements=function(e){var t=this;if(void 0!==this.m_textRenderer){var r,n,o=-window.innerWidth*window.devicePixelRatio/2,s=window.innerHeight*window.devicePixelRatio/2,c=function(e){var r=d.m_textRenderer.getTextRendererBufferForStyle(e.style);if(void 0===r)return"break";var n=r.textStyle,c=n.fontCatalog,h=r.textBuffer,p=e,m=e.path(),y=!0===n.smallCaps,v=!0===n.allCaps||y,g=e.getCodePoints(v),b=e.convertedToUpperCase,_=g.length,O=void 0!==e.bold?e.bold:!0===r.textStyle.bold,E=void 0!==e.oblique?e.oblique:!0===r.textStyle.oblique,A=r.textStyle.bgMode===a.TextBackgroundModeStrings.Glow?a.TextBackgroundMode.Glow:a.TextBackgroundMode.Outline,I=void 0!==e.tracking?e.tracking:void 0!==r.textStyle.tracking?r.textStyle.tracking:0;if(void 0===h||!h.canAddElements(_)||void 0===c)return"break";var L=d.m_textRenderer.getGlyphTextureCacheForFontCatalog(c.name);if(void 0===L)return x.error("FontCatalog not used by text renderer: "+c.name),{value:void 0};if(!e.allGlyphsLoaded){for(var F=!0,R=0,D=0;D<_;++D){if(void 0===(ue=c.getGlyph(g[D],O))){F=!1;break}d.m_firstGlyphLoaded=!0,R+=ue.advanceX+I}if(!F)return"continue";e.allGlyphsLoaded=!0,e.textWidth=R}if((void 0===m||m.length<=1)&&function(r){var i=r.scale*w;if(j.x=o,j.y=s,void 0!==r.xOffset&&(j.x+=r.xOffset*w),void 0!==r.yOffset&&(j.y-=r.yOffset*w),k.x=j.x,k.y=j.y,_>0){var a=r.color;void 0===a&&(a=void 0!==n.color?l.ColorCache.instance.getColor(n.color):t.m_mapView.defaultTextColor),B.makeScale(i,i,i);for(var u=0;u<_;++u){var d=c.getGlyph(g[u],O);if(void 0!==d){L.add(d.codepoint,O);var f=b[u]&&y?d.metrics.xHeight/d.metrics.capHeight:1;B.setPosition(k),h.addGlyph(d,a,1,0,B,T,!0,e.verticalAlignment,E,1!==f,A,r),k.x+=(d.advanceX+I)*f*i}}}}(e),void 0===m||m.length<=1)return"continue";var U=e.scale*w;P.set(U,U,U);var G=[];try{for(var V=i(m),q=V.next();!q.done;q=V.next()){var N=q.value,z=o+N.x,H=s-N.y;G.push(new u.Vector2(z,H))}}catch(e){oe={error:e}}finally{try{q&&!q.done&&(ae=V.return)&&ae.call(V)}finally{if(oe)throw oe.error}}for(var W=new f.SimplePath,X=0;X<G.length-1;++X)W.add(new f.SimpleLineCurve(G[X],G[X+1]));var Q=W.getLength(),Y=e.textWidth*U,K=void 0,Z=void 0;if(void 0!==p._worldParam&&void 0!==p._index)K=p._index,Z=p._worldParam;else{var J=W.getParamAt(.5);if(null===J)return"continue";K=J.index,Z=J.t*J.t}p._worldParam=Z,p._index=K;var $=W.getLengths(),ee=$[u.Math.clamp(K,0,$.length-1)],te=$[u.Math.clamp(K+1,0,$.length-1)],re=u.Math.clamp(ee*(1-Z)+te*Z,0,1),ne=W.getTangent(re/Q),ie=ne&&ne.x<0?-1:1;ie<0&&(re+=Y);var oe,ae,se=e.renderDistance;for(X=0;X<_;++X){var ue;if(void 0!==(ue=c.getGlyph(g[X],O))){L.add(ue.codepoint,O);var le=b[X]&&y?ue.metrics.xHeight/ue.metrics.capHeight:1,ce=re/Q,de=ce+ie*(ue.width*le*U)/Q,he=W.getPoint(u.Math.clamp(ce,0,1));ne=W.getPoint(u.Math.clamp(de,0,1)).sub(he).normalize(),he.x+=e.xOffset||0,he.y-=e.yOffset||0,M.set(he.x,he.y,0),S.set(ne.x,-ne.y,0,0,ne.y,ne.x,0,0,0,0,1,0,0,0,0,1),S.setPosition(M),S.scale(P),a.FontCatalog.getGlyphCorners(ue,S,T,!0,e.verticalAlignment,E,1!==le),C.setFromPoints(T),h.addGlyph(ue,e.color||d.m_mapView.defaultTextColor,1,se,S,T,!0,e.verticalAlignment,E,1!==le,A,e),re+=ie*(ue.advanceX+I)*U}}},d=this;try{for(var h=i(e),p=h.next();!p.done;p=h.next()){var m=c(p.value);if("object"==typeof m)return m.value;if("break"===m)break}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}}},e.prototype.initTextRenderer=function(){var e;w=window.devicePixelRatio,(void 0===this.m_theme.fontCatalogs||Array.isArray(this.m_theme.fontCatalogs)&&0===this.m_theme.fontCatalogs.length)&&(this.m_theme.fontCatalogs=[{name:a.DEFAULT_FONT_CATALOG_NAME,url:this.m_mapView.defaultFontCatalog}]);var t=this.m_theme.fontCatalogs;if(t.length>0){try{for(var r=i(t),n=r.next();!n.done;n=r.next()){var o=n.value;if(void 0!==o.name){e=o.name;break}}}catch(e){s={error:e}}finally{try{n&&!n.done&&(l=r.return)&&l.call(r)}finally{if(s)throw s.error}}void 0===e&&(e=a.DEFAULT_FONT_CATALOG_NAME,t[0].name=e)}void 0===this.m_theme.textStyles&&(this.m_theme.textStyles=[]);var s,l,c=this.m_theme.textStyles,d=c.find(function(e){return e.name===a.DEFAULT_STYLE_NAME});void 0!==d?this.m_defaultStyle=d:void 0!==this.m_theme.defaultTextStyle?(this.m_defaultStyle=this.m_theme.defaultTextStyle,this.m_defaultStyle.name=a.DEFAULT_STYLE_NAME,c.push(this.m_defaultStyle)):c.length>0?(this.m_defaultStyle=c[0],this.m_defaultStyle.name=a.DEFAULT_STYLE_NAME):c.push(this.m_defaultStyle),this.m_defaultStyle.fontCatalogName=e,void 0!==this.m_defaultStyle.color&&(this.m_mapView.defaultTextColor=new u.Color(this.m_defaultStyle.color)),this.loadThemeFonts(t)},e.prototype.loadThemeFonts=function(e){var t=this;if(void 0!==e){var r=[],n=[];e.forEach(function(e){var i=a.FontCatalog.load(e.url,e.name,function(){t.m_mapView.update()}).then(function(e){t.m_fontCatalogs.set(e.name,e),t.m_mapView.update()}).catch(function(t){n.push(e.name),x.error("failed to load font. ",t)});r.push(i)}),Promise.all(r).then(function(){t.initTextStyles(),t.createTextRenderer()})}},e.prototype.initTextStyles=function(){var e=this;void 0!==this.m_theme&&void 0!==this.m_theme.textStyles&&void 0!==this.m_theme.textStyles.length&&(this.m_theme.textStyles.forEach(function(t){e.m_textStyles.push(n({},t))}),this.assignFontCatalogsToStyles())},e.prototype.assignFontCatalogsToStyles=function(){var e,t,r;this.m_fontCatalogs.forEach(function(t){void 0===e&&(e=t)});try{for(var n=i(this.m_textStyles),o=n.next();!o.done;o=n.next()){var a=o.value;void 0===a.fontCatalog&&(void 0!==a.fontCatalogName&&(a.fontCatalog=this.m_fontCatalogs.get(a.fontCatalogName)),void 0===a.fontCatalog&&(void 0!==a.fontCatalogName&&x.warn("FontCatalog '"+a.fontCatalogName+"' set in TextStyle",a,"not found, using default fontCatalog."),a.fontCatalog=e))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.createTextRenderer=function(){this.m_textRenderer=new a.TextRenderer(this.m_textStyles,this.m_textMaterialConstructor),void 0!==this.debugMesh&&this.m_textRenderer.sceneSet.getScene(a.DEFAULT_TEXT_RENDER_ORDER).add(this.debugMesh),this.m_poiRenderer=new d.PoiRenderer(this.m_mapView,this.m_textRenderer.sceneSet);var e=this.m_textRenderer.getGlyphTextureCacheForFontCatalog(this.m_defaultStyle.fontCatalogName);void 0!==e?(m&&(this.m_debugGlyphTextureCacheMesh.material.map=e.texture,this.m_textRenderer.sceneSet.getScene(a.DEFAULT_TEXT_RENDER_ORDER).add(this.m_debugGlyphTextureCacheMesh,this.m_debugGlyphTextureCacheWireMesh)),this.m_mapView.update()):x.error("FontCatalog not used by text renderer: "+this.m_defaultStyle.fontCatalogName)},e.prototype.updateViewDistance=function(e,t){var r;if(t.points instanceof u.Vector2||t.points instanceof u.Vector3){var n=t.position3;q.x=n.x+t.tileCenterX,q.y=n.y+t.tileCenterY,r=e.distanceTo(q)}else if(Array.isArray(t.points))if(1===t.points.length){var i=t.points[0];q.x=i.x+t.tileCenterX,q.y=i.y+t.tileCenterY,r=e.distanceTo(q)}else if(t.points.length>1){var o=t.points;i=o[0];q.x=i.x+t.tileCenterX,q.y=i.y+t.tileCenterY;var a=e.distanceTo(q);i=o[o.length-1],q.x=i.x+t.tileCenterX,q.y=i.y+t.tileCenterY;var s=e.distanceTo(q);r=Math.min(a,s)}return t.currentViewDistance=r,r},e.prototype.sortTextElements=function(e,t){var r,n;try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value;s.sortPriority=s.priority+.1-s.currentViewDistance/t*.1}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}e.sort(function(e,t){return t.sortPriority-e.sortPriority})},e.prototype.placeAllLabels=function(){var e=this;this.m_mapView.visibleTileSet.dataSourceTileList.forEach(function(t){e.placeTextElements(t.dataSource,t.storageLevel,t.zoomLevel,t.visibleTiles)}),this.m_lastRenderedTextElements.length=0,this.m_secondChanceTextElements.length=0},e.prototype.placeTextElements=function(e,t,r,n){try{for(var o=i(n),a=o.next();!a.done;a=o.next()){var s=a.value;this.prepareUserTextElements(s)}}catch(e){l={error:e}}finally{try{a&&!a.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}var u=[];this.createSortedGroupsForSorting(e,t,n,u);var l,c;this.selectTextElementsToPlaceByDistance(r,u,[])},e.prototype.prepareUserTextElements=function(e){try{for(var t=i(e.userTextElements),r=t.next();!r.done;r=t.next()){var n=r.value;n.tileCenterX=e.center.x,n.tileCenterY=e.center.y}}catch(e){o={error:e}}finally{try{r&&!r.done&&(a=t.return)&&a.call(t)}finally{if(o)throw o.error}}var o,a},e.prototype.createSortedGroupsForSorting=function(e,t,r,n){if(void 0!==this.m_textRenderer&&0!==r.length){var o=[];try{for(var a=i(r),s=a.next();!s.done;s=a.next()){(d=s.value).placedTextElements.clear(),e.shouldRenderText(t,d.tileKey)&&o.push(d)}}catch(e){b={error:e}}finally{try{s&&!s.done&&(_=a.return)&&_.call(a)}finally{if(b)throw b.error}}var u=new Map;try{for(var l=i(o),c=l.next();!c.done;c=l.next()){var d=c.value;try{for(var h=i(d.textElementGroups.groups.values()),f=h.next();!f.done;f=h.next()){var p=f.value;if(0!==p.elements.length){var m=u.get(p.priority);void 0===m?u.set(p.priority,new W(p.priority,[new H(d,p.elements)])):m.textElementLists.push(new H(d,p.elements))}}}catch(e){T={error:e}}finally{try{f&&!f.done&&(S=h.return)&&S.call(h)}finally{if(T)throw T.error}}}}catch(e){x={error:e}}finally{try{c&&!c.done&&(w=l.return)&&w.call(l)}finally{if(x)throw x.error}}if(0!==u.size){try{for(var y=i(u),v=y.next();!v.done;v=y.next()){var g=v.value[1];n.push(g)}}catch(e){O={error:e}}finally{try{v&&!v.done&&(E=y.return)&&E.call(y)}finally{if(O)throw O.error}}var b,_,x,w,T,S,O,E}}},e.prototype.getMaxDistance=function(e){return this.m_mapView.camera.far*e},e.prototype.selectTextElementsToPlaceByDistance=function(e,t,r){t.sort(function(e,t){return t.priority-e.priority});var n,o,a,s,u,l,c=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position),d=this.m_maxDistanceRatioForLabels,h=this.getMaxDistance(d);try{for(var f=i(t),p=f.next();!p.done;p=f.next()){var m=p.value;try{for(var y=i(m.textElementLists),v=y.next();!v.done;v=y.next()){var g=v.value,b=g.tile;try{for(var _=i(g.textElements),x=_.next();!x.done;x=_.next()){var w=x.value;if(!(void 0!==w.minZoomLevel&&e<w.minZoomLevel)){w.tileCenterX=b.center.x,w.tileCenterY=b.center.y;var T=this.updateViewDistance(c,w);void 0!==T&&T>h||b.placedTextElements.add(w)}}}catch(e){u={error:e}}finally{try{x&&!x.done&&(l=_.return)&&l.call(_)}finally{if(u)throw u.error}}}}catch(e){a={error:e}}finally{try{v&&!v.done&&(s=y.return)&&s.call(y)}finally{if(a)throw a.error}}r.push([])}}catch(e){n={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(n)throw n.error}}},e.prototype.renderTextElements=function(e,t,r,n,o,c){var d=this;if(void 0===this.m_textRenderer||void 0===this.m_poiRenderer)return 0;var m,v,g=void 0===o,b=(e.length,this.m_maxNumVisibleLabels),_=this.m_numSecondChanceLabels,M=this.m_labelStartScaleDistance,q=0,H=[],W=this.getMaxDistance(.9),X=this.getMaxDistance(.6),Q=this.m_mapView.cameraIsMoving,Y=this.m_poiRenderer,K=this.m_mapView.camera.near,Z=this.m_mapView.camera.far,J=this.m_mapView.worldCenter.clone().add(this.m_mapView.camera.position),$=!1,ee=function(e){if(!g&&b>=0&&q>=b)return"break";var m=te.m_textRenderer.getTextRendererBufferForStyle(e.style,e.renderOrder);if(void 0===m)return"break";var v=m.textStyle,ee=v.fontCatalog,re=m.textBuffer,ne=e,ie=e.path(),oe=!0===v.smallCaps,ae=!0===v.allCaps||oe,se=e.getCodePoints(ae),ue=e.convertedToUpperCase,le=se.length,ce=void 0!==e.bold?e.bold:!0===m.textStyle.bold,de=void 0!==e.oblique?e.oblique:!0===m.textStyle.oblique,he=m.textStyle.bgMode===a.TextBackgroundModeStrings.Glow?a.TextBackgroundMode.Glow:a.TextBackgroundMode.Outline,fe=void 0!==e.tracking?e.tracking:void 0!==m.textStyle.tracking?m.textStyle.tracking:0;if(void 0===re||!re.canAddElements(le)||void 0===ee)return"break";var pe=te.m_textRenderer.getGlyphTextureCacheForFontCatalog(ee.name);if(void 0===pe)return x.error("FontCatalog not used by text renderer: "+ee.name),{value:-1};if(!e.allGlyphsLoaded){for(var me=!0,ye=0,ve=0;ve<le;++ve){if(void 0===(pt=ee.getGlyph(se[ve],ce))){me=!1;break}te.m_firstGlyphLoaded=!0,ye+=pt.advanceX+fe}if(!me)return"continue";e.allGlyphsLoaded=!0,e.textWidth=ye}var ge=void 0===ie,be=e.isLineMarker,_e=function(n,i,a,s,u){var h=n.scale*w,f=1;R.x=D.x=u.x,R.y=D.y=u.y,void 0!==n.xOffset&&(R.x+=n.xOffset*w),void 0!==n.yOffset&&(R.y+=n.yOffset*w);var p=J.distanceTo(s);if(void 0!==p){var m=(Z-K)*M;(ne=p)>m&&(h*=f=1-(ne-m)/(Z-m)*(1-n.distanceScale)),e.currentViewDistance=p}var g=n.poiInfo,b=!0;if(void 0!==g&&Y.prepareRender(g)){if(!1===g.isValid)return!1;if(!Y.computeScreenBox(g,D,f,d.m_screenCollisions,z))return void 0!==c&&c.length<_&&c.push(n),i.lastFrameNumber=-1,!1;if(b=Y.isSpaceAvailable(d.m_screenCollisions,z))(i.lastFrameNumber<r-1||i.isFadingOut()||i.isFadedOut())&&d.startFadeIn(i,r,t);else{if(!i.isVisible())return!1;!0===g.mayOverlap||i.isFadingOut()||(d.startFadeOut(i,r,t),void 0!==a&&a.isVisible()&&d.startFadeOut(a,r,t))}i.isFading()&&d.updateFading(i,t)}if((!0===n.ignoreDistance||void 0===n.currentViewDistance||n.currentViewDistance<X)&&(void 0===g||!0===g.isValid||!1!==g.iconIsOptional)&&le>0){var x=0;G.x=1/0,G.y=1/0,G.width=-1/0,G.height=-1/0;for(var S=0;S<le;++S){if(void 0!==(ie=ee.getGlyph(se[S],ce))){var O=ue[S]&&oe?ie.metrics.xHeight/ie.metrics.capHeight:1,E=x+ie.offsetX,P=E+ie.width*O,C=0-ie.offsetY+ie.height*O;E<G.x&&(G.x=E),0<G.y&&(G.y=0),P-G.x>G.width&&(G.width=P-G.x),C-G.y>G.height&&(G.height=C-G.y),x+=(ie.advanceX+fe)*O}}var A=G.width*h,I=G.height*h;if(U.x=R.x-A*e.horizontalAlignment,U.y=R.y-I,U.w=A,U.h=2*I,k.x=U.x,k.y=U.y+I,U.x-=4*h,U.y-=2*h,U.w+=8*h,U.h+=4*h,!d.m_screenCollisions.isVisible(U))return void 0!==c&&c.length<_&&c.push(n),0,!1;var L=void 0!==n.poiInfo&&!0===n.poiInfo.textIsOptional,j=void 0!==a&&a.isFadingIn(),F=void 0!==a&&a.isFadingOut(),V=!d.m_screenCollisions.isAllocated(U);if(n.textMayOverlap||V||j||F){if(y&&void 0!==d.m_debugPositions&&void 0!==d.m_debugIndex){var N=d.m_positionCount;d.m_debugPositions.setXY(d.m_positionCount++,U.x,U.y),d.m_debugPositions.setXY(d.m_positionCount++,U.x+U.w,U.y),d.m_debugPositions.setXY(d.m_positionCount++,U.x,U.y+U.h),d.m_debugPositions.setXY(d.m_positionCount++,U.x+U.w,U.y+U.h),d.m_debugIndex.setX(d.m_indexCount++,N),d.m_debugIndex.setX(d.m_indexCount++,N+1),d.m_debugIndex.setX(d.m_indexCount++,N+2),d.m_debugIndex.setX(d.m_indexCount++,N+2),d.m_debugIndex.setX(d.m_indexCount++,N+1),d.m_debugIndex.setX(d.m_indexCount++,N+3)}if(!F&&n.textReservesSpace&&d.m_screenCollisions.allocate(U),(j||F||!Q||void 0===g||!0===g.renderTextDuringMovements)&&!i.isFadedOut()){var H=n.color;void 0===H&&(H=void 0!==v.color?l.ColorCache.instance.getColor(v.color):d.m_mapView.defaultTextColor);var W=!1;!i.isFadingOut()&&V&&b?W=d.checkStartFadeIn(a,r,t,!0):void 0!==a&&a.isFading()&&(d.updateFading(a,t),W=!0),$=$||F||W;var te=void 0!==a?a.opacity:i.opacity,ne=n.renderDistance;B.makeScale(h,h,h);for(S=0;S<le;++S){var ie;if(void 0!==(ie=ee.getGlyph(se[S],ce))){pe.add(ie.codepoint,ce);O=ue[S]&&oe?ie.metrics.xHeight/ie.metrics.capHeight:1;B.setPosition(k),re.addGlyph(ie,H,te,ne,B,T,!0,e.verticalAlignment,de,1!==O,he,n),k.x+=(ie.advanceX+fe)*O*h}}void 0!==a&&(a.lastFrameNumber=r)}0}else if(L){if(void 0!==a&&a.isVisible()){ae=d.checkStartFadeOut(a,r,t);$=$||ae}}else{if(void 0!==n.poiInfo&&!i.isVisible())return void 0!==c&&c.length<_&&c.push(n),0,!1;if(void 0!==n.poiInfo&&d.startFadeOut(i,r,t),void 0!==a&&a.isVisible()){var ae=d.checkStartFadeOut(a,r,t);$=$||ae}}}if(void 0!==g&&Y.poiIsRenderable(g)){var me=d.checkStartFadeIn(i,r,t);$=$||me,Y.renderPoi(g,D,d.m_screenCollisions,f,!1!==g.reserveSpace,i.opacity),i.lastFrameNumber=r,0}return q++,void 0!==o&&o.push(n),!0};if(ge)return L.x=e.position.x+e.tileCenterX,L.y=e.position.y+e.tileCenterY,L.z=0,void 0!==te.m_screenProjector.project(L,F)&&(void 0===e.iconRenderState&&(e.iconRenderState=new p.RenderState,te.startFadeIn(e.iconRenderState,r,t),e.textRenderState=new p.RenderState,te.startFadeIn(e.textRenderState,r,t)),_e(e,e.iconRenderState,e.textRenderState,L,F)),"continue";if(be){var xe=e.poiInfo;if(void 0===ie||0===ie.length||!Y.prepareRender(xe))return"continue";var we=xe.technique,Te=void 0!==we.minDistance?we.minDistance*we.minDistance:0,Se=void 0;if(void 0!==xe.shieldGroupIndex&&void 0===(Se=H[xe.shieldGroupIndex])&&(Se=[],H[xe.shieldGroupIndex]=Se),void 0===e.iconRenderStates){var Oe=new Array;ie.forEach(function(){var e=new p.RenderState;e.state=p.FadingState.FadingIn,Oe.push(e)}),e.iconRenderStates=Oe}if(Te>0&&void 0!==Se)for(var Ee=0;Ee<ie.length;Ee++){var Pe=ie[Ee];if(!re.canAddElements(le))break;if(L.x=Pe.x+e.tileCenterX,L.y=Pe.y+e.tileCenterY,L.z=0,void 0!==te.m_screenProjector.project(L,j)){var Ce=!1;for(ve=0;ve<Se.length;ve+=2){if(Ce=s.Math2D.distSquared(Se[ve],Se[ve+1],j.x,j.y)<Te)break}Ce||_e(e,e.iconRenderStates[Ee],void 0,L,j)&&Se.push(j.x,j.y)}}else{if(!re.canAddElements(ie.length*le))return"break";for(Ee=0;Ee<ie.length;Ee++){Pe=ie[Ee];L.x=Pe.x+e.tileCenterX,L.y=Pe.y+e.tileCenterY,L.z=0,void 0!==te.m_screenProjector.project(L,j)&&_e(e,e.iconRenderStates[Ee],void 0,L,j)}}return"continue"}if(void 0===ie||0===ie.length)return"continue";if(!(!0===e.ignoreDistance||void 0===e.currentViewDistance||e.currentViewDistance<W))return"continue";var Ae=e.scale*w;P.set(Ae,Ae,Ae);var Ie=[],Me=!1,Le=ie[0].clone(),je=e.tileCenterX,Fe=e.tileCenterY;Le.x+=je,Le.y+=Fe;var Re=n.get(e.text);if(void 0===Re)n.set(e.text,[Le]);else{var De=!1;try{for(var Be=i(Re),Ue=Be.next();!Ue.done;Ue=Be.next()){var ke=Ue.value;if(Math.abs(ke.x-Le.x)<.001&&Math.abs(ke.y-Le.y)<.001){De=!0;break}}}catch(e){lt={error:e}}finally{try{Ue&&!Ue.done&&(ct=Be.return)&&ct.call(Be)}finally{if(lt)throw lt.error}}if(De)return"continue";Re.push(Le)}try{for(var Ge=i(ie),Ve=Ge.next();!Ve.done;Ve=Ge.next()){ke=Ve.value;I.set(ke.x+je,ke.y+Fe,0);var qe=te.m_screenProjector.project(I);if(void 0===qe){Me=!0;break}Ie.push(qe)}}catch(e){dt={error:e}}finally{try{Ve&&!Ve.done&&(ht=Ge.return)&&ht.call(Ge)}finally{if(dt)throw dt.error}}if(Me)return"continue";if(-1===Ie.findIndex(function(e){return!!d.m_screenCollisions.screenBounds.contains(e.x,e.y)}))return 0,"continue";var Ne=new f.SimplePath;for(Ee=0;Ee<Ie.length-1;++Ee)Ne.add(new f.SimpleLineCurve(Ie[Ee],Ie[Ee+1]));var ze=Ne.getLength(),He=e.textWidth*Ae;if(He>ze)return 0,"continue";var We=.5,Xe=void 0,Qe=void 0;if(void 0!==ne._worldParam&&void 0!==ne._index){Xe=ne._index,Qe=ne._worldParam,N.set(ie[Xe].x+je,ie[Xe].y+Fe,0,1),te.m_screenProjector.projectVector(N);var Ye=N.w;N.set(ie[Xe+1].x+je,ie[Xe+1].y+Fe,0,1),te.m_screenProjector.projectVector(N),We=Qe*(Ze=N.w)/(Ye+(Ze-Ye)/Qe)}else{var Ke=Ne.getParamAt(We);if(null===Ke)return 0,"continue";Xe=Ke.index,N.set(ie[Ke.index].x+je,ie[Ke.index].y+Fe,0,1),te.m_screenProjector.projectVector(N);Ye=N.w;N.set(ie[Ke.index+1].x+je,ie[Ke.index+1].y+Fe,0,1),te.m_screenProjector.projectVector(N);var Ze=N.w;Qe=Ke.t*Ye/(Ze+(Ye-Ze)/Ke.t)}ne._worldParam=Qe,ne._index=Xe;var Je=Ne.getLengths(),$e=Je[u.Math.clamp(Xe,0,Je.length-1)]*(1-Qe)+Je[u.Math.clamp(Xe+1,0,Je.length-1)]*Qe;if($e>ze)return 0,"continue";var et=!0,tt=!1,rt=void 0,nt=re.saveState();V.makeEmpty();var it=Ne.getTangent($e/ze),ot=it&&it.x<0?-1:1;ot<0&&($e+=He);var at=1;void 0===e.textRenderState&&(e.textRenderState=new p.RenderState);var st=e.textRenderState;(st.state===p.FadingState.Undefined||st.lastFrameNumber<r-1)&&te.startFadeIn(st,r,t);var ut=te.checkStartFadeIn(st,r,t);$=$||ut,st.isFading()&&(at=st.opacity);var lt,ct,dt,ht,ft=e.renderDistance;for(Ee=0;Ee<le;++Ee){var pt;if(void 0!==(pt=ee.getGlyph(se[Ee],ce))){pe.add(pt.codepoint,ce);var mt=ue[Ee]&&oe?pt.metrics.xHeight/pt.metrics.capHeight:1,yt=$e/ze,vt=yt+ot*(pt.width*mt*Ae)/ze;if(yt<0||yt>1||vt<0||vt>1)et=!1,0;else{var gt=Ne.getPoint(yt);if(it=Ne.getPoint(vt).sub(gt).normalize(),void 0!==rt){var bt=Math.atan2(rt.x*it.y-it.x*rt.y,it.dot(rt));if(Math.abs(bt)>Math.PI/8){et=!1,0;break}}if(rt=it,O.set(it.x,-it.y,0,0,it.y,it.x,0,0,0,0,1,0,0,0,0,1),gt.x+=e.xOffset||0,gt.y-=e.yOffset||0,E.makeTranslation(gt.x,gt.y,0),S.multiplyMatrices(E,O).scale(P),a.FontCatalog.getGlyphCorners(pt,S,T,!0,e.verticalAlignment,de,1!==mt),C.setFromPoints(T),h.ScreenCollisions.toBox2D(C,A),!te.m_screenCollisions.isVisible(A)||!e.textMayOverlap&&te.m_screenCollisions.isAllocated(A)){et=!1,tt=!0,0;break}if(V.union(C),!re.addGlyph(pt,e.color||te.m_mapView.defaultTextColor,at,ft,S,T,!0,e.verticalAlignment,de,1!==mt,he,e)){et=!1,0;break}$e+=ot*(pt.advanceX+fe)*mt*Ae}}}if(!et)return re.restoreState(nt),tt&&void 0!==c&&c.length<te.m_numSecondChanceLabels&&c.push(e),"continue";if(e.textReservesSpace&&(h.ScreenCollisions.toBox2D(V,A),te.m_screenCollisions.allocate(A)),void 0!==o&&o.push(e),q++,y&&void 0!==te.m_debugPositions&&void 0!==te.m_debugIndex){var _t=te.m_positionCount;te.m_debugPositions.setXY(te.m_positionCount++,V.min.x,V.min.y),te.m_debugPositions.setXY(te.m_positionCount++,V.max.x,V.min.y),te.m_debugPositions.setXY(te.m_positionCount++,V.min.x,V.max.y),te.m_debugPositions.setXY(te.m_positionCount++,V.max.x,V.max.y),te.m_debugIndex.setX(te.m_indexCount++,_t),te.m_debugIndex.setX(te.m_indexCount++,_t+1),te.m_debugIndex.setX(te.m_indexCount++,_t+2),te.m_debugIndex.setX(te.m_indexCount++,_t+2),te.m_debugIndex.setX(te.m_indexCount++,_t+1),te.m_debugIndex.setX(te.m_indexCount++,_t+3)}},te=this;try{for(var re=i(e),ne=re.next();!ne.done;ne=re.next()){var ie=ee(ne.value);if("object"==typeof ie)return ie.value;if("break"===ie)break}}catch(e){m={error:e}}finally{try{ne&&!ne.done&&(v=re.return)&&v.call(re)}finally{if(m)throw m.error}}return $&&this.m_mapView.update(),q},e.prototype.renderTileList=function(e,t,r,n,o,a){if(void 0!==this.m_textRenderer&&0!==e.length){var u=new s.GroupedPriorityList;try{for(var l=i(e),c=l.next();!c.done;c=l.next()){var d=c.value;u.merge(d.placedTextElements)}}catch(e){h={error:e}}finally{try{c&&!c.done&&(f=l.return)&&f.call(l)}finally{if(h)throw h.error}}var h,f,p,m,y=this.m_mapView.camera.far*this.m_mapView.camera.far,v=this.m_maxNumVisibleLabels,g=0;try{for(var b=i(u.sortedGroups),_=b.next();!_.done;_=b.next()){var x=_.value.elements;if(this.sortTextElements(x,y),(g+=this.renderTextElements(x,t,r,n,o,a))>v)break}}catch(e){p={error:e}}finally{try{_&&!_.done&&(m=b.return)&&m.call(b)}finally{if(p)throw p.error}}}},e.prototype.checkStartFadeIn=function(e,t,r,n){void 0===n&&(n=!1);var i=!1;return void 0!==e&&((n||e.state===p.FadingState.Undefined||e.lastFrameNumber<t-1)&&this.startFadeIn(e,t,r),e.isFading()&&(this.updateFading(e,r),i=!0),e.lastFrameNumber=t),i},e.prototype.checkStartFadeOut=function(e,t,r,n){void 0===n&&(n=!0);var i=!1;return void 0!==e&&((n||e.state===p.FadingState.Undefined||e.lastFrameNumber<t-1)&&this.startFadeOut(e,t,r),e.isFading()&&(this.updateFading(e,r),i=!0),e.lastFrameNumber=t),i},e.prototype.startFadeIn=function(e,t,r){e.lastFrameNumber<t-1&&e.reset(),e.state!==p.FadingState.FadingIn&&e.state!==p.FadingState.FadedIn&&(e.state===p.FadingState.FadingOut?(e.value=1-e.value,e.startTime=r-e.value*e.fadingTime):(e.startTime=r,e.value=0,e.opacity=0),e.state=p.FadingState.FadingIn)},e.prototype.startFadeOut=function(e,t,r){e.lastFrameNumber<t-1&&e.reset(),e.state!==p.FadingState.FadingOut&&e.state!==p.FadingState.FadedOut&&(e.state===p.FadingState.FadingIn?(e.startTime=r-e.value*e.fadingTime,e.value=1-e.value):(e.startTime=r,e.value=0,e.opacity=1),e.state=p.FadingState.FadingOut)},e.prototype.updateFading=function(e,t){if(e.state===p.FadingState.FadingIn||e.state===p.FadingState.FadingOut){0===e.startTime&&(e.startTime=t);var r=t-e.startTime,n=e.state===p.FadingState.FadingIn?0:1,i=e.state===p.FadingState.FadingIn?1:0;r>=e.fadingTime?(e.value=1,e.opacity=i,e.state=e.state===p.FadingState.FadingIn?p.FadingState.FadedIn:p.FadingState.FadedOut):(e.value=r/e.fadingTime,e.opacity=s.MathUtils.clamp(s.MathUtils.smootherStep(n,i,e.value),0,1))}},e}();t.TextElementsRenderer=X},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o,a=r(2),s=r(0),u=r(68);!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(o=t.PickObjectType||(t.PickObjectType={}));var l=function(){function e(e,t){void 0===t&&(t=!0),this.mapView=e,this.enableRoadPicking=t,this.m_rayCaster=new s.Raycaster,this.m_plane=new s.Plane(new s.Vector3(0,0,1)),t&&(this.m_roadPicker=new u.RoadPicker)}return e.prototype.registerTile=function(e){return void 0!==this.m_roadPicker?this.m_roadPicker.registerTile(e):void 0},e.prototype.intersectMapObjects=function(e,t){var r=this,n=this.mapView.getNormalizedScreenCoordinates(e,t),u=this.m_rayCaster,l=[];if(void 0!==this.mapView.textElementsRenderer){var c=this.mapView.canvas,d=c.clientWidth,h=c.clientHeight,f=n.x*d*.5*devicePixelRatio,p=n.y*h*.5*devicePixelRatio,m=new s.Vector2(f,p);this.mapView.textElementsRenderer.pickTextElements(m,l)}u.setFromCamera(n,this.mapView.camera),u.linePrecision=1;var y,v,g=u.intersectObjects(this.mapView.worldRootObject.children,!0);try{for(var b=i(g),_=b.next();!_.done;_=b.next()){var x=_.value,w={type:o.Unspecified,point:x.point,distance:x.distance,intersection:x};if(void 0!==x.object.userData){var T=void 0!==x.object.userData?x.object.userData.feature:void 0;if(void 0===T){l.push(w);continue}if(this.addObjInfo(T,x),void 0!==T.ids){var S=1===T.ids.length?T.ids[0]:void 0;w.featureId=S}var O=void 0;switch(T.geometryType){case a.GeometryType.Point:case a.GeometryType.Text:O=o.Point;break;case a.GeometryType.Line:case a.GeometryType.ExtrudedLine:case a.GeometryType.SolidLine:case a.GeometryType.TextPath:O=o.Line;break;case a.GeometryType.Polygon:case a.GeometryType.ExtrudedPolygon:O=o.Area;break;case a.GeometryType.Object3D:O=o.Object3D;break;default:O=o.Unspecified}w.type=O,l.push(w)}}}catch(e){y={error:e}}finally{try{_&&!_.done&&(v=b.return)&&v.call(b)}finally{if(y)throw y.error}}if(this.enableRoadPicking){var E=new s.Vector3;u.ray.intersectPlane(this.m_plane,E),E.add(this.mapView.worldCenter);var P=this.mapView.worldCenter.clone().add(this.mapView.camera.position);this.mapView.forEachVisibleTile(function(e){r.m_roadPicker.intersectRoads(e,P,E,l)})}return l.sort(function(e,t){return e.distance-t.distance}),l},e.prototype.addObjInfo=function(e,t){var r,o;if(void 0!==e.objInfos&&void 0!==e.starts&&void 0!==t.faceIndex)if(e.starts.length>1){var a=0;try{for(var s=i(e.starts),u=s.next();!u.done;u=s.next()){if(u.value>t.faceIndex)break;a++}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}t.object.userData.objInfo=n({},e.objInfos[a-1])}else t.object.userData.objInfo=n({},e.objInfos[0])},e}();t.PickHandler=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),i=r(6),o=r(10),a=r(13),s=function(){function e(){}return e.clamp=function(e,t,r){return Math.min(Math.max(t,e),r)},e.latitudeClamp=function(t){return e.clamp(t,-e.MAXIMUM_LATITUDE,e.MAXIMUM_LATITUDE)},e.latitudeProject=function(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI},e.latitudeClampProject=function(t){return e.latitudeProject(e.latitudeClamp(t))},e.unprojectLatitude=function(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI},e.prototype.getScaleFactor=function(e){return Math.cosh(2*Math.PI*(e.y/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5))},e.prototype.worldExtent=function(e,t,r){return r||(r=o.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r.max.y=a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r.max.z=t,r},e.prototype.projectPoint=function(t,r){var n;return n=t instanceof i.GeoCoordinates?t.normalized():new i.GeoCoordinates(t.latitude,t.longitude,t.altitude).normalized(),r||(r={x:0,y:0,z:0}),r.x=(n.longitude+180)/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r.y=(.5*e.latitudeClampProject(n.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,r.z=t.altitude||0,r},e.prototype.unprojectPoint=function(t){return i.GeoCoordinates.fromRadians(e.unprojectLatitude(2*(t.y/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5)),t.x/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE*2*Math.PI-Math.PI,t.z)},e.prototype.projectBox=function(t,r){var n=t.center,s=this.projectPoint(new i.GeoCoordinates(n.latitude,n.longitude,0)),u=(.5*e.latitudeClampProject(t.northEast.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,l=(.5*e.latitudeClampProject(t.southWest.latitudeInRadians)+.5)*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,c=.5*(u+l);s.y=c;var d=u-l,h=t.longitudeSpan/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE;r||(r=o.MathUtils.newEmptyBox3()),r.min.x=s.x-.5*h,r.min.y=s.y-.5*d,r.max.x=s.x+.5*h,r.max.y=s.y+.5*d;var f=t.altitudeSpan;return void 0!==f?(r.min.z=s.z-.5*f,r.max.z=s.z+.5*f):(r.min.z=0,r.max.z=0),r},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,r)},e.MAXIMUM_LATITUDE=1.4844222297453322,e}();t.MercatorProjection=s,t.mercatorProjection=new s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.getSubdivisionX=function(){return 2},e.prototype.getSubdivisionY=function(){return 2},e.prototype.getLevelDimensionX=function(e){return 1<<e},e.prototype.getLevelDimensionY=function(e){return 1<<e},e}();t.quadTreeSubdivisionScheme=new n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={project_line_vert_func:"\nvoid projectVertex(vec2 segment, vec2 t0, vec2 t1, float lineWidth, inout vec2 pos, inout vec2 uv) {\n        float uu = uv.x / 2.0 + 0.5;\n        float ss = mix(segment.x, segment.y, uu);\n\n        if (t0 != t1) {\n            float angle = atan(t0.x * t1.y - t0.y * t1.x, t0.x * t1.x + t0.y * t1.y);\n            vec2 t = normalize(t0 + t1);\n            vec2 n = vec2(t.y, -t.x);\n            pos += uv.y * lineWidth * n / cos(angle / 2.0);\n            uv.x = ss + uv.x * lineWidth * uv.y * tan(angle / 2.0);\n        }\n        else {\n            vec2 n = vec2(t0.y, -t0.x);\n            pos += uv.y * lineWidth * n + uv.x * lineWidth * mix(t0, t1, uu);\n            uv.x = ss + uv.x * lineWidth;\n        }\n}\n",join_dist_func:"\nfloat joinDist(vec2 segment, vec2 texcoord) {\n    float d = abs(texcoord.y);\n    float dx = texcoord.x;\n    if (dx < segment.x) {\n        d = max(d, length(texcoord - vec2(segment.x, 0.0)));\n    } else if (dx > segment.y) {\n        d = max(d, length(texcoord - vec2(segment.y, 0.0)));\n    }\n    return d;\n}\n",tile_clip_func:"\nvoid tileClip(vec2 tilePos, vec2 tileSize) {\n    if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n        discard;\n    if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n        discard;\n}\n",high_precision_vert2D_func:"\nvec2 subtractDblEyePos( const in vec2 pos ) {\n    vec2 t1 = positionLow - u_eyepos_lowpart.xy;\n    vec2 e = t1 - positionLow.xy;\n    vec2 t2 = ((-u_eyepos_lowpart.xy - e) + (positionLow.xy - (t1 - e))) + pos - u_eyepos.xy;\n    vec2 high_delta = t1 + t2;\n    vec2 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n",high_precision_vert3D_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=r(0),u=a.LoggerManager.instance.create("Theme"),l=function(){function e(){}return e.prototype.lookup=function(e){},e.prototype.unmap=function(){return{}},e}();t.Env=l;var c=function(e){function t(t,r,n){var i=e.call(this)||this;return i.name=t,i.value=r,i.parent=n,i}return n(t,e),t.prototype.lookup=function(e){return e===this.name?this.value:this.parent?this.parent.lookup(e):void 0},t.prototype.unmap=function(){var e=this.parent?this.parent.unmap():{};return e[this.name]=this.value,e},t}(l);t.Bind=c,t.EmptyEnv={lookup:function(e){},unmap:function(){return{}}};var d=function(e){function t(t,r){var n=e.call(this)||this;return n.entries=t,n.parent=r,n}return n(t,e),t.prototype.lookup=function(e){var t=this.entries[e];return void 0!==t?t:this.parent?this.parent.lookup(e):void 0},t.prototype.unmap=function(){var e=this.parent?this.parent.unmap():{};for(var t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e},t}(l);t.MapEnv=d;var h=function(){function e(e){this.kind=e}return e.parse=function(e){return new M(e).parse()},e}();t.Expr=h;var f,p,m=function(e){function t(t){var r=e.call(this,"var")||this;return r.name=t,r}return n(t,e),t.prototype.evaluate=function(e){return e.lookup(this.name)},t}(h),y=function(e){function t(t){var r=e.call(this,"number")||this;return r.value=t,r}return n(t,e),t.prototype.evaluate=function(){return this.value},t}(h),v=function(e){function t(t){var r=e.call(this,"string")||this;return r.value=t,r}return n(t,e),t.prototype.evaluate=function(){return this.value},t}(h),g=function(e){function t(t){var r=e.call(this,"has")||this;return r.attribute=t,r}return n(t,e),t.prototype.evaluate=function(e){return void 0!==e.lookup(this.attribute)},t}(h),b=function(e){function t(t,r){var n=e.call(this,"in")||this;return n.value=t,n.elements=r,n}return n(t,e),t.prototype.evaluate=function(e){var t,r,n=this.value.evaluate(e);try{for(var o=i(this.elements),a=o.next();!a.done;a=o.next()){if(n===a.value.evaluate(e))return!0}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return!1},t}(h),_=function(e){function t(t){var r=e.call(this,"!")||this;return r.expr=t,r}return n(t,e),t.prototype.evaluate=function(e){return!this.expr.evaluate(e)},t}(h),x=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.op=t,i.left=r,i.right=n,i}return n(t,e),t.prototype.evaluate=function(e){var t=this.left.evaluate(e),r=this.right.evaluate(e);switch(this.op){case"~=":return"string"==typeof t&&"string"==typeof r&&-1!==t.indexOf(r);case"^=":return"string"==typeof t&&"string"==typeof r&&t.startsWith(r);case"$=":return"string"==typeof t&&"string"==typeof r&&t.endsWith(r);case"==":return t===r;case"!=":return t!==r;case"<":return void 0!==t&&void 0!==r?t<r:void 0;case">":return void 0!==t&&void 0!==r?t>r:void 0;case"<=":return void 0!==t&&void 0!==r?t<=r:void 0;case">=":return void 0!==t&&void 0!==r?t>=r:void 0}throw new Error("invalid relational op "+this.op)},t}(h),w=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.op=t,i.left=r,i.right=n,i}return n(t,e),t.prototype.evaluate=function(e){var t=this.left.evaluate(e);switch(this.op){case"||":return t||this.right.evaluate(e);case"&&":return t&&this.right.evaluate(e)}throw new Error("invalid logical op "+this.op)},t}(h);function T(e){switch(e){case f.Tab:case f.Lf:case f.Cr:case f.Space:return!0;default:return!1}}function S(e){return e>=f._0&&e<=f._9}function O(e){return e>=f.a&&e<=f.z||e>=f.A&&e<=f.Z}function E(e){return function(e){return O(e)||S(e)}(e)||e===f._||e===f.Dollar}function P(e){switch(e){case p.Eof:return"eof";case p.Error:return"error";case p.Identifier:return"identifier";case p.Number:return"number";case p.String:return"string";case p.Comma:return",";case p.LParen:return"(";case p.RParen:return")";case p.LBracket:return"[";case p.RBracket:return"]";case p.Exclaim:return"!";case p.TildeEqual:return"~=";case p.CaretEqual:return"^=";case p.DollarEqual:return"$=";case p.EqualEqual:return"==";case p.ExclaimEqual:return"!=";case p.Less:return"<";case p.Greater:return">";case p.LessEqual:return"<=";case p.GreaterEqual:return">=";case p.BarBar:return"||";case p.AmpAmp:return"&&";default:throw new Error("invalid token "+e)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(f||(f={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(p||(p={}));var C=function(){function e(e){this.code=e,this.m_token=p.Error,this.m_index=0,this.m_char=f.Lf}return e.prototype.token=function(){return this.m_token},e.prototype.text=function(){return this.m_text||""},e.prototype.next=function(){if(this.m_token=this.yylex(),this.m_token===p.Error)throw new Error("unexpected character "+this.m_char);return this.m_token},e.prototype.yyinp=function(){this.m_char=this.code.codePointAt(this.m_index++)||0},e.prototype.yylex=function(){for(this.m_text=void 0;T(this.m_char);)this.yyinp();if(0===this.m_char)return p.Eof;var e=this.m_char;switch(this.yyinp(),e){case f.LParen:return p.LParen;case f.RParen:return p.RParen;case f.LBracket:return p.LBracket;case f.RBracket:return p.RBracket;case f.Comma:return p.Comma;case f.SingleQuote:case f.DoubleQuote:for(var t=this.m_index-1;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),p.String;case f.Exclaim:return this.m_char===f.Equal?(this.yyinp(),p.ExclaimEqual):p.Exclaim;case f.Caret:return this.m_char===f.Equal?(this.yyinp(),p.CaretEqual):p.Error;case f.Tilde:return this.m_char===f.Equal?(this.yyinp(),p.TildeEqual):p.Error;case f.Equal:return this.m_char===f.Equal?(this.yyinp(),p.EqualEqual):p.Error;case f.Less:return this.m_char===f.Equal?(this.yyinp(),p.LessEqual):p.Less;case f.Greater:return this.m_char===f.Equal?(this.yyinp(),p.GreaterEqual):p.Greater;case f.Bar:return this.m_char===f.Bar?(this.yyinp(),p.BarBar):p.Error;case f.Amp:return this.m_char===f.Amp?(this.yyinp(),p.AmpAmp):p.Error;default:t=this.m_index-2;if(O(e)||e===f._||e===f.Dollar&&E(this.m_char)){for(;E(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),p.Identifier}if(S(e)){for(;S(this.m_char);)this.yyinp();if(this.m_char===f.Dot)for(this.yyinp();S(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),p.Number}if(e===f.Dollar)return this.m_char===f.Equal?(this.yyinp(),p.DollarEqual):p.Error}return p.Error},e}();function A(e){switch(e){case p.TildeEqual:return"~=";case p.CaretEqual:return"^=";case p.DollarEqual:return"$=";case p.EqualEqual:return"==";case p.ExclaimEqual:return"!=";default:return}}function I(e){switch(e){case p.Less:return"<";case p.Greater:return">";case p.LessEqual:return"<=";case p.GreaterEqual:return">=";default:return}}var M=function(){function e(e){this.lex=new C(e),this.lex.next()}return e.prototype.parse=function(){return this.parseLogicalOr()},e.prototype.yyexpect=function(e){if(this.lex.token()!==e)throw new Error("Syntax error: Expected token '"+P(e)+"' but found '"+P(this.lex.token())+"'");this.lex.next()},e.prototype.parsePrimary=function(){switch(this.lex.token()){case p.Identifier:var e=this.lex.text();if("has"!==e){var t=new m(e);return this.lex.next(),t}this.lex.next(),this.yyexpect(p.LParen);var r=this.lex.text();return this.yyexpect(p.Identifier),this.yyexpect(p.RParen),new g(r);case p.Number:t=new y(parseFloat(this.lex.text()));return this.lex.next(),t;case p.String:t=new v(this.lex.text());return this.lex.next(),t;case p.LParen:this.lex.next();t=this.parseLogicalOr();return this.yyexpect(p.RParen),t}throw new Error("Syntax error")},e.prototype.parseUnary=function(){return this.lex.token()===p.Exclaim?(this.lex.next(),new _(this.parseUnary())):this.parsePrimary()},e.prototype.parseRelational=function(){for(var e=this.parseUnary();;)if(this.lex.token()===p.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(p.LBracket);for(var t=[this.parsePrimary()];this.lex.token()===p.Comma;)this.lex.next(),t.push(this.parsePrimary());this.yyexpect(p.RBracket),e=new b(e,t)}else{var r=I(this.lex.token());if(void 0===r)break;this.lex.next();var n=this.parseUnary();e=new x(r,e,n)}return e},e.prototype.parseEquality=function(){for(var e=this.parseRelational();;){var t=A(this.lex.token());if(void 0===t)break;this.lex.next();var r=this.parseRelational();e=new x(t,e,r)}return e},e.prototype.parseLogicalAnd=function(){for(var e=this.parseEquality();this.lex.token()===p.AmpAmp;){this.lex.next();var t=this.parseEquality();e=new w("&&",e,t)}return e},e.prototype.parseLogicalOr=function(){for(var e=this.parseLogicalAnd();this.lex.token()===p.BarBar;){this.lex.next();var t=this.parseLogicalAnd();e=new w("||",e,t)}return e},e}();t.createLight=function(e){switch(e.type){case"ambient":return(t=new s.AmbientLight(e.color,e.intensity)).name=e.name,t;case"directional":var t;return(t=new s.DirectionalLight(e.color,e.intensity)).name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.position.set(e.direction.x,e.direction.y,e.direction.z),t.position.normalize(),t}};var L=function(){function e(e,t,r){var n=this;this.theme=e,this.dataSourceName=t,this.validate=r,this.m_renderOrderBiasGroups=new Map,this.m_techniques=new Array;var a=0,s=function(e){if(void 0!==e.renderOrderBiasGroup){var t=e.renderOrderBiasGroup?n.m_renderOrderBiasGroups.get(e.renderOrderBiasGroup):void 0;if(void 0!==e.renderOrderBiasRange&&void 0===t){void 0!==e.renderOrder&&u.warn("WARN: style.renderOrder will be overriden if renderOrderBiasGroup is set:",e);var r=o(e.renderOrderBiasRange,2),l=r[0],c=r[1];e.renderOrder=l<0?a+Math.abs(l):a,a+=Math.abs(l)+c,e.renderOrderBiasGroup&&n.m_renderOrderBiasGroups.set(e.renderOrderBiasGroup,e.renderOrder),a++}else t&&(void 0!==e.renderOrder&&u.warn("WARN: style.renderOrder will be overriden if renderOrderBiasGroup is set:",e),e.renderOrder=t)}if(void 0!==e.styles){n.validate&&(Array.isArray(e.styles)||u.error("ERROR: style.styles must be an Array:",e));try{for(var d=i(e.styles),h=d.next();!h.done;h=d.next()){var f=h.value;s(f)}}catch(e){p={error:e}}finally{try{h&&!h.done&&(m=d.return)&&m.call(d)}finally{if(p)throw p.error}}}else void 0!==e.technique&&void 0!==e.attr&&void 0===e.attr.renderOrder&&(e.attr._renderOrderAuto=a++);var p,m};e.styles.forEach(function(e){void 0!==e&&s(e)})}return e.prototype.getMatchingTechniques=function(e){var t,r,n=[],o=new Array;try{for(var a=i(this.theme.styles),s=a.next();!s.done;s=a.next()){var u=s.value;if(this.validate&&0!==o.length)throw new Error("Internal error: sytle stack cleanup failed");if(this.processStyle(e,o,u,n))break}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n},e.prototype.checkAddTechnique=function(e,t){var r=void 0===e._index?-1:e._index;return r<0?(t._index=r=this.m_techniques.length,this.m_techniques.push(t),e._index=r):t._index=r,r},Object.defineProperty(e.prototype,"techniques",{get:function(){return this.m_techniques},enumerable:!0,configurable:!0}),e.prototype.cleanupStyle=function(e,t){return"styles"===e?"[...]":e.startsWith("_")?void 0:t},e.prototype.processStyle=function(e,t,r,n){var o,a,s,l,c=this;if(void 0!==r.dataSource&&void 0!==this.dataSourceName&&r.dataSource!==this.dataSourceName)return!1;if(void 0!==r.when&&(void 0===r._whenExpr&&(r._whenExpr=h.parse(r.when)),!r._whenExpr.evaluate(e)))return!1;if(void 0!==r.styles){if(r.debug&&u.log("\n======== style group =========\nenv:",JSON.stringify(e.unmap(),void 0,2),"\nstyle group:",JSON.stringify(r,this.cleanupStyle,2)),t.push(r),this.validate&&!Array.isArray(r.styles))return u.error("ERROR: style.styles must be an Array:",r),t.pop(),!1;try{for(var d=i(r.styles),f=d.next();!f.done;f=d.next()){var p=f.value;if(this.processStyle(e,t,p,n))return t.pop(),!0}}catch(e){o={error:e}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}t.pop()}else{if(void 0!==r.technique){if(void 0===r._index){var m={};m.name=r.technique;var y=function(e){void 0!==e.renderOrder&&(m.renderOrder=e.renderOrder),void 0!==e.transient&&(m.transient=e.transient),void 0!==e.renderOrderBiasProperty&&(m.renderOrderBiasProperty=e.renderOrderBiasProperty),void 0!==e.renderOrderBiasRange&&(m.renderOrderBiasRange=e.renderOrderBiasRange),void 0!==e.renderOrderBiasGroup&&(m.renderOrderBiasGroup=e.renderOrderBiasGroup),void 0!==e.attr&&Object.getOwnPropertyNames(e.attr).forEach(function(t){c.validate&&("technique"===t?u.warn("WARNING: technique defined in attr (deprecated):",e):"renderOrder"===t&&u.warn("WARNING: renderOrder defined in attr (deprecated):",e)),void 0!==e.attr&&(m[t]=e.attr[t])})};try{for(var v=i(t),g=v.next();!g.done;g=v.next()){y(p=g.value)}}catch(e){s={error:e}}finally{try{g&&!g.done&&(l=v.return)&&l.call(v)}finally{if(s)throw s.error}}y(r),this.checkAddTechnique(r,m),n.push(m),r.debug&&u.log("\n======== style w/ technique =========\nenv:",JSON.stringify(e.unmap(),void 0,2),"\nstyle:",JSON.stringify(r,this.cleanupStyle,2),"\ntechnique:",JSON.stringify(m,this.cleanupStyle,2))}else n.push(this.m_techniques[r._index]);return!0===r.final}this.validate&&u.warn("WARNING: No technique defined in style. Either sub-styles or a technique must be defined:",JSON.stringify(r))}return!1},e}();t.ThemeEvaluator=L;var j=function(){function e(e){this.theme=e}return e.prototype.visitStyles=function(e){var t,r,n=function(t){if(e(t))return!0;if(void 0!==t.styles)try{for(var r=i(t.styles),o=r.next();!o.done;o=r.next()){var a=o.value;if(n(a))return!0}}catch(e){s={error:e}}finally{try{o&&!o.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}}return!1;var s,u},o=this.theme.styles;try{for(var a=i(o),s=a.next();!s.done;s=a.next()){var u=s.value;if(n(u))return!0}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return!1},e}();t.ThemeVisitor=j},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(t.LogLevel||(t.LogLevel={}));var n=function(){return function(){}}();t.LoggerOptions=n},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,l=[],c=!1,d=-1;function h(){c&&u&&(c=!1,u.length?l=u.concat(l):d=-1,l.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=l.length;t;){for(u=l,l=[];++d<t;)u&&u[d].run();d=-1,t=l.length}u=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new p(e,t)),1!==l.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(129)),n(r(51)),n(r(52)),n(r(28))},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),o=r(0),a=r(52),s=r(130),u=r(51);!function(e){function t(e){return new Float32Array([e])[0]}function r(e){return new o.Vector3(t(e.x),t(e.y),t(e.z))}function l(e,t){var n=(new o.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),i=new o.Vector3(0,0,0).applyMatrix4(t),a=r(i);return{viewProjection:n,eyePosHi:a,eyePosLo:r(i.sub(a))}}function c(e,r){if(e.length>0){var i=e[0];if(void 0===i||null===i)throw Error("Empty element in positions");var a=new Array,s=new Array,u=function(){for(var e,r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];try{for(var u=n(i),l=u.next();!l.done;l=u.next()){var c=l.value,d=t(c);s.push(c-d),a.push(d)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}},l=i;if(void 0!==l.z)e.forEach(function(e){!function(e){u(e.x,e.y,e.z)}(e)}),r=3;else if(void 0!==l.y)e.forEach(function(e){u(e.x,e.y)}),r=2;else{if(void 0===r)throw Error("Positions are float array, please provide dimensionality (2 or 3)");if(a.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach(function(e){u(e)})}return{positionHigh:new o.Float32BufferAttribute(a,r),positionLow:new o.Float32BufferAttribute(s,r)}}return{positionHigh:new o.Float32BufferAttribute([],r||3),positionLow:new o.Float32BufferAttribute([],r||3)}}function d(e,r,n){void 0===n&&(n=0);for(var i=new Array,o=e.length,a=0;a<o;a+=r){for(var s=0;s<n;s++)i.push(e[a+s]);var u=e[a+n],l=e[a+n+1],c=e[a+n+2],d=t(u),h=u-d,f=t(l),p=l-f,m=t(c),y=c-m;i.push(d,f,m,h,p,y);for(s=n+3;s<r;s++)i.push(e[a+s])}return i}function h(e,t,r){var n=c(t,r);return e.bufferGeometry.addAttribute("position",n.positionHigh),e.bufferGeometry.addAttribute("positionLow",n.positionLow),n.positionHigh.itemSize}e.doubleToFloat=t,e.doubleToFloatVec=r,e.makeFloatVec=function(e){var r=t(e.x),n=t(e.y),i=t(e.z),a=new o.Vector3(e.x-r,e.y-n,e.z-i);return e.x=t(r),e.y=t(n),e.z=t(i),a},e.createHighPrecisionCameraPos=l,e.updateHpUniforms=function(e,t,r){var n=l(t,e.matrixWorldInverse),i=n.viewProjection;if(void 0===r||!r.isMaterial)throw Error("High pecision line has no high precision material");if(!(r.uniforms&&r.uniforms.u_mvp&&r.uniforms.u_eyepos&&r.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");r.uniforms.u_mvp.value=new Float32Array(i.elements),r.uniforms.u_eyepos.value=new Float32Array(n.eyePosHi.toArray()),r.uniforms.u_eyepos_lowpart.value=new Float32Array(n.eyePosLo.toArray())},e.createAttributes=c,e.addInterleavedAttributes3=d,e.setPositions=h,e.convertPositions=function(e,t){if(e.length<=0)return{positions:[],dimensionality:t};var r=e[0];if(void 0===r||null===r)throw Error("Empty element in positions");var n=r;if(void 0===n.y&&void 0===n.z)return{positions:e,dimensionality:t};var i=new Array;return void 0!==n.z&&2!==t?(t=3,e.forEach(function(e){i.push(e.x,e.y,e.z)})):(t=2,e.forEach(function(e){i.push(e.x,e.y)})),{positions:i,dimensionality:t}},e.createLine=function(e,t){var r=void 0!==t.lineWidth?t.lineWidth:5,n=void 0!==t.addCircles&&t.addCircles,s=void 0!==t.wireFrame&&t.wireFrame,l=[],c=[];u.triangulateLine(e,r,l,c,n);var h=new o.BufferGeometry,f=d(l,3),p=new o.InterleavedBuffer(new Float32Array(f),6),m=new o.InterleavedBufferAttribute(p,3,0,!1),y=new o.InterleavedBufferAttribute(p,3,3,!1);h.addAttribute("position",m),h.addAttribute("positionLow",y),h.setIndex(new o.BufferAttribute(new Uint32Array(c),1));var v=new i.HighPrecisionLineMaterial(t),g=s?new a.HighPrecisionWireFrameLine(h,v):new a.HighPrecisionLine(h,v);return g.setupForRendering(),g},e.createPoints=function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(r.length/3);var a=new o.BufferGeometry,u=t&&t.isHighPrecisionPointMaterial?t:new i.HighPrecisionPointMaterial(t),l=new s.HighPrecisionPoints(a,u);return h(l,e,3),l.setupForRendering(),l}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(11);t.deleteConfiguration=function(e,t){var r="/v2/admin/catalog/{catalog}".replace("{catalog}",n.UrlBuilder.toString(t.catalog)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"DELETE",headers:{}};return e.request(i,o)},t.getCatalogConfiguration=function(e,t){var r="/v2/admin/catalog/{catalog}".replace("{catalog}",n.UrlBuilder.toString(t.catalog)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"GET",headers:{}};return e.request(i,o)},t.getCatalogs=function(e){var t=new n.UrlBuilder(e.baseUrl+"/v2/admin/catalogs"),r={method:"GET",headers:{}};return e.request(t,r)},t.getIndexStatistics=function(e){var t=new n.UrlBuilder(e.baseUrl+"/v2/admin/indexStatistics"),r={method:"GET",headers:{}};return e.request(t,r)},t.putCatalogConfiguration=function(e,t){var r="/v2/admin/catalog/{catalog}".replace("{catalog}",n.UrlBuilder.toString(t.catalog)),i=new n.UrlBuilder(e.baseUrl+r),o={},a={method:"PUT",headers:o};return o["Content-Type"]="application/json",void 0!==t.configuration&&(a.body=JSON.stringify(t.configuration)),e.request(i,a)},t.getCatalogsConfiguration=function(e){var t=new n.UrlBuilder(e.baseUrl+"/v2/catalog/configuration"),r={method:"GET",headers:{}};return e.request(t,r)},t.getChangeHistory=function(e,t){var r="/v2/catalog/changeHistory/{layer}/{partition}".replace("{layer}",n.UrlBuilder.toString(t.layer)).replace("{partition}",n.UrlBuilder.toString(t.partition)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("version",t.version),i.appendQuery("direction",t.direction),i.appendQuery("limit",t.limit),i.appendQuery("additionalFields",t.additionalFields);var o={method:"GET",headers:{}};return e.request(i,o)},t.getChanges=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/changes");r.appendQuery("layer",t.layer),r.appendQuery("partition",t.partition),r.appendQuery("startVersion",t.startVersion),r.appendQuery("endVersion",t.endVersion),r.appendQuery("additionalFields",t.additionalFields),r.appendQuery("range",t.range);var i={method:"GET",headers:{}};return e.request(r,i)},t.getChangesStatistics=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/changes/changesetStatistics");r.appendQuery("startVersion",t.startVersion),r.appendQuery("endVersion",t.endVersion);var i={},o={method:"POST",headers:i};return i["Content-Type"]="application/json",void 0!==t.body&&(o.body=JSON.stringify(t.body)),e.request(r,o)},t.getChangesetStatistics=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/statistics/changeset");r.appendQuery("token",t.token);var i={method:"GET",headers:{}};return e.request(r,i)},t.getInfo=function(e){var t=new n.UrlBuilder(e.baseUrl+"/v2/catalog/info"),r={method:"GET",headers:{}};return e.request(t,r)},t.getLatestVersion=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/versions/latest");r.appendQuery("startVersion",t.startVersion);var i={method:"GET",headers:{}};return e.request(r,i)},t.getLayerVersions=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/layerVersions");r.appendQuery("version",t.version);var i={method:"GET",headers:{}};return e.request(r,i)},t.getPartition=function(e,t){var r="/v2/catalog/partition/{layer}/{partition}".replace("{layer}",n.UrlBuilder.toString(t.layer)).replace("{partition}",n.UrlBuilder.toString(t.partition)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("version",t.version);var o={method:"GET",headers:{}};return e.request(i,o)},t.getPartitions=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/partitions");r.appendQuery("version",t.version),r.appendQuery("layer",t.layer),r.appendQuery("partition",t.partition),r.appendQuery("additionalFields",t.additionalFields),r.appendQuery("range",t.range);var i={method:"GET",headers:{}};return e.request(r,i)},t.getPartitionsStatistics=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/partitions/changesetStatistics");r.appendQuery("version",t.version);var i={},o={method:"POST",headers:i};return i["Content-Type"]="application/json",void 0!==t.body&&(o.body=JSON.stringify(t.body)),e.request(r,o)},t.getVersions=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/versions");r.appendQuery("startVersion",t.startVersion),r.appendQuery("endVersion",t.endVersion),r.appendQuery("limit",t.limit);var i={method:"GET",headers:{}};return e.request(r,i)},t.queryPartitions=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/catalog/queryPartitions");r.appendQuery("additionalFields",t.additionalFields),r.appendQuery("range",t.range);var i={},o={method:"POST",headers:i};return i["Content-Type"]="application/json",void 0!==t.body&&(o.body=JSON.stringify(t.body)),e.request(r,o)},t.resetCatalog=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/admin/reset"),i={},o={method:"PUT",headers:i};return i["Content-Type"]="application/json",void 0!==t.configuration&&(o.body=JSON.stringify(t.configuration)),e.request(r,o)},t.getConfiguration=function(e){var t=new n.UrlBuilder(e.baseUrl+"/v2/config"),r={method:"GET",headers:{}};return e.request(t,r)},t.putConfiguration=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/config"),i={},o={method:"PUT",headers:i};return i["Content-Type"]="application/json",void 0!==t.configuration&&(o.body=JSON.stringify(t.configuration)),e.request(r,o)},t.getIndex=function(e,t){var r="/v2/index/{version}/{layer}/{quadKey}/{depth}".replace("{version}",n.UrlBuilder.toString(t.version)).replace("{layer}",n.UrlBuilder.toString(t.layer)).replace("{quadKey}",n.UrlBuilder.toString(t.quadKey)).replace("{depth}",n.UrlBuilder.toString(t.depth)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("additionalFields",t.additionalFields);var o={method:"GET",headers:{}};return e.request(i,o)},t.compare=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/publish/compare");r.appendQuery("baseVersion",t.baseVersion);var i={},o={method:"POST",headers:i};return i["Content-Type"]="application/json",void 0!==t.body&&(o.body=JSON.stringify(t.body)),e.request(r,o)},t.deleteRetiredVersions=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/publish/deleteRetiredVersions");r.appendQuery("newMinimumVersion",t.newMinimumVersion);var i={method:"POST",headers:{}};return e.request(r,i)},t.getDeletableData=function(e){var t=new n.UrlBuilder(e.baseUrl+"/v2/publish/deletableData"),r={method:"GET",headers:{}};return e.request(t,r)},t.multipartAbort=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/publish/multipart/abort");r.appendQuery("token",t.token);var i={method:"POST",headers:{}};return e.request(r,i)},t.multipartCommit=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/publish/multipart/commit");r.appendQuery("token",t.token);var i={},o={method:"POST",headers:i};return i["Content-Type"]="application/json",void 0!==t.body&&(o.body=JSON.stringify(t.body)),e.request(r,o)},t.multipartGetPartUrl=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/publish/multipart/getPartUrl");r.appendQuery("token",t.token),r.appendQuery("contentType",t.contentType);var i={method:"POST",headers:{}};return e.request(r,i)},t.multipartStart=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/publish/multipart/start");r.appendQuery("baseVersion",t.baseVersion);var i={},o={method:"POST",headers:i};return i["Content-Type"]="application/json",void 0!==t.body&&(o.body=JSON.stringify(t.body)),e.request(r,o)},t.multipartStatus=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/publish/multipart/status");r.appendQuery("token",t.token);var i={method:"GET",headers:{}};return e.request(r,i)},t.retire=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v2/publish/retire");r.appendQuery("newMinimumVersion",t.newMinimumVersion);var i={method:"POST",headers:{}};return e.request(r,i)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(11);t.checkHandleExistsUsingHEAD=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"HEAD",headers:{}};return e.request(i,o)},t.completeMultipartUsingPUT=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}/multiparts/{multiPartToken}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)).replace("{multiPartToken}",n.UrlBuilder.toString(t.multiPartToken)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={},a={method:"PUT",headers:o};return o["Content-Type"]="application/json",void 0!==t.parts&&(a.body=JSON.stringify(t.parts)),e.request(i,a)},t.deleteMultipartUsingDELETE=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}/multiparts/{multiPartToken}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)).replace("{multiPartToken}",n.UrlBuilder.toString(t.multiPartToken)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"DELETE",headers:{}};return e.request(i,o)},t.deleteObjectUsingDELETE=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"DELETE",headers:{}};return e.request(i,o)},t.fetchDataUsingGET=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.getMultipartStatusUsingGET=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}/multiparts/{multiPartToken}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)).replace("{multiPartToken}",n.UrlBuilder.toString(t.multiPartToken)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.publishObjectUsingPUT=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={},a={method:"PUT",headers:o};return o["Content-Type"]="application/x-www-form-urlencoded",a.body=n.UrlBuilder.stringifyQuery({file:t.file}),e.request(i,a)},t.startMultipartUsingPOST=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}/multiparts".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={},a={method:"POST",headers:o};return o["Content-Type"]="application/json",void 0!==t.body&&(a.body=JSON.stringify(t.body)),e.request(i,a)},t.uploadPartUsingPOST=function(e,t){var r="/blobstore/v1/catalogs/{catalogId}/layers/{layerId}/data/{dataHandle}/multiparts/{multiPartToken}/parts".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{dataHandle}",n.UrlBuilder.toString(t.dataHandle)).replace("{multiPartToken}",n.UrlBuilder.toString(t.multiPartToken)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("partNumber",t.partNumber),i.appendQuery("billingTag",t.billingTag);var o={},a={method:"POST",headers:o};return o["Content-Type"]="application/x-www-form-urlencoded",a.body=n.UrlBuilder.stringifyQuery({file:t.file}),e.request(i,a)},t.catalogUsingPUT=function(e,t){var r="/config/v1/catalogs/{catalogHrn}".replace("{catalogHrn}",n.UrlBuilder.toString(t.catalogHrn)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={},a={method:"PUT",headers:o};return o["Content-Type"]="application/json",void 0!==t.catalog&&(a.body=JSON.stringify(t.catalog)),e.request(i,a)},t.createCatalogUsingPOST=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/config/v1/catalogs");r.appendQuery("billingTag",t.billingTag);var i={},o={method:"POST",headers:i};return i["Content-Type"]="application/json",void 0!==t.catalog&&(o.body=JSON.stringify(t.catalog)),e.request(r,o)},t.deleteCatalogUsingDELETE=function(e,t){var r="/config/v1/catalogs/{catalogHrn}".replace("{catalogHrn}",n.UrlBuilder.toString(t.catalogHrn)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"DELETE",headers:{}};return e.request(i,o)},t.getCatalogStatusUsingGET=function(e,t){var r="/config/v1/status/{token}".replace("{token}",n.UrlBuilder.toString(t.token)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.getCatalogUsingGET=function(e,t){var r="/config/v1/catalogs/{catalogHrn}".replace("{catalogHrn}",n.UrlBuilder.toString(t.catalogHrn)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.getCatalogsUsingGET=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/config/v1/catalogs");r.appendQuery("billingTag",t.billingTag);var i={method:"GET",headers:{}};return e.request(r,i)},t.ingestViaPublishAPIUsingPOST=function(e,t){var r="/ingest/v1/catalog/{catalogId}/layer/{layerId}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)),i=new n.UrlBuilder(e.baseUrl+r),o={},a={method:"POST",headers:o};return o["Content-Type"]="application/json",void 0!==t.data&&(a.body=JSON.stringify(t.data)),void 0!==t.xHEREChecksum&&(o["X-HERE-Checksum"]=t.xHEREChecksum),void 0!==t.xHERETraceId&&(o["X-HERE-TraceId"]=t.xHERETraceId),e.request(i,a)},t.getChangeHistoryUsingGET=function(e,t){var r="/metadata/v1/catalogs/{catalogId}/layers/{layerId}/partitions/{partition}/changeHistory".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{partition}",n.UrlBuilder.toString(t.partition)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("version",t.version),i.appendQuery("direction",t.direction),i.appendQuery("limit",t.limit),i.appendQuery("additionalFields",t.additionalFields),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.getChangesUsingGET=function(e,t){var r="/metadata/v1/catalogs/{catalogId}/layers/{layerId}/changes".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("startVersion",t.startVersion),i.appendQuery("endVersion",t.endVersion),i.appendQuery("additionalFields",t.additionalFields),i.appendQuery("range",t.range),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.getPartitionsUsingGET=function(e,t){var r="/metadata/v1/catalogs/{catalogId}/layers/{layerId}/partitions".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("version",t.version),i.appendQuery("additionalFields",t.additionalFields),i.appendQuery("range",t.range),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.latestVersionUsingGET=function(e,t){var r="/metadata/v1/catalogs/{catalogId}/versions/latest".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("startVersion",t.startVersion),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.layerVersionsForCatalogUsingGET=function(e,t){var r="/metadata/v1/catalogs/{catalogId}/layerVersions".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("version",t.version),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.listVersionsUsingGET=function(e,t){var r="/metadata/v1/catalogs/{catalogId}/versions".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("startVersion",t.startVersion),i.appendQuery("endVersion",t.endVersion),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.minimumVersionUsingGET=function(e,t){var r="/metadata/v1/catalogs/{catalogId}/versions/minimum".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.deleteBatchUsingDELETE=function(e,t){var r="/publish/v1/catalogs/{catalogId}/batches/{batchToken}".replace("{batchToken}",n.UrlBuilder.toString(t.batchToken)).replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"DELETE",headers:{}};return e.request(i,o)},t.finalizeUsingPUT=function(e,t){var r="/publish/v1/catalogs/{catalogId}/batches/{batchToken}".replace("{batchToken}",n.UrlBuilder.toString(t.batchToken)).replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"PUT",headers:{}};return e.request(i,o)},t.getBatchesUsingGET=function(e,t){var r="/publish/v1/catalogs/{catalogId}/batches".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"GET",headers:{}};return e.request(i,o)},t.getStatusUsingGET=function(e,t){var r="/publish/v1/catalogs/{catalogId}/batches/{batchToken}".replace("{batchToken}",n.UrlBuilder.toString(t.batchToken)).replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.publishPartitionsUsingPOST=function(e,t){var r="/publish/v1/catalogs/{catalogId}/layers/{layerId}/publications".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={},a={method:"POST",headers:o};return o["Content-Type"]="application/json",void 0!==t.publications&&(a.body=JSON.stringify(t.publications)),e.request(i,a)},t.startUsingPOST=function(e,t){var r="/publish/v1/catalogs/{catalogId}/batches".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("billingTag",t.billingTag);var o={},a={method:"POST",headers:o};return o["Content-Type"]="application/json",void 0!==t.body&&(a.body=JSON.stringify(t.body)),e.request(i,a)},t.getChangesUsingGET1=function(e,t){var r="/query/v1/catalogs/{catalogId}/layers/{layerId}/changes".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("startVersion",t.startVersion),i.appendQuery("endVersion",t.endVersion),i.appendQuery("additionalFields",t.additionalFields),i.appendQuery("range",t.range),i.appendQuery("partition",t.partition),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.getPartitionsUsingGET1=function(e,t){var r="/query/v1/catalogs/{catalogId}/layers/{layerId}/partitions".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("version",t.version),i.appendQuery("partition",t.partition),i.appendQuery("additionalFields",t.additionalFields),i.appendQuery("range",t.range),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)},t.quadTreeIndexUsingGET=function(e,t){var r="/query/v1/catalogs/{catalogId}/layers/{layerId}/versions/{version}/quadkeys/{quadKey}/depths/{depth}".replace("{catalogId}",n.UrlBuilder.toString(t.catalogId)).replace("{layerId}",n.UrlBuilder.toString(t.layerId)).replace("{version}",n.UrlBuilder.toString(t.version)).replace("{quadKey}",n.UrlBuilder.toString(t.quadKey)).replace("{depth}",n.UrlBuilder.toString(t.depth)),i=new n.UrlBuilder(e.baseUrl+r);i.appendQuery("additionalFields",t.additionalFields),i.appendQuery("billingTag",t.billingTag);var o={method:"GET",headers:{}};return e.request(i,o)}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(5),u=r(1).LoggerManager.instance.create("FontCatalog"),l="./resources/replacementCharacter.png";function c(e){return n(this,void 0,void 0,function(){var t,r;return i(this,function(n){switch(n.label){case 0:return[4,s.fetch(e,{responseType:"text"})];case 1:if(!(t=n.sent()).ok)throw new Error(e+" Status Text:  "+t.statusText);return[4,t.text()];case 2:return r=n.sent(),[2,JSON.parse(r)]}})})}t.BOLD_CODEPOINT_OFFSET=2147483648,function(e){e[e.Left=1]="Left",e[e.Center=.5]="Center",e[e.Right=0]="Right"}(t.TextHorizontalAlignment||(t.TextHorizontalAlignment={})),function(e){e[e.Above=0]="Above",e[e.Center=.5]="Center",e[e.Below=1]="Below"}(t.TextVerticalAlignment||(t.TextVerticalAlignment={})),function(e){e.Left="Left",e.Center="Center",e.Right="Right"}(t.TextHorizontalAlignmentStrings||(t.TextHorizontalAlignmentStrings={})),function(e){e.Above="Above",e.Center="Center",e.Below="Below"}(t.TextVerticalAlignmentStrings||(t.TextVerticalAlignmentStrings={}));var d=function(){function e(e,t,r,n){this.name=e,this.fonts=t,this.supportedRanges=r,this.supportedSubranges=n}return e.load=function(t){return n(this,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return[4,c(t)];case 1:return r=n.sent(),[2,new e(r.name,r.fonts,r.supportedRanges,r.supportedSubranges)]}})})},e}();t.FontCatalogInfo=d;var h=function(){function e(t,r,n,i){(this.info=t,this.name=r,this.m_url=n,this.m_callback=i,this.m_loadingJson=new Set,this.m_loadedJson=new Map,this.m_loadingTextures=new Set,this.m_loadedTextures=new Map,this.m_loadedGlyphs=new Map,void 0===e.replacementGlyph)&&(e.replacementGlyph={codepoint:65533,advanceX:32,offsetX:-3,offsetY:14,width:37,height:37,s0:0,t0:1,s1:1,t1:0,s2:0,t2:0,s3:0,t3:0,page:0,texture:a.Texture.DEFAULT_IMAGE,emulateBold:!1,size:32,base:38,lineHeight:44,metrics:{unitsPerEm:1,capHeight:1}},new Promise(function(e){(new a.TextureLoader).load(l,e)}).then(function(t){u.log("Loaded texture: "+l);var r=t;r.wrapS=a.ClampToEdgeWrapping,r.wrapT=a.ClampToEdgeWrapping,r.minFilter=a.NearestFilter,r.needsUpdate=!0,e.replacementGlyph.texture=r}).catch(function(e){u.error("Failed to load texture: "+l,e)}))}return e.load=function(t,r,o){return n(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,d.load(t)];case 1:return[2,new e(n.sent(),r,t,o)]}})})},e.getGlyphCorners=function(e,t,r,n,i,o,s){void 0===r&&(r=[]),void 0===n&&(n=!0),void 0===o&&(o=!1),void 0===s&&(s=!1);for(var u=0;u<4;++u)void 0===r[u]&&(r[u]=new a.Vector2);var l=e.metrics.capHeight/e.metrics.unitsPerEm*e.size*i,c=e.lineHeight-l,d=0,h=0,f=0,p=0;if(n){var m=s?e.metrics.xHeight/e.metrics.capHeight:1,y=s?e.metrics.xHeight/e.metrics.unitsPerEm*e.size*.5:0,v=e.width*m,g=e.height*m,b=e.offsetX*m,_=e.offsetY*m+y;h=(d=b)+v,p=(f=c-_-g)+g}else d=0,f=0,h=e.width,p=e.height;var x=o&&n?Math.tan(.174533)*e.size:0,w=new a.Vector3;return r[0].copy(w.set(d,f,0).applyMatrix4(t)),r[1].copy(w.set(h,f,0).applyMatrix4(t)),r[2].copy(w.set(d+x,p,0).applyMatrix4(t)),r[3].copy(w.set(h+x,p,0).applyMatrix4(t)),r},e.prototype.getGlyphAt=function(e,t,r){var n=e.codePointAt(t);if(void 0!==n)return this.getGlyph(n,r)},e.prototype.getGlyph=function(r,n){var i=r;!0===n&&(i+=t.BOLD_CODEPOINT_OFFSET);var a=this.m_loadedGlyphs.get(i);if(void 0!==a)return a;var s,u=void 0;try{for(var l=o(this.info.supportedRanges),c=l.next();!c.done;c=l.next()){var d=c.value;if(r>=d.min&&r<=d.max){u=d,s=d.fonts[0];break}}}catch(e){f={error:e}}finally{try{c&&!c.done&&(p=l.return)&&p.call(l)}finally{if(f)throw f.error}}if(void 0===u)return e.replacementGlyph;var h=this.info.fonts.find(function(e){return e.name===s});if(void 0===h)return e.replacementGlyph;var f,p,m=void 0!==h.bold,y=!0===n&&!m,v=this.m_url.lastIndexOf("_FontCatalog.json"),g=this.m_url.substr(0,v)+(n&&m?"_BoldAssets/":"_Assets/")+u.fonts[0];return void 0!==(a=this.loadGlyph(r,u,g,y))&&this.m_loadedGlyphs.set(i,a),a},e.prototype.getGlyphs=function(e,t){for(var r=[],n=0;n<e.length;++n){var i=e.codePointAt(n);if(void 0!==i){var o=this.getGlyph(i,t);void 0!==o&&r.push(o)}}return r},Object.defineProperty(e.prototype,"loading",{get:function(){return this.m_loadingJson.size>0||this.m_loadingTextures.size>0},enumerable:!0,configurable:!0}),e.prototype.loadGlyph=function(t,r,n,i){var o=this.m_loadedJson.get(n+"/"+r.name+".json");if(void 0!==o){var a=o.chars.find(function(e){return e.id===t});if(void 0===a)return e.replacementGlyph;var s=n+"/"+o.pages[a.page],u=this.m_loadedTextures.get(s);if(void 0!==u)return{codepoint:a.id,advanceX:a.xadvance,offsetX:a.xoffset,offsetY:a.yoffset,width:a.width,height:a.height,s0:a.x/u.image.width,t0:1-a.y/u.image.height,s1:(a.x+a.width)/u.image.width,t1:1-(a.y+a.height)/u.image.height,s2:0,t2:0,s3:0,t3:0,page:a.page,texture:u,emulateBold:i,size:o.info.size,base:o.common.base,lineHeight:o.common.lineHeight,metrics:o.metrics};this.loadTexture(s)}else this.loadJson(t,r.name,n)},e.prototype.loadJson=function(e,t,r){var n=this,i=r+"/"+t+".json";this.m_loadingJson.has(i)||(u.log("Loading font json: "+i),this.m_loadingJson.add(i),c(i).then(function(t){u.log("Loaded font json: "+i),n.m_loadingJson.delete(i),n.m_loadedJson.set(i,t);var o=t.chars.find(function(t){return t.id===e});if(void 0===o)u.error("Codepoint "+e+" not found in FontCatalog assets.");else{var a=r+"/"+t.pages[o.page];n.loadTexture(a)}}).catch(function(e){u.error("Failed to load font. ",e)}))},e.prototype.loadTexture=function(e){var t=this;this.m_loadingTextures.has(e)||(u.log("Loading font texture: "+e),this.m_loadingTextures.add(e),function(e){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){(new a.TextureLoader).load(e,t)})];case 1:return[2,t.sent()]}})})}(e).then(function(r){u.log("Loaded font texture: "+e),r.wrapS=a.ClampToEdgeWrapping,r.wrapT=a.ClampToEdgeWrapping,r.minFilter=a.NearestFilter,r.needsUpdate=!0,t.m_loadingTextures.delete(e),t.m_loadedTextures.set(e,r),t.m_callback()}).catch(function(e){u.error("Failed to load texture. ",e)}))},e}();t.FontCatalog=h},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(31),a=0,s=32768,u=0,l=32768;!function(e){e[e.Outline=0]="Outline",e[e.Glow=1]="Glow"}(t.TextBackgroundMode||(t.TextBackgroundMode={})),function(e){e.Outline="Outline",e.Glow="Glow"}(t.TextBackgroundModeStrings||(t.TextBackgroundModeStrings={}));var c=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.type="BoxBufferMesh",n}return n(t,e),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return void 0===this.geometry||0===this.geometry.index.count},enumerable:!0,configurable:!0}),t}(i.Mesh);t.BoxBufferMesh=c;var d=function(){function e(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=a),void 0===n&&(n=s),this.material=e,this.renderOrder=t,this.startElementCount=r,this.maxElementCount=n,this.m_size=0,this.resizeBuffer(r),this.pickInfos=new Array}return e.prototype.clone=function(){return new e(this.material,this.renderOrder)},e.prototype.dispose=function(){void 0!==this.geometry&&(this.geometry.dispose(),this.geometry=void 0),this.internalMesh=void 0},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_size},enumerable:!0,configurable:!0}),e.prototype.reset=function(){void 0!==this.positionAttribute&&(this.positionAttribute.count=0,this.colorAttribute.count=0,this.uvAttribute.count=0,this.indexAttribute.count=0,this.pickInfos.length=0)},e.prototype.canAddElements=function(e){void 0===e&&(e=1);var t=this.indexAttribute;if(t.count+6*e>=t.array.length){if(t.array.length>=6*this.maxElementCount)return!1;var r=Math.min(this.maxElementCount,0===this.size?256:2*this.size);this.resize(r)}return!0},e.prototype.saveState=function(){return{positionAttributeCount:this.positionAttribute.count,colorAttributeCount:this.colorAttribute.count,uvAttributeCount:this.uvAttribute.count,indexAttributeCount:this.indexAttribute.count,pickInfoCount:this.pickInfos.length}},e.prototype.restoreState=function(e){this.positionAttribute.count=e.positionAttributeCount,this.colorAttribute.count=e.colorAttributeCount,this.uvAttribute.count=e.uvAttributeCount,this.indexAttribute.count=e.indexAttributeCount,this.pickInfos.length=e.pickInfoCount},e.prototype.addBox=function(e,t,r,n,i,o){if(!this.canAddElements())return!1;var a=t.s0,s=t.t0,u=t.s1,l=t.t1,c=e.x,d=e.y,h=e.w,f=e.h,p=Math.round(255*r.r),m=Math.round(255*r.g),y=Math.round(255*r.b),v=Math.round(255*n),g=this.positionAttribute,b=this.colorAttribute,_=this.uvAttribute,x=this.indexAttribute,w=g.count,T=x.count;return g.setXYZ(w,c,d,i),g.setXYZ(w+1,c+h,d,i),g.setXYZ(w+2,c,d+f,i),g.setXYZ(w+3,c+h,d+f,i),b.setXYZW(w,p,m,y,v),b.setXYZW(w+1,p,m,y,v),b.setXYZW(w+2,p,m,y,v),b.setXYZW(w+3,p,m,y,v),_.setXY(w,a,s),_.setXY(w+1,u,s),_.setXY(w+2,a,l),_.setXY(w+3,u,l),x.setX(T,w),x.setX(T+1,w+1),x.setX(T+2,w+2),x.setX(T+3,w+2),x.setX(T+4,w+1),x.setX(T+5,w+3),g.count+=4,b.count+=4,_.count+=4,x.count+=6,this.pickInfos.push(o),!0},e.prototype.updateBufferGeometry=function(){var e=this.positionAttribute,t=this.colorAttribute,r=this.uvAttribute,n=this.indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=4*e.count),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),r.count>0&&(r.needsUpdate=!0,r.updateRange.offset=0,r.updateRange.count=4*r.count),n.count>0&&(n.needsUpdate=!0,n.updateRange.offset=0,n.updateRange.count=n.count),void 0!==this.geometry&&(this.geometry.clearGroups(),this.geometry.addGroup(0,this.indexAttribute.count))},e.prototype.cleanUp=function(){0===this.indexAttribute.count&&this.size>a&&this.clearAttributes()},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.internalMesh.isEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return void 0===this.internalMesh&&this.resize(),this.internalMesh},enumerable:!0,configurable:!0}),e.prototype.pickBoxes=function(e,t){for(var r=this.pickInfos.length,n=this.pickInfos,i=this.positionAttribute,o=e.x,a=e.y,s=0;s<r;s++){var u=4*s;if(!(o<i.getX(u)))if(!(o>i.getX(u+1)))if(!(a<i.getY(u)))a>i.getY(u+2)||void 0!==n[s]&&t(n[s])}},e.prototype.resize=function(e,t){return void 0!==this.geometry&&this.geometry.dispose(),this.geometry=new i.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.geometry.addAttribute("position",this.positionAttribute),this.geometry.addAttribute("color",this.colorAttribute),this.geometry.addAttribute("uv",this.uvAttribute),this.geometry.setIndex(this.indexAttribute),this.geometry.addGroup(0,this.indexAttribute.count),void 0===this.internalMesh?(this.internalMesh=new c(this.geometry,this.material),this.internalMesh.renderOrder=this.renderOrder):this.internalMesh.geometry=this.geometry,this.internalMesh},e.prototype.clearAttributes=function(){this.positionAttribute=void 0,this.colorAttribute=void 0,this.uvAttribute=void 0,this.indexAttribute=void 0,this.resize(a,!0)},e.prototype.resizeBuffer=function(e){var t=new Float32Array(4*e*3);if(void 0!==this.positionAttribute&&this.positionAttribute.array.length>0){var r=this.positionAttribute.count;t.set(this.positionAttribute.array),this.positionAttribute.setArray(t),this.positionAttribute.count=r}else this.positionAttribute=new i.BufferAttribute(t,3),this.positionAttribute.count=0,this.positionAttribute.setDynamic(!0);var n=new Uint8Array(4*e*4);if(void 0!==this.colorAttribute){var o=this.colorAttribute.count;n.set(this.colorAttribute.array),this.colorAttribute.setArray(n),this.colorAttribute.count=o}else this.colorAttribute=new i.BufferAttribute(n,4,!0),this.colorAttribute.count=0,this.colorAttribute.setDynamic(!0);var a=new Float32Array(4*e*4);if(void 0!==this.uvAttribute){var s=this.uvAttribute.count;a.set(this.uvAttribute.array),this.uvAttribute.setArray(a),this.uvAttribute.count=s}else this.uvAttribute=new i.BufferAttribute(a,4),this.uvAttribute.count=0,this.uvAttribute.setDynamic(!0);var u=6*e*1,l=u>65535?new Uint32Array(u):new Uint16Array(u);if(void 0!==this.indexAttribute){var c=this.indexAttribute.count;l.set(this.indexAttribute.array),this.indexAttribute.setArray(l),this.indexAttribute.count=c}else this.indexAttribute=new i.BufferAttribute(l,1),this.indexAttribute.count=0,this.indexAttribute.setDynamic(!0);this.m_size=e},e}();t.BoxBuffer=d;var h=function(e){function t(t,r,n,o,a){void 0===n&&(n=0),void 0===o&&(o=u),void 0===a&&(a=l);var s=e.call(this,t,n,o,a)||this;return s.textMaterial=t,s.outlineMaterial=r,s.renderOrder=n,s.startGlyphCount=o,s.maxGlyphCount=a,s.m_glyphAxis=new i.Vector2,s}return n(t,e),t.prototype.clone=function(){return new t(this.textMaterial,this.outlineMaterial,this.renderOrder)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.m_outlineMesh=void 0},Object.defineProperty(t.prototype,"outlineMesh",{get:function(){return void 0===this.m_outlineMesh&&this.resize(),this.m_outlineMesh},enumerable:!0,configurable:!0}),t.prototype.addGlyph=function(e,t,r,n,i,a,s,u,l,c,d,h){if(void 0===a&&(a=[]),!this.canAddElements())return!1;var f=e.s0,p=e.t0,m=e.s1,y=e.t1,v=e.s2,g=e.t2,b=e.s3,_=e.t3,x=e.page,w=e.emulateBold,T=Math.round(255*t.r),S=Math.round(255*t.g),O=Math.round(255*t.b),E=Math.round(255*r),P=this.positionAttribute,C=this.colorAttribute,A=this.uvAttribute,I=this.indexAttribute,M=this.glyphAxisAttribute,L=P.count,j=I.count;o.FontCatalog.getGlyphCorners(e,i,a,s,u,l,c),this.m_glyphAxis.set(a[1].x,a[1].y),this.m_glyphAxis.sub(a[0]).normalize(),P.setXYZ(L,a[0].x,a[0].y,n),P.setXYZ(L+1,a[1].x,a[1].y,n),P.setXYZ(L+2,a[2].x,a[2].y,n),P.setXYZ(L+3,a[3].x,a[3].y,n),M.setXY(L,this.m_glyphAxis.x,this.m_glyphAxis.y),M.setXY(L+1,this.m_glyphAxis.x,this.m_glyphAxis.y),M.setXY(L+2,this.m_glyphAxis.x,this.m_glyphAxis.y),M.setXY(L+3,this.m_glyphAxis.x,this.m_glyphAxis.y),C.setXYZW(L,T,S,O,E),C.setXYZW(L+1,T,S,O,E),C.setXYZW(L+2,T,S,O,E),C.setXYZW(L+3,T,S,O,E);var F=w?.2:0,R=c?.125:0;return s?(A.setXYZW(L,v,_,1+F+R,d),A.setXYZW(L+1,b,_,1+F+R,d),A.setXYZW(L+2,v,g,1+F+R,d),A.setXYZW(L+3,b,g,1+F+R,d)):(A.setXYZW(L,f,y,x,d),A.setXYZW(L+1,m,y,x,d),A.setXYZW(L+2,f,p,x,d),A.setXYZW(L+3,m,p,x,d)),I.setX(j,L),I.setX(j+1,L+1),I.setX(j+2,L+2),I.setX(j+3,L+2),I.setX(j+4,L+1),I.setX(j+5,L+3),P.count+=4,M.count+=4,C.count+=4,A.count+=4,I.count+=6,this.pickInfos.push(h),!0},t.prototype.pickBoxes=function(e,t){for(var r=this.pickInfos.length,n=this.pickInfos,i=this.positionAttribute,o=e.x,a=e.y,s=0;s<r;s++){var u=4*s;if(!(o<Math.min(i.getX(u+2),i.getX(u+1))))if(!(o>Math.max(i.getX(u+2),i.getX(u+1))))if(!(a<Math.min(i.getY(u+2),i.getY(u+1))))a>Math.max(i.getY(u+2),i.getY(u+1))||void 0!==n[s]&&t(n[s])}},t.prototype.resize=function(e,t){return void 0!==this.geometry&&this.geometry.dispose(),this.geometry=new i.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.geometry.addAttribute("position",this.positionAttribute),this.geometry.addAttribute("glyphAxis",this.glyphAxisAttribute),this.geometry.addAttribute("color",this.colorAttribute),this.geometry.addAttribute("uv",this.uvAttribute),this.geometry.setIndex(this.indexAttribute),this.geometry.addGroup(0,this.indexAttribute.count),void 0===this.internalMesh?this.internalMesh=new c(this.geometry,this.material):this.internalMesh.geometry=this.geometry,void 0===this.m_outlineMesh?this.m_outlineMesh=new c(this.geometry,this.outlineMaterial):this.m_outlineMesh.geometry=this.geometry,this.internalMesh},t.prototype.updateBufferGeometry=function(){var t=this.glyphAxisAttribute;t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),e.prototype.updateBufferGeometry.call(this)},t.prototype.clearAttributes=function(){this.glyphAxisAttribute=void 0,e.prototype.clearAttributes.call(this)},t.prototype.resizeBuffer=function(t){var r=new Float32Array(4*t*2);if(void 0!==this.glyphAxisAttribute){var n=this.glyphAxisAttribute.count;r.set(this.glyphAxisAttribute.array),this.glyphAxisAttribute.setArray(r),this.glyphAxisAttribute.count=n}else this.glyphAxisAttribute=new i.BufferAttribute(r,2),this.glyphAxisAttribute.count=0,this.glyphAxisAttribute.setDynamic(!0);e.prototype.resizeBuffer.call(this,t)},t}(d);t.TextBuffer=h},function(e,t,r){"use strict";function n(e,t,r,i){if(!(this instanceof n))return new n(e,t,r,i);var o,a,s;e.x?(r=e.w,i=e.h,t=e.y,0!==e.w&&!e.w&&e.x2?(r=e.x2-e.x,i=e.y2-e.y):(r=e.w,i=e.h),e=e.x,o=e+r,a=t+i,s=!(i+r)):(o=e+r,a=t+i,s=!(i+r)),this.x1=this.x=function(){return e},this.y1=this.y=function(){return t},this.x2=function(){return o},this.y2=function(){return a},this.w=function(){return r},this.h=function(){return i},this.p=function(){return s},this.overlap=function(r){return s||r.p()?e<=r.x2()&&o>=r.x()&&t<=r.y2()&&a>=r.y():e<r.x2()&&o>r.x()&&t<r.y2()&&a>r.y()},this.expand=function(n){var s,u,l=n.x(),c=n.y(),d=n.x2(),h=n.y2();return s=e>l?l:e,u=t>c?c:t,r=o>d?o-s:d-s,i=a>h?a-u:h-u,e=s,t=u,this}}n.overlapRectangle=function(e,t){return 0===e.h&&0===e.w||0===t.h&&0===t.w?e.x<=t.x+t.w&&e.x+e.w>=t.x&&e.y<=t.y+t.h&&e.y+e.h>=t.y:e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y},n.containsRectangle=function(e,t){return e.x+e.w<=t.x+t.w&&e.x>=t.x&&e.y+e.h<=t.y+t.h&&e.y>=t.y},n.expandRectangle=function(e,t){var r,n,i=e.x+e.w,o=t.x+t.w,a=e.y+e.h,s=t.y+t.h;return r=e.x>t.x?t.x:e.x,n=e.y>t.y?t.y:e.y,e.w=i>o?i-r:o-r,e.h=a>s?a-n:s-n,e.x=r,e.y=n,e},n.makeMBR=function(e,t){if(!e.length)return{x:0,y:0,w:0,h:0};(t=t||{}).x=e[0].x,t.y=e[0].y,t.w=e[0].w,t.h=e[0].h;for(var r=1,i=e.length;r<i;r++)n.expandRectangle(t,e[r]);return t},n.squarifiedRatio=function(e,t,r){var n=(e+t)/2,i=e*t;return i*r/(i/(n*n))},e.exports=n},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);function o(e){e.depthWrite=!0,e.depthFunc=i.LessDepth,e.colorWrite=!0,e.transparent=!0;var r=e.clone();return r.depthWrite=!0,r.depthTest=!0,r.colorWrite=!1,r.transparent=!1,r.opacity=1,r.polygonOffset=!0,r.polygonOffsetUnits=t.DEPTH_PASS_POLYGON_OFFSET_UNITS,r}t.DEPTH_PASS_POLYGON_OFFSET_UNITS=1,t.DEFAULT_DEPTH_BASED_POLYGON_OFFSET_MULTIPLIER=t.DEPTH_PASS_POLYGON_OFFSET_UNITS+1,t.isRenderDepthPrePassEnabled=function(e){return!1!==e.enableDepthPrePass&&void 0!==e.opacity&&e.opacity>0&&e.opacity<1},t.createDepthPrePassMaterial=o,t.createDepthPrePassMesh=function(e){var t=e.geometry;if(!(t instanceof i.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");var r=t.getAttribute("position");if(!r)throw new Error("#createDepthPassMesh position attribute not found");var a=new i.BufferGeometry;a.addAttribute("position",r);var s=t.getAttribute("uv");s&&a.addAttribute("uv",s),t.index&&a.setIndex(t.index);try{for(var u=n(t.groups),l=u.next();!l.done;l=u.next()){var c=l.value,d=c.start,h=c.count,f=c.materialIndex;a.addGroup(d,h,f)}}catch(e){p={error:e}}finally{try{l&&!l.done&&(m=u.return)&&m.call(u)}finally{if(p)throw p.error}}var p,m,y=e.material instanceof Array?e.material.map(o):o(e.material),v=new i.Mesh(a,y);return v.renderOrder=e.renderOrder,v},t.applyDepthBasedPolygonOffset=function(e){for(var r,i,o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];try{for(var l=n(o),c=l.next();!c.done;c=l.next())s(c.value,function(e){e.polygonOffset=!0,e.polygonOffsetFactor=0})}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}o[0].onBeforeRender=function(){for(var r=a++*e,n=function(e){var n=o[e],i=0===e?t.DEPTH_PASS_POLYGON_OFFSET_UNITS:0;s(n,function(e){e.polygonOffsetUnits=r+i})},i=0;i<o.length;++i)n(i)}};var a=0;function s(e,t){e.material instanceof Array?e.material.forEach(t):t(e.material)}t.resetDepthBasedPolygonOffsetIndex=function(){a=0}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(24),a=r(4),s=r(1),u=r(183),l=r(0),c=r(84),d=r(37),h=r(89),f=r(184),p=r(90),m=r(185),y=r(186),v=r(88),g=s.LoggerManager.instance.create("OmvDecoder",{enabled:!1}),b=function(){function e(e){this.contour=e,this.isOuterRing=this.area()<0}return Object.defineProperty(e.prototype,"isInnerRing",{get:function(){return!this.isOuterRing},enumerable:!0,configurable:!0}),e.prototype.area=function(){for(var e=this.contour.length/2,t=0,r=e-1,n=0;n<e;r=n++)t+=this.contour[2*r]*this.contour[2*n+1]-this.contour[2*n]*this.contour[2*r+1];return t/2},e}();t.Ring=b;var _=function(){function e(e,t,r,n,i,o,a,s,u){void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=!1),this.m_projection=e,this.m_evaluator=t,this.m_showMissingTechniques=r,this.m_dataFilter=n,this.m_featureModifier=i,this.m_gatherFeatureIds=o,this.m_createTileInfo=a,this.m_gatherRoadSegments=s,this.m_languages=u,this.m_featureAttributes=new d.FeatureAttributes}return e.prototype.getDecodedTile=function(e,t){var r=this,n=v.com.mapbox.pb.Tile.decode(new Uint8Array(t)),i=a.webMercatorTilingScheme.getGeoBox(e),o=this.m_projection.projectBox(i,new l.Box3),s=new l.Vector3;o.getCenter(s);var u={tileKey:e,projection:this.m_projection,geoBox:i,tileBounds:o,center:s};if(this.m_decodedTileEmitter=new f.OmvDecodedTileEmitter(u,this.m_evaluator,this.m_gatherFeatureIds,this.m_languages),this.m_createTileInfo){this.m_infoTileEmitter=new m.OmvTileInfoEmitter(u,this.m_evaluator,!0,this.m_gatherRoadSegments)}var c=this.m_dataFilter;d.visitOmv(n,{visitLayer:function(t){var n=e.level;return(void 0===c||c.wantsLayer(t,n))&&d.visitOmvLayer(t,{visitPolygonFeature:function(e){(void 0===c||c.wantsPolygonFeature(t,e,n))&&r.processPolygonFeature(t,e,n)},visitLineFeature:function(e){(void 0===c||c.wantsLineFeature(t,e,n))&&r.processLineFeature(t,e,n)},visitPointFeature:function(e){(void 0===c||c.wantsPointFeature(t,e,n))&&r.processPointFeature(t,e,n)}}),!1}});var h=this.m_decodedTileEmitter.getDecodedTile();return this.m_createTileInfo&&(h.tileInfo=this.m_infoTileEmitter.getTileInfo()),h},e.prototype.getTileInfo=function(e,t){var r=this,n=v.com.mapbox.pb.Tile.decode(new Uint8Array(t)),i=a.webMercatorTilingScheme.getGeoBox(e),o=this.m_projection.projectBox(i,new l.Box3),s=new l.Vector3;o.getCenter(s);var u={tileKey:e,projection:this.m_projection,geoBox:i,tileBounds:o,center:s};this.m_infoTileEmitter=new m.OmvTileInfoEmitter(u,this.m_evaluator,!0,this.m_gatherRoadSegments);var c=this.m_dataFilter;return d.visitOmv(n,{visitLayer:function(t){var n=e.level;return(void 0===c||c.wantsLayer(t,n))&&d.visitOmvLayer(t,{visitPolygonFeature:function(e){(void 0===c||c.wantsPolygonFeature(t,e,n))&&r.processPolygonFeature(t,e,n)},visitLineFeature:function(e){(void 0===c||c.wantsLineFeature(t,e,n))&&r.processLineFeature(t,e,n)},visitPointFeature:function(e){(void 0===c||c.wantsPointFeature(t,e,n))&&r.processPointFeature(t,e,n)}}),!1}}),this.m_infoTileEmitter.getTileInfo()},e.prototype.processPointFeature=function(e,t,r){if(t.geometry){var n=this.createEnv(e,t,r);if(void 0===this.m_featureModifier||this.m_featureModifier.doProcessPointFeature(e,n,r)){var i=this.m_evaluator.getMatchingTechniques(n);if(0!==i.length){var o=this.getFeatureId(t);this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processPointFeature(e,t,n,i,o),this.m_infoTileEmitter&&this.m_infoTileEmitter.processPointFeature(e,t,n,i,o)}else this.m_showMissingTechniques&&g.log("OmvDecoder#processPointFeature: no techniques for object:",JSON.stringify(n.unmap()))}}},e.prototype.processLineFeature=function(e,t,r){if(t.geometry){var n=this.createEnv(e,t,r);if(void 0===this.m_featureModifier||this.m_featureModifier.doProcessLineFeature(e,n,r)){var i=this.m_evaluator.getMatchingTechniques(n);if(0!==i.length){var o=this.getFeatureId(t);this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processLineFeature(e,t,n,i,o),this.m_infoTileEmitter&&this.m_infoTileEmitter.processLineFeature(e,t,n,i,o)}else this.m_showMissingTechniques&&g.log("OmvDecoder#processLineFeature: no techniques for object:",JSON.stringify(n.unmap()))}}},e.prototype.processPolygonFeature=function(e,t,r){if(t.geometry){var n=this.createEnv(e,t,r);if(void 0===this.m_featureModifier||this.m_featureModifier.doProcessPolygonFeature(e,n,r)){var i=this.m_evaluator.getMatchingTechniques(n);if(0!==i.length){var o=this.getFeatureId(t);this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processPolygonFeature(e,t,n,i,o),this.m_infoTileEmitter&&this.m_infoTileEmitter.processPolygonFeature(e,t,n,i,o)}else this.m_showMissingTechniques&&g.log("OmvDecoder#processPolygonFeature: no techniques for object:",JSON.stringify(n.unmap()))}}},e.prototype.getFeatureId=function(e){if(void 0!==e.id){if("number"==typeof e.id)return e.id;if(u.isLong(e.id))return e.id.greaterThan(Number.MAX_SAFE_INTEGER)&&g.error("Invalid ID: Larger than largest available Number in feature: ",e),e.id.toNumber()}},e.prototype.createEnv=function(e,t,r,n){var i={$layer:e.name,$level:r,$id:this.getFeatureId(t)};return this.m_featureAttributes.accept(e,t,{visitAttribute:function(e,t){var r=t;return r.hasOwnProperty("stringValue")?i[e]=t.stringValue:r.hasOwnProperty("boolValue")?i[e]=t.boolValue:r.hasOwnProperty("doubleValue")?i[e]=t.doubleValue:r.hasOwnProperty("floatValue")?i[e]=t.floatValue:r.hasOwnProperty("intValue")?i[e]="number"==typeof t.intValue?t.intValue:t.intValue.toNumber():r.hasOwnProperty("uintValue")?i[e]="number"==typeof t.uintValue?t.uintValue:t.uintValue.toNumber():r.hasOwnProperty("sintValue")&&(i[e]="number"==typeof t.sintValue?t.sintValue:t.sintValue.toNumber()),!0}}),new o.MapEnv(i,n)},e}();t.OmvDecoder=_,function(e){e.getFeatureName=function(e,t,r,n){var o,a,s;if(t){var u=e.lookup("abbr");if("string"==typeof u&&u.length>0)return u}if(r){var l=e.lookup("iso_code");if("string"==typeof l&&l.length>0)return l}if(void 0!==n)try{for(var c=i(n),d=c.next();!d.done;d=c.next()){var h=d.value;if("string"==typeof(o=e.lookup("name_"+h))&&o.length>0)return o}}catch(e){a={error:e}}finally{try{d&&!d.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}if("string"==typeof(o=e.lookup("name")))return o}}(_=t.OmvDecoder||(t.OmvDecoder={})),t.OmvDecoder=_;var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.m_showMissingTechniques=!1,t.m_gatherFeatureIds=!0,t.m_createTileInfo=!1,t.m_gatherRoadSegments=!1,t}return n(t,e),t.prototype.connect=function(){return Promise.resolve()},t.prototype.decodeThemedTile=function(e,t,r,n){var i=s.PerformanceTimer.now(),o=new _(n,r,this.m_showMissingTechniques,this.m_featureFilter,this.m_featureModifier,this.m_gatherFeatureIds,this.m_createTileInfo,this.m_gatherRoadSegments,this.languages).getDecodedTile(t,e);return o.decodeTime=s.PerformanceTimer.now()-i,Promise.resolve(o)},t.prototype.getTileInfo=function(e,t,r,n){var i=s.PerformanceTimer.now(),o=this.getThemeEvalator(r);if(void 0===o)return Promise.reject(new Error("no theme loaded"));var a=new _(n,o,this.m_showMissingTechniques,this.m_featureFilter,this.m_featureModifier,this.m_gatherFeatureIds,this.m_createTileInfo,this.m_gatherRoadSegments,this.languages).getTileInfo(t,e);return a.setupTime=s.PerformanceTimer.now()-i,Promise.resolve(a)},t.prototype.configure=function(t,r,n){if(e.prototype.configure.call(this,t,r,n),n){var i=n;void 0!==i.showMissingTechniques&&(this.m_showMissingTechniques=!0===i.showMissingTechniques),i&&void 0!==i.filterDescription&&(null!==i.filterDescription?(this.m_featureFilter=new h.OmvGenericFeatureFilter(i.filterDescription),this.m_featureModifier=this.createFeatureModifier(i.filterDescription,i.featureModifierId)):(this.m_featureFilter=void 0,this.m_featureModifier=void 0)),void 0!==i.gatherFeatureIds&&(this.m_gatherFeatureIds=!0===i.gatherFeatureIds),void 0!==i.createTileInfo&&(this.m_createTileInfo=!0===i.createTileInfo),void 0!==i.gatherRoadSegments&&(this.m_gatherRoadSegments=!0===i.gatherRoadSegments)}void 0!==r&&(this.languages=r)},t.prototype.createFeatureModifier=function(e,t){return t===p.FeatureModifierId.tomTom?new y.OmvTomTomFeatureModifier(e):new h.OmvGenericFeatureModifier(e)},t}(c.ThemedTileDecoder);t.OmvTileDecoder=x;var w=function(){return function(e){c.TileDecoderService.start(e||p.OMV_TILE_DECODER_SERVICE_ID,new x)}}();t.default=w},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i,o=r(88);function a(e,t){if((!t.visitLayer||t.visitLayer(e))&&e.features)try{for(var r=n(e.features),i=r.next();!i.done;i=r.next()){var a=i.value;switch(a.type){case o.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case o.com.mapbox.pb.Tile.GeomType.POINT:t.visitPointFeature&&t.visitPointFeature(a);break;case o.com.mapbox.pb.Tile.GeomType.LINESTRING:t.visitLineFeature&&t.visitLineFeature(a);break;case o.com.mapbox.pb.Tile.GeomType.POLYGON:t.visitPolygonFeature&&t.visitPolygonFeature(a)}}}catch(e){s={error:e}}finally{try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}}var s,u;t.endVisitLayer&&t.endVisitLayer(e)}!function(e){e[e.MoveTo=1]="MoveTo",e[e.LineTo=2]="LineTo",e[e.ClosePath=7]="ClosePath"}(i=t.CommandKind||(t.CommandKind={})),t.isMoveToCommand=function(e){return e.kind===i.MoveTo},t.isLineToCommand=function(e){return e.kind===i.LineTo},t.isClosePathCommand=function(e){return e.kind===i.ClosePath},t.visitOmv=function(e,t){var r,i;if(e.layers)try{for(var o=n(e.layers),s=o.next();!s.done;s=o.next()){var u=s.value;t.visitLayer&&!t.visitLayer(u)||a(u,t),t.endVisitLayer&&t.endVisitLayer(u)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.visitOmvLayer=a;var s=function(){function e(){}return e.prototype.accept=function(e,t,r){var n=e.keys,i=e.values,o=t.tags;if(o&&n&&i)for(var a=0;a<o.length;a+=2){var s=n[o[a]],u=i[o[a+1]];if(!r.visitAttribute(s,u))break}},e}();function u(e,t){var r=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}t.FeatureAttributes=s;var l=function(){function e(){}return e.prototype.accept=function(e,t,r,n,o){void 0===n&&(n=4096);for(var a=r.longitudeSpan/n,s=e.length,l=r.north,c=r.west,d=Math.log2(n),h=function(e,t){return Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}(l,t.level+d),f=0,p=0,m=0;m<s;){var y=7&e[m],v=e[m]>>3;if(++m,y===i.MoveTo||y===i.LineTo)for(var g=0;g<v;++g){var b=e[m++],_=e[m++],x=c+(f+=b>>1^-(1&b))*a,w=u(h+(p+=_>>1^-(1&_)),t.level+d);o.visitCommand({kind:y,latitude:w,longitude:x})}else o.visitCommand({kind:y})}},e}();t.GeometryCommands=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),i=r(6),o=r(10),a=Math.PI/180,s=function(){function e(){}return e.prototype.getScaleFactor=function(e){return 1},e.prototype.worldExtent=function(e,t,r){return r||(r=o.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=1,r.max.y=.5,r.max.z=t,r},e.prototype.projectPoint=function(t,r){return void 0===r&&(r={x:0,y:0,z:0}),r.x=(t.longitude*a+Math.PI)*e.geoToWorldScale,r.y=(t.latitude*a+.5*Math.PI)*e.geoToWorldScale,r.z=t.altitude||0,r},e.prototype.unprojectPoint=function(t){return i.GeoCoordinates.fromRadians(t.y*e.worldToGeoScale-.5*Math.PI,t.x*e.worldToGeoScale-Math.PI,t.z)},e.prototype.projectBox=function(t,r){var n=this.projectPoint(new i.GeoCoordinates(t.center.latitude,t.center.longitude,0)),a=t.latitudeSpanInRadians,s=t.longitudeSpanInRadians,u=t.altitudeSpan,l=s*e.geoToWorldScale,c=a*e.geoToWorldScale;return r||(r=o.MathUtils.newEmptyBox3()),r.min.x=n.x-.5*l,r.min.y=n.y-.5*c,r.max.x=n.x+.5*l,r.max.y=n.y+.5*c,void 0!==u?(r.min.z=n.z-.5*u,r.max.z=n.z+.5*u):(r.min.z=0,r.max.z=0),r},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,r)},e.geoToWorldScale=1/(2*Math.PI),e.worldToGeoScale=2*Math.PI/1,e}();t.equirectangularProjection=new s},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(9),o=r(6),a=r(13),s=r(21),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.projectPoint=function(e,t){var r;r=e instanceof o.GeoCoordinates?e.normalized():new o.GeoCoordinates(e.latitude,e.longitude,e.altitude).normalized(),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE;var n=Math.sin(s.MercatorProjection.latitudeClamp(r.latitudeInRadians));return t.y=(.5-Math.log((1+n)/(1-n))/(4*Math.PI))*a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,t.z=e.altitude||0,t},t.prototype.unprojectPoint=function(e){var t=s.MercatorProjection.clamp(e.x,0,a.EarthConstants.EQUATORIAL_CIRCUMFERENCE)/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE-.5,r=.5-s.MercatorProjection.clamp(e.y,0,a.EarthConstants.EQUATORIAL_CIRCUMFERENCE)/a.EarthConstants.EQUATORIAL_CIRCUMFERENCE,n=360*t,i=90-360*Math.atan(Math.exp(2*-r*Math.PI))/Math.PI;return new o.GeoCoordinates(i,n,e.z)},t.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return new i.GeoBox(new o.GeoCoordinates(r.latitude,t.longitude,t.altitude),new o.GeoCoordinates(t.latitude,r.longitude,r.altitude))},t.MAXIMUM_LATITUDE=1.4844222297453322,t}(s.MercatorProjection);t.webMercatorProjection=new u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(10),i=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.tilingScheme=e,this.minElevation=t,this.maxElevation=r,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,r);var n=this.m_worldBox,i=n.min,o=n.max;this.m_worldDimensions={x:o.x-i.x,y:o.y-i.y,z:o.z-i.z}}return Object.defineProperty(e.prototype,"projection",{get:function(){return this.m_tilingScheme.projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisionScheme",{get:function(){return this.m_tilingScheme.subdivisionScheme},enumerable:!0,configurable:!0}),e.prototype.getWorldBox=function(e,t){var r=e.level,i=this.subdivisionScheme.getLevelDimensionX(r),o=this.subdivisionScheme.getLevelDimensionY(r),a=this.m_worldDimensions.x/i,s=this.m_worldDimensions.y/o,u=this.m_worldBox.min.x+a*e.column,l=this.m_worldBox.min.y+s*e.row;return t||(t=n.MathUtils.newEmptyBox3()),t.min.x=u,t.min.y=l,t.min.z=this.m_worldBox.min.z,t.max.x=u+a,t.max.y=l+s,t.max.z=this.m_worldBox.max.z,t},e.prototype.getGeoBox=function(e){var t=this.getWorldBox(e);return this.projection.unprojectBox(t)},e}();t.FlatTileBoundingBoxGenerator=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.getSubdivisionX=function(){return 2},e.prototype.getSubdivisionY=function(e){return 0===e?1:2},e.prototype.getLevelDimensionX=function(e){return 1<<e},e.prototype.getLevelDimensionY=function(e){return 0!==e?1<<e-1:1},e}();t.halfQuadTreeSubdivisionScheme=new n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8),i=function(){function e(e,t,r){this.m_tileKey=e,this.m_level=t,this.m_count=1<<(t<<1),this.m_mask=r,this.m_shift=t>2?t-2<<1:0}return Object.defineProperty(e.prototype,"length",{get:function(){return this.m_count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.m_level},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileKey",{get:function(){return this.m_tileKey},enumerable:!0,configurable:!0}),e.prototype.iterator=function(){return new e.Iterator(this)},e.prototype.skip=function(e){if(-1!==this.m_mask)for(;e<this.m_count&&0==(this.m_mask&1<<(e>>this.m_shift));)++e;return e},e}();t.SubTiles=i,function(e){var t=function(){function e(e,t){void 0===t&&(t=0),this.m_parent=e,this.m_index=e.skip(t)}return Object.defineProperty(e.prototype,"value",{get:function(){var e=this.m_parent.tileKey,t=this.m_parent.level;return n.TileKey.fromRowColumnLevel(e.row<<t|this.m_index>>t,e.column<<t|this.m_index&(1<<t)-1,e.level+t)},enumerable:!0,configurable:!0}),e.prototype.next=function(){this.m_index=this.m_parent.skip(++this.m_index)},e}();e.Iterator=t}(i=t.SubTiles||(t.SubTiles={})),t.SubTiles=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=r(8),o=function(){function e(){}return e.geoCoordinatesToTileKey=function(e,t,r){var n=e.projection,o=e.subdivisionScheme,a=n.projectPoint(t),s=o.getLevelDimensionX(r),u=o.getLevelDimensionY(r),l=n.worldExtent(0,0),c=l.min,d=l.max,h=d.x-c.x,f=d.y-c.y;if(a.x<c.x||a.x>d.x)return null;if(a.y<c.y||a.y>d.y)return null;var p=Math.min(s-1,Math.floor(s*(a.x-c.x)/h)),m=Math.min(u-1,Math.floor(u*(a.y-c.y)/f));return i.TileKey.fromRowColumnLevel(m,p,r)},e.geoRectangleToTileKeys=function(t,r,o){var a=function(e,t,r){return e<t?r-(t-e)%(r-t):t+(e-t)%(r-t)},s=function(e,t,r){return Math.min(Math.max(e,t),r)},u=a(r.southWest.longitudeInRadians,-Math.PI,Math.PI),l=s(r.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),c=a(r.northEast.longitudeInRadians,-Math.PI,Math.PI),d=s(r.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=e.geoCoordinatesToTileKey(t,n.GeoCoordinates.fromRadians(l,u),o),f=e.geoCoordinatesToTileKey(t,n.GeoCoordinates.fromRadians(d,c),o),p=t.subdivisionScheme.getLevelDimensionX(o);if(!h||!f)throw new Error("Invalid coordinates");var m=h.column,y=f.column;u>c&&(y+=y!==m?p:p-1);for(var v=Math.min(h.row,f.row),g=Math.max(h.row,f.row),b=new Array,_=v;_<=g;++_)for(var x=m;x<=y;++x)b.push(i.TileKey.fromRowColumnLevel(_,x%p,o));return b},e}();t.TileKeyUtils=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(42),i=function(){function e(e){this.m_subdivisionScheme=e}return e.prototype.subTiles=function(e){for(var t=~(-1<<this.m_subdivisionScheme.getSubdivisionX(e.level)*this.m_subdivisionScheme.getSubdivisionY(e.level)),r=new n.SubTiles(e,1,t),i=r.iterator(),o=new Array,a=0;a<r.length;++a)o.push(i.value),i.next();return o},e}();t.TileTreeTraverse=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(23),a="\nattribute vec2 position;\nattribute vec4 tangents;\nattribute vec2 segment;\nattribute vec2 angles;\nattribute vec2 texcoord;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float lineWidth;\n\nvarying vec2 vPosition;\nvarying vec2 vTexcoord;\nvarying vec2 vSegment;\nvarying float vLinewidth;\n\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n#include <fog_pars_vertex>\n#include <project_line_vert_func>\n\nvoid main() {\n    vLinewidth = lineWidth;\n    vSegment = segment;\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = position;\n    vec2 uvs = texcoord;\n    projectVertex(segment, normalize(tangents.xy), normalize(tangents.zw), lineWidth, pos, uvs);\n\n    vPosition = pos;\n    vTexcoord = vec2(uvs.x, uvs.y * lineWidth);\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 0.0, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n    #include <fog_vertex>\n}",s="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform vec2 tileSize;\n#if DASHED_LINE\nuniform float dashSize;\nuniform float gapSize;\n#endif\n\nvarying vec2 vPosition;\nvarying vec2 vTexcoord;\nvarying vec2 vSegment;\nvarying float vLinewidth;\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\n#include <join_dist_func>\n#include <tile_clip_func>\n#include <fog_pars_fragment>\n\nvoid main() {\n\n    float alpha = opacity;\n\n    #if TILE_CLIP\n    tileClip(vPosition, tileSize);\n    #endif\n\n    #if DASHED_LINE\n    float halfSegment = (dashSize + gapSize) / dashSize * 0.5;\n    float segmentDist = mod(vTexcoord.x, dashSize + gapSize) / dashSize;\n    float dist = 0.5 - distance(segmentDist, halfSegment);\n    float width = fwidth(dist);\n    alpha *= smoothstep(-width, width, dist);\n    #else\n    float dist = joinDist(vSegment, vTexcoord) - vLinewidth;\n    float width = fwidth(dist);\n    alpha *= (1.0 - smoothstep(-width, width, dist));\n    #endif\n\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, alpha );\n    #else\n    gl_FragColor = vec4( diffuse, alpha );\n    #endif\n    #include <fog_fragment>\n}",u=function(e){function t(r){var n=this;Object.assign(i.ShaderChunk,o.default);var u={DASHED_LINE:0,TILE_CLIP:0},l=void 0!==r&&!0===r.fog;l&&(u.USE_FOG="");var c={name:"SolidLineMaterial",vertexShader:a,fragmentShader:s,uniforms:i.UniformsUtils.merge([{diffuse:new i.Uniform(new i.Color(t.DEFAULT_COLOR)),lineWidth:new i.Uniform(t.DEFAULT_WIDTH),opacity:new i.Uniform(t.DEFAULT_OPACITY),tileSize:new i.Uniform(new i.Vector2)},i.UniformsLib.fog]),defines:u,transparent:!0,fog:!0};return(n=e.call(this,c)||this).extensions.derivatives=!0,void 0!==r&&(void 0!==r.color&&n.color.set(r.color),void 0!==r.lineWidth&&(n.lineWidth=r.lineWidth),void 0!==r.opacity&&(n.opacity=r.opacity),void 0!==r.depthTest&&(n.depthTest=r.depthTest),n.fog=l),n}return n(t,e),t.prototype.updateFog=function(e){e?this.defines.USE_FOG="":delete this.defines.USE_FOG},Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e},enumerable:!0,configurable:!0}),t.DEFAULT_COLOR=16711680,t.DEFAULT_WIDTH=1,t.DEFAULT_OPACITY=1,t}(i.RawShaderMaterial);t.SolidLineMaterial=u},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(3);function a(e){return e instanceof Array&&e.length>0&&void 0!==e[0].value}function s(e,t){var r,i;{if(!(e instanceof Array))return e;try{for(var o=n(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(!(void 0!==s.minLevel&&t<s.minLevel)&&!(void 0!==s.maxLevel&&t>s.maxLevel))return s.value}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}}}t.isPointTechnique=function(e){return"point"===e.name},t.isPoiTechnique=function(e){return"labeled-icon"===e.name},t.isLineMarkerTechnique=function(e){return"line-marker"===e.name},t.isLineTechnique=function(e){return"line"===e.name},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=function(e){return"extruded-line"===e.name},t.isFillTechnique=function(e){return"fill"===e.name},t.isExtrudedPolygonTechnique=function(e){return"extruded-polygon"===e.name},t.isStandardTechnique=function(e){return"standard"===e.name},t.isStandardTexturedTechnique=function(e){return"standard-textured"===e.name},t.isLandmarkTechnique=function(e){return"landmark"===e.name},t.isTextTechnique=function(e){return"text"===e.name},t.isShaderTechnique=function(e){return"shader"===e.name},t.getMaterialConstructor=function(e){switch(e.name){case"extruded-line":return"standard"===e.shading?i.MeshStandardMaterial:i.MeshBasicMaterial;case"standard":case"standard-textured":case"landmark":case"extruded-polygon":return i.MeshStandardMaterial;case"solid-line":return o.SolidLineMaterial;case"dashed-line":return o.DashedLineMaterial;case"fill":return i.MeshBasicMaterial;case"point":return i.PointsMaterial;case"line":case"segments":return i.LineBasicMaterial;case"shader":return i.ShaderMaterial;case"text":case"labeled-icon":case"line-marker":return}},t.getObjectConstructor=function(e){switch(e.name){case"extruded-line":case"standard":case"standard-textured":case"landmark":case"extruded-polygon":case"fill":case"solid-line":case"dashed-line":return i.Mesh;case"point":return i.Points;case"line":case"segments":return i.LineSegments;case"shader":switch(e.primitive){case"line":return i.Line;case"segments":return i.LineSegments;case"point":return i.Points;case"mesh":return i.Mesh;default:return}case"text":case"labeled-icon":case"line-marker":return}},t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=["name","id","renderOrder","renderOrderBiasProperty","renderOrderBiasGroup","renderOrderBiasRange","transient"],t.getPropertyValue=s,t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.format},t.getAttributeValue=function(e,t){return a(e)?s(e,t):e},t.toWrappingMode=function(e){if("clamp"===e)return i.ClampToEdgeWrapping;if("repeat"===e)return i.RepeatWrapping;if("mirror"===e)return i.MirroredRepeatWrapping;throw new Error("invalid wrapping: "+e)},t.applyTechniqueToMaterial=function(e,r,n,o){Object.getOwnPropertyNames(e).forEach(function(u){if(!(u.startsWith("_")||-1!==t.BASE_TECHNIQUE_NON_MATERIAL_PROPS.indexOf(u)||void 0!==o&&-1!==o.indexOf(u))){var l=u,c=r,d=e[l];void 0!==c[l]&&(void 0!==n&&a(d)&&(d=s(d,n)),c[l]instanceof i.Color?c[l].set(d):c[l]=d)}})}},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.error=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.error.apply(console,i([e],t))},e.prototype.debug=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.debug.apply(console,i([e],t))},e.prototype.info=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.info.apply(console,i([e],t))},e.prototype.log=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.log.apply(console,i([e],t))},e.prototype.trace=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.trace.apply(console,i([e],t))},e.prototype.warn=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];console.warn.apply(console,i([e],t))},e}();t.ConsoleChannel=o},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(25),a=function(){function e(e,t,r){this.name=e,this.m_channel=t,this.enabled=!0,this.level=o.LogLevel.Trace,void 0!==r&&this.update(r)}return e.prototype.error=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.enabled&&this.level<=o.LogLevel.Error&&(t=this.m_channel).error.apply(t,i([this.prefix,e],r))},e.prototype.debug=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.enabled&&this.level<=o.LogLevel.Debug&&(t=this.m_channel).debug.apply(t,i([this.prefix,e],r))},e.prototype.info=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.enabled&&this.level<=o.LogLevel.Info&&(t=this.m_channel).info.apply(t,i([this.prefix,e],r))},e.prototype.log=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.enabled&&this.level<=o.LogLevel.Log&&(t=this.m_channel).log.apply(t,i([this.prefix,e],r))},e.prototype.trace=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.enabled&&this.level<=o.LogLevel.Trace&&(t=this.m_channel).trace.apply(t,i([this.prefix,e],r))},e.prototype.warn=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.enabled&&this.level<=o.LogLevel.Warn&&(t=this.m_channel).warn.apply(t,i([this.prefix,e],r))},e.prototype.update=function(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level},Object.defineProperty(e.prototype,"prefix",{get:function(){return this.name+":"},enumerable:!0,configurable:!0}),e}();t.Logger=a},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(25);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";var a=function(){function e(){}return e.prototype.error=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={message:i([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Error};self.postMessage(a)},e.prototype.debug=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={message:i([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Debug};self.postMessage(a)},e.prototype.info=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={message:i([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Info};self.postMessage(a)},e.prototype.log=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={message:i([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Log};self.postMessage(a)},e.prototype.trace=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={message:i([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Trace};self.postMessage(a)},e.prototype.warn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={message:i([e],r),type:t.WORKERCHANNEL_MSG_TYPE,level:o.LogLevel.Warn};self.postMessage(a)},e}();t.WorkerChannel=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=new n.Vector3(0,0,1),o=[0,1,2,1,3,2],a=16,s=2*Math.PI/a;function u(e,t,r,n,i){var o=n.length/3;n.push(e,t,0);for(var u=0;u<a;++u)n.push(e+r*Math.cos(s*u),t+r*Math.sin(s*u),0),i.push(o,o+u+1,o+(u+1)%a+1)}t.numCirclePoints=function(e){return a},t.triangulateLine=function(e,t,r,a,s,l){if(void 0===s&&(s=!0),void 0===l&&(l=s),0!==e.length){s&&u(e[0],e[1],t,r,a);for(var c=r.length/3,d=new n.Vector3,h=new n.Vector3,f=new n.Vector3,p=new n.Vector3,m=new n.Vector3,y=new n.Vector3,v=new n.Vector3,g=e.length/2,b=0;b<g;++b)h.set(e[2*b],e[2*b+1],0),b+1<g?(f.set(e[2*(b+1)],e[2*(b+1)+1],0),p.copy(f).sub(h).normalize().cross(i),m.copy(p),b>0&&m.add(d).multiplyScalar(1-.5*p.dot(d)),y.copy(m).multiplyScalar(-t).add(h),v.copy(m).multiplyScalar(t).add(h),r.push(y.x,y.y,y.z,v.x,v.y,v.z),d.copy(p)):(y.copy(d).multiplyScalar(-t).add(h),v.copy(d).multiplyScalar(t).add(h),r.push(y.x,y.y,y.z,v.x,v.y,v.z));var _=function(e){o.forEach(function(t){return a.push(c+2*e+t)})};for(b=0;b<g-1;++b)_(b);l&&u(e[2*(g-1)],e[2*(g-1)+1],t,r,a)}},t.reconstructLine=function(e,t){for(var r=new Float32Array(e.length/2),n=3*t,i=2*n;n<r.length;n+=3,i+=6)r[n]=e[i]+.5*(e[i+3]-e[i]),r[n+1]=e[i+1]+.5*(e[i+3+1]-e[i+1]),r[n+2]=e[i+2]+.5*(e[i+3+2]-e[i+2]);return r},t.reconstructLineWidth=function(e,t){var r=e[2*t+3]-e[2*t],n=e[2*t+3+1]-e[2*t+1],i=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(r*r+n*n+i*i)}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),o=r(0),a=r(28),s=function(e){function t(t,r,n,a,s){var u=e.call(this,void 0===t?new o.BufferGeometry:t,r)||this;return u.dimensionality=0,void 0===r&&(r=new i.HighPrecisionLineMaterial({color:a||i.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:i.HighPrecisionLineMaterial.DEFAULT_OPACITY})),u.matrixWorldInverse=new o.Matrix4,n&&u.setPositions(n),u}return n(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e){this.dimensionality=a.HighPrecisionUtils.setPositions(this,e)},t.prototype.setupForRendering=function(){var e=this;if(0===this.dimensionality||void 0===this.dimensionality)throw new Error("HighPrecisionLine: positions not specified.");this.material.isHighPrecisionLineMaterial&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,r,n,i,o,s){a.HighPrecisionUtils.updateHpUniforms(e,n,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var r=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),r&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(o.Line);t.HighPrecisionWireFrameLine=s;var u=function(e){function t(t,r,n,a,s){var u=e.call(this,void 0===t?new o.BufferGeometry:t,r)||this;return u.dimensionality=0,void 0===r&&(r=new i.HighPrecisionLineMaterial({color:a||i.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:i.HighPrecisionLineMaterial.DEFAULT_OPACITY})),u.matrixWorldInverse=new o.Matrix4,n&&u.setPositions(n),u}return n(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e,t){this.dimensionality=a.HighPrecisionUtils.setPositions(this,e,t)},t.prototype.setupForRendering=function(){var e=this;this.material.isHighPrecisionLineMaterial&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,r,n,i,o,s){a.HighPrecisionUtils.updateHpUniforms(e,n,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var r=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),r&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(o.Mesh);t.HighPrecisionLine=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){}}();t.DataProvider=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(134))},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this,"Request cancelled")||this;return t.isCancelled=!0,t}return n(t,e),t}(Error);t.CancellationException=s;var u=function(){function e(){this.m_isCancelled=!1}return e.prototype.cancel=function(){this.m_isCancelled=!0,void 0!==this._cancel&&this._cancel()},Object.defineProperty(e.prototype,"isCancelled",{get:function(){return this.m_isCancelled},enumerable:!0,configurable:!0}),e}();t.CancellationToken=u;var l=function(){function e(t){var r,n,i=this;if(this.m_headers=new Map,void 0!==t)if(t instanceof e)t.forEach(function(e,t){return i.append(t,e)});else try{for(var o=a(Object.getOwnPropertyNames(t)),s=o.next();!s.done;s=o.next()){var u=s.value;this.append(u,t[u])}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}}return e.prototype.append=function(e,t){var r=this.m_headers.get(e);void 0===r?this.set(e,t):r.push(t)},e.prototype.getAll=function(e){var t=this.m_headers.get(e.toLowerCase());return void 0===t?[]:t},e.prototype.get=function(e){var t=this.m_headers.get(e.toLowerCase());return void 0===t?null:t[0]},e.prototype.set=function(e,t){this.m_headers.set(e.toLowerCase(),[t])},e.prototype.has=function(e){return this.m_headers.has(e.toLowerCase())},e.prototype.forEach=function(e){var t=this;this.m_headers.forEach(function(r,n){r.forEach(function(r){return e(r,n,t)})})},e}();t.Headers=l,t.vanillaFetch=function(e,t){return i(this,void 0,void 0,function(){var t;return o(this,function(r){switch(r.label){case 0:return[4,fetch(e)];case 1:return[2,{status:(t=r.sent()).status,statusText:t.statusText,ok:t.ok,type:t.type,url:e,headers:t.headers,arrayBuffer:function(){return t.arrayBuffer()},json:function(){return t.json()},text:function(){return t.text()}}]}})})},t.addBearerToken=function(e,t){return i(this,void 0,void 0,function(){var r;return o(this,function(n){switch(n.label){case 0:return void 0===t&&(t={}),void 0===t.headers&&(t.headers=new l),[4,e()];case 1:return r=n.sent(),t.headers.append("Authorization","Bearer "+r),[2,t]}})})}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(136),s=r(5);function u(e){if(void 0!==e)return{method:e.method,body:e.body,headers:void 0===e.headers?void 0:new s.Headers(e.headers)}}var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(a.RequestBuilder);t.DataStoreRequestBuilder=l;var c=function(e){function t(t,r,n,i){var o=e.call(this,r)||this;return o.downloadManager=t,o.app_id=n,o.app_code=i,o}return n(t,e),t.prototype.clone=function(e){return new t(this.downloadManager,void 0===e?this.baseUrl:e,this.app_id,this.app_code)},t.prototype.download=function(e,t){return this.downloadManager.downloadJson(e,u(t))},t.prototype.request=function(e,t){return void 0!==this.app_id&&void 0!==this.app_code&&(e.appendQuery("app_id",this.app_id),e.appendQuery("app_code",this.app_code)),this.download(e.url,t)},t.prototype.downloadData=function(e,t){var r=e;if(void 0!==this.app_id&&void 0!==this.app_code){var n=e.includes("?"),i=new a.UrlBuilder(e,n);i.appendQuery("app_id",this.app_id),i.appendQuery("app_code",this.app_code),r=i.url}return this.downloadManager.download(r,t)},t}(l);t.DataStoreAppIdRequestBuilder=c;var d=function(e){function t(t,r,n){var i=e.call(this,r)||this;return i.downloadManager=t,i.getBearerToken=n,i}return n(t,e),t.prototype.clone=function(e){return new t(this.downloadManager,void 0===e?this.baseUrl:e,this.getBearerToken)},t.prototype.download=function(e,t){return i(this,void 0,void 0,function(){var r;return o(this,function(n){switch(n.label){case 0:return[4,this.addBearerToken(u(t))];case 1:return r=n.sent(),[2,this.downloadManager.downloadJson(e,r)]}})})},t.prototype.downloadData=function(e,t){return i(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this.addBearerToken(t)];case 1:return t=r.sent(),[2,this.downloadManager.download(e,t)]}})})},t.prototype.addBearerToken=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){return[2,s.addBearerToken(this.getBearerToken,e)]})})},t}(l);t.DataStoreOAuthRequestBuilder=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){return function(e,t,r,n,i){this.key=e,this.value=t,this.size=r,this.newer=n,this.older=i}}();t.Entry=i;var o=function(){function e(e,t){void 0===t&&(t=function(){return 1}),this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}return e.prototype.forEach=function(e,t){for(var r=this.m_newest;null!==r;)e.call(t,r.value,r.key,this),r=r.older},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this.m_capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this.m_map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"newest",{get:function(){return this.m_newest},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldest",{get:function(){return this.m_oldest},enumerable:!0,configurable:!0}),e.prototype.setCapacity=function(e){for(this.m_capacity=e;this.m_size>this.m_capacity;)this.evict()},e.prototype.set=function(e,t){var r=this.m_sizeFunction(t),o=this.m_map.get(e);if(void 0!==o)this.m_size=this.m_size-o.size+r,o.value=t,o.size=r,this.promote(o),this.evict();else{if(r>this.m_capacity)return;if(o=new i(e,t,r,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=o;else{n.assert(null!==this.m_newest);var a=this.m_newest;o.older=this.m_newest,a.newer=o,this.m_newest=o}this.m_map.set(e,o),this.m_size+=r,this.evict()}},e.prototype.get=function(e){var t=this.m_map.get(e);if(void 0!==t)return this.promote(t),t.value},e.prototype.has=function(e){return this.m_map.has(e)},e.prototype.clear=function(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()},e.prototype.evictAll=function(){var e=this.evictionCallback;void 0!==e&&this.forEach(function(t,r){return e(r,t)}),this.clear()},e.prototype.delete=function(e){var t=this.m_map.get(e);return void 0!==t&&(t===this.m_newest?this.m_newest=t.older:t.newer?t.newer.older=t.older:n.assert(!1),t===this.m_oldest?this.m_oldest=t.newer:t.older?t.older.newer=t.newer:n.assert(!1),this.m_size-=t.size,this.m_map.delete(e))},e.prototype.evict=function(){for(;this.m_size>this.m_capacity;)this.evictOldest()},e.prototype.evictOldest=function(){n.assert(null!==this.m_oldest);var e=this.m_oldest;n.assert(null===e.older);var t=e;this.m_oldest=t.newer,null!==t.newer&&(n.assert(t.newer.older===t),t.newer.older=null);var r=this.m_map.delete(t.key);return n.assert(!0===r),r&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t},e.prototype.promote=function(e){if(e!==this.m_newest){e.newer&&(n.assert(e.newer.older===e),e.newer.older=e.older),e.older&&(n.assert(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,n.assert(null!==this.m_newest);var t=this.m_newest;n.assert(null===t.newer),t.newer=e,this.m_newest=e}},e}();t.LRUCache=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),o=function(){function e(){this.status=204,this.statusText="No Content",this.ok=!0,this.type="default"}return Object.defineProperty(e.prototype,"headers",{get:function(){return new i.Headers},enumerable:!0,configurable:!0}),e.prototype.arrayBuffer=function(){return Promise.resolve(new ArrayBuffer(0))},e.prototype.json=function(){return Promise.reject(new Error("Response has no body"))},e.prototype.text=function(){return Promise.resolve("")},e}();t.Error204Response=o;var a=function(e){function t(t,r){var n=this.constructor,i=e.call(this,t)||this;return i.name="HTTPError",Object.setPrototypeOf(i,n.prototype),i.message=t||"",i.statusText=r&&r.statusText||"",i.status=r&&r.status||0,i}return n(t,e),t}(Error);t.ErrorHTTPResponse=a},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(60)),n(r(17)),n(r(61)),n(r(146)),n(r(147)),n(r(64)),n(r(65)),n(r(18)),n(r(19)),n(r(69)),n(r(71)),n(r(155)),n(r(75)),n(r(20)),n(r(73)),n(r(74)),n(r(164)),n(r(165)),n(r(78)),n(r(16)),n(r(77)),n(r(68)),n(r(76)),n(r(35))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(16),o=300,a=function(){function e(e,t,r){this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=r,this.m_lastCameraPos=new n.Vector3,this.m_newCameraPos=new n.Vector3,this.m_lastWorldCenter=new n.Vector3,this.m_throttlingTimerId=void 0,void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=o)}return e.prototype.checkCameraMoved=function(e){var t=i.MapViewUtils.extractYawPitchRoll(e.camera.quaternion),r=e.camera.getWorldPosition(this.m_newCameraPos),n=void 0===this.m_lastYawPitchRoll||!this.m_lastCameraPos.equals(r)||!this.m_lastWorldCenter.equals(e.worldCenter)||t.yaw!==this.m_lastYawPitchRoll.yaw||t.pitch!==this.m_lastYawPitchRoll.pitch||t.roll!==this.m_lastYawPitchRoll.roll;return n&&(this.m_lastCameraPos.copy(r),this.m_lastWorldCenter.copy(e.worldCenter),this.m_lastYawPitchRoll=t),n!==this.m_cameraMovedLastFrame&&(n&&this.movementStarted(),this.m_cameraMovedLastFrame=n),n&&this.startMovementFinishedTimer(),this.m_cameraMovedLastFrame},Object.defineProperty(e.prototype,"cameraIsMoving",{get:function(){return void 0!==this.m_throttlingTimerId},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0},Object.defineProperty(e.prototype,"cameraMovedLastFrame",{get:function(){return!0===this.m_cameraMovedLastFrame},enumerable:!0,configurable:!0}),e.prototype.movementStarted=function(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()},e.prototype.movementFinished=function(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()},e.prototype.startMovementFinishedTimer=function(){var e=this;this.removeMovementFinishedTimer(),this.m_throttlingTimerId=setTimeout(function(){return e.movementFinished()},this.m_throttlingTimeout)},e.prototype.removeMovementFinishedTimer=function(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)},e}();t.CameraMovementDetector=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(144);t.IPassManager=n.IPassManager;var i=r(145);t.IMapAntialiasSettings=i.IMapAntialiasSettings,t.IMapRenderingManager=i.IMapRenderingManager,t.MapRenderingManager=i.MapRenderingManager;var o=r(63);t.IPass=o.IPass,t.Pass=o.Pass;var a=r(62);t.MSAARenderPass=a.MSAARenderPass,t.MSAASampling=a.MSAASampling},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i,o=r(3),a=r(0),s=r(63);!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(i=t.MSAASampling||(t.MSAASampling={}));var u=function(e){function t(){var t=e.call(this)||this;return t.samplingLevel=i.Level_1,t.m_renderTarget=null,t.m_localCamera=new a.OrthographicCamera(-1,1,1,-1,0,1),t.m_quadScene=new a.Scene,t.m_quadUniforms=o.CopyShader.uniforms,t.m_quadMaterial=new o.MSAAMaterial(t.m_quadUniforms),t.m_quad=new a.Mesh(new a.PlaneBufferGeometry(2,2),t.m_quadMaterial),t.m_quad.frustumCulled=!1,t.m_quadScene.add(t.m_quad),t}return n(t,e),t.prototype.dispose=function(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)},t.prototype.render=function(e,r,n,i,o){if(this.enabled){null===this.m_renderTarget&&(this.m_renderTarget=new a.WebGLRenderTarget(o.width,o.height,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;var s=t.OffsetVectors[this.samplingLevel],u=e.getClearColor().getHex(),l={enabled:null!==n.view&&n.view.enabled,fullWidth:o.width,fullHeight:o.height,x:0,y:0,width:o.width,height:o.height};l.enabled&&null!==n.view&&(l.fullWidth=n.view.fullWidth,l.fullHeight=n.view.fullHeight,l.x=n.view.offsetX,l.y=n.view.offsetY,l.width=n.view.width,l.height=n.view.height);for(var c=0;c<s.length;c++){var d=s[c];n.setViewOffset(l.fullWidth,l.fullHeight,l.x+d[0]/16,l.y+d[1]/16,l.width,l.height);var h=(c+.5)/s.length-.5,f=1/s.length+h/32;this.m_quadUniforms.opacity.value=f,e.render(r,n,this.m_renderTarget,!0),0===c&&e.setClearColor(0),e.render(this.m_quadScene,this.m_localCamera,this.renderToScreen?void 0:i,0===c),0===c&&e.setClearColor(u)}null!==n.view&&(n.view.enabled=l.enabled,n.view.offsetX=l.x,n.view.offsetY=l.y)}},t.prototype.setSize=function(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)},t.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],t}(s.Pass);t.MSAARenderPass=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.enabled=!0,this.renderToScreen=!1}return e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,r,n,i,o){},e}();t.Pass=n},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=i.LoggerManager.instance.create("ImageCache"),s=(function(){}(),function(){function e(){this.m_images=new Map}return Object.defineProperty(e,"instance",{get:function(){return void 0===e.m_instance&&(e.m_instance=new e),e.m_instance},enumerable:!0,configurable:!0}),e.dispose=function(){e.m_instance=void 0},e.prototype.registerImage=function(e,t,r){var n=this.findImageCacheItem(t);if(void 0!==n)return void 0!==e&&n.mapViews.indexOf(e)<0&&n.mapViews.push(e),n.imageItem;if(void 0!==(n=this.findImageCacheItem(t)))return void 0!==e&&n.mapViews.indexOf(e)<0&&n.mapViews.push(e),n.imageItem;var i=[];return void 0!==e&&i.push(e),n={imageItem:{url:t,imageData:r,loaded:!1},mapViews:i},this.m_images.set(t,n),n.imageItem},e.prototype.addImage=function(e,t,r){void 0===r&&(r=!0);var n=this.registerImage(e,t,void 0);return void 0!==n&&!0===r?this.loadImage(n):n},e.prototype.findImage=function(e){var t=this.m_images.get(e);if(void 0!==t)return t.imageItem},e.prototype.clear=function(e){var t,r,i=[];this.m_images.forEach(function(t){var r=t.mapViews.indexOf(e);r>=0&&t.mapViews.splice(r,1),0===t.mapViews.length&&i.push(t.imageItem.url)});try{for(var o=n(i),a=o.next();!a.done;a=o.next()){var s=a.value;this.m_images.delete(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.clearAll=function(){this.m_images=new Map},Object.defineProperty(e.prototype,"size",{get:function(){return this.m_images.size},enumerable:!0,configurable:!0}),e.prototype.loadImage=function(e){var t=this;if(void 0!==e.imageData)return e;if(void 0!==e.loadingPromise)return e.loadingPromise;var r=new o.ImageLoader;return e.loadingPromise=new Promise(function(n){a.log("Loading image: "+e.url),r.load(e.url,function(r){a.log("... finished loading image: "+e.url),t.renderImage(e,r).then(function(){e.loadingPromise=void 0,n(e)}).catch(function(t){a.error("... loading image failed: "+e.url+" : "+t),n(void 0)})},void 0,function(t){a.error("... loading image failed: "+e.url+" : "+t),e.loadingPromise=void 0,n(void 0)})}),e.loadingPromise},e.prototype.findImageCacheItem=function(e){return this.m_images.get(e)},e.prototype.renderImage=function(e,t){return new Promise(function(r,n){if("function"==typeof createImageBitmap){a.log("Creating bitmap image: "+e.url),createImageBitmap(t,0,0,t.width,t.height,{premultiplyAlpha:"default",imageOrientation:"flipY"}).then(function(t){a.log("... finished creating bitmap image: "+e.url),e.loadingPromise=void 0,e.imageData=t,e.loaded=!0,r(t)}).catch(function(t){a.error("... loading image failed: "+e.url+" : "+t),r(void 0)})}else try{"undefined"==typeof document&&(a.error("Error: document is not available, cannot generate image"),n(new Error("ImageCache#renderImage: document is not available, cannot render image to create texture")));var i=document.createElement("canvas");i.width=t.width,i.height=t.height;var o=i.getContext("2d");if(null!==o){a.log("... finished creating bitmap image in canvas: "+e.url+" "+t),o.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height);var s=o.getImageData(0,0,t.width,t.height);e.imageData=s,e.loaded=!0,r(s)}else a.error("renderImage: no context found"),n(new Error("ImageCache#renderImage: no context found"))}catch(t){a.error("renderImage failed: "+t),e.imageData=void 0,e.loaded=!0,n(new Error("ImageCache#renderImage failed: "+t))}})},e}());t.ImageCache=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(64),i=function(){function e(e){this.mapView=e,this.m_name2Url=new Map,this.m_url2Name=new Map}return e.prototype.registerImage=function(e,t,r){if(void 0!==e){if(this.hasName(e))throw new Error("duplicate name in cache");var i=this.m_url2Name.get(t);void 0!==i?i.indexOf(e)<0&&i.push(e):this.m_url2Name.set(t,[e]),this.m_name2Url.set(e,t)}var o=n.ImageCache.instance.findImage(t);return void 0===o?n.ImageCache.instance.registerImage(this.mapView,t,r):o},e.prototype.addImage=function(e,t,r){void 0===r&&(r=!0);var i=this.registerImage(e,t,void 0);return!0===r?n.ImageCache.instance.loadImage(i):i},e.prototype.findImageByName=function(e){var t=this.m_name2Url.get(e);if(void 0!==t)return n.ImageCache.instance.findImage(t)},e.prototype.findImageByUrl=function(e){return n.ImageCache.instance.findImage(e)},e.prototype.loadImage=function(e){return n.ImageCache.instance.loadImage(e)},e.prototype.clear=function(){n.ImageCache.instance.clear(this.mapView),this.m_name2Url=new Map,this.m_url2Name=new Map},Object.defineProperty(e.prototype,"numberOfNames",{get:function(){return this.m_name2Url.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfUrls",{get:function(){return this.m_url2Name.size},enumerable:!0,configurable:!0}),e.prototype.hasName=function(e){return void 0!==this.m_name2Url.get(e)},e.prototype.hasUrl=function(e){return void 0!==this.m_url2Name.get(e)},e.prototype.findNames=function(e){return this.m_url2Name.get(e)},e}();t.MapViewImageCache=i},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(15),o=r(3),a=r(0),s=r(31),u=r(32),l=r(67),c=new a.Vector3(0,0,0),d=new a.Matrix4,h=new Array;t.GLYPH_CACHE_SIZE=1024,t.GLYPH_CACHE_WIDTH=Math.sqrt(t.GLYPH_CACHE_SIZE),t.GLYPH_CACHE_TEXTURE_SIZE=2048,t.GLYPH_CACHE_ENTRY_WIDTH=t.GLYPH_CACHE_TEXTURE_SIZE/t.GLYPH_CACHE_WIDTH;var f=function(){function e(e){this.fontCatalogAsset=e,this.m_scene=new a.Scene,this.m_glyphCache=new i.LRUCache(t.GLYPH_CACHE_SIZE),this.initCacheEntries(),this.m_camera=new a.OrthographicCamera(0,t.GLYPH_CACHE_TEXTURE_SIZE,t.GLYPH_CACHE_TEXTURE_SIZE,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new a.WebGLRenderTarget(t.GLYPH_CACHE_TEXTURE_SIZE,t.GLYPH_CACHE_TEXTURE_SIZE),this.m_clearColor=new a.Color(0,0,0),this.m_copyMaterial=new o.GlyphCopyMaterial,this.m_copyTextureSet=new Set;var r=new u.TextBuffer(this.m_copyMaterial,this.m_copyMaterial);this.m_renderBuffer=new l.TextRenderBuffer(r,{fontCatalog:e,fontCatalogName:e.name}),this.m_scene.add(this.m_renderBuffer.textBuffer.mesh)}return Object.defineProperty(e.prototype,"size",{get:function(){return this.m_glyphCache.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this.m_glyphCache.capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_rt.texture},enumerable:!0,configurable:!0}),e.prototype.add=function(e,r){var i=e;if(!0===r&&(i+=s.BOLD_CODEPOINT_OFFSET),void 0===this.m_glyphCache.get(i)){var o=this.m_glyphCache.oldest;if(void 0===this.m_renderBuffer||void 0===this.m_renderBuffer.textStyle.fontCatalog||null===o)throw new Error("GlyphTextureCache not properly initialized.");var a=this.m_renderBuffer.textStyle.fontCatalog.getGlyph(i);if(void 0!==a){this.m_copyTextureSet.add(a.texture);var l,f,p=0;try{for(var m=n(this.m_copyTextureSet.values()),y=m.next();!y.done;y=m.next()){if(y.value===a.texture)break;p++}}catch(e){l={error:e}}finally{try{y&&!y.done&&(f=m.return)&&f.call(m)}finally{if(l)throw l.error}}a.page=p,d.identity(),c.set(o.value.location.x*t.GLYPH_CACHE_ENTRY_WIDTH,o.value.location.y*t.GLYPH_CACHE_ENTRY_WIDTH,0),d.setPosition(c),this.m_renderBuffer.textBuffer.addGlyph(a,this.m_clearColor,1,0,d,h,!1,s.TextVerticalAlignment.Center,!1,!1,u.TextBackgroundMode.Outline),a.s2=h[0].x/t.GLYPH_CACHE_TEXTURE_SIZE,a.t2=h[3].y/t.GLYPH_CACHE_TEXTURE_SIZE,a.s3=h[3].x/t.GLYPH_CACHE_TEXTURE_SIZE,a.t3=h[0].y/t.GLYPH_CACHE_TEXTURE_SIZE,this.m_glyphCache.set(i,{glyphInfo:a,location:o.value.location})}}},e.prototype.get=function(e,t){var r=e;return!0===t&&(r+=s.BOLD_CODEPOINT_OFFSET),this.m_glyphCache.get(r)},e.prototype.has=function(e,t){var r=e;return!0===t&&(r+=s.BOLD_CODEPOINT_OFFSET),this.m_glyphCache.has(r)},e.prototype.delete=function(e,t){var r=e;return!0===t&&(r+=s.BOLD_CODEPOINT_OFFSET),this.m_glyphCache.delete(r)},e.prototype.clear=function(){this.m_glyphCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()},e.prototype.disposeBuffer=function(){void 0!==this.m_renderBuffer&&(this.m_renderBuffer.dispose(),this.m_copyTextureSet.clear())},e.prototype.resetBuffer=function(){void 0!==this.m_renderBuffer&&(this.m_renderBuffer.reset(),this.m_copyTextureSet.clear())},e.prototype.updateBuffer=function(){void 0!==this.m_renderBuffer&&this.m_renderBuffer.updateBufferGeometry()},e.prototype.clearTexture=function(e){var t=e.getRenderTarget(),r=e.getClearColor();e.setRenderTarget(this.m_rt),e.setClearColor(this.m_clearColor),e.clear(!0),e.setRenderTarget(t),e.setClearColor(r)},e.prototype.updateTexture=function(e){for(var t=Array.from(this.m_copyTextureSet),r=Math.ceil(this.m_copyTextureSet.size/8),n=0;n<r;n++){var i=8*n;this.m_copyMaterial.uniforms.pageOffset.value=i;for(var o=0;o<8;o++){var a=i+o;a<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+o].value=t[a])}e.render(this.m_scene,this.m_camera,this.m_rt)}this.m_copyTextureSet.clear()},e.prototype.initCacheEntries=function(){for(var e=0;e<t.GLYPH_CACHE_WIDTH;e++)for(var r=0;r<t.GLYPH_CACHE_WIDTH;r++){var n={glyphInfo:{codepoint:0,advanceX:0,offsetX:0,offsetY:0,width:0,height:0,s0:0,t0:0,s1:0,t1:0,s2:0,t2:0,s3:0,t3:0,page:0,texture:a.Texture.DEFAULT_IMAGE,emulateBold:!1,size:0,lineHeight:0,base:0,metrics:{}},location:new a.Vector2(r,e)};this.m_glyphCache.set(-(e*t.GLYPH_CACHE_WIDTH+r+1),n)}},e}();t.GlyphTextureCache=f},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=r(0),u=r(66),l=r(32),c=a.LoggerManager.instance.create("TextRenderer");t.DEFAULT_TEXT_RENDER_ORDER=0,t.BG_TEXT_RENDER_ORDER=t.DEFAULT_TEXT_RENDER_ORDER+.1;var d=t.BG_TEXT_RENDER_ORDER+1e-9;t.DEFAULT_STYLE_NAME="default",t.DEFAULT_FONT_CATALOG_NAME="default";var h=function(){function e(e,r,n){void 0===n&&(n=t.DEFAULT_TEXT_RENDER_ORDER),this.textBuffer=e,this.textStyle=r,this.renderOrder=n}return e.prototype.reset=function(){this.textBuffer.reset()},e.prototype.dispose=function(){this.textBuffer.dispose()},e.prototype.updateBufferGeometry=function(){this.textBuffer.updateBufferGeometry()},e.prototype.cleanUp=function(){this.textBuffer.cleanUp()},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.textBuffer.isEmpty},enumerable:!0,configurable:!0}),e}();t.TextRenderBuffer=h;var f=function(){function e(){this.scenes=new Map,this.sortedScenes=[]}return e.prototype.getScene=function(e){var t=this;void 0===e&&(e=0);var r=Math.floor(e),n=this.scenes.get(r);void 0===n&&(n=new s.Scene,this.scenes.set(r,n),this.sortedScenes.length=0,new Map(i(this.scenes.entries()).sort()).forEach(function(e){t.sortedScenes.push(e)}));return n},e}();t.SceneSet=f;var p=function(){function e(e,t){this.styles=e,this.materialConstructor=t,this.sceneSet=new f,this.fontCatalogs=[],this.renderBuffers=new Map,this.glyphCaches=new Map,void 0!==e&&void 0!==t&&this.addFontCatalogStyles(e,t)}return e.prototype.defaultTextRenderBuffer=function(e){return void 0===e&&(e=t.DEFAULT_TEXT_RENDER_ORDER),void 0!==this.m_defaultRenderBuffer&&void 0!==this.m_defaultRenderBuffer.get(e)?this.m_defaultRenderBuffer.get(e):(this.m_defaultRenderBuffer=this.renderBuffers.get(t.DEFAULT_STYLE_NAME),void 0!==this.m_defaultRenderBuffer?this.m_defaultRenderBuffer.get(e):void 0)},Object.defineProperty(e.prototype,"defaultGlyphTextureCache",{get:function(){return this.m_defaultGlyphCache?this.m_defaultGlyphCache:(this.m_defaultGlyphCache=this.glyphCaches.get(t.DEFAULT_FONT_CATALOG_NAME),this.m_defaultGlyphCache)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{get:function(){var e=[];return this.renderBuffers.forEach(function(t){t.forEach(function(t){e.push(t.textBuffer)})}),e},enumerable:!0,configurable:!0}),e.prototype.getTextRendererBufferForStyle=function(e,r){if(void 0===r&&(r=t.DEFAULT_TEXT_RENDER_ORDER),void 0===e)return this.defaultTextRenderBuffer(r);var n=this.renderBuffers.get(e);if(void 0!==n){var i=n.get(r);return void 0===i?this.addOrderedTextBuffer(n,r):i}return void 0!==this.m_defaultRenderBuffer?this.m_defaultRenderBuffer.get(r):void 0},e.prototype.getGlyphTextureCacheForFontCatalog=function(e){if(void 0===e)return this.defaultGlyphTextureCache;var t=this.glyphCaches.get(e);return void 0!==t?t:this.defaultGlyphTextureCache},e.prototype.dispose=function(){this.renderBuffers.forEach(function(e){e.forEach(function(e){e.dispose()})})},e.prototype.reset=function(){this.renderBuffers.forEach(function(e){e.forEach(function(e){e.reset()})})},e.prototype.update=function(){this.renderBuffers.forEach(function(e){e.forEach(function(e){e.updateBufferGeometry()})})},e.prototype.render=function(e,t,r){try{for(var n=o(this.sceneSet.sortedScenes),i=n.next();!i.done;i=n.next()){var a=i.value,s=!1;if(a.children.length>0)try{for(var u=o(a.children),l=u.next();!l.done;l=u.next()){var c=l.value;if("BoxBufferMesh"===c.type){var d=c;d.visible=!d.isEmpty,s=s||d.visible}}}catch(e){p={error:e}}finally{try{l&&!l.done&&(m=u.return)&&m.call(u)}finally{if(p)throw p.error}}s&&(e.clearDepth(),e.render(a,t))}}catch(e){h={error:e}}finally{try{i&&!i.done&&(f=n.return)&&f.call(n)}finally{if(h)throw h.error}}var h,f,p,m;r||this.renderBuffers.forEach(function(e){e.forEach(function(e){e.cleanUp()})})},e.prototype.pickTextElements=function(e,t){try{for(var r=o(this.renderBuffers.values()),n=r.next();!n.done;n=r.next()){n.value.forEach(function(r){r.textBuffer.pickBoxes(e,t)})}}catch(e){i={error:e}}finally{try{n&&!n.done&&(a=r.return)&&a.call(r)}finally{if(i)throw i.error}}var i,a},e.prototype.addFontCatalogStyles=function(e,r){var n=this,i=new Set;e.forEach(function(e){void 0!==e.fontCatalog?i.add(e.fontCatalog):c.warn("No 'fontCatalog' defined in style:",e)}),i.forEach(function(e){var t=new u.GlyphTextureCache(e);n.glyphCaches.set(e.name,t),n.fontCatalogs.push(e.name)}),e.forEach(function(e){if(void 0===e.fontCatalog&&c.warn("No 'fontCatalog' defined in style:",e),void 0===e.name&&c.warn("No 'name' defined in style:",e),void 0!==e.fontCatalog&&void 0!==e.name){var i=n.glyphCaches.get(e.fontCatalog.name);if(void 0!==i){var o={texture:i.texture,textureSize:u.GLYPH_CACHE_TEXTURE_SIZE},a=new r(o),s={texture:i.texture,textureSize:u.GLYPH_CACHE_TEXTURE_SIZE,bgColor:e.bgColor,bgFactor:e.bgFactor,bgAlpha:e.bgAlpha},d=new r(s),f=new l.TextBuffer(a,d,t.DEFAULT_TEXT_RENDER_ORDER),p=new Map,m=new h(f,e,t.DEFAULT_TEXT_RENDER_ORDER);p.set(t.DEFAULT_TEXT_RENDER_ORDER,m),n.renderBuffers.set(e.name,p),n.initTextBuffer(m,t.DEFAULT_TEXT_RENDER_ORDER)}else c.error("GlyphCacheTexture not properly set up for fontCatalog: ",e.fontCatalog.name)}})},e.prototype.addOrderedTextBuffer=function(e,t){var r=e.get(0);a.assert(void 0!==r);var n=r.textBuffer.clone(),i=new h(n,r.textStyle,r.renderOrder);return e.set(t,i),this.initTextBuffer(i,t),i},e.prototype.initTextBuffer=function(e,r){var n=e.textBuffer.mesh,i=e.textBuffer.outlineMesh;n.frustumCulled=!1,i.frustumCulled=!1,n.renderOrder=d+r,i.renderOrder=t.BG_TEXT_RENDER_ORDER+r;var o=this.sceneSet.getScene(r);a.assert(void 0!==o),void 0!==o&&o.add(n,i)},e}();t.TextRenderer=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(1),o=r(20),a=function(){function e(){}return e.prototype.registerTile=function(e){if(i.assert(void 0!==e.decodedTile),void 0!==e.decodedTile&&void 0!==e.decodedTile.tileInfo){var t=e.decodedTile.tileInfo,r=t.lineGroup;if(void 0!==r&&0!==r.numFeatures){var o=[];o.length=r.numFeatures;for(var a=e.tileKey.level,s=0;s<r.numFeatures;s++){var u=t.techniqueCatalog[r.techniqueIndex[s]],l=n.getAttributeValue(u.lineWidth,a);o[s]=void 0!==l?Math.max(1,l):1}return{ids:r.featureIds,techniqueIndex:r.techniqueIndex,starts:r.positionIndex,widths:o,positions:r.positions,techniques:t.techniqueCatalog}}}},e.prototype.intersectRoads=function(e,t,r,n){if(e.boundingBox.distanceToPoint(r)>.01)return!1;var a=e.roadIntersectionData;if(void 0===a)return!1;for(var s=a.ids,u=a.techniques,l=a.techniqueIndex,c=s.length,d=a.positions,h=a.widths,f=r.x-e.center.x,p=r.y-e.center.y,m=r.distanceTo(t),y=0;y<c;y++){var v=u[l[y]];if(!0!==v.transient){for(var g=a.starts[y],b=y<c-1?a.starts[y+1]:a.positions.length,_=d[g],x=d[g+1],w=h[y]*h[y],T=Number.MAX_VALUE,S=g+2;S<b;S+=2){var O=d[S],E=d[S+1],P=i.Math2D.distToSegmentSquared(f,p,_,x,O,E);P<w&&P<T&&(T=P),_=O,x=E}if(T<Number.MAX_VALUE){var C={type:o.PickObjectType.Line,point:r,distance:m,distFromCenter:Math.sqrt(T),featureId:s[y],positions:d.slice(g,b),technique:v};n.push(C)}}}return!1},e}();t.RoadPicker=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TopLeft=0]="TopLeft",e[e.BottomLeft=1]="BottomLeft"}(t.ImageOrigin||(t.ImageOrigin={}));var n=function(){return function(e){this.image=e}}();t.IconTexture=n},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(150),a=r(151),s=i.LoggerManager.instance.create("ScreenCollissions"),u=function(){function e(){this.screenBounds=new i.Math2D.Box,this.rtree=new a,this.m_returnArray=[]}return e.toBox2D=function(e,t){t.x=e.min.x,t.y=e.min.y,t.w=e.max.x-e.min.x,t.h=e.max.y-e.min.y},e.prototype.reset=function(){this.rtree=new a},e.prototype.update=function(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()},e.prototype.allocate=function(e){this.rtree.insert(e,null)},e.prototype.isAllocated=function(e){return this.m_returnArray.length=0,this.m_returnArray=this.rtree.search(e,void 0,this.m_returnArray),0!==this.m_returnArray.length},e.prototype.isVisible=function(e){return this.screenBounds.intersects(e)},e}();t.ScreenCollisions=u;var l=function(e){function t(t){var r=e.call(this)||this;return r.m_renderContext=null,r.m_renderingEnabled=!1,r.m_numAllocations=0,r.m_numSuccessfulTests=0,r.m_numFailedTests=0,r.m_numSuccessfulVisibilityTests=0,r.m_numFailedVisibilityTests=0,void 0!==t&&null!==t&&(r.m_renderContext=t.getContext("2d")),r}return n(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0},t.prototype.update=function(t,r){this.m_renderingEnabled&&s.log("Allocations: "+this.m_numAllocations+" Successful Tests: "+this.m_numSuccessfulTests+" Failed Tests: "+this.m_numFailedTests+"  Successful Visibility Tests: "+this.m_numSuccessfulVisibilityTests+"  Failed Visibility Tests: "+this.m_numFailedVisibilityTests+" "),e.prototype.update.call(this,t,r),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=t,this.m_renderContext.canvas.height=r),this.m_renderingEnabled=o.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")},t.prototype.allocate=function(t){e.prototype.allocate.call(this,t),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(t.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.y-1,t.w,-t.h))},t.prototype.isAllocated=function(t){var r=e.prototype.isAllocated.call(this,t);if(this.m_renderingEnabled&&null!==this.m_renderContext){var n=r?2:0;this.m_renderContext.strokeStyle=r?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(t.x-this.screenBounds.x-n,this.screenBounds.y+this.screenBounds.h-t.y-1+n,t.w+2*n,-t.h-2*n)}return r?this.m_numFailedTests++:this.m_numSuccessfulTests++,r},t.prototype.isVisible=function(t){var r=e.prototype.isVisible.call(this,t);return r?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,r},t}(u);t.ScreenCollisionsDebug=l},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=r(5),a=r(12),s=r(1),u=r(0),l=r(18),c=r(19),d=s.LoggerManager.instance.create("PoiManager"),h=function(){function e(e){this.mapView=e,this.m_imageTextures=new Map,this.m_poiShieldGroups=new Map}return e.prototype.addPois=function(e,t){var r,o,a=s.assertExists(t.poiGeometries);try{for(var l=n(a),c=l.next();!c.done;c=l.next()){var d=c.value;s.assert(void 0!==d.technique);var h=s.assertExists(d.technique),f=t.techniques[h];if("line-marker"===f.name||"labeled-icon"===f.name){var p=new u.BufferAttribute(new Float32Array(d.positions.buffer),d.positions.itemCount);if(i.isLineMarkerTechnique(f)&&p.count>0)this.addLineMarker(e,d,f,p);else{var m=f,y=m.imageTexture;if(void 0===d.stringCatalog)continue;for(var v=0;v<p.count;++v){var g=p.getX(v),b=p.getY(v);s.assert(d.texts.length>v);var _=d.stringCatalog[d.texts[v]];void 0===_&&(_=""),void 0!==d.stringCatalog&&void 0!==d.imageTextures&&d.imageTextures[v]>=0?(s.assert(d.imageTextures.length>v),y=d.stringCatalog[d.imageTextures[v]]):y=m.imageTexture;var x=this.checkCreateTextElement(_,f,y,0,d.featureId,g,b);void 0!==x&&e.addTextElement(x)}}}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}},e.prototype.addTextureAtlas=function(e,t){var r=this;o.fetch(t,{responseType:"json"}).then(function(e){if(!e.ok)throw new Error("addTextureAtlas: Cannot load textureAtlas: "+e.statusText);return e.json()}).then(function(i){if(void 0!==i){try{d.log("addTextureAtlas: Loading textureAtlas '"+t+"' for image '"+e+"'");try{for(var o=n(Object.getOwnPropertyNames(i)),a=o.next();!a.done;a=o.next()){var s=a.value,u=i[s],l={name:s,image:e,xOffset:u.x,yOffset:u.y,width:u.width,height:u.height};r.addImageTexture(l)}}catch(e){c={error:e}}finally{try{a&&!a.done&&(h=o.return)&&h.call(o)}finally{if(c)throw c.error}}}catch(e){d.error("addTextureAtlas: Failed to load textureAtlas '"+t+"' : "+e)}var c,h;r.mapView.update()}else d.info("addTextureAtlas: TextureAtlas empty: "+t)}).catch(function(e){d.error("addTextureAtlas: Failed to load textureAtlas '"+t+"' : "+e)})},e.prototype.addImageTexture=function(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&d.warn("addImageTexture: Name already used: "+e.name+" (overriding it)"),this.m_imageTextures.set(e.name,e)):d.error("addImageTexture: Name required",e)},e.prototype.getImageTexture=function(e){return this.m_imageTextures.get(e)},e.prototype.clear=function(){this.m_imageTextures.clear(),this.m_poiShieldGroups.clear()},e.prototype.addLineMarker=function(e,t,r,n){var i,o=r.imageTexture;void 0!==t.stringCatalog&&void 0!==t.imageTextures&&(o=t.stringCatalog[t.imageTextures[0]],i=t.stringCatalog[t.texts[0]]),void 0===i&&(i="");var a=String(o)+"-"+i,s=this.m_poiShieldGroups.get(a);void 0===s&&(s=this.m_poiShieldGroups.size,this.m_poiShieldGroups.set(a,s));for(var l=[],c=0;c<n.count;c+=2)l.push(new u.Vector2(n.getX(c),n.getY(c)));var d=this.checkCreateTextElement(i,r,o,s,t.featureId,l);void 0!==d&&(d.ignoreDistance=!0,e.addTextElement(d))},e.prototype.checkCreateTextElement=function(e,t,r,n,i,o,s){var d;if(void 0===e&&(e=""),void 0!==e){var h=void 0!==t.priority?t.priority:0;h+=.01*Math.random();var f=Array.isArray(o)?o:new u.Vector2(o,s);(d=new l.TextElement(e,f,h,void 0!==t.scale?t.scale:1,void 0!==t.xOffset?t.xOffset:0,void 0!==t.yOffset?t.yOffset:0,i,t.style)).mayOverlap=!0===t.textMayOverlap,d.reserveSpace=!1!==t.textReserveSpace,d.alwaysOnTop=!0===t.alwaysOnTop;var p=!0===t.textIsOptional,m=!1!==t.iconIsOptional,y=!(!1===t.renderTextDuringMovements),v=void 0===t.iconMayOverlap?d.textMayOverlap:!0===t.iconMayOverlap,g=void 0===t.iconReserveSpace?d.textReservesSpace:!1!==t.iconReserveSpace,b=void 0!==t.distanceScale?t.distanceScale:c.DEFAULT_TEXT_DISTANCE_SCALE;void 0!==r&&(d.poiInfo={technique:t,imageTextureName:r,shieldGroupIndex:n,textElement:d,textIsOptional:p,iconIsOptional:m,renderTextDuringMovements:y,mayOverlap:v,reserveSpace:g,featureId:i}),void 0!==t.color&&(d.color=new u.Color(t.color)),d.bold=t.bold,d.oblique=t.oblique,d.minZoomLevel=t.minZoomLevel,d.distanceScale=b,void 0===t.hAlignment||t.hAlignment!==a.TextHorizontalAlignmentStrings.Left&&t.hAlignment!==a.TextHorizontalAlignmentStrings.Center&&t.hAlignment!==a.TextHorizontalAlignmentStrings.Right||(d.horizontalAlignment=a.TextHorizontalAlignment[t.hAlignment]),void 0===t.vAlignment||t.vAlignment!==a.TextVerticalAlignmentStrings.Above&&t.vAlignment!==a.TextVerticalAlignmentStrings.Center&&t.vAlignment!==a.TextVerticalAlignmentStrings.Below||(d.verticalAlignment=a.TextVerticalAlignment[t.vAlignment]),void 0!==t.tracking&&(d.tracking=t.tracking)}return d},e}();t.PoiManager=h},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(156),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(34))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(157),i=r(74),o=function(){function e(){}return e.getTileDecoder=function(e,t){var r=this.getWorkerSet(t);return new i.WorkerBasedDecoder(r,e)},e.getWorkerSet=function(e){void 0===e&&(e=this.defaultScriptUrl);var t=this.workerSets[e];return void 0===t&&(t=new n.ConcurrentWorkerSet({scriptUrl:e,workerCount:this.defaultWorkerCount}),this.workerSets[e]=t),t},e.destroyWorkerSet=function(e){var t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])},e.destroy=function(){var e=this;Object.keys(this.workerSets).forEach(function(t){e.workerSets[t].destroy()}),this.workerSets={}},e.defaultScriptUrl="./decoder.bundle.js",e.defaultWorkerCount=void 0,e.workerSets={},e}();t.ConcurrentDecoderFacade=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(){function e(e,t){this.workerSet=e,this.serviceId=t,this.workerSet.addReference()}return e.prototype.dispose=function(){this.workerSet.removeReference()},e.prototype.connect=function(){return this.workerSet.connect(this.serviceId)},e.prototype.decodeTile=function(e,t,r,i){var o=t.mortonCode(),a={type:n.Requests.DecodeTileRequest,dataSourceName:r,tileKey:o,data:e,projection:n.getProjectionName(i)},s=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,a,s)},e.prototype.getTileInfo=function(e,t,r,i){var o=t.mortonCode(),a={type:n.Requests.TileInfoRequest,dataSourceName:r,tileKey:o,data:e,projection:n.getProjectionName(i)},s=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,a,s)},e.prototype.configure=function(e,t,r){var i={service:this.serviceId,type:n.DecodedTileMessageName.Configuration,theme:e,options:r,languages:t};this.workerSet.broadcastMessage(i)},e}();t.WorkerBasedDecoder=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(0),o=function(){function e(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new i.Fog(0),this.m_fogIsDefined=!1,this.m_cachedTheme=void 0}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this.m_enabled},set:function(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()},enumerable:!0,configurable:!0}),e.prototype.reset=function(e){this.m_cachedTheme=e,void 0!==e&&void 0!==e.sky&&void 0!==e.sky.colorBottom&&void 0!==e.fog&&void 0!==e.fog.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.sky.colorBottom),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())},e.prototype.update=function(e){null!==this.m_scene.fog&&void 0!==e.far&&void 0!==this.m_cachedTheme&&this.m_cachedTheme.fog&&void 0!==this.m_cachedTheme.fog.startRatio&&(this.m_fog.far=e.far,this.m_fog.near=e.far*this.m_cachedTheme.fog.startRatio)},e.prototype.add=function(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)},e.prototype.remove=function(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)},e.prototype.setFogInRawShaderMaterials=function(e){this.m_scene.traverse(function(t){if(t instanceof i.Mesh&&t.material instanceof i.Material){if(t.material instanceof i.RawShaderMaterial&&!(t.material instanceof n.HighPrecisionLineMaterial))t.material.updateFog(e);t.material.fog=e,t.material.needsUpdate=!0}})},e}();t.MapViewFog=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=o.LoggerManager.instance.create("Statistics"),s=function(){function e(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}return e.prototype.clear=function(){this.head=this.tail=this.size=0},e.prototype.enqOne=function(e){var t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)},e.prototype.enq=function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{for(var o=i(r),a=o.next();!a.done;a=o.next()){var s=a.value;this.enqOne(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.deq=function(){if(0===this.size)throw new Error("Ringbuffer underrun");var e=this.buffer[this.tail],t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e},e.prototype.iterator=function(){return new e.Iterator(this)},e.prototype.asArray=function(){for(var e=new Array,t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e},e}();t.RingBuffer=s,function(e){var t=function(){function e(e,t){void 0===t&&(t=0),this.m_buffer=e,this.m_index=t}return Object.defineProperty(e.prototype,"value",{get:function(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]},enumerable:!0,configurable:!0}),e.prototype.next=function(){return this.m_index++,this.m_index<this.m_buffer.size},e}();e.Iterator=t}(s=t.RingBuffer||(t.RingBuffer={})),t.RingBuffer=s;var u=function(){function e(e,t){this.statistics=e,this.name=t,this.running=!1}return Object.defineProperty(e.prototype,"value",{get:function(){return this.m_currentValue},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e){this.m_currentValue=e},e.prototype.reset=function(){this.m_currentValue=void 0},e.prototype.start=function(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=o.PerformanceTimer.now()},e.prototype.stop=function(){if(!this.statistics.enabled)return-1;if(this.running){var e=o.PerformanceTimer.now()-(this.m_currentValue||0);return this.m_currentValue=e,this.setValue(e),this.running=!1,e}throw new Error("Timer '"+this.name+"' has not been started")},e.prototype.now=function(){if(!this.statistics.enabled)return-1;if(this.running)return o.PerformanceTimer.now()-(this.m_currentValue||0);throw new Error("Timer '"+this.name+"' has not been started")},e}();t.SimpleTimer=u;var l=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.statistics=t,n.name=r,n.numSamples=0,n.numResets=0,n.maxNumSamples=1e3,n.samples=new s(n.maxNumSamples),n}return n(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.updateStats(),this.samples.clear(),this.numResets++},t.prototype.setValue=function(t){e.prototype.setValue.call(this,t),void 0!==t&&(this.samples.enqOne(t),this.numSamples++)},t.prototype.updateStats=function(){if(0!==this.samples.size){var e=this.samples.asArray();e.sort(function(e,t){return e-t});var t,r,n=e[0],i=e[e.length-1];if(1===e.length)r=t=e[0];else if(2===e.length)t=.5*e[0]+.5*e[1],r=e[1];else{var o=Math.floor(e.length/2);t=e.length%2==0?.5*e[o]+.5*e[o+1]:e[o],r=e[Math.floor(.95*e.length)]}for(var a=0,s=0,u=e.length;s<u;s++)a+=e[s];var l=a/e.length;this.min=n,this.max=i,this.avg=l,this.median=t,this.median95=r}},t}(u);t.SampledTimer=l;var c=function(){function e(e,t,r){if(this.statistics=e,this.name=t,this.stages=r,r.length<1)throw new Error("MultiStageTimer needs stages");r.forEach(function(t){if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)})}return Object.defineProperty(e.prototype,"value",{get:function(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value},enumerable:!0,configurable:!0}),e.prototype.reset=function(){var e=this;this.statistics.enabled&&this.stages.forEach(function(t){e.statistics.getTimer(t).reset()})},e.prototype.start=function(){return this.stage=this.stages[0],this.statistics.getTimer(this.stages[0]).value||-1},e.prototype.stop=function(){return this.stage=void 0,void 0!==this.value?this.value:-1},Object.defineProperty(e.prototype,"stage",{get:function(){return this.currentStage},set:function(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())},enumerable:!0,configurable:!0}),e}();t.MultiStageTimer=c;var d=function(){function e(e,t){void 0===t&&(t=!1),this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new u(this,"<null>")}return e.prototype.createTimer=function(e,t){void 0===t&&(t=!0);var r=t?new l(this,e):new u(this,e);return this.addTimer(r)},e.prototype.addTimer=function(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e},e.prototype.getTimer=function(e){if(!this.enabled)return this.nullTimer;var t=this.timers.get(e);return void 0===t?this.nullTimer:t},e.prototype.hasTimer=function(e){return void 0!==this.timers.get(e)},e.prototype.reset=function(){this.timers.forEach(function(e){e.reset()})},e.prototype.log=function(e,t){void 0===e&&void 0===this.name||a.log(void 0!==e?e:this.name);var r=0;this.timers.forEach(function(e){r=Math.max(r,e.name.length)});var n=function(e){return void 0!==e?e.toFixed(5):"?"};this.timers.forEach(function(e){var t=e.name+": "+" ".repeat(r-e.name.length);t+=n(e.value),e instanceof l&&(e.updateStats(),t+="  [ min="+n(e.min)+", max="+n(e.max)+", avg="+n(e.avg)+", med="+n(e.median)+", med95="+n(e.median95)+", N="+n(e.numSamples)+" ]"),a.log(t)}),void 0!==t&&a.log(t)},e}();t.Statistics=d},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(5),s=r(1),u=function(){function e(){}return e.loadAsync=function(e){return n(this,void 0,void 0,function(){var t,r,n,u,l,c,d,h,f,p,m,y,v;return i(this,function(i){switch(i.label){case 0:return e=s.defaultUrlResolver(e),[4,a.fetch(e,{responseType:"json"})];case 1:if(!(t=i.sent()).ok)throw new Error("ThemeLoader#loadAsync: cannot load theme: "+t.statusText);return[4,t.json()];case 2:if(null===(r=i.sent()))throw new Error("ThemeLoader#loadAsync: loaded resource is not valid JSON");if(n=s.composeUrlResolvers(function(t){return s.resolveReferenceUrl(e,t)},s.defaultUrlResolver),r.images)try{for(u=o(r.images),l=u.next();!l.done;l=u.next())(c=l.value).url=n(c.url),void 0!==c.atlas&&(c.atlas=n(c.atlas))}catch(e){p={error:e}}finally{try{l&&!l.done&&(m=u.return)&&m.call(u)}finally{if(p)throw p.error}}if(r.fontCatalogs)try{for(d=o(r.fontCatalogs),h=d.next();!h.done;h=d.next())(f=h.value).url=n(f.url)}catch(e){y={error:e}}finally{try{h&&!h.done&&(v=d.return)&&v.call(d)}finally{if(y)throw y.error}}return[2,r]}})})},e}();t.ThemeLoader=u},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),a=r(27),s=r(1),u=s.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};var l=function(){function e(e,t,r){this.object=e,this.geometryType=t,this.bufferGeometry=r,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,s.assert(!!e),"BufferGeometry"!==r.type&&u.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),s.assert("BufferGeometry"===r.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||u.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&u.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}return e.prototype.getCount=function(){return this.position.count},Object.defineProperty(e.prototype,"renderOrder",{get:function(){return this.object.renderOrder},enumerable:!0,configurable:!0}),e.prototype.setRange=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),s.assert(e>=0),s.assert(t>=0),s.assert(e<=t),this.start=e,this.end=t,this.startCapSize=r,this.endCapSize=n},Object.defineProperty(e.prototype,"color",{get:function(){var e,t,r=function(e){var t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){var r=e;if("SolidLineMaterial"===r.name)return r.uniforms.diffuse.value;u.warn("BufferedGeometryAccessor#color: unknown shader material name",r.name)}else u.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){var n=new Array,o=this.object.material;try{for(var a=i(o),s=a.next();!s.done;s=a.next()){var l=s.value;n.push(r(l))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}return r(this.object.material)},enumerable:!0,configurable:!0}),e}();t.BufferedGeometryAccessorBase=l;var c=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n)||this;return o.object=t,o.geometryType=r,o.bufferGeometry=n,o.stride=i,o}return n(t,e),t.prototype.clear=function(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");for(var e=this.position.array,t=this.start*this.itemSize,r=this.end*this.itemSize,n=t;n<r;n++)e[n]=0;this.position.needsUpdate=!0},t.prototype.getVertices=function(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");var e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)},t.prototype.checkSetUp=function(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end},t}(l);t.BufferedGeometryAccessor=c;var d=function(e){function t(t,r,n){var i=e.call(this,t,r,n,3)||this;return i.object=t,i.geometryType=r,i.bufferGeometry=n,i}return n(t,e),t.prototype.isLineAccessor=function(){return!0},Object.defineProperty(t.prototype,"width",{get:function(){s.assert(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")},enumerable:!0,configurable:!0}),t}(c);t.BufferedGeometryLineAccessor=d;var h=function(e){function t(t,r,n){var i=e.call(this,t,r,n,1)||this;return i.object=t,i.geometryType=r,i.bufferGeometry=n,i}return n(t,e),t.prototype.isObject3dAccessor=function(){return!0},t.prototype.getVertices=function(){return e.prototype.getVertices.call(this)},t}(c);t.BufferedGeometryObject3dAccessor=h;var f=function(e){function t(t,r,n,i,o){var a=e.call(this,t,r,n)||this;return a.object=t,a.geometryType=r,a.bufferGeometry=n,a.indices=a.bufferGeometry.index.array,a.indices?a.indices instanceof Uint32Array||(u.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),s.assert(a.indices instanceof Uint32Array)):(u.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),s.assert(!!a.indices)),a}return n(t,e),t.prototype.getCount=function(){return this.indices.length},t.prototype.checkSetUp=function(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end},t}(l);t.IndexedBufferedGeometryAccessor=f;var p=function(e){function t(t,r,n){var i=e.call(this,t,r,n,3)||this;return i.object=t,i.geometryType=r,i.bufferGeometry=n,i}return n(t,e),t.prototype.isLineAccessor=function(){return!0},Object.defineProperty(t.prototype,"width",{get:function(){if(s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===o.GeometryType.ExtrudedLine){var e=this.start+this.startCapSize,t=this.position.array;return a.reconstructLineWidth(t,e)}},enumerable:!0,configurable:!0}),t.prototype.clear=function(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");for(var e=this.start,t=this.end,r=e;r<t;r++)this.indices[r]=0;this.bufferGeometry.index.needsUpdate=!0},t.prototype.getVertices=function(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");var e=this.itemSize,t=this.start,r=this.end,n=new Float32Array((r-t)*e),i=this.position.array;if(2===e)for(var o=t,a=0;o<r;o++,a+=e){var u=this.indices[o];n[a+0]=i[u*e+0],n[a+1]=i[u*e+1]}if(3===e)for(o=t,a=0;o<r;o++,a+=e){u=this.indices[o];n[a+0]=i[u*e+0],n[a+1]=i[u*e+1],n[a+2]=i[u*e+2]}else for(o=t,a=0;o<r;o++,a++){u=this.indices[o];for(var l=0;l<e;l++)n[a*e+l]=i[u*e+l]}return n},t}(f);t.IndexedBufferedGeometryLineAccessor=p},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),o=r(59),a=r(1).LoggerManager.instance.create("TileLoader"),s=function(){function e(e,t,r,n){this.dataSource=e,this.tileKey=t,this.dataProvider=r,this.tileDecoder=n,this.state=o.TileLoaderState.Initialized,this.loadCancellationToken=new i.CancellationToken}return e.prototype.loadAndDecode=function(){switch(this.state){case o.TileLoaderState.Loading:return this.donePromise;case o.TileLoaderState.Disposed:return a.warn("cannot load in disposed state"),Promise.resolve(o.TileLoaderState.Disposed);case o.TileLoaderState.Ready:case o.TileLoaderState.Failed:case o.TileLoaderState.Initialized:case o.TileLoaderState.Canceled:return this.ensureLoadingStarted(),this.donePromise;case o.TileLoaderState.Loaded:return this.startDecodeTile(),this.donePromise;case o.TileLoaderState.Decoding:return this.cancelDecoding(),this.ensureLoadingStarted(),this.donePromise}},e.prototype.waitSettled=function(){return this.donePromise?this.donePromise:Promise.resolve(this.state)},e.prototype.cancel=function(){switch(this.state){case o.TileLoaderState.Disposed:return void a.warn("attempting to cancel disposed TileLoader");case o.TileLoaderState.Loading:this.loadCancellationToken.cancel(),this.loadCancellationToken=new i.CancellationToken;break;case o.TileLoaderState.Decoding:this.decodeCancellationToken&&(this.decodeCancellationToken.cancel(),this.decodeCancellationToken=void 0)}this.onDone(o.TileLoaderState.Canceled)},e.prototype.dispose=function(){this.state!==o.TileLoaderState.Disposed&&(this.cancel(),this.state=o.TileLoaderState.Disposed)},e.prototype.isFinished=function(){return this.state===o.TileLoaderState.Ready||this.state===o.TileLoaderState.Canceled||this.state===o.TileLoaderState.Failed},e.prototype.ensureLoadingStarted=function(){switch(this.state){case o.TileLoaderState.Ready:case o.TileLoaderState.Initialized:case o.TileLoaderState.Canceled:return void this.doStartLoad();case o.TileLoaderState.Loading:case o.TileLoaderState.Loaded:return void a.info("reusing already started load operation");case o.TileLoaderState.Decoding:return this.cancelDecoding(),void this.doStartLoad();case o.TileLoaderState.Disposed:return void a.warn("cannot load in disposed state")}},e.prototype.doStartLoad=function(){var e=this,t=this.loadCancellationToken;this.dataProvider.getTile(this.tileKey,this.loadCancellationToken).then(function(r){if(t.isCancelled)throw new i.CancellationException;e.onLoaded(r)}).catch(function(t){t instanceof i.CancellationException||e.onError(t)}),void 0===this.donePromise&&(this.donePromise=new Promise(function(t){e.resolveDonePromise=t})),this.state=o.TileLoaderState.Loading},e.prototype.onLoaded=function(e){this.state=o.TileLoaderState.Loaded,this.payload=e,(void 0===e.byteLength||0!==e.byteLength)&&e!=={}?this.startDecodeTile():this.onDone(o.TileLoaderState.Ready)},e.prototype.startDecodeTile=function(){var e=this,t=this.payload;if(void 0!==t){this.state=o.TileLoaderState.Decoding,this.payload=void 0;var r=new i.CancellationToken;this.decodeCancellationToken=r;var n=this.dataSource;this.tileDecoder.decodeTile(t,this.tileKey,n.name,n.projection).then(function(t){r.isCancelled||e.onDecoded(t)}).catch(function(t){t instanceof i.CancellationException||e.onError(t)})}else a.error("TileLoader#startDecodeTile: Cannot decode without payload")},e.prototype.onDecoded=function(e){this.decodedTile=e,this.onDone(o.TileLoaderState.Ready)},e.prototype.cancelDecoding=function(){void 0!==this.decodeCancellationToken&&(this.decodeCancellationToken.cancel(),this.decodeCancellationToken=void 0)},e.prototype.onDone=function(e){this.resolveDonePromise&&(this.resolveDonePromise(e),this.resolveDonePromise=void 0,this.donePromise=void 0),this.state=e},e.prototype.onError=function(e){var t=this.dataSource;a.error("["+t.name+"]: failed to load tile "+this.tileKey.toHereTile(),e),this.error=e,this.onDone(o.TileLoaderState.Failed)},e}();t.TileLoader=s;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.startDecodeTile=function(){var e=this,t=this.payload;if(void 0!==t){this.state=o.TileLoaderState.Decoding,this.payload=void 0;var r=new i.CancellationToken;this.decodeCancellationToken=r;var n=this.dataSource;this.tileDecoder.getTileInfo(t,this.tileKey,n.name,n.projection).then(function(t){r.isCancelled||(e.tileInfo=t,e.onDone(o.TileLoaderState.Ready))}).catch(function(t){t instanceof i.CancellationException||e.onError(t)})}else a.error("TileInfoLoader#startDecodeTile: Cannot decode without payload")},t}(s);t.TileInfoLoader=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(){function e(){this.m_themeEvaluators=new Map}return e.prototype.dispose=function(){},e.prototype.decodeTile=function(e,t,r,n){var i=this.getThemeEvalator(r);return void 0===i?Promise.reject(new Error("no theme loaded")):this.decodeThemedTile(e,t,i,n)},e.prototype.getTileInfo=function(e,t,r,n){return Promise.resolve(void 0)},e.prototype.configure=function(e,t,r){void 0!==e&&(this.m_theme=e,this.m_themeEvaluators.clear()),void 0!==t&&(this.languages=t)},e.prototype.getThemeEvalator=function(e){if(void 0!==this.m_theme){var t=this.m_themeEvaluators.get(e);return void 0===t&&(t=new n.ThemeEvaluator(this.m_theme,e),this.m_themeEvaluators.set(e,t)),t}},e}();t.ThemedTileDecoder=i},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=r(4),a=r(1),s=r(82),u=a.LoggerManager.instance.create("TileDecoderService"),l=function(e){function t(t,r){var n=e.call(this,t)||this;return n.serviceId=t,n.m_decoder=r,n.m_decoder.connect(),n}return n(t,e),t.start=function(e,r){return new t(e,r)},t.prototype.handleRequest=function(t){var r=this;return i.isDecodeTileRequest(t)?new Promise(function(e){e(r.handleDecodeTileRequest(t))}):i.isTileInfoRequest(t)?new Promise(function(e){e(r.handleTileInfoRequest(t))}):e.prototype.handleRequest.call(this,t)},t.prototype.handleMessage=function(e){i.isConfigurationMessage(e)?this.handleConfigurationMessage(e):u.error("["+this.serviceId+"]: invalid message "+e.type)},t.prototype.handleDecodeTileRequest=function(e){var t=o.TileKey.fromMortonCode(e.tileKey),r=i.getProjection(e.projection);return this.m_decoder.decodeTile(e.data,t,e.dataSourceName,r).then(function(e){var t=[];return e.geometries.forEach(function(e){e.vertexAttributes.forEach(function(e){e.buffer instanceof ArrayBuffer&&t.push(e.buffer)}),e.index&&e.index.buffer instanceof ArrayBuffer&&t.push(e.index.buffer)}),e.techniques.forEach(function(e){i.isStandardTexturedTechnique(e)&&i.isTextureBuffer(e.texture)&&e.texture.buffer instanceof ArrayBuffer&&t.push(e.texture.buffer)}),{response:e,transferList:t}})},t.prototype.handleTileInfoRequest=function(e){var t=o.TileKey.fromMortonCode(e.tileKey),r=i.getProjection(e.projection);return this.m_decoder.getTileInfo(e.data,t,e.dataSourceName,r).then(function(e){return{response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]}})},t.prototype.handleConfigurationMessage=function(e){this.m_decoder.configure(e.theme,e.languages,e.options)},t}(s.WorkerService);t.TileDecoderService=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(1).LoggerManager.instance.create("WorkerService",{enabled:!1}),o=function(){function e(e){var t=this;this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=function(e){if("string"==typeof e.data.service&&e.data.service===t.serviceId)try{if(n.isRequestMessage(e.data)){var r=e.data,o={service:r.service,messageId:r.messageId,responseSent:!1};t.m_pendingRequests.set(r.messageId,o),t.tryHandleRequest(r.request).then(function(e){t.doSendResponse(o,{service:t.serviceId,type:n.DecodedTileMessageName.Response,messageId:r.messageId,response:e.response},e.transferList)}).catch(function(e){t.doSendResponse(o,{service:t.serviceId,type:n.DecodedTileMessageName.Response,messageId:r.messageId,error:e.toString()})})}else n.isConfigurationMessage(e.data)&&t.tryHandleMessage(e.data)}catch(r){i.error("["+t.serviceId+"]: Unhandled exception when handling "+e.type)}},self.addEventListener("message",this.onMessage);var r={service:e,type:n.DecodedTileMessageName.Initialized};self.postMessage(r)}return e.prototype.destroy=function(){this.cancelAllPendingRequests(),self.removeEventListener("message",this.onMessage)},e.prototype.handleMessage=function(e){i.error("["+this.serviceId+"]: Invalid message "+e.type)},e.prototype.handleRequest=function(e){throw new Error("ServiceAdapter["+this.serviceId+"]: Invalid request '"+e.type+"'")},e.prototype.tryHandleMessage=function(e){try{this.handleMessage(e)}catch(t){i.error("["+this.serviceId+"]: Failed, handling message "+e.type)}},e.prototype.tryHandleRequest=function(e){try{return this.handleRequest(e)}catch(e){return i.error("["+this.serviceId+"]: Failure",e),Promise.reject(e)}},e.prototype.doSendResponse=function(e,t,r){e.responseSent||(self.postMessage(t,r),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))},e.prototype.cancelAllPendingRequests=function(){var e=this;this.m_pendingRequests.forEach(function(t){e.doSendResponse(t,{service:e.serviceId,type:n.DecodedTileMessageName.Response,messageId:t.messageId,error:"cancelled"})})},e}();t.WorkerService=o},function(e,t,r){"use strict";function n(e,t,r){r=r||2;var n,s,u,l,c,f,m,y=t&&t.length,v=y?t[0]*r:e.length,g=i(e,0,v,r,!0),b=[];if(!g)return b;if(y&&(g=function(e,t,r,n){var a,s,u,l,c,f=[];for(a=0,s=t.length;a<s;a++)u=t[a]*n,l=a<s-1?t[a+1]*n:e.length,(c=i(e,u,l,n,!1))===c.next&&(c.steiner=!0),f.push(p(c));for(f.sort(d),a=0;a<f.length;a++)h(f[a],r),r=o(r,r.next);return r}(e,t,g,r)),e.length>80*r){n=u=e[0],s=l=e[1];for(var _=r;_<v;_+=r)c=e[_],f=e[_+1],c<n&&(n=c),f<s&&(s=f),c>u&&(u=c),f>l&&(l=f);m=0!==(m=Math.max(u-n,l-s))?1/m:0}return a(g,b,r,n,s,m),b}function i(e,t,r,n,i){var o,a;if(i===O(e,t,r,n)>0)for(o=t;o<r;o+=n)a=w(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=w(o,e[o],e[o+1],a);return a&&g(a,a.next)&&(T(a),a=a.next),a}function o(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!g(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{if(T(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function a(e,t,r,n,i,d,h){if(e){!h&&d&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=f(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,a,s,u,l=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,n=r,s=0,t=0;t<l&&(s++,n=n.nextZ);t++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1)}(i)}(e,n,i,d);for(var p,m,y=e;e.prev!==e.next;)if(p=e.prev,m=e.next,d?u(e,n,i,d):s(e))t.push(p.i/r),t.push(e.i/r),t.push(m.i/r),T(e),e=m.next,y=m.next;else if((e=m)===y){h?1===h?a(e=l(e,t,r),t,r,n,i,d,2):2===h&&c(e,t,r,n,i,d):a(o(e),t,r,n,i,d,1);break}}}function s(e){var t=e.prev,r=e,n=e.next;if(v(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(m(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&v(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(e,t,r,n){var i=e.prev,o=e,a=e.next;if(v(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,d=f(s,u,t,r,n),h=f(l,c,t,r,n),p=e.prevZ,y=e.nextZ;p&&p.z>=d&&y&&y.z<=h;){if(p!==e.prev&&p!==e.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,y!==e.prev&&y!==e.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&v(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;y&&y.z<=h;){if(y!==e.prev&&y!==e.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,y.x,y.y)&&v(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function l(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!g(i,o)&&b(i,n,n.next,o)&&_(i,o)&&_(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),T(n),T(n.next),n=e=o),n=n.next}while(n!==e);return n}function c(e,t,r,n,i,s){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&y(u,l)){var c=x(u,l);return u=o(u,u.next),c=o(c,c.next),a(u,t,r,n,i,s),void a(c,t,r,n,i,s)}l=l.next}u=u.next}while(u!==e)}function d(e,t){return e.x-t.x}function h(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r.prev;var u,l=r,c=r.x,d=r.y,h=1/0;n=r.next;for(;n!==l;)i>=n.x&&n.x>=c&&i!==n.x&&m(o<d?i:a,o,c,d,o<d?a:i,o,n.x,n.y)&&((u=Math.abs(o-n.y)/(i-n.x))<h||u===h&&n.x>r.x)&&_(n,e)&&(r=n,h=u),n=n.next;return r}(e,t)){var r=x(t,e);o(r,r.next)}}function f(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,n,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&_(e,t)&&_(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function v(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,r,n){return!!(g(e,t)&&g(r,n)||g(e,n)&&g(r,t))||v(e,t,r)>0!=v(e,t,n)>0&&v(r,n,e)>0!=v(r,n,t)>0}function _(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function x(e,t){var r=new S(e.i,e.x,e.y),n=new S(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function w(e,t,r,n){var i=new S(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}e.exports=n,e.exports.default=n,n.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,a=Math.abs(O(e,0,o,r));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*r,c=s<u-1?t[s+1]*r:e.length;a-=Math.abs(O(e,l,c,r))}var d=0;for(s=0;s<n.length;s+=3){var h=n[s]*r,f=n[s+1]*r,p=n[s+2]*r;d+=Math.abs((e[h]-e[p])*(e[f+1]-e[h+1])-(e[h]-e[f])*(e[p+1]-e[h+1]))}return 0===a&&0===d?0:Math.abs((d-a)/a)},n.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[i][o][a]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(80)),n(r(81)),n(r(82))},function(e,t,r){"use strict";e.exports=r(168)},function(e,t,r){"use strict";e.exports=c;var n,i=r(7),o=i.LongBits,a=i.base64,s=i.utf8;function u(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function c(){this.len=0,this.head=new u(l,0,0),this.tail=this.head,this.states=null}function d(e,t,r){t[r]=255&e}function h(e,t){this.len=e,this.next=void 0,this.val=t}function f(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function p(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}c.create=i.Buffer?function(){return(c.create=function(){return new n})()}:function(){return new c},c.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(c.alloc=i.pool(c.alloc,i.Array.prototype.subarray)),c.prototype._push=function(e,t,r){return this.tail=this.tail.next=new u(e,t,r),this.len+=t,this},h.prototype=Object.create(u.prototype),h.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},c.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new h((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},c.prototype.int32=function(e){return e<0?this._push(f,10,o.fromNumber(e)):this.uint32(e)},c.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},c.prototype.uint64=function(e){var t=o.from(e);return this._push(f,t.length(),t)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(f,t.length(),t)},c.prototype.bool=function(e){return this._push(d,1,e?1:0)},c.prototype.fixed32=function(e){return this._push(p,4,e>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(e){var t=o.from(e);return this._push(p,4,t.lo)._push(p,4,t.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},c.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var m=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};c.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(d,1,0);if(i.isString(e)){var r=c.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(m,t,e)},c.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(d,1,0)},c.prototype.fork=function(){return this.states=new function(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}(this),this.head=this.tail=new u(l,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(l,0,0),this.len=0),this},c.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},c.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},c._configure=function(e){n=e}},function(e,t,r){"use strict";e.exports=u;var n,i=r(7),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")};function c(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function h(){if(this.pos+8>this.len)throw s(this,8);return new o(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}u.create=i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new n(e):l(e)})(e)}:l,u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return e}}(),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return d(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|d(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},u.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){n=e;var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return c.call(this)[t](!1)},uint64:function(){return c.call(this)[t](!0)},sint64:function(){return c.call(this).zzDecode()[t](!1)},fixed64:function(){return h.call(this)[t](!0)},sfixed64:function(){return h.call(this)[t](!1)}})}},function(e,t,r){"use strict";var n=r(85),i=n.Reader,o=n.util,a=n.roots.default||(n.roots.default={});a.com=function(){var e={};return e.mapbox=function(){var e={};return e.pb=function(){var e={};return e.Tile=function(){function e(e){if(this.layers=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.layers=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.com.mapbox.pb.Tile;e.pos<r;){var o=e.uint32();switch(o>>>3){case 3:n.layers&&n.layers.length||(n.layers=[]),n.layers.push(a.com.mapbox.pb.Tile.Layer.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.com.mapbox.pb.Tile)return e;var t=new a.com.mapbox.pb.Tile;if(e.layers){if(!Array.isArray(e.layers))throw TypeError(".com.mapbox.pb.Tile.layers: array expected");t.layers=[];for(var r=0;r<e.layers.length;++r){if("object"!=typeof e.layers[r])throw TypeError(".com.mapbox.pb.Tile.layers: object expected");t.layers[r]=a.com.mapbox.pb.Tile.Layer.fromObject(e.layers[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.layers=[]),e.layers&&e.layers.length){r.layers=[];for(var n=0;n<e.layers.length;++n)r.layers[n]=a.com.mapbox.pb.Tile.Layer.toObject(e.layers[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.GeomType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="POINT"]=1,t[e[2]="LINESTRING"]=2,t[e[3]="POLYGON"]=3,t}(),e.Value=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.stringValue="",e.prototype.floatValue=0,e.prototype.doubleValue=0,e.prototype.intValue=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.uintValue=o.Long?o.Long.fromBits(0,0,!0):0,e.prototype.sintValue=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.boolValue=!1,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.com.mapbox.pb.Tile.Value;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.stringValue=e.string();break;case 2:n.floatValue=e.float();break;case 3:n.doubleValue=e.double();break;case 4:n.intValue=e.int64();break;case 5:n.uintValue=e.uint64();break;case 6:n.sintValue=e.sint64();break;case 7:n.boolValue=e.bool();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.com.mapbox.pb.Tile.Value)return e;var t=new a.com.mapbox.pb.Tile.Value;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.floatValue&&(t.floatValue=Number(e.floatValue)),null!=e.doubleValue&&(t.doubleValue=Number(e.doubleValue)),null!=e.intValue&&(o.Long?(t.intValue=o.Long.fromValue(e.intValue)).unsigned=!1:"string"==typeof e.intValue?t.intValue=parseInt(e.intValue,10):"number"==typeof e.intValue?t.intValue=e.intValue:"object"==typeof e.intValue&&(t.intValue=new o.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber())),null!=e.uintValue&&(o.Long?(t.uintValue=o.Long.fromValue(e.uintValue)).unsigned=!0:"string"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):"number"==typeof e.uintValue?t.uintValue=e.uintValue:"object"==typeof e.uintValue&&(t.uintValue=new o.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),null!=e.sintValue&&(o.Long?(t.sintValue=o.Long.fromValue(e.sintValue)).unsigned=!1:"string"==typeof e.sintValue?t.sintValue=parseInt(e.sintValue,10):"number"==typeof e.sintValue?t.sintValue=e.sintValue:"object"==typeof e.sintValue&&(t.sintValue=new o.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber())),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(r.stringValue="",r.floatValue=0,r.doubleValue=0,o.Long){var n=new o.Long(0,0,!1);r.intValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.intValue=t.longs===String?"0":0;if(o.Long){n=new o.Long(0,0,!0);r.uintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.uintValue=t.longs===String?"0":0;if(o.Long){n=new o.Long(0,0,!1);r.sintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.sintValue=t.longs===String?"0":0;r.boolValue=!1}return null!=e.stringValue&&e.hasOwnProperty("stringValue")&&(r.stringValue=e.stringValue),null!=e.floatValue&&e.hasOwnProperty("floatValue")&&(r.floatValue=t.json&&!isFinite(e.floatValue)?String(e.floatValue):e.floatValue),null!=e.doubleValue&&e.hasOwnProperty("doubleValue")&&(r.doubleValue=t.json&&!isFinite(e.doubleValue)?String(e.doubleValue):e.doubleValue),null!=e.intValue&&e.hasOwnProperty("intValue")&&("number"==typeof e.intValue?r.intValue=t.longs===String?String(e.intValue):e.intValue:r.intValue=t.longs===String?o.Long.prototype.toString.call(e.intValue):t.longs===Number?new o.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber():e.intValue),null!=e.uintValue&&e.hasOwnProperty("uintValue")&&("number"==typeof e.uintValue?r.uintValue=t.longs===String?String(e.uintValue):e.uintValue:r.uintValue=t.longs===String?o.Long.prototype.toString.call(e.uintValue):t.longs===Number?new o.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),null!=e.sintValue&&e.hasOwnProperty("sintValue")&&("number"==typeof e.sintValue?r.sintValue=t.longs===String?String(e.sintValue):e.sintValue:r.sintValue=t.longs===String?o.Long.prototype.toString.call(e.sintValue):t.longs===Number?new o.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber():e.sintValue),null!=e.boolValue&&e.hasOwnProperty("boolValue")&&(r.boolValue=e.boolValue),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e.Feature=function(){function e(e){if(this.tags=[],this.geometry=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=o.Long?o.Long.fromBits(0,0,!0):0,e.prototype.tags=o.emptyArray,e.prototype.type=0,e.prototype.geometry=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.com.mapbox.pb.Tile.Feature;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.id=e.uint64();break;case 2:if(n.tags&&n.tags.length||(n.tags=[]),2==(7&o))for(var s=e.uint32()+e.pos;e.pos<s;)n.tags.push(e.uint32());else n.tags.push(e.uint32());break;case 3:n.type=e.int32();break;case 4:if(n.geometry&&n.geometry.length||(n.geometry=[]),2==(7&o))for(s=e.uint32()+e.pos;e.pos<s;)n.geometry.push(e.uint32());else n.geometry.push(e.uint32());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.com.mapbox.pb.Tile.Feature)return e;var t=new a.com.mapbox.pb.Tile.Feature;if(null!=e.id&&(o.Long?(t.id=o.Long.fromValue(e.id)).unsigned=!0:"string"==typeof e.id?t.id=parseInt(e.id,10):"number"==typeof e.id?t.id=e.id:"object"==typeof e.id&&(t.id=new o.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0))),e.tags){if(!Array.isArray(e.tags))throw TypeError(".com.mapbox.pb.Tile.Feature.tags: array expected");t.tags=[];for(var r=0;r<e.tags.length;++r)t.tags[r]=e.tags[r]>>>0}switch(e.type){case"UNKNOWN":case 0:t.type=0;break;case"POINT":case 1:t.type=1;break;case"LINESTRING":case 2:t.type=2;break;case"POLYGON":case 3:t.type=3}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(".com.mapbox.pb.Tile.Feature.geometry: array expected");t.geometry=[];for(r=0;r<e.geometry.length;++r)t.geometry[r]=e.geometry[r]>>>0}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.tags=[],r.geometry=[]),t.defaults){if(o.Long){var n=new o.Long(0,0,!0);r.id=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.id=t.longs===String?"0":0;r.type=t.enums===String?"UNKNOWN":0}if(null!=e.id&&e.hasOwnProperty("id")&&("number"==typeof e.id?r.id=t.longs===String?String(e.id):e.id:r.id=t.longs===String?o.Long.prototype.toString.call(e.id):t.longs===Number?new o.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0):e.id),e.tags&&e.tags.length){r.tags=[];for(var i=0;i<e.tags.length;++i)r.tags[i]=e.tags[i]}if(null!=e.type&&e.hasOwnProperty("type")&&(r.type=t.enums===String?a.com.mapbox.pb.Tile.GeomType[e.type]:e.type),e.geometry&&e.geometry.length){r.geometry=[];for(i=0;i<e.geometry.length;++i)r.geometry[i]=e.geometry[i]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e.Layer=function(){function e(e){if(this.features=[],this.keys=[],this.values=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.version=1,e.prototype.name="",e.prototype.features=o.emptyArray,e.prototype.keys=o.emptyArray,e.prototype.values=o.emptyArray,e.prototype.extent=4096,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.com.mapbox.pb.Tile.Layer;e.pos<r;){var s=e.uint32();switch(s>>>3){case 15:n.version=e.uint32();break;case 1:n.name=e.string();break;case 2:n.features&&n.features.length||(n.features=[]),n.features.push(a.com.mapbox.pb.Tile.Feature.decode(e,e.uint32()));break;case 3:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;case 4:n.values&&n.values.length||(n.values=[]),n.values.push(a.com.mapbox.pb.Tile.Value.decode(e,e.uint32()));break;case 5:n.extent=e.uint32();break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("version"))throw o.ProtocolError("missing required 'version'",{instance:n});if(!n.hasOwnProperty("name"))throw o.ProtocolError("missing required 'name'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.com.mapbox.pb.Tile.Layer)return e;var t=new a.com.mapbox.pb.Tile.Layer;if(null!=e.version&&(t.version=e.version>>>0),null!=e.name&&(t.name=String(e.name)),e.features){if(!Array.isArray(e.features))throw TypeError(".com.mapbox.pb.Tile.Layer.features: array expected");t.features=[];for(var r=0;r<e.features.length;++r){if("object"!=typeof e.features[r])throw TypeError(".com.mapbox.pb.Tile.Layer.features: object expected");t.features[r]=a.com.mapbox.pb.Tile.Feature.fromObject(e.features[r])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(".com.mapbox.pb.Tile.Layer.keys: array expected");t.keys=[];for(r=0;r<e.keys.length;++r)t.keys[r]=String(e.keys[r])}if(e.values){if(!Array.isArray(e.values))throw TypeError(".com.mapbox.pb.Tile.Layer.values: array expected");t.values=[];for(r=0;r<e.values.length;++r){if("object"!=typeof e.values[r])throw TypeError(".com.mapbox.pb.Tile.Layer.values: object expected");t.values[r]=a.com.mapbox.pb.Tile.Value.fromObject(e.values[r])}}return null!=e.extent&&(t.extent=e.extent>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.features=[],r.keys=[],r.values=[]),t.defaults&&(r.name="",r.extent=4096,r.version=1),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),e.features&&e.features.length){r.features=[];for(var n=0;n<e.features.length;++n)r.features[n]=a.com.mapbox.pb.Tile.Feature.toObject(e.features[n],t)}if(e.keys&&e.keys.length){r.keys=[];for(n=0;n<e.keys.length;++n)r.keys[n]=e.keys[n]}if(e.values&&e.values.length){r.values=[];for(n=0;n<e.values.length;++n)r.values[n]=a.com.mapbox.pb.Tile.Value.toObject(e.values[n],t)}return null!=e.extent&&e.hasOwnProperty("extent")&&(r.extent=e.extent),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e}(),e}(),e}(),e}(),e.exports=a},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(90),o=function(){function e(e){this.m_processLayersDefault=!0,this.m_processPointsDefault=!0,this.m_processLinesDefault=!0,this.m_processPolygonsDefault=!0,this.m_layersToProcess=new Array,this.m_layersToIgnore=new Array,this.m_pointsToProcess=new Array,this.m_ignoredPoints=new Array,this.m_linesToProcess=new Array,this.m_linesToIgnore=new Array,this.m_polygonsToProcess=new Array,this.m_polygonsToIgnore=new Array,e&&(this.m_processLayersDefault=void 0===e.processLayersDefault||e.processLayersDefault,this.m_processPointsDefault=void 0===e.processPointsDefault||e.processPointsDefault,this.m_processLinesDefault=void 0===e.processLinesDefault||e.processLinesDefault,this.m_processPolygonsDefault=void 0===e.processPolygonsDefault||e.processPolygonsDefault)}return e.prototype.processLayer=function(e,t,r,n){void 0===t&&(t=i.OmvFilterString.StringMatch.Match),void 0===r&&(r=0),void 0===n&&(n=1/0),this.m_layersToProcess.push({name:{value:e,match:t},minLevel:r,maxLevel:n})},e.prototype.ignoreLayer=function(e,t,r,n){void 0===t&&(t=i.OmvFilterString.StringMatch.Match),void 0===r&&(r=0),void 0===n&&(n=1/0),this.m_layersToIgnore.push({name:{value:e,match:t},minLevel:r,maxLevel:n})},e.prototype.processPoint=function(e){this.addItem(this.m_pointsToProcess,e.layer,e.geomType,e.featureClass,e.matchLayer,e.matchClass,e.minLevel,e.maxLevel)},e.prototype.processPoints=function(e){this.addItems(this.m_pointsToProcess,e.layer,e.geomTypes,e.featureClasses,e.matchLayer,e.minLevel,e.maxLevel)},e.prototype.ignorePoint=function(e,t,r,n,o){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),void 0===o&&(o=i.OmvFilterString.StringMatch.Match),this.addItem(this.m_ignoredPoints,e,t,r,n,o)},e.prototype.ignorePoints=function(e,t,r,n){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),this.addItems(this.m_ignoredPoints,e,t,r,n)},e.prototype.processLine=function(e,t,r,n,o){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),void 0===o&&(o=i.OmvFilterString.StringMatch.Match),this.addItem(this.m_linesToProcess,e,t,r,n,o)},e.prototype.processLines=function(e,t,r,n){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),this.addItems(this.m_linesToProcess,e,t,r,n)},e.prototype.ignoreLine=function(e,t,r,n,o){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),void 0===o&&(o=i.OmvFilterString.StringMatch.Match),this.addItem(this.m_linesToIgnore,e,t,r,n,o)},e.prototype.ignoreLines=function(e,t,r,n){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),this.addItems(this.m_linesToIgnore,e,t,r,n)},e.prototype.processPolygon=function(e,t,r,n,o){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),void 0===o&&(o=i.OmvFilterString.StringMatch.Match),this.addItem(this.m_polygonsToProcess,e,t,r,n,o)},e.prototype.processPolygons=function(e,t,r,n){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),this.addItems(this.m_polygonsToProcess,e,t,r,n)},e.prototype.ignorePolygon=function(e,t,r,n,o){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),void 0===o&&(o=i.OmvFilterString.StringMatch.Match),this.addItem(this.m_polygonsToIgnore,e,t,r,n,o)},e.prototype.ignorePolygons=function(e,t,r,n){void 0===n&&(n=i.OmvFilterString.StringMatch.Match),this.addItems(this.m_polygonsToIgnore,e,t,r,n)},e.prototype.createDescription=function(){return{processLayersDefault:this.m_processLayersDefault,processPointsDefault:this.m_processPointsDefault,processLinesDefault:this.m_processLinesDefault,processPolygonsDefault:this.m_processPolygonsDefault,layersToProcess:this.m_layersToProcess,layersToIgnore:this.m_layersToIgnore,pointsToProcess:this.m_pointsToProcess,pointsToIgnore:this.m_ignoredPoints,linesToProcess:this.m_linesToProcess,linesToIgnore:this.m_linesToIgnore,polygonsToProcess:this.m_polygonsToProcess,polygonsToIgnore:this.m_polygonsToIgnore}},e.prototype.addItem=function(e,t,r,n,o,a,s,u){(void 0===s||isNaN(s))&&(s=0),(void 0===u||isNaN(u))&&(u=1/0);var l={layerName:{value:t,match:void 0===o?i.OmvFilterString.StringMatch.Match:o},geometryTypes:void 0!==r?Array.isArray(r)?r:[r]:void 0,classes:[{value:n,match:void 0===a?i.OmvFilterString.StringMatch.Match:a}],minLevel:s,maxLevel:u};e.push(l)},e.prototype.addItems=function(e,t,r,n,o,a,s){(void 0===a||isNaN(a))&&(a=0),(void 0===s||isNaN(s))&&(s=1/0);var u={layerName:{value:t,match:void 0===o?i.OmvFilterString.StringMatch.Match:o},geometryTypes:void 0!==r?Array.isArray(r)?r:[r]:void 0,classes:n,minLevel:a,maxLevel:s};e.push(u)},e}();t.OmvFeatureFilterDescriptionBuilder=o;var a=function(){function e(e){this.description=e}return e.matchLayer=function(e,t,r){try{for(var o=n(t),a=o.next();!a.done;a=o.next()){var s=a.value;if(!(r<s.minLevel||r>s.maxLevel)&&i.OmvFilterString.matchString(e.name,s.name))return!0}}catch(e){u={error:e}}finally{try{a&&!a.done&&(l=o.return)&&l.call(o)}finally{if(u)throw u.error}}return!1;var u,l},e.prototype.wantsLayer=function(t,r){return!!e.matchLayer(t,this.description.layersToProcess,r)||!e.matchLayer(t,this.description.layersToIgnore,r)&&this.description.processLayersDefault},e.prototype.wantsPointFeature=function(e,t,r){return this.wantsFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,r,this.description.processPointsDefault)},e.prototype.wantsLineFeature=function(e,t,r){return this.wantsFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,r,this.description.processLinesDefault)},e.prototype.wantsPolygonFeature=function(e,t,r){return this.wantsFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,r,this.description.processPolygonsDefault)},e.prototype.wantsFeature=function(e,t,r,o,a,s){try{for(var u=n(e),l=u.next();!l.done;l=u.next()){if(!(a<(h=l.value).minLevel||a>h.maxLevel)&&(i.OmvFilterString.matchString(r.name,h.layerName)&&void 0!==h.geometryTypes&&void 0!==o.type&&h.geometryTypes.indexOf(o.type.valueOf())>=0))return!0}}catch(e){f={error:e}}finally{try{l&&!l.done&&(p=u.return)&&p.call(u)}finally{if(f)throw f.error}}try{for(var c=n(t),d=c.next();!d.done;d=c.next()){var h=d.value;if(i.OmvFilterString.matchString(r.name,h.layerName)&&(void 0!==h.geometryTypes&&void 0!==o.type&&h.geometryTypes.indexOf(o.type.valueOf())>=0))return!1}}catch(e){m={error:e}}finally{try{d&&!d.done&&(y=c.return)&&y.call(c)}finally{if(m)throw m.error}}return s;var f,p,m,y},e}();t.OmvGenericFeatureFilter=a;var s=function(){function e(e){this.description=e}return e.matchItems=function(e,t,r){try{for(var o=n(r),a=o.next();!a.done;a=o.next()){var s=a.value;if(i.OmvFilterString.matchString(e,s.layerName)){var u=s.classes;if(void 0!==t&&void 0!==u)try{for(var l=n(u),c=l.next();!c.done;c=l.next()){var d=c.value;if(i.OmvFilterString.matchString(t,d))return!0}}catch(e){p={error:e}}finally{try{c&&!c.done&&(m=l.return)&&m.call(l)}finally{if(p)throw p.error}}}}}catch(e){h={error:e}}finally{try{a&&!a.done&&(f=o.return)&&f.call(o)}finally{if(h)throw h.error}}return!1;var h,f,p,m},e.prototype.doProcessPointFeature=function(e,t){return this.doProcessFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,this.description.processPointsDefault)},e.prototype.doProcessLineFeature=function(e,t){return this.doProcessFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,this.description.processLinesDefault)},e.prototype.doProcessPolygonFeature=function(e,t){return this.doProcessFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,this.description.processPolygonsDefault)},e.prototype.doProcessFeature=function(t,r,n,i,o){if(void 0===n||void 0===n.name)return o;var a,s=i.lookup("class");return void 0!==s&&(a=s.toString()),!(!a||!e.matchItems(n.name,a,t))||(!a||!e.matchItems(n.name,a,r))&&o},e}();t.OmvGenericFeatureModifier=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OMV_TILE_DECODER_SERVICE_ID="omv-tile-decoder",function(e){e[e.tomTom=0]="tomTom"}(t.FeatureModifierId||(t.FeatureModifierId={})),function(e){!function(e){e[e.Any=0]="Any",e[e.Match=1]="Match",e[e.StartsWith=2]="StartsWith",e[e.Contains=3]="Contains",e[e.EndsWith=4]="EndsWith"}(e.StringMatch||(e.StringMatch={})),e.matchString=function(t,r){switch(r.match){case e.StringMatch.Any:return!0;case e.StringMatch.Match:return t===r.value;case e.StringMatch.StartsWith:return r.value.startsWith(t);case e.StringMatch.EndsWith:return r.value.endsWith(t);default:return t.indexOf(r.value)>=0}}}(t.OmvFilterString||(t.OmvFilterString={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.POINT=1]="POINT",e[e.LINESTRING=2]="LINESTRING",e[e.POLYGON=3]="POLYGON"}(t.OmvGeometryType||(t.OmvGeometryType={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),self.importScripts("three.min.js");var n=r(92),i=r(166),o=r(36);new o.default,new o.default("omv-tile-decoder-1"),new o.default("omv-tile-decoder-2"),new o.default("omv-tile-decoder-3"),new i.default("landmark-tile-decoder-1"),new i.default("landmark-tile-decoder-2"),new i.default("landmark-tile-decoder-3"),new i.default,new n.default},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),a=r(24),s=r(4),u=r(27),l=r(131),c=r(81),d=r(1),h=r(83),f=r(0),p=d.LoggerManager.instance.create("GeoJson-Decoder"),m=function(){return function(){this.positions=[],this.indices=[],this.groups=[],this.featureStarts=[],this.featureIds=[],this.geojsonProperties=[]}}(),y=function(){return function(){this.points=[],this.lines=[],this.polygons=[]}}(),v=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.connect=function(){return Promise.resolve()},t.prototype.decodeThemedTile=function(e,t,r,n){var i=new g(n,r).getDecodedTile(t,e);return Promise.resolve(i)},t}(l.ThemedTileDecoder);t.GeoJsonTileDecoder=v;var g=function(){function e(e,t){this.m_projection=e,this.m_evaluator=t,this.m_center=new f.Vector3,this.m_geometries=[],this.m_geometryBuffer=new Map}return e.prototype.getDecodedTile=function(e,t){return this.m_center=this.getTileCenter(e),this.processGeoJson(t),{geometries:this.m_geometries,techniques:this.m_evaluator.techniques}},e.prototype.processGeoJson=function(e){var t=this;switch(e.type){case"Feature":this.processFeature(e);break;case"FeatureCollection":e.features.forEach(function(e){return t.processFeature(e)});break;default:var r={type:"Feature",geometry:e};this.processFeature(r)}this.createGeometry()},e.prototype.processFeature=function(e){var t,r=this;if(null!==e.geometry)switch(e.geometry.type){case"Point":t=this.findOrCreateTechniqueIndex(e,"point"),this.processPoint([e.geometry.coordinates],t);break;case"MultiPoint":t=this.findOrCreateTechniqueIndex(e,"point"),this.processPoint(e.geometry.coordinates,t);break;case"LineString":t=this.findOrCreateTechniqueIndex(e,"line"),this.processLineString([e.geometry.coordinates],t);break;case"MultiLineString":t=this.findOrCreateTechniqueIndex(e,"line"),this.processLineString(e.geometry.coordinates,t);break;case"Polygon":t=this.findOrCreateTechniqueIndex(e,"polygon"),this.processPolygon([e.geometry.coordinates],t,e.properties);break;case"MultiPolygon":t=this.findOrCreateTechniqueIndex(e,"polygon"),this.processPolygon(e.geometry.coordinates,t,e.properties);break;case"GeometryCollection":e.geometry.geometries.forEach(function(t){var n={type:"Feature",properties:e.properties,geometry:t};r.processFeature(n)});break;default:p.warn("Invalid GeoJSON data. Unknown geometry type.")}},e.prototype.processPoint=function(e,t){var r=this,n=this.findOrCreateGeometryBuffer(t);n.type="point",e.forEach(function(e){var t=new s.GeoCoordinates(e[1],e[0]),i=new f.Vector3;r.m_projection.projectPoint(t,i).sub(r.m_center),n.points.push(i.x,i.y,i.z)})},e.prototype.processLineString=function(e,t){var r=this,n=this.findOrCreateGeometryBuffer(t);n.type="solid-line",e.forEach(function(e){var t=[];e.forEach(function(e){if(null!==e&&null!==e[0]&&void 0!==e[0]){var n=new s.GeoCoordinates(e[1],e[0]),i=new f.Vector3;r.m_projection.projectPoint(n,i).sub(r.m_center),t.push(i.x,i.y)}}),n.lines.push(t)})},e.prototype.processPolygon=function(e,t,r){var n=this,i=this.findOrCreateGeometryBuffer(t);i.type="polygon",e.forEach(function(e){var t=[],o=[];e.forEach(function(e){null!==e[0]&&"number"==typeof e[0][0]&&(t.length&&o.push(t.length/2),e.forEach(function(e){var r=new s.GeoCoordinates(e[1],e[0]),i=new f.Vector3;n.m_projection.projectPoint(r,i).sub(n.m_center),e[0]>=180&&(i.x=-1*i.x),t.push(i.x,i.y)}))}),i.polygons.push({vertices:t,holes:o,geojsonProperties:r})})},e.prototype.createGeometry=function(){var e=this;this.m_geometryBuffer.forEach(function(t,r){switch(t.type){case"point":e.createPointGeometry(r,t);break;case"solid-line":e.createSolidLineGeometry(r,t);break;case"polygon":e.createPolygonGeometry(r,t);break;case"segments":e.createSegmentsGeometry(r,t)}})},e.prototype.createPointGeometry=function(e,t){var r={type:o.GeometryType.Point,vertexAttributes:[{name:"position",buffer:new Float32Array(t.points).buffer,itemCount:3,type:"float"}],groups:[{start:0,count:0,technique:e}]};this.m_geometries.push(r)},e.prototype.createSolidLineGeometry=function(e,t){var r=new u.Lines,n=new Array;t.lines.forEach(function(e){r.add(e),n.push.apply(n,e)});var i=r.vertices,a=r.indices,s=new Float32Array(i).buffer,l=new Uint32Array(a).buffer,c={type:"float",stride:12,buffer:s,attributes:u.LINE_VERTEX_ATTRIBUTE_DESCRIPTORS},d={type:o.GeometryType.SolidLine,index:{buffer:l,itemCount:1,type:"uint32",name:"index"},interleavedVertexAttributes:[c],vertexAttributes:[{name:"points",buffer:new Float32Array(n).buffer,itemCount:2,type:"float"}],groups:[{start:0,count:0,technique:e}]};this.m_geometries.push(d)},e.prototype.createPolygonGeometry=function(e,t){var r=new m,n=r.positions,i=r.indices,a=r.groups,s=r.featureStarts,u=r.featureIds,l=r.geojsonProperties;t.polygons.forEach(function(e){var t=n.length/3;s.push(i.length/3),u.push(0),l.push(e.geojsonProperties);for(var r=0;r<e.vertices.length;r+=2)n.push(e.vertices[r],e.vertices[r+1],0);var o=h.default(e.vertices,e.holes);for(r=0;r<o.length;r+=3){var a=o[r],c=o[r+1],d=o[r+2];i.push(a+t,c+t,d+t)}}),i.length>0&&a.push({start:0,count:i.length,technique:e});var c={type:o.GeometryType.Polygon,vertexAttributes:[{name:"position",buffer:new Float32Array(r.positions).buffer,itemCount:3,type:"float"}],groups:r.groups};r.indices.length>0&&(c.index={name:"index",buffer:new Uint32Array(r.indices).buffer,itemCount:1,type:"uint32"},c.featureStarts=r.featureStarts,c.featureIds=r.featureIds,c.objInfos=r.geojsonProperties),this.m_geometries.push(c)},e.prototype.createSegmentsGeometry=function(e,t){var r={type:o.GeometryType.Line,vertexAttributes:[{name:"position",buffer:new Float32Array(t.points).buffer,itemCount:3,type:"float"}],groups:[{start:0,count:0,technique:e}]};this.m_geometries.push(r)},e.prototype.findOrCreateTechniqueIndex=function(e,t){var r={};void 0!==e.id&&(r.featureId=e.id),e.properties&&void 0!==e.properties.featureClass&&(r.featureClass=e.properties.featureClass);var n,s,u=new a.MapEnv(i({type:t},r)),l=this.m_evaluator.getMatchingTechniques(u);void 0!==e.properties&&void 0!==e.properties.style&&("polygon"===t&&void 0!==e.properties.style.fill?s=new f.Color(e.properties.style.fill):void 0!==e.properties.style.color&&(s=new f.Color(e.properties.style.color)));var c="point"===t&&e.properties&&e.properties.radius?e.properties.radius:void 0,d=e.properties&&e.properties.width?e.properties.width:void 0;if(void 0!==s||void 0!==c||void 0!==d){if(l.forEach(function(e){var t=!0;if(void 0!==s&&(o.isSegmentsTechnique(e)||o.isPointTechnique(e)||o.isFillTechnique(e)||"solid-line"===e.name)){var r=new f.Color(e.color);void 0!==s&&r.r===s.r&&r.g===s.g&&r.b===s.b?n=e._index:(t=!1,n=void 0)}void 0!==c&&o.isPointTechnique(e)&&!0===t&&(5*c===e.size?n=e._index:(t=!1,n=void 0)),void 0!==d&&"solid-line"===e.name&&!0===t&&("number"==typeof e.lineWidth&&e.lineWidth===d?n=e._index:(t=!1,n=void 0))}),void 0===n){var h=this.m_evaluator.theme.styles.find(function(e){return e._index===l[0]._index});if(void 0!==(h=JSON.parse(JSON.stringify(h)))){if(delete h._index,delete h._whenExpr,void 0!==h.attr){delete h.attr._renderOrderAuto;var p=Object.assign({},{name:h.technique},h.attr);void 0!==s&&(o.isSegmentsTechnique(p)||o.isPointTechnique(p)||o.isFillTechnique(p)||"solid-line"===p.name)&&(h.attr.color=s.getStyle()),void 0!==c&&o.isPointTechnique(p)&&(h.attr.size=5*c),void 0!==d&&"solid-line"===p.name&&(h.attr.lineWidth=d)}this.m_evaluator.theme.styles.push(h),this.m_evaluator.getMatchingTechniques(u),n=h._index}}}else n=l[0]._index;if(void 0===n)throw new Error("GeoJsonDecoder#findOrCreateTechniqueIndex: Internal error - No technique index");return n},e.prototype.findOrCreateGeometryBuffer=function(e){var t=this.m_geometryBuffer.get(e);return void 0!==t?t:(t=new y,this.m_geometryBuffer.set(e,t),t)},e.prototype.getTileCenter=function(e){var t=s.webMercatorTilingScheme.getGeoBox(e),r=this.m_projection.projectBox(t,new f.Box3),n=new f.Vector3;return r.getCenter(n),n},e}(),b=function(){return function(e){c.TileDecoderService.start(e||"geojson",new v)}}();t.default=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),o=r(3),a=r(47);t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.createMaterial=function(e){var t=a.getMaterialConstructor(e.technique),r={};if(void 0!==t){t.prototype instanceof n.RawShaderMaterial&&t!==o.HighPrecisionLineMaterial&&(r.fog=e.fog);var i=new t(r);if(void 0!==e.technique.id&&(i.name=e.technique.id),"extruded-polygon"===e.technique.name&&(i.flatShading=!0),i.depthTest="extruded-polygon"===e.technique.name&&!1!==e.technique.depthTest,"shader"===e.technique.name){var s=e.technique.params;Object.getOwnPropertyNames(s).forEach(function(e){var t=e;if("name"!==t){var r=i;r[t]instanceof n.Color?r[t].set(s[t]):r[t]=s[t]}})}else a.applyTechniqueToMaterial(e.technique,i,e.level,e.skipExtraProps);return i}},t.getProjection=function(e){switch(e){case"mercator":return i.mercatorProjection;case"webMercator":return i.webMercatorProjection;default:throw new Error("Unknown projection "+e)}},t.getProjectionName=function(e){if(e===i.mercatorProjection)return"mercator";if(e===i.webMercatorProjection)return"webMercator";throw new Error("Unknown projection")},t.getBufferAttribute=function(e){switch(e.type){case"float":return new n.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint16":return new n.BufferAttribute(new Uint16Array(e.buffer),e.itemCount);case"uint32":return new n.BufferAttribute(new Uint32Array(e.buffer),e.itemCount);default:throw new Error("unsupported buffer of type "+e.type)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),i=r(6),o=r(10),a=Math.PI/180,s=function(){function e(){}return e.prototype.getScaleFactor=function(e){return 1},e.prototype.worldExtent=function(e,t,r){return r||(r=o.MathUtils.newEmptyBox3()),r.min.x=-Math.PI,r.min.y=.5*-Math.PI,r.min.z=e,r.max.x=Math.PI,r.max.y=.5*Math.PI,r.max.z=t,r},e.prototype.projectPoint=function(e,t){return t||(t={x:0,y:0,z:0}),t.x=e.longitude*a,t.y=e.latitude*a,t.z=e.altitude||0,t},e.prototype.unprojectPoint=function(e){return i.GeoCoordinates.fromRadians(e.y,e.x,e.z)},e.prototype.projectBox=function(e,t){return t||(t=o.MathUtils.newEmptyBox3()),this.projectPoint(new i.GeoCoordinates(e.south,e.west,e.minAltitude),t.min),this.projectPoint(new i.GeoCoordinates(e.north,e.east,e.maxAltitude),t.max),t},e.prototype.unprojectBox=function(e){var t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,r)},e}();t.identityProjection=new s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(8),o=function(){function e(e){this.tilingScheme=e}return e.prototype.visit=function(e){this.visitTileKey(i.TileKey.fromRowColumnLevel(0,0,0),e)},e.prototype.visitTileKey=function(e,t){var r,i;if(t(e,this.tilingScheme.getGeoBox(e)))try{for(var o=n(this.tilingScheme.getSubTileKeys(e)),a=o.next();!a.done;a=o.next()){var s=a.value;this.visitTileKey(s,t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e}();t.QuadTree=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(38),i=r(41),o=r(14);t.hereTilingScheme=new o.TilingScheme(i.halfQuadTreeSubdivisionScheme,n.equirectangularProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(39),i=r(22),o=r(14);t.webMercatorTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,n.webMercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(21),i=r(22),o=r(14);t.mercatorTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,n.mercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(r){var n=this,o={};return void 0!==r&&void 0!==r.color&&(o.color=r.color),void 0!==r&&void 0!==r.lineWidth&&(o.lineWidth=r.lineWidth),void 0!==r&&void 0!==r.opacity&&(o.opacity=r.opacity),void 0!==r&&void 0!==r.fog&&(o.fog=r.fog),(n=e.call(this,o)||this).name="DashedLineMaterial",Object.assign(n.uniforms,{dashSize:new i.Uniform(t.DEFAULT_DASH_SIZE),gapSize:new i.Uniform(t.DEFAULT_GAP_SIZE)}),void 0!==r&&(void 0!==r.dashSize&&(n.dashSize=r.dashSize),void 0!==r.gapSize&&(n.gapSize=r.gapSize),void 0!==r.fog&&(n.fog=null!==r.fog)),n}return n(t,e),Object.defineProperty(t.prototype,"dashSize",{get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gapSize",{get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e,this.updateDashedFeature()},enumerable:!0,configurable:!0}),t.prototype.updateDashedFeature=function(){this.defines.DASHED_LINE=this.gapSize>0?1:0},t.DEFAULT_DASH_SIZE=1,t.DEFAULT_GAP_SIZE=1,t}(r(46).SolidLineMaterial);t.DashedLineMaterial=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o="\nattribute vec3 position;\nattribute vec4 color;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\nvarying vec3 vColor;\n#if DEPTH_FADE_OUT\nvarying float vDepth;\n#endif\n\nvoid main() {\n    #if USE_COLOR\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n    #else\n    vColor = edgeColor.rgb;\n    #endif\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    #if DEPTH_FADE_OUT\n    vDepth = gl_Position.z/gl_Position.w;\n    #endif\n}",a="\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n#if DEPTH_FADE_OUT\nvarying float vDepth;\nuniform float depthFadeDist;\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    #if DEPTH_FADE_OUT\n    alphaValue = (1.0 - vDepth) * (1.0 / (1.0 - depthFadeDist));\n    #endif\n\n    gl_FragColor = vec4(vColor, alphaValue);\n}",s=function(e){function t(r){var n=this,s={name:"EdgeMaterial",vertexShader:o,fragmentShader:a,uniforms:{edgeColor:new i.Uniform(new i.Color(t.DEFAULT_COLOR)),edgeColorMix:new i.Uniform(t.DEFAULT_COLOR_MIX),depthFadeDist:new i.Uniform(t.DEFAULT_FADE_DIST)},depthWrite:!1};return n=e.call(this,s)||this,void 0!==r&&(void 0!==r.color&&n.color.set(r.color),void 0!==r.colorMix&&(n.colorMix=r.colorMix),void 0!==r.fadeDistance&&(n.fadeDistance=r.fadeDistance)),n}return n(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.edgeColor.value},set:function(e){this.uniforms.edgeColor.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorMix",{get:function(){return this.uniforms.edgeColorMix.value},set:function(e){this.uniforms.edgeColorMix.value=e,this.updateColorMixFeature()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeDistance",{get:function(){return this.uniforms.depthFadeDist.value},set:function(e){this.uniforms.depthFadeDist.value=e,this.updateDistanceFadeFeature()},enumerable:!0,configurable:!0}),t.prototype.updateColorMixFeature=function(){this.defines.USE_COLOR=this.colorMix>0?1:0},t.prototype.updateDistanceFadeFeature=function(){this.fadeDistance<1?(this.transparent=!0,this.defines.DEPTH_FADE_OUT=1):(this.transparent=!1,this.defines.DEPTH_FADE_OUT=0)},t.DEFAULT_COLOR=0,t.DEFAULT_COLOR_MIX=0,t.DEFAULT_FADE_DIST=.9,t}(i.RawShaderMaterial);t.EdgeMaterial=s},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o="\nattribute vec4 position;\nattribute vec3 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec3 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n}",a="\nprecision highp float;\nprecision highp int;\n\nuniform float pageOffset;\nuniform sampler2D page0;\nuniform sampler2D page1;\nuniform sampler2D page2;\nuniform sampler2D page3;\nuniform sampler2D page4;\nuniform sampler2D page5;\nuniform sampler2D page6;\nuniform sampler2D page7;\n\nvarying vec3 vUv;\n\nvoid main() {\n    float sample = 0.0;\n    if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n    else if (vUv.z < pageOffset + 1.0) sample = texture2D(page0, vUv.xy).a;\n    else if (vUv.z < pageOffset + 2.0) sample = texture2D(page1, vUv.xy).a;\n    else if (vUv.z < pageOffset + 3.0) sample = texture2D(page2, vUv.xy).a;\n    else if (vUv.z < pageOffset + 4.0) sample = texture2D(page3, vUv.xy).a;\n    else if (vUv.z < pageOffset + 5.0) sample = texture2D(page4, vUv.xy).a;\n    else if (vUv.z < pageOffset + 6.0) sample = texture2D(page5, vUv.xy).a;\n    else if (vUv.z < pageOffset + 7.0) sample = texture2D(page6, vUv.xy).a;\n    else sample = texture2D(page7, vUv.xy).a;\n\n    gl_FragColor = vec4(sample, sample, sample, 1.0);\n}",s=function(e){function t(){var t={name:"GlyphCopyMaterial",vertexShader:o,fragmentShader:a,uniforms:{pageOffset:new i.Uniform(0),page0:new i.Uniform(i.Texture.DEFAULT_IMAGE),page1:new i.Uniform(i.Texture.DEFAULT_IMAGE),page2:new i.Uniform(i.Texture.DEFAULT_IMAGE),page3:new i.Uniform(i.Texture.DEFAULT_IMAGE),page4:new i.Uniform(i.Texture.DEFAULT_IMAGE),page5:new i.Uniform(i.Texture.DEFAULT_IMAGE),page6:new i.Uniform(i.Texture.DEFAULT_IMAGE),page7:new i.Uniform(i.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1};return e.call(this,t)||this}return n(t,e),t}(i.RawShaderMaterial);t.GlyphCopyMaterial=s},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(23),a="\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert3D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",s="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuse, opacity );\n    #endif\n}",u=function(e){function t(r){var n=this;Object.assign(i.ShaderChunk,o.default);var u={name:"HighPrecisionLineMaterial",vertexShader:a,fragmentShader:s,uniforms:{diffuse:new i.Uniform(new i.Color(t.DEFAULT_COLOR)),opacity:new i.Uniform(t.DEFAULT_OPACITY),u_mvp:new i.Uniform(new i.Matrix4),u_eyepos:new i.Uniform(new i.Vector3),u_eyepos_lowpart:new i.Uniform(new i.Vector3)}};return Object.assign(u,r),(n=e.call(this,u)||this).type="HighPrecisionLineMaterial",n.isHighPrecisionLineMaterial=!0,n.dimensionality=3,void 0!==r&&(void 0!==r.color&&n.color.set(r.color),void 0!==r.opacity&&(n.opacity=r.opacity)),n.updateTransparencyFeature(),n}return n(t,e),Object.defineProperty(t.prototype,"color",{get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e},enumerable:!0,configurable:!0}),t.prototype.setDimensionality=function(e){e!==this.dimensionality&&(this.dimensionality=e,this.vertexShader=2===this.dimensionality?"\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec2 position;        // high part\nattribute vec2 positionLow;     // low part\n\n#include <high_precision_vert2D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 0.0, 1.0);\n}":a)},t.prototype.updateTransparencyFeature=function(){this.transparent=this.opacity<1},t.DEFAULT_COLOR=80,t.DEFAULT_OPACITY=1,t}(i.RawShaderMaterial);t.HighPrecisionLineMaterial=u},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(23),a="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert3D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}",s=function(e){function t(r){var n=this;Object.assign(i.ShaderChunk,o.default);var s=r;return(n=e.call(this,s)||this).type="HighPrecisionPointMaterial",n.vertexShader=a,n.fragmentShader=i.ShaderChunk.points_frag,n.fog=!1,n.uniforms={diffuse:new i.Uniform(new i.Color(t.DEFAULT_COLOR)),opacity:new i.Uniform(t.DEFAULT_OPACITY),size:new i.Uniform(t.DEFAULT_SIZE),scale:new i.Uniform(t.DEFAULT_SCALE),map:new i.Uniform(new i.Texture),uvTransform:new i.Uniform(new i.Matrix3),u_mvp:new i.Uniform(new i.Matrix4),u_eyepos:new i.Uniform(new i.Vector3),u_eyepos_lowpart:new i.Uniform(new i.Vector3)},n.isHighPrecisionPointMaterial=!0,n.dimensionality=3,void 0!==r&&(void 0!==r.color&&n.color.set(r.color),void 0!==r.opacity&&(n.opacity=r.opacity),void 0!==r.size&&(n.size=r.size),void 0!==r.scale&&(n.scale=r.scale),void 0!==r.uvTransform&&(n.uvTransform=r.uvTransform),void 0!==r.map&&(n.map=r.map)),n}return n(t,e),Object.defineProperty(t.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uvTransform",{get:function(){return this.uniforms.uvTransform.value},set:function(e){this.uniforms.uvTransform.value=e},enumerable:!0,configurable:!0}),t.prototype.setDimensionality=function(e){e!==this.dimensionality&&(this.dimensionality=e,this.vertexShader=2===this.dimensionality?"\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec2 position;        // high part\nattribute vec2 positionLow;     // low part\n\n#include <high_precision_vert2D_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec2 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 0.0, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}":a)},t.DEFAULT_COLOR=80,t.DEFAULT_OPACITY=1,t.DEFAULT_SIZE=1,t.DEFAULT_SCALE=1,t}(i.PointsMaterial);t.HighPrecisionPointMaterial=s},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o="\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",a="\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor.a;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}",s=function(e){function t(t){var r={name:"IconMaterial",vertexShader:o,fragmentShader:a,uniforms:{map:new i.Uniform(t.map)},depthTest:!0,depthWrite:!0,transparent:!0,vertexColors:i.VertexColors,premultipliedAlpha:!0,blending:i.NormalBlending};return e.call(this,r)||this}return n(t,e),Object.defineProperty(t.prototype,"map",{get:function(){return this.uniforms.map.value},enumerable:!0,configurable:!0}),t}(i.RawShaderMaterial);t.IconMaterial=s},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(45),a=function(e){function t(t){return e.call(this,{uniforms:t,vertexShader:o.CopyShader.vertexShader,fragmentShader:o.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:i.AdditiveBlending,depthTest:!1,depthWrite:!1})||this}return n(t,e),t}(i.ShaderMaterial);t.MSAAMaterial=a},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o="\nattribute vec4 position;\nattribute vec4 color;\nattribute vec4 uv;\nattribute vec2 glyphAxis;\nattribute vec2 dummy_for_alignment;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec4 vUv;\nvarying float vWeight;\nvarying float vBG;\n\nvoid main() {\n    vColor = color;\n    vUv = vec4(uv.xy, glyphAxis.xy);\n    vWeight = uv.z;\n    vBG = uv.w;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",a='\nprecision highp float;\nprecision highp int;\n\n// Make sure this parameter matches the "distanceRange" used when generating these fonts (found in:\n// @here/map-theme/scripts/create-font-catalog.js).\n#define SDF_DISTANCE_RANGE 8.0\n\nuniform sampler2D texture;\nuniform float textureSize;\n\n#if BG_TEXT\nuniform vec3 bgColor;\nuniform float bgFactor;\nuniform float bgAlpha;\n#endif\n\nvarying vec4 vColor;\nvarying vec4 vUv;\nvarying float vWeight;\nvarying float vBG;\n\nvoid main() {\n\n    vec4 color = vec4(vColor);\n    vec3 sample = texture2D(texture, vUv.xy).rgb;\n\n    float h = sqrt(vUv.z * vUv.z + vUv.w * vUv.w);\n    float textScale = max(abs(vUv.z / h), 0.000001);\n    float dx = abs(dFdx( vUv.x ) * textureSize);\n    float dy = abs(dFdy( vUv.y ) * textureSize);\n    // Special case for glyphs perfectly aligned with the screen Y axis.\n    if (dx == 0.0 && dy == 0.0) {\n        textScale = 1.0;\n        dx = abs(dFdy( vUv.x ) * textureSize);\n        dy = abs(dFdx( vUv.y ) * textureSize);\n    }\n    float toPixels = SDF_DISTANCE_RANGE * inversesqrt( dx * dx + dy * dy ) * textScale;\n\n    float distScale = vWeight;\n    float alphaScale = 1.0;\n    #if BG_TEXT\n    // TODO: Make this less hard-coded with proper outlines specified in pixel width.\n    distScale = (1.0 + (bgFactor * (vWeight - 1.0 ))) * bgFactor;\n    alphaScale = bgAlpha;\n    color.rgb = bgColor;\n\n    float dist = sample.r * distScale - 0.5;\n    float alpha = 1.0;\n    if (vBG < 1.0) alpha = clamp( dist * toPixels + 0.5, 0.0, alphaScale);\n    else alpha = (dist + 0.5) * alphaScale;\n    #else\n    float dist = sample.r * distScale - 0.5;\n    float alpha = clamp( dist * toPixels + 0.5, 0.0, alphaScale);\n    #endif\n    color.a *= alpha;\n    if (color.a < 0.05) {\n        discard;\n    }\n\n    gl_FragColor = color;\n}',s=function(e){function t(r){var n=this,s={name:"TextMaterial",vertexShader:o,fragmentShader:a,uniforms:{texture:new i.Uniform(r.texture),textureSize:new i.Uniform(r.textureSize),bgFactor:new i.Uniform(t.DEFAULT_BG_FACTOR),bgColor:new i.Uniform(new i.Color(t.DEFAULT_BG_COLOR)),bgAlpha:new i.Uniform(t.DEFAULT_BG_ALPHA)},defines:{BG_TEXT:0},depthTest:!0,depthWrite:!0,transparent:!0};return(n=e.call(this,s)||this).extensions.derivatives=!0,void 0!==r&&(void 0!==r.bgColor&&n.bgColor.set(r.bgColor),void 0!==r.bgFactor&&(n.bgFactor=r.bgFactor),void 0!==r.bgAlpha&&(n.bgAlpha=r.bgAlpha)),n}return n(t,e),Object.defineProperty(t.prototype,"bgFactor",{get:function(){return this.uniforms.bgFactor.value},set:function(e){this.uniforms.bgFactor.value=e,this.updateBackgroundFeature()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgColor",{get:function(){return this.uniforms.bgColor.value},set:function(e){this.uniforms.bgColor.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgAlpha",{get:function(){return this.uniforms.bgAlpha.value},set:function(e){this.uniforms.bgAlpha.value=e},enumerable:!0,configurable:!0}),t.prototype.updateBackgroundFeature=function(){this.defines.BG_TEXT=this.bgFactor>0?1:0},t.DEFAULT_BG_FACTOR=0,t.DEFAULT_BG_COLOR=14737632,t.DEFAULT_BG_ALPHA=1,t}(i.RawShaderMaterial);t.TextMaterial=s},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t){void 0===t&&(t=new Array),this.priority=e,this.elements=t}}();t.PriorityListGroup=i;var o=function(){function e(){this.groups=new Map}return e.prototype.add=function(e){this.getGroup(e.priority).elements.push(e)},e.prototype.remove=function(e){var t=this.getGroup(e.priority);if(void 0!==t){var r=t.elements.indexOf(e);if(r>=0){if(t.elements.splice(r,1),0===t.elements.length){var n=Math.floor(e.priority);this.groups.delete(n)}return!0}}return!1},e.prototype.clear=function(){this.groups.clear()},e.prototype.merge=function(e){try{for(var t=n(e.groups),r=t.next();!r.done;r=t.next()){var i=r.value,o=this.findGroup(i[1].priority);void 0!==o?o.elements=o.elements.concat(i[1].elements):this.groups.set(Math.floor(i[1].priority),i[1])}}catch(e){a={error:e}}finally{try{r&&!r.done&&(s=t.return)&&s.call(t)}finally{if(a)throw a.error}}return this;var a,s},Object.defineProperty(e.prototype,"sortedGroups",{get:function(){var e,t,r=[];try{for(var i=n(this.groups),o=i.next();!o.done;o=i.next()){var a=o.value;r.push(a[1])}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r.sort(function(e,t){return t.priority-e.priority}),r},enumerable:!0,configurable:!0}),e.prototype.findGroup=function(e){var t=Math.floor(e);return this.groups.get(t)},e.prototype.getGroup=function(e){var t=this.findGroup(e);if(void 0===t){var r=Math.floor(e);t=new i(r),this.groups.set(r,t)}return t},e}();t.GroupedPriorityList=o},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(48)),n(r(115)),n(r(25)),n(r(49)),n(r(116)),n(r(118)),n(r(50))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(117),i=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this.m_instance||(this.m_instance=new n.LoggerManagerImpl)},enumerable:!0,configurable:!0}),e}();t.LoggerManager=i},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(48),o=r(49),a=r(50),s=function(){function e(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new i.ConsoleChannel:new a.WorkerChannel}return e.prototype.getLoggerNames=function(){return this.m_loggers.map(function(e){return e.name})},e.prototype.getLogger=function(e){return this.m_loggers.find(function(t){return t.name===e})},e.prototype.create=function(e,t){var r=new o.Logger(e,this.channel,t);return this.m_loggers.push(r),r},e.prototype.dispose=function(e){var t=this.m_loggers.indexOf(e);if(t<0)throw new Error('Cannot unregister "'+e+'" : no such logger registered.');this.m_loggers.splice(t,1)},e.prototype.updateAll=function(e){try{for(var t=n(this.m_loggers),r=t.next();!r.done;r=t.next()){r.value.update(e)}}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=t.return)&&o.call(t)}finally{if(i)throw i.error}}var i,o},e.prototype.update=function(e,t){try{for(var r=n(this.m_loggers),i=r.next();!i.done;i=r.next()){var o=i.value;o.name===e&&o.update(t)}}catch(e){a={error:e}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(a)throw a.error}}var a,s},e.prototype.enableAll=function(e){try{for(var t=n(this.m_loggers),r=t.next();!r.done;r=t.next()){r.value.enabled=e}}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=t.return)&&o.call(t)}finally{if(i)throw i.error}}var i,o},e.prototype.enable=function(e,t){this.update(e,{enabled:t})},e.prototype.setLogLevelForAll=function(e){try{for(var t=n(this.m_loggers),r=t.next();!r.done;r=t.next()){r.value.level=e}}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=t.return)&&o.call(t)}finally{if(i)throw i.error}}var i,o},e.prototype.setLogLevel=function(e,t){this.update(e,{level:t})},e.prototype.setChannel=function(e){this.channel=e},e}();t.LoggerManagerImpl=s},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.channels=[],this.channels=e}return e.prototype.error=function(e){for(var t,r,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=n(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.error.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.debug=function(e){for(var t,r,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=n(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.debug.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.info=function(e){for(var t,r,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=n(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.info.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.log=function(e){for(var t,r,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=n(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.log.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.trace=function(e){for(var t,r,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=n(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.trace.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e.prototype.warn=function(e){for(var t,r,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];try{for(var s=n(this.channels),u=s.next();!u.done;u=s.next()){var l=u.value;l.warn.apply(l,o([e],i))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}},e}();t.MultiChannel=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t=function(){function e(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=0),this.x=e,this.y=t,this.w=r,this.h=n}return e.prototype.set=function(e,t,r,n){this.x=e,this.y=t,this.w=r,this.h=n},e.prototype.contains=function(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t},e.prototype.intersects=function(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y},e}();function r(e,t,r,n){return(e-r)*(e-r)+(t-n)*(t-n)}e.Box=t,e.distSquared=r,e.distToSegmentSquared=function(e,t,n,i,o,a){var s=r(n,i,o,a);if(0===s)return r(e,t,n,i);var u=((e-n)*(o-n)+(t-i)*(a-i))/s;return r(e,t,n+(u=Math.max(0,Math.min(1,u)))*(o-n),i+u*(a-i))}}(t.Math2D||(t.Math2D={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,r){return e<t?t:e>r?r:e}e.clamp=t,e.smoothStep=function(e,r,n){return(n=t((n-e)/(r-e),0,1))*n*(3-2*n)},e.smootherStep=function(e,r,n){return(n=t((n-e)/(r-e),0,1))*n*n*(n*(6*n-15)+10)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=!0;t.assert=function(e,t){if(!n&&!e)throw new Error(void 0!==t?t:"ASSERTION failed")},t.assertExists=function(e,t){if(!n&&!e)throw new Error(void 0!==t?t:"ASSERTION failed: Element is undefined");return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function t(){if("undefined"!=typeof performance&&void 0!==performance.now)t.nowFunc=function(){return performance.now()};else if("undefined"!=typeof window){var r=window;r&&r.performance&&r.performance.now?t.nowFunc=function(){return window.performance.now()}:r&&r.webkitNow?t.nowFunc=function(){return r.performance.webkitNow()}:t.nowFunc=function(){return(new Date).getTime()}}else void 0!==e&&void 0!==e.hrtime?t.nowFunc=function(){var t=e.hrtime();return Math.round(1e3*t[0]+t[1]/1e6)}:t.nowFunc=function(){return(new Date).getTime()}}return t.now=function(){return t.nowFunc()},t.instance=new t,t}();t.PerformanceTimer=r}).call(this,r(26))},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{for(var o=i(r),a=o.next();!a.done;a=o.next()){var s=a.value;if(void 0!==s&&null!==s)return s}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.mergeWithOptions=function(e,t){var r=n({},e);if(void 0===t||null===t)return r;for(var i in e)if(e.hasOwnProperty(i)){var o=t[i];void 0!==o&&null!==o&&(r[i]=o)}return r}},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultUrlResolver=function(e){return void 0!==n?n(e):e},t.setDefaultUrlResolver=function(e){n=e},t.composeUrlResolvers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return e.reduce(function(e,t){return void 0!==t?t(e):e},t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveReferenceUrl=function(e,t){return n.test(t)?t:t.startsWith("/")?o(e)+t:(t.startsWith("./")&&(t=t.substr(2)),i(e)+t)};var n=new RegExp("^(?:[a-z]+:)?//","i");function i(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}function o(e){var t=a(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function a(e){var t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),r=e.match(t);if(!r)throw new Error("getUrlHostAndProtocol: unable to parse URL '"+e+"'");return{protocol:r[1],host:r[2]}}t.baseUrl=i,t.getUrlOrigin=o,t.getUrlHostAndProtocol=a},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=function(){return function(e,t){void 0===t&&(t=5e3),this.featureIds=new Array,this.numFeatures=0,this.numPositions=0,this.featureIds=new Array(t),this.featureIds.length=t,this.techniqueIndex=new Array(t),this.techniqueIndex.length=t,this.textIndex=new Array(t),this.textIndex.length=t,this.positionIndex=new Array(t),this.positionIndex.length=t,this.positions=new Array(10*t),this.positions.length=10*t,e&&(this.layerIndex=new Array(t),this.layerIndex.length=t,this.classIndex=new Array(t),this.classIndex.length=t,this.typeIndex=new Array(t),this.typeIndex.length=t)}}();t.FeatureGroup=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(a);t.LineFeatureGroup=s;var u=function(e){function t(t,r){void 0===r&&(r=5e3);var n=e.call(this,t,r)||this;return n.groupNumRings=0,n.outerRingStartIndex=new Array(r),n.outerRingStartIndex.length=r,n.innerRingIsOuterContour=new Array(r),n.innerRingIsOuterContour.length=r,n.innerRingStartIndex=new Array(r),n.innerRingStartIndex.length=r,n}return n(t,e),t}(a);t.PolygonFeatureGroup=u;var l=function(){return function(e,t){this.tileKey=e,this.textCatalog=new Array,this.techniqueCatalog=new Array,this.setupTime=0,this.pointGroup=new a(t),this.lineGroup=new s(t),this.polygonGroup=new u(t),t&&(this.layerCatalog=new Array,this.classCatalog=new Array,this.typeCatalog=new Array)}}();t.ExtendedTileInfo=l,function(e){function t(e){e.featureIds.length=e.numFeatures,e.techniqueIndex.length=e.numFeatures,e.textIndex.length=e.numFeatures,e.positionIndex.length=e.numFeatures,e.positions.length=e.numPositions,void 0!==e.layerIndex&&(e.layerIndex.length=e.numFeatures),void 0!==e.classIndex&&(e.classIndex.length=e.numFeatures),void 0!==e.typeIndex&&(e.typeIndex.length=e.numFeatures)}function r(e){return e.numPositions===e.positions.length}e.finish=function(e){t(e.pointGroup),function(e){t(e),void 0!==e.segmentIds&&(e.segmentIds.length=e.numFeatures,e.segmentStartOffsets.length=e.numFeatures,e.segmentEndOffsets.length=e.numFeatures)}(e.lineGroup),function(e){t(e),e.outerRingStartIndex.length=e.numFeatures,e.innerRingIsOuterContour.length=e.groupNumRings,e.innerRingStartIndex.length=e.groupNumRings}(e.polygonGroup)},e.featureGroupSize=function(e){return e.numFeatures},e.featureGroupFinished=r,e.tileInfoFinished=function(e){return r(e.pointGroup)&&r(e.lineGroup)&&r(e.polygonGroup)},e.getFeatureName=function(e,t,r,n){var o,a,s;if(t){var u=e.lookup("abbr");if("string"==typeof u&&u.length>0)return u}if(r){var l=e.lookup("iso_code");if("string"==typeof l&&l.length>0)return l}if(void 0!==n)try{for(var c=i(n),d=c.next();!d.done;d=c.next()){var h=d.value;if("string"==typeof(o=e.lookup("name_"+h))&&o.length>0)return o}}catch(e){a={error:e}}finally{try{d&&!d.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}if("string"==typeof(o=e.lookup("name")))return o}}(l=t.ExtendedTileInfo||(t.ExtendedTileInfo={})),t.ExtendedTileInfo=l;var c=function(){function e(e,t,r){this.tileInfo=e,this.storeExtendedTags=t,this.languages=r,this.techniqueIndexMap=new Map,this.stringMap=new Map,this.layerMap=new Map,this.classMap=new Map,this.typeMap=new Map}return e.prototype.addTechnique=function(e){if(void 0===e._index)throw new Error("ExtendedTileInfoEmitter#processPointFeature: Internal error - No technique index");var t=this.techniqueIndexMap.get(e._index);if(void 0!==t)return t;t=this.tileInfo.techniqueCatalog.length;var r={};return Object.getOwnPropertyNames(e).forEach(function(t){t.startsWith("_")||(r[t]=e[t])}),r._index=e._index,this.techniqueIndexMap.set(e._index,t),this.tileInfo.techniqueCatalog.push(r),t},e.prototype.addFeature=function(e,t,r,n,i,a){var s=t,u=s.label,c=s.useAbbreviation,d=s.useIsoCode,h="string"==typeof u?r.lookup(u):l.getFeatureName(r,c,d,this.languages),f=-1;if(h&&"string"==typeof h&&(f=this.addText(h)),e.featureIds[e.numFeatures]=n,e.techniqueIndex[e.numFeatures]=i,e.textIndex[e.numFeatures]=f,e.positionIndex[e.numFeatures]=e.numPositions,a){var p=e;o.assert(void 0!==p.outerRingStartIndex),o.assert(void 0!==p.innerRingStartIndex),o.assert(void 0!==p.innerRingIsOuterContour),p.outerRingStartIndex[e.numFeatures]=p.groupNumRings}this.storeExtendedTags&&(e.layerIndex[e.numFeatures]=this.addLayer(r.lookup("$layer")),e.classIndex[e.numFeatures]=this.addClass(r.lookup("class")),e.typeIndex[e.numFeatures]=this.addType(r.lookup("type"))),e.numFeatures++},e.prototype.addFeaturePoint=function(e,t,r){e.positions[e.numPositions++]=t,e.positions[e.numPositions++]=r},e.prototype.addFeaturePoints=function(e,t){for(var r=e.numPositions,n=t.length,i=e.positions,o=0;o<n;o++)i[r+o]=t[o];e.numPositions+=t.length},e.prototype.addRoadSegments=function(e,t,r,n){void 0===e.segmentIds&&(e.segmentIds=new Array,e.segmentStartOffsets=new Array,e.segmentEndOffsets=new Array),e.segmentIds[e.numFeatures-1]=t,e.segmentStartOffsets[e.numFeatures-1]=r,e.segmentEndOffsets[e.numFeatures-1]=n},e.prototype.addRingPoints=function(e,t,r){e.innerRingStartIndex[e.groupNumRings]=e.numPositions,e.innerRingIsOuterContour[e.groupNumRings]=r?1:0,e.groupNumRings++;for(var n=e.numPositions,i=t.length,o=e.positions,a=0;a<i;a++)o[n+a]=t[a];e.numPositions+=t.length},e.prototype.finish=function(){l.finish(this.tileInfo)},e.prototype.addText=function(e){return this.addStringValue(e,this.tileInfo.textCatalog,this.stringMap)},e.prototype.addLayer=function(e){return this.addStringValue(e,this.tileInfo.layerCatalog,this.layerMap)},e.prototype.addClass=function(e){return this.addStringValue(e,this.tileInfo.classCatalog,this.classMap)},e.prototype.addType=function(e){return this.addStringValue(e,this.tileInfo.typeCatalog,this.typeMap)},e.prototype.addStringValue=function(e,t,r){if(void 0===e)return-1;var n=e.toString(),i=r.get(n);return void 0!==i?i:(i=t.length,t.push(n),r.set(n,i),i)},e}();t.ExtendedTileInfoWriter=c;var d=function(){function e(){this.polygons=new u(!1,5e3),this.featureIndex=0,this.ringStart=0,this.numRings=0}return e.prototype.setup=function(e,t,r,n){this.polygons=e,this.featureIndex=t,this.ringStart=r,this.numRings=n},e.prototype.isOuterRing=function(e){if(o.assert(e>=0),o.assert(e<this.numRings),e<0||e>=this.numRings)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");return 0!==this.polygons.innerRingIsOuterContour[this.ringStart+e]},e.prototype.getPoints=function(e){if(o.assert(e>=0),o.assert(e<this.numRings),e<0||e>=this.numRings)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");var t,r=this.polygons.innerRingStartIndex[this.ringStart+e];return t=e<this.numRings-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-r:this.ringStart+e<this.polygons.innerRingStartIndex.length-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-r:this.polygons.positions.length-r,{points:this.polygons.positions,pointsStart:r,numPointValues:t}},e}(),h=function(){function e(e){this.tileInfo=e}return e.prototype.visitAll=function(e){this.visitAllPointFeatures(e),this.visitAllLineFeatures(e),this.visitAllPolygonFeatures(e)},e.prototype.visitFeature=function(e,t){for(var r=0,n=this.tileInfo.pointGroup.numFeatures,i=this.tileInfo.pointGroup.featureIds,o=0;o<n;o++)i[o]===e&&(r++,this.visitPointFeature(o,t));var a=this.tileInfo.lineGroup.numFeatures,s=this.tileInfo.lineGroup.featureIds;for(o=0;o<a;o++)s[o]===e&&(r++,this.visitLineFeature(o,t));var u=this.tileInfo.polygonGroup.numFeatures,l=this.tileInfo.polygonGroup.featureIds;for(o=0;o<u;o++)l[o]===e&&(r++,this.visitPolygonFeature(o,t));return r},e.prototype.visitAllPointFeatures=function(e){for(var t=this.tileInfo.pointGroup.numFeatures,r=0;r<t;r++)this.visitPointFeature(r,e)},e.prototype.visitAllLineFeatures=function(e){for(var t=this.tileInfo.lineGroup.numFeatures,r=0;r<t;r++)this.visitLineFeature(r,e)},e.prototype.visitAllPolygonFeatures=function(e){for(var t=this.tileInfo.polygonGroup.numFeatures,r=0;r<t;r++)this.visitPolygonFeature(r,e)},e.prototype.getTag=function(e,t){return void 0!==t&&t[e]>=0?t[e]:-1},e.prototype.visitPointFeature=function(e,t){var r=this.tileInfo.pointGroup,n=r.positionIndex[e],i=r.positions[n],o=r.positions[n+1];t.acceptPoint&&t.acceptPoint(r.featureIds[e],r.techniqueIndex[e],i,o,r.textIndex[e],this.getTag(e,r.layerIndex),this.getTag(e,r.classIndex),this.getTag(e,r.typeIndex))},e.prototype.visitLineFeature=function(e,t){var r,n,i,o=this.tileInfo,a=o.lineGroup,s=a.numFeatures,u=a.positionIndex[e],l=e===s-1?a.positions.length-u:a.positionIndex[e+1]-u;void 0!==a.segmentIds&&(r=a.segmentIds[e],n=a.segmentStartOffsets[e],i=a.segmentEndOffsets[e]),t.acceptLine&&t.acceptLine(a.featureIds[e],a.techniqueIndex[e],a.textIndex[e],this.getTag(e,a.layerIndex),this.getTag(e,a.classIndex),this.getTag(e,a.typeIndex),o.lineGroup.positions,u,l,r,n,i)},e.prototype.visitPolygonFeature=function(t,r){var n=this.tileInfo.polygonGroup,i=n.numFeatures,o=n.outerRingStartIndex[t],a=t===i-1?n.innerRingStartIndex.length-o:n.outerRingStartIndex[t+1]-o;e.polygonAccessor.setup(n,t,o,a),r.acceptPolygon&&r.acceptPolygon(n.featureIds[t],n.techniqueIndex[t],n.textIndex[t],this.getTag(t,n.layerIndex),this.getTag(t,n.classIndex),this.getTag(t,n.typeIndex),e.polygonAccessor)},e.polygonAccessor=new d,e}();t.ExtendedTileInfoVisitor=h},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Configuration="configuration",e.Initialized="initialized",e.Request="request",e.Response="response"}(n=t.DecodedTileMessageName||(t.DecodedTileMessageName={})),function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(i=t.Requests||(t.Requests={})),t.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===n.Configuration},t.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===n.Initialized},t.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===n.Request},t.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===n.Response},t.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.DecodeTileRequest},t.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.TileInfoRequest}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);function i(e){return new Float32Array([e])[0]}var o=function(){return function(){this.vertices=[],this.indices=[]}}();function a(e,t,r){if(void 0===t&&(t=new o),void 0===r&&(r=!1),0===e.length)return t;var n=e.length/2,a=t.vertices,s=t.indices,u=[],l=[],c=[],d=t.vertices.length/12,h=0;l.push(0);for(var f=0;f<n-1;++f){var p=e[2*(f+1)]-e[2*f],m=e[2*(f+1)+1]-e[2*f+1],y=Math.sqrt(p*p+m*m);u[f]=y,h+=y,l.push(h),c.push([p,m])}var v=e[0]===e[e.length-2]&&e[1]===e[e.length-1];for(f=0;f<n;++f){var g=e[2*f],b=e[2*f+1],_=v&&0===f?c[c.length-1]:c[Math.max(0,f-1)],x=v&&f===n-1?c[0]:c[Math.min(f,c.length-1)];if(f>0){var w=l[f-1],T=l[f];if(r){var S=g-(E=i(g)),O=b-(P=i(b));a.push(E,P,S,O,w,T,_[0],_[1],x[0],x[1],0,0,1,-1),a.push(E,P,S,O,w,T,_[0],_[1],x[0],x[1],0,0,1,1)}else a.push(g,b,w,T,_[0],_[1],x[0],x[1],0,0,1,-1),a.push(g,b,w,T,_[0],_[1],x[0],x[1],0,0,1,1)}if(f+1<n){w=l[Math.min(f,l.length-1)],T=l[Math.min(f+1,l.length-1)];if(r){var E,P;S=g-(E=i(g)),O=b-(P=i(b));a.push(E,P,S,O,w,T,_[0],_[1],x[0],x[1],0,0,-1,-1),a.push(E,P,S,O,w,T,_[0],_[1],x[0],x[1],0,0,-1,1)}else a.push(g,b,w,T,_[0],_[1],x[0],x[1],0,0,-1,-1),a.push(g,b,w,T,_[0],_[1],x[0],x[1],0,0,-1,1)}}for(f=0;f<n-1;++f){var C=d+4*f;s.push(C,C+1,C+2,C+2,C+1,C+3)}return t}function s(e,t){if(void 0===t&&(t=new o),0===e.length)return t;for(var r=e.length/2,n=t.vertices,i=t.indices,a=n.length/3,s=0;s<r;++s,a++){var u=e[2*s],l=e[2*s+1];s>0&&i.push(a),s<r-1&&i.push(a),n.push(u,l,0)}return t}t.LineGeometry=o,t.createLineGeometry=a,t.createSimpleLineGeometry=s,t.LINE_VERTEX_ATTRIBUTE_DESCRIPTORS=[{name:"position",itemSize:2,offset:0},{name:"segment",itemSize:2,offset:2},{name:"tangents",itemSize:4,offset:4},{name:"angles",itemSize:2,offset:8},{name:"texcoord",itemSize:2,offset:10}],t.HP_LINE_VERTEX_ATTRIBUTE_DESCRIPTORS=[{name:"position",itemSize:2,offset:0},{name:"positionLow",itemSize:2,offset:2},{name:"segment",itemSize:2,offset:4},{name:"tangents",itemSize:4,offset:6},{name:"angles",itemSize:2,offset:10},{name:"texcoord",itemSize:2,offset:12}];var u=function(){function e(e){void 0===e&&(e=!1),this.highPrecision=e,this.g=new o}return e.createGeometry=function(e,r,i,o){void 0===o&&(o=!1);var a=new n.InterleavedBuffer(new Float32Array(e),o?14:12);return(o?t.HP_LINE_VERTEX_ATTRIBUTE_DESCRIPTORS:t.LINE_VERTEX_ATTRIBUTE_DESCRIPTORS).forEach(function(e){var t=new n.InterleavedBufferAttribute(a,e.itemSize,e.offset,!1);i.addAttribute(e.name,t)}),i.setIndex(new n.BufferAttribute(new Uint32Array(r),1)),i},e.prototype.clear=function(){this.g.vertices=[],this.g.indices=[]},e.prototype.add=function(e,t){return void 0===t&&(t=!1),t?s(e,this.g):a(e,this.g,this.highPrecision),this},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.g.vertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this.g.indices},enumerable:!0,configurable:!0}),e.prototype.createGeometry=function(t){return void 0===t&&(t=new n.BufferGeometry),e.createGeometry(this.g.vertices,this.g.indices,t,this.highPrecision)},e}();t.Lines=u},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(3),a=r(28),s=function(e){function t(t,r,n,a,s){var u=this;return void 0===r&&(r=new o.HighPrecisionPointMaterial({color:a||o.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==s?s:1})),(u=e.call(this,void 0===t?new i.BufferGeometry:t,r)||this).matrixWorldInverse=new i.Matrix4,n&&u.setPositions(n),u}return n(t,e),Object.defineProperty(t.prototype,"bufferGeometry",{get:function(){return this.geometry},enumerable:!0,configurable:!0}),t.prototype.clearGeometry=function(){return this.geometry=new i.BufferGeometry},Object.defineProperty(t.prototype,"shaderMaterial",{get:function(){return this.material},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e){this.dimensionality=a.HighPrecisionUtils.setPositions(this,e)},t.prototype.setupForRendering=function(){var e=this;this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=function(t,r,n,i,o,s){a.HighPrecisionUtils.updateHpUniforms(e,n,e.shaderMaterial)}},t.prototype.updateMatrixWorld=function(t){var r=this.matrixWorldNeedsUpdate||t;e.prototype.updateMatrixWorld.call(this,t),r&&this.matrixWorldInverse.getInverse(this.matrixWorld)},t}(i.Points);t.HighPrecisionPoints=s},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(53)),n(r(132)),n(r(143)),n(r(79)),n(r(80))},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(133),s=r(139),u=function(e){function t(t){var r=e.call(this)||this;return r.m_options=t,r}return n(t,e),t.prototype.ready=function(){return void 0!==this.m_layer},t.prototype.catalogClient=function(){if(void 0===this.m_catalogClient)throw new Error("Data provider not connected");return this.m_catalogClient},t.prototype.connect=function(){return i(this,void 0,void 0,function(){var e,t,r,n;return o(this,function(i){switch(i.label){case 0:if(e=this.m_options,"data"===this.m_options.hrn.data.service)t=new s.DataStore2Client(this.m_options);else{if("datastore"!==this.m_options.hrn.data.service)throw new Error("Unknown service "+this.m_options.hrn.data.service+", cannot connect");t=new a.DataStore1Client(this.m_options)}return r=this,[4,t.getCatalogClient(e.catalogVersion)];case 1:return r.m_catalogClient=i.sent(),n=this.m_catalogClient.getLayer(e.layer),void 0!==e.proxyDataUrl&&e.proxyDataUrl.length>0&&n.setDataProxy(e.proxyDataUrl),this.m_layer=n,[2]}})})},t.prototype.getTile=function(e,t){return i(this,void 0,void 0,function(){var r;return o(this,function(n){switch(n.label){case 0:if(void 0===this.m_layer)throw new Error("Hype data provider not connected");return[4,this.m_layer.getTile(e,{cancellationToken:t})];case 1:if(!(r=n.sent()).ok)throw new Error("Error downloading tile "+e.toHereTile()+" from catalog "+this.m_options.hrn.toString()+": "+r.status+" "+r.statusText);return[2,r.arrayBuffer()]}})})},t}(r(53).DataProvider);t.HypeDataProvider=u},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(29),a=r(54),s=r(56),u=r(137);var l=function(){function e(e,t,r,n){var i;if(this.apiVersion=1,"string"==typeof e){if(void 0===t||void 0===r)throw new TypeError("Wrong arguments in constructor");i={appId:e,appCode:t,hrn:r,downloadManager:n}}else i=e;this.hrn=i.hrn;var o=this.hrn.resolve(),u=void 0===i.downloadManager?a.DownloadManager.instance():i.downloadManager;if(function(e){return void 0!==e.appId&&void 0!==e.appCode}(i))this.requestBuilder=new s.DataStoreAppIdRequestBuilder(u,o,i.appId,i.appCode);else{if(!function(e){return void 0!==e.getBearerToken}(i))throw new Error("Unknown authorization method");this.requestBuilder=new s.DataStoreOAuthRequestBuilder(u,o,i.getBearerToken)}}return e.prototype.getCatalogClient=function(t){return void 0===t&&(t=e.LATEST_VERSION),n(this,void 0,void 0,function(){var r,n,a,s;return i(this,function(i){switch(i.label){case 0:return t!==e.LATEST_VERSION?[3,2]:[4,o.getLatestVersion(this.requestBuilder,{startVersion:e.LATEST_VERSION})];case 1:if((r=i.sent()).version===e.LATEST_VERSION)throw new Error("Invalid version received from latest version call, cannot proceed");t=r.version,i.label=2;case 2:return n=o.getLayerVersions(this.requestBuilder,{version:t}),a=o.getCatalogsConfiguration(this.requestBuilder),[4,Promise.all([a,n])];case 3:return s=i.sent(),[2,new u.Catalog1Client(this.requestBuilder,s[0],s[1])]}})})},e.LATEST_VERSION=-1,e}();t.DataStore1Client=l},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),a=function(){function e(e){var t=this;this.executor=e,this.doExec=!1,this.promise=new Promise(function(e,r){t.resolveFunc=e,t.rejectFunc=r,t.doExec&&t.execInnerPromise(t.resolveFunc,t.rejectFunc)})}return e.prototype.exec=function(){void 0!==this.resolveFunc&&void 0!==this.rejectFunc?this.execInnerPromise(this.resolveFunc,this.rejectFunc):this.doExec=!0},e.prototype.execInnerPromise=function(e,t){this.executor().then(function(t){return e(t)}).catch(function(e){return t(e)})},e}(),s=function(){function e(e,t){void 0===e&&(e=o.fetch),void 0===t&&(t=5),this.fetch=e,this.maxRetries=t,this.activeDownloadCount=0,this.downloadQueue=new Array,this.activeDownloads=new Map}return e.instance=function(){return e.defaultInstance},e.fetchRepeatedly=function(t,r,o,a,s){return n(this,void 0,void 0,function(){var n,u;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t(a,s)];case 1:return 503!==(n=i.sent()).status||r>o?[2,n]:[3,3];case 2:if((u=i.sent()).hasOwnProperty("isCancelled")||r>o)throw u;return[3,3];case 3:return[2,e.waitFor(e.retryTimeout*r).then(function(){return e.fetchRepeatedly(t,o,r+1,a,s)})]}})})},e.waitFor=function(e){return new Promise(function(t){return setTimeout(t,e)})},e.prototype.downloadJson=function(e,t){return void 0===t?t={responseType:"json"}:void 0===t.responseType&&(t.responseType="json"),this.downloadAs(function(e){return e.json()},e,t)},e.prototype.download=function(t,r){var n=this;if(this.activeDownloadCount>=e.maxParallelDownloads){var i=new a(function(){return n.doDownload(t,r)});return this.downloadQueue.push(i),i.promise}return this.doDownload(t,r)},e.prototype.doDownload=function(t,r){var n=this;return++this.activeDownloadCount,e.fetchRepeatedly(this.fetch,0,this.maxRetries,t,r).then(function(e){return n.onDownloadDone(),e}).catch(function(e){throw n.onDownloadDone(),e})},e.prototype.onDownloadDone=function(){--this.activeDownloadCount,this.execDeferredDownload()},e.prototype.execDeferredDownload=function(){var e=this.downloadQueue.pop();void 0!==e&&e.exec()},e.prototype.downloadAs=function(e,t,r){var n=this,i=t,o=this.activeDownloads.get(i);if(void 0!==o)return Promise.resolve(o);var a=this.download(t,r).then(function(t){if(n.activeDownloads.delete(i),t.ok)return e(t);throw new Error(JSON.stringify(t))}).catch(function(e){throw n.activeDownloads.delete(i),e});return this.activeDownloads.set(i,a),a},e.retryTimeout=500,e.maxParallelDownloads=16,e.defaultInstance=new e,e}();t.DownloadManager=s},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(55);function o(e){if(null===e)return null;var t=e.indexOf(";");return(-1===t?e:e.substring(0,t)).trim()}function a(e,t){return new Promise(function(r,a){var s=new XMLHttpRequest;if(void 0===t&&(t={}),void 0!==t.cancellationToken){if(t.cancellationToken.isCancelled)return a(new i.CancellationException);t.cancellationToken._cancel=function(){return s.abort()}}void 0!==t.responseType&&(s.responseType=t.responseType),s.onload=function(){var t={type:"default",status:s.status,statusText:s.statusText,ok:s.status>=200&&s.status<300,url:e,get headers(){return function(e){var t,r,o=new i.Headers;try{for(var a=n(e.split("\r\n")),s=a.next();!s.done;s=a.next()){var u=s.value,l=u.indexOf(":");if(-1!==l){var c=u.substring(0,l).trim(),d=u.substring(l+1).trim();o.append(c,d)}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return o}(s.getAllResponseHeaders())},arrayBuffer:function(){return"arraybuffer"===s.responseType?Promise.resolve(s.response):Promise.reject(new Error("Content type "+o(s.getResponseHeader("Content-Type"))+" cannot be expressed as ArrayBuffer, please use json() or text() instead."))},json:function(){return"json"===s.responseType?Promise.resolve(s.response):Promise.reject(new Error('Response type must be "json" but is '+s.responseType))},text:function(){return""===s.responseType||"text"===s.responseType?Promise.resolve(s.responseText):Promise.reject(new Error('Response type must be "" or "text"'))}};r(t)},s.onerror=function(){a(new TypeError("Network request failed"))},s.ontimeout=function(){a(new TypeError("Network request timed out"))},s.onabort=function(){a(new i.CancellationException)},s.onreadystatechange=function(){try{if(s.readyState===s.HEADERS_RECEIVED){if(void 0!==t&&void 0!==t.responseType)return void(s.responseType=t.responseType);var e=o(s.getResponseHeader("Content-Type"));s.responseType="text/plain"===e?"text":"application/json"===e||"application/vnd.geo+json"===e||"application/geo+json"===e?"json":"arraybuffer"}}catch(e){}};var u=void 0===t.method?"GET":t.method;s.open(u,e),void 0!==t.headers&&t.headers.forEach(function(e,t){return s.setRequestHeader(t,e)}),s.send(t.body)})}t.cancellableFetch_xhr=a,t.fetch=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(11));var n=r(29);t.ApiV1=n;var i=r(30);t.ApiV2=i},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(29),s=r(8),u=r(15),l=r(58),c=function(){function e(e,t,r){var n,i,a,s,l=this;this.requestBuilder=e,this.configuration=t,this.layerVersions=r,this.apiVersion=1,this.layers=new Map,this.m_indexCache=new u.LRUCache(64),this.m_partitionIndexCache=new u.LRUCache(4),this.m_indexDepth=4;try{for(var c=o(t.layers),d=c.next();!d.done;d=c.next()){var h=d.value;this.layers.set(h.name,h)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}try{for(var f=o(r.layerVersions),p=f.next();!p.done;p=f.next()){var m=p.value,y=this.layers.get(m.layer);void 0!==y&&(y.version=m.version,void 0===y.dataUrl&&(y.dataUrl=e.baseUrl))}}catch(e){a={error:e}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}this.layers.forEach(function(e){void 0===e.version?l.layers.delete(e.name):(e.getTile=function(t,r){return l.getTile(e,t,r)},e.getPartition=function(t,r){return l.getPartition(e,t,r)},e.setDataProxy=function(t){return l.setDataProxy(e,t)},e.apiVersion=1,e.getIndex=function(t){return l.getIndex(e,t)})})}return e.toUrlString=function(e,t){switch(e.partitioning){case"heretile":return t.toHereTile();case"quadtree":return 0===t.level?"-":t.toQuadKey();default:throw new Error("Unknown partitioning scheme "+e.partitioning)}},e.subkeyAddFunction=function(e){switch(e.partitioning){case"heretile":return function(e,t){return e.addedSubHereTile(t)};case"quadtree":return function(e,t){return e.addedSubKey(t)};default:throw new Error("Unknown partitioning scheme "+e.partitioning)}},e.toTileKeyFunction=function(e){switch(e.partitioning){case"heretile":return function(e){return s.TileKey.fromHereTile(e)};case"quadtree":return function(e){return s.TileKey.fromQuadKey(e)};default:throw new Error("Unknown partitioning scheme "+e.partitioning)}},e.prototype.getLayer=function(e){var t=this.findLayer(e);if(void 0===t)throw new Error("Layer '"+e+"' not found in catalog");return t},e.prototype.findLayer=function(e){return this.layers.get(e)},e.prototype.getTile=function(e,t,r){return n(this,void 0,void 0,function(){var n;return i(this,function(i){switch(i.label){case 0:return[4,this.getDataTag(e,t)];case 1:return void 0===(n=i.sent())?[2,Promise.resolve(new l.Error204Response)]:[2,this.downloadTile(e,n,r)]}})})},e.prototype.getAggregatedTile=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,a;return i(this,function(i){switch(i.label){case 0:return[4,this.getIndexFor(e,t)];case 1:return n=i.sent(),void 0===(o=this.findAggregatedIndex(n,t))?[2,Promise.resolve(new l.Error204Response)]:[4,this.downloadTile(e,o.dataHandle,r)];case 2:return(a=i.sent()).tileKey=o.tileKey,[2,a]}})})},e.prototype.getPartition=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,a;return i(this,function(i){switch(i.label){case 0:return[4,this.getPartitionIndex(e)];case 1:if(n=i.sent(),void 0===(o=n.partitions.find(function(e){return e.partition===t})))throw new Error("Unknown partition: "+t+" in layer "+e.name);return a=this.partitionUrl(e,o),[2,this.requestBuilder.downloadData(a,r)]}})})},e.prototype.getPartitionIndex=function(e){return n(this,void 0,void 0,function(){var t,r;return i(this,function(n){switch(n.label){case 0:return void 0!==(t=this.m_partitionIndexCache.get(e.name))?[2,t]:[4,this.downloadPartitionIndex(e)];case 1:return r=n.sent(),this.m_partitionIndexCache.set(e.name,r),[2,r]}})})},e.prototype.getIndex=function(e,t){return n(this,void 0,void 0,function(){var r;return i(this,function(n){return void 0!==(r=this.findCachedIndex(e,t))?[2,r]:[2,this.downloadIndex(e,t)]})})},e.prototype.setDataProxy=function(e,t){e.dataUrl=t},e.prototype.downloadPartitionIndex=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){return[2,a.getPartitions(this.requestBuilder,{version:e.version,layer:[e.name]})]})})},e.prototype.getIndexFor=function(e,t){return n(this,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:for(r=this.m_indexDepth;r>=0;--r)if(void 0!==(n=this.findCachedIndex(e,t.changedLevelBy(-r))))return[2,n];return[4,this.downloadIndex(e,t.changedLevelBy(-this.m_indexDepth))];case 1:return[2,i.sent()]}})})},e.prototype.getDataTag=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,this.getIndexFor(e,t)];case 1:return[2,r.sent().get(t.mortonCode())]}})})},e.prototype.findCachedIndex=function(e,t){var r=e.name+"/"+t.toHereTile();return this.m_indexCache.get(r)},e.prototype.cacheIndex=function(e,t){this.m_indexCache.set(e,t)},e.prototype.parseIndex=function(t,r,n){var i,a,s,u,l=e.subkeyAddFunction(t),c=e.toTileKeyFunction(t),d=new Map;if(void 0===n.subQuads)return d;try{for(var h=o(n.subQuads),f=h.next();!f.done;f=h.next()){var p=f.value,m=l(r,p.subQuadKey);d.set(m.mortonCode(),p.dataHandle)}}catch(e){i={error:e}}finally{try{f&&!f.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}try{for(var y=o(n.parentQuads),v=y.next();!v.done;v=y.next()){var g=v.value,b=c(g.partition);d.set(b.mortonCode(),g.dataHandle)}}catch(e){s={error:e}}finally{try{v&&!v.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}return d},e.prototype.downloadIndex=function(t,r){return n(this,void 0,void 0,function(){var n,o,s,u;return i(this,function(i){switch(i.label){case 0:return n=t.name+"/"+r.toHereTile(),[4,a.getIndex(this.requestBuilder,{version:t.version,layer:t.name,quadKey:e.toUrlString(t,r),depth:this.m_indexDepth})];case 1:return o=i.sent(),void 0!==(s=this.m_indexCache.get(n))?[2,s]:(u=this.parseIndex(t,r,o),this.cacheIndex(n,u),[2,u])}})})},e.prototype.downloadTile=function(e,t,r){var n=this.dataUrl(e,t);return this.requestBuilder.downloadData(n,r)},e.prototype.dataUrl=function(e,t){return e.dataUrl+t},e.prototype.partitionUrl=function(e,t){return(void 0===e.dataUrl?"":e.dataUrl)+t.dataHandle},e.prototype.findAggregatedIndex=function(e,t){for(var r=t.mortonCode(),n=t.level;n>=0;--n){var i=e.get(r);if(void 0!==i)return{dataHandle:i,tileKey:s.TileKey.fromMortonCode(r)};r=s.TileKey.parentMortonCode(r)}},e}();t.Catalog1Client=c},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,t)||this;return n.m_memoryLimit=r,n}return n(t,e),Object.defineProperty(t.prototype,"maximumMemoryAllocated",{get:function(){return this.m_memoryLimit},enumerable:!0,configurable:!0}),t.prototype.setMaximumMemoryAllocated=function(e){this.m_memoryLimit=e,this.evict()},t.prototype.set=function(t,r){e.prototype.set.call(this,t,r),this.evict()},t.prototype.evict=function(){for(var e=this.calculateMemoryUsage();this.map.size>this.capacity||e>this.m_memoryLimit;){var t=this.evictOldest().value.memoryUsage;void 0!==t&&(e-=t)}},t.prototype.calculateMemoryUsage=function(){var e=0;return this.map.forEach(function(t){e+=t.value.memoryUsage}),e},t}(r(57).LRUCache);t.ResourceCache=i},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(30),s=r(54),u=r(56),l=r(140);function c(e){return void 0!==e.appId&&void 0!==e.appCode}function d(e){return void 0!==e.getBearerToken}t.isAppIdAuthorization=c,t.isOAuthAuthorization=d;var h=function(){function e(e){this.apiVersion=2,this.hrn=e.hrn,this.serviceUrls=void 0===e.serviceUrls?{}:e.serviceUrls;var t=void 0===e.downloadManager?s.DownloadManager.instance():e.downloadManager,r=void 0===this.serviceUrls.discovery?"https://discovery.datastore.sit.api.here.com/v1/discover/catalogs":this.serviceUrls.discovery;if(c(e))this.discoveryRequestBuilder=new u.DataStoreAppIdRequestBuilder(t,r,e.appId,e.appCode);else{if(!d(e))throw new Error("Unknown authorization method");this.discoveryRequestBuilder=new u.DataStoreOAuthRequestBuilder(t,r,e.getBearerToken)}}return e.prototype.getCatalogClient=function(t){return void 0===t&&(t=e.LATEST_VERSION),n(this,void 0,void 0,function(){var r,n,o,s,u;return i(this,function(i){switch(i.label){case 0:return[4,this.getRequestBuilders()];case 1:return r=i.sent(),t!==e.LATEST_VERSION?[3,3]:[4,a.latestVersionUsingGET(r.metaDataApiRequestBuilder,{catalogId:this.hrn.data.resource,startVersion:e.LATEST_VERSION})];case 2:if(void 0===(n=i.sent()).version||-1===n.version)throw new Error("Invalid version received from latest version call, cannot proceed");t=n.version,i.label=3;case 3:return o=a.layerVersionsForCatalogUsingGET(r.metaDataApiRequestBuilder,{catalogId:this.hrn.data.resource,version:t}),s=a.getCatalogUsingGET(r.configApiRequestBuilder,{catalogHrn:this.hrn.toString()}),[4,Promise.all([s,o])];case 4:return u=i.sent(),[2,new l.Catalog2Client({configuration:u[0],layerVersions:u[1],metaDataRequestBuilder:r.metaDataApiRequestBuilder,queryRequestBuilder:r.queryApiRequestBuilder,blobStoreRequestBuilder:r.blobstoreApiRequestBuilder,volatileBlobRequestBuilder:r.volatileBlobApiRequestBuilder,coverageRequestBuilder:r.coverageApiRequestBuilder,artifactRequestBuilder:r.artifactApiRequestBuilder})]}})})},e.prototype.getBaseUrl=function(e,t,r){var n,i,a=this.serviceUrls[r];if(void 0!==a)return a;if(void 0!==e.endpoints)try{for(var s=o(e.endpoints),u=s.next();!u.done;u=s.next()){var l=u.value;if(l.service===t&&l.api===r&&void 0!==l.baseUrl)return l.baseUrl}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}throw new Error("Unable to determine "+t+" "+r+" base URL")},e.prototype.getRequestBuilders=function(){return n(this,void 0,void 0,function(){var e,t,r,n,o,a,s,u;return i(this,function(i){return Object.assign(this.serviceUrls,this.bypassDiscovery()),e={},t=this.getBaseUrl(e,"datastore","metadata"),r=this.getBaseUrl(e,"datastore","query"),n=this.getBaseUrl(e,"datastore","blobstore"),o=this.getBaseUrl(e,"datastore","volatile-blob"),a=this.getBaseUrl(e,"datastore","config"),s=this.getBaseUrl(e,"datastore","coverage"),u=this.getBaseUrl(e,"datastore","artifact"),[2,{configApiRequestBuilder:this.discoveryRequestBuilder.clone(a),blobstoreApiRequestBuilder:this.discoveryRequestBuilder.clone(n),volatileBlobApiRequestBuilder:this.discoveryRequestBuilder.clone(o),queryApiRequestBuilder:this.discoveryRequestBuilder.clone(r),metaDataApiRequestBuilder:this.discoveryRequestBuilder.clone(t),coverageApiRequestBuilder:this.discoveryRequestBuilder.clone(s),artifactApiRequestBuilder:this.discoveryRequestBuilder.clone(u)}]})})},e.prototype.bypassDiscovery=function(){var e,t,r={},n="here-dev"===this.hrn.data.partition?".in":"";try{for(var i=o(["metadata","query","blobstore","volatile-blob","config","coverage","artifact"]),a=i.next();!a.done;a=i.next()){var s=a.value;r[s]=void 0===this.serviceUrls[s]?"https://"+s+("artifact"===s?"":".data")+".api.platform"+n+".here.com":this.serviceUrls[s]}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},e.LATEST_VERSION=-1,e}();t.DataStore2Client=h},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a,s=r(30),u=r(141),l=r(11),c=r(8),d=r(15),h=r(58),f=r(142);!function(e){e.BITMAP="bitmap",e.SIZEMAP="sizemap",e.TIMEMAP="timemap"}(a||(a={}));var p=function(){function e(e){var t=this;this.apiVersion=2,this.layers=new Map,this.indexCache=new d.LRUCache(64),this.schemeCache=new d.LRUCache(64),this.partitionIndexCache=new d.LRUCache(4),this.indexDepth=4,this.catalog=e.configuration,this.metaDataRequestBuilder=e.metaDataRequestBuilder,this.queryRequestBuilder=e.queryRequestBuilder,this.blobStoreRequestBuilder=e.blobStoreRequestBuilder,this.volatileBlobRequestBuilder=e.volatileBlobRequestBuilder,this.artifactRequestBuilder=e.artifactRequestBuilder,this.coverageRequestBuilder=e.coverageRequestBuilder,this.version=e.layerVersions.version;var r,n,i=new Map(e.layerVersions.layerVersions.map(function(e){return[e.layer,e.version]})),a=function(e){var r=e;r.apiVersion=2,r.version=i.get(r.id),r.getTile=function(e,n){return t.getTile(r,e,n)},r.getPartition=function(e,n){return t.getPartition(r,e,n)},r.setDataProxy=function(e){return t.setDataProxy(r,e)},r.getIndex=function(e){return t.getIndex(r,e)},r.getSchemaDetails=function(){return t.getSchemaDetails(r)},r.getSchema=function(e){return t.getSchema(r,e)},r.getSchema=function(e){return t.getSchema(r,e)},r.getDataCoverageBitmap=function(e){return t.getDataCoverageBitmap(r,e)},r.getDataCoverageSizeMap=function(e){return t.getDataCoverageSizeMap(r,e)},r.getDataCoverageTimeMap=function(e){return t.getDataCoverageTimeMap(r,e)},s.layers.set(e.id,r)},s=this;try{for(var u=o(e.configuration.layers),l=u.next();!l.done;l=u.next()){a(l.value)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}return e.toUrlString=function(e,t){switch(e.partitioningScheme){case"heretile":return t.toHereTile();default:throw new Error("Unknown partitioning scheme "+e.partitioningScheme)}},e.subkeyAddFunction=function(e){switch(e.partitioningScheme){case"heretile":return function(e,t){return e.addedSubHereTile(t)};default:throw new Error("Unknown partitioning scheme "+e.partitioningScheme)}},e.toTileKeyFunction=function(e){switch(e.partitioningScheme){case"heretile":return function(e){return c.TileKey.fromHereTile(e)};default:throw new Error("Unknown partitioning scheme "+e.partitioningScheme)}},e.prototype.setDataProxy=function(e,t){throw new Error("Not implemented")},e.prototype.getPartitionIndex=function(e){return n(this,void 0,void 0,function(){var t,r;return i(this,function(n){switch(n.label){case 0:return void 0!==(t=this.partitionIndexCache.get(e.id))?[2,t]:[4,this.downloadPartitionIndex(e)];case 1:return r=n.sent(),this.partitionIndexCache.set(e.id,r),[2,r]}})})},e.prototype.getIndex=function(e,t){return n(this,void 0,void 0,function(){var r;return i(this,function(n){return void 0!==(r=this.findCachedIndex(e,t))?[2,r]:[2,this.downloadIndex(e,t)]})})},e.prototype.downloadData=function(e,t){return this.blobStoreRequestBuilder.downloadData(e,t)},e.prototype.getLayer=function(e){var t=this.findLayer(e);if(void 0===t)throw new Error("Layer '"+e+"' not found in catalog");return t},e.prototype.findLayer=function(e){return this.layers.get(e)},e.prototype.getTile=function(e,t,r){return n(this,void 0,void 0,function(){var n;return i(this,function(i){switch(i.label){case 0:return[4,this.getDataTag(e,t)];case 1:return void 0===(n=i.sent())?[2,Promise.resolve(new h.Error204Response)]:[2,this.downloadTile(e,n,r)]}})})},e.prototype.getAggregatedTile=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,a;return i(this,function(i){switch(i.label){case 0:return[4,this.getIndexFor(e,t)];case 1:return n=i.sent(),void 0===(o=this.findAggregatedIndex(n,t))?[2,Promise.resolve(new h.Error204Response)]:[4,this.downloadTile(e,o.dataHandle,r)];case 2:return(a=i.sent()).tileKey=o.tileKey,[2,a]}})})},e.prototype.getPartition=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,a;return i(this,function(i){switch(i.label){case 0:return[4,this.getPartitionIndex(e)];case 1:if(n=i.sent(),void 0===(o=n.partitions.find(function(e){return e.partition===t})))throw new Error("Unknown partition: "+t+" in layer "+e.id);return a=this.partitionUrl(e,o),[2,this.downloadData(a,r)]}})})},e.prototype.getSchema=function(e,t){return n(this,void 0,void 0,function(){var r,n,o,a,s;return i(this,function(i){switch(i.label){case 0:if(void 0===e.schema||void 0===e.schema.hrn)throw new Error("Required property 'schema.hrn' missing in the layer "+e);return[4,this.getSchemaDetails(e)];case 1:if(r=i.sent(),void 0===(n=r.variants.find(function(e){return"ds"===e.id})))throw new Error("URL of the schema bundle is not found: "+r);return o=this.artifactRequestBuilder.baseUrl+"/v1"+n.url,[4,this.downloadData(o,t).catch(function(){throw new Error("Cannot download Schema bundle: "+e.schema)})];case 2:switch((a=i.sent()).status){case 401:s="You are not authorized to view the schema";break;case 403:s="Accessing the schema is forbidden";break;case 404:s="The schema was not found";break;case 500:s="Internal server error"}switch(a.status){case 200:return[2,a.arrayBuffer()];case 401:case 403:case 404:case 500:default:throw new h.ErrorHTTPResponse("Artifact Service error: HTTP "+a.status+": "+(""!==a.statusText?a.statusText:s),a)}return[2]}})})},e.prototype.getSchemaDetails=function(e){return n(this,void 0,void 0,function(){var t,r,n;return i(this,function(i){switch(i.label){case 0:if(void 0!==(t=this.findCachedScheme(e)))return[2,t];if(void 0===e.schema||void 0===e.schema.hrn)throw new Error("Required property 'schema.hrn' missing in layer "+e.name);return[4,u.getSchemaUsingGET(this.artifactRequestBuilder,{schemaHrn:e.schema.hrn}).catch(function(){throw new Error("Cannot get schema details: "+e.schema.hrn)})];case 1:return r=i.sent(),void 0!==(t=this.findCachedScheme(e))?[2,t]:[4,Promise.resolve(r)];case 2:return n=i.sent(),this.cacheScheme(e,n),[2,n]}})})},e.prototype.getDataCoverageBitmap=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){return[2,this.getDataCoverage(a.BITMAP,e,t)]})})},e.prototype.getDataCoverageSizeMap=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){return[2,this.getDataCoverage(a.SIZEMAP,e,t)]})})},e.prototype.getDataCoverageTimeMap=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){return[2,this.getDataCoverage(a.TIMEMAP,e,t)]})})},e.prototype.getLatestVersion=function(e){return void 0===e&&(e=-1),n(this,void 0,void 0,function(){var t;return i(this,function(r){return t=f.HRN.fromString(this.catalog.hrn).data.resource,[2,s.latestVersionUsingGET(this.metaDataRequestBuilder,{catalogId:t,startVersion:e})]})})},e.prototype.getVersions=function(e,t){return void 0===e&&(e=-1),n(this,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:return r=f.HRN.fromString(this.catalog.hrn).data.resource,void 0!==t?[3,2]:[4,this.getLatestVersion(e)];case 1:n=i.sent(),t=n.version,i.label=2;case 2:return[2,s.listVersionsUsingGET(this.metaDataRequestBuilder,{catalogId:r,startVersion:e,endVersion:t})]}})})},e.prototype.coverageUrl=function(e,t){var r="/datacoverage/v1/catalogs/"+this.catalog.hrn+"/layers/"+e.id+"/"+t.toString();return this.coverageRequestBuilder.baseUrl+r},e.prototype.downloadPartitionIndex=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){if(void 0===e.version)throw new Error("Unable to download partitions for unversioned layer "+e.id);return[2,s.getPartitionsUsingGET(this.metaDataRequestBuilder,{version:e.version,layerId:e.id,catalogId:this.catalog.id})]})})},e.prototype.getIndexFor=function(e,t){return n(this,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:for(r=this.indexDepth;r>=0;--r)if(void 0!==(n=this.findCachedIndex(e,t.changedLevelBy(-r))))return[2,n];return[4,this.downloadIndex(e,t.changedLevelBy(-this.indexDepth))];case 1:return[2,i.sent()]}})})},e.prototype.getDataCoverage=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,a,s;return i(this,function(i){switch(i.label){case 0:return n=this.coverageUrl(t,e),o=new l.UrlBuilder(n),void 0!==this.version&&o.appendQuery("version",this.version),[4,this.coverageRequestBuilder.downloadData(o.url,r).catch(function(e){throw new Error("Coverage Service error: "+e)})];case 1:switch((a=i.sent()).status){case 400:s="Bad request, incorrect version type";break;case 404:s="Requested file does not exist";break;case 500:s="Internal server error"}switch(a.status){case 200:return[2,a.arrayBuffer()];case 400:case 404:case 500:default:throw new h.ErrorHTTPResponse("Coverage Service error: HTTP "+a.status+": "+(""!==a.statusText?a.statusText:s),a)}return[2]}})})},e.prototype.getDataTag=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return"volatile"===e.layerType?[2,t.toHereTile()]:[4,this.getIndexFor(e,t)];case 1:return[2,r.sent().get(t.mortonCode())]}})})},e.prototype.findCachedIndex=function(e,t){var r=e.id+"/"+t.toHereTile();return this.indexCache.get(r)},e.prototype.cacheIndex=function(e,t){this.indexCache.set(e,t)},e.prototype.cacheScheme=function(e,t){this.schemeCache.set(e.id,t)},e.prototype.findCachedScheme=function(e){return this.schemeCache.get(e.id)},e.prototype.parseIndex=function(t,r,n){var i,a,s,u,l=e.subkeyAddFunction(t),c=e.toTileKeyFunction(t),d=new Map;if(void 0===n.subQuads)return d;try{for(var h=o(n.subQuads),f=h.next();!f.done;f=h.next()){var p=f.value,m=l(r,p.subQuadKey);d.set(m.mortonCode(),p.dataHandle)}}catch(e){i={error:e}}finally{try{f&&!f.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}if(void 0!==n.parentQuads)try{for(var y=o(n.parentQuads),v=y.next();!v.done;v=y.next()){var g=v.value,b=c(g.partition);d.set(b.mortonCode(),g.dataHandle)}}catch(e){s={error:e}}finally{try{v&&!v.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}return d},e.prototype.downloadIndex=function(t,r){return n(this,void 0,void 0,function(){var n,o,a,u;return i(this,function(i){switch(i.label){case 0:if(void 0===t.version)throw new Error("Unable to download tiles for unversioned layer "+t.id);return n=t.id+"/"+r.toHereTile(),[4,s.quadTreeIndexUsingGET(this.queryRequestBuilder,{version:t.version,catalogId:this.catalog.id,layerId:t.id,quadKey:e.toUrlString(t,r),depth:this.indexDepth})];case 1:return o=i.sent(),void 0!==(a=this.indexCache.get(n))?[2,a]:(u=this.parseIndex(t,r,o),this.cacheIndex(n,u),[2,u])}})})},e.prototype.downloadTile=function(e,t,r){var n=this.dataUrl(e,t);return this.downloadData(n,r)},e.prototype.dataUrl=function(e,t){var r="/blobstore/v1/catalogs/"+this.catalog.id+"/layers/"+e.id+"/data/"+t;return"volatile"===e.layerType?this.volatileBlobRequestBuilder.baseUrl+r:this.blobStoreRequestBuilder.baseUrl+r},e.prototype.partitionUrl=function(e,t){if(void 0===t.dataHandle)throw new Error("### FIX SPEC");return this.dataUrl(e,t.dataHandle)},e.prototype.findAggregatedIndex=function(e,t){for(var r=t.mortonCode(),n=t.level;n>=0;--n){var i=e.get(r);if(void 0!==i)return{dataHandle:i,tileKey:c.TileKey.fromMortonCode(r)};r=c.TileKey.parentMortonCode(r)}},e}();t.Catalog2Client=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(11);t.deleteArtifactUsingDELETE=function(e,t){var r="/v1/artifact/{artifactHrn}".replace("{artifactHrn}",n.UrlBuilder.toString(t.artifactHrn)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"DELETE",headers:{}};return e.request(i,o)},t.deleteFileUsingDELETE=function(e,t){var r="/v1/artifact/{artifactHrn}/**".replace("{artifactHrn}",n.UrlBuilder.toString(t.artifactHrn)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"DELETE",headers:{}};return e.request(i,o)},t.getArtifactFileUsingGET=function(e,t){var r="/v1/artifact/{artifactHrn}/**".replace("{artifactHrn}",n.UrlBuilder.toString(t.artifactHrn)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"GET",headers:{}};return e.request(i,o)},t.getArtifactUsingGET=function(e,t){var r="/v1/artifact/{artifactHrn}".replace("{artifactHrn}",n.UrlBuilder.toString(t.artifactHrn)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"GET",headers:{}};return e.request(i,o)},t.putArtifactFileUsingPUT=function(e,t){var r="/v1/artifact/{artifactHrn}/**".replace("{artifactHrn}",n.UrlBuilder.toString(t.artifactHrn)),i=new n.UrlBuilder(e.baseUrl+r),o={},a={method:"PUT",headers:o};return void 0!==t.authorizationClaims&&(o["authorization-claims"]=t.authorizationClaims),e.request(i,a)},t.registerArtifactUsingPUT=function(e,t){var r="/v1/artifact/register/{groupId}/{artifactId}".replace("{groupId}",n.UrlBuilder.toString(t.groupId)).replace("{artifactId}",n.UrlBuilder.toString(t.artifactId)),i=new n.UrlBuilder(e.baseUrl+r),o={},a={method:"PUT",headers:o};return o["Content-Type"]="application/json",void 0!==t.registerRequest&&(a.body=JSON.stringify(t.registerRequest)),void 0!==t.authorizationClaims&&(o["authorization-claims"]=t.authorizationClaims),e.request(i,a)},t.deleteSchemaUsingDELETE=function(e,t){var r="/v1/schema/{schemaHrn}".replace("{schemaHrn}",n.UrlBuilder.toString(t.schemaHrn)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"DELETE",headers:{}};return e.request(i,o)},t.getDocumentUsingGET=function(e,t){var r="/v1/schema/{schemaHrn}/doc/{file}".replace("{schemaHrn}",n.UrlBuilder.toString(t.schemaHrn)).replace("{file}",n.UrlBuilder.toString(t.file)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"GET",headers:{}};return e.request(i,o)},t.getSchemaUsingGET=function(e,t){var r="/v1/schema/{schemaHrn}".replace("{schemaHrn}",n.UrlBuilder.toString(t.schemaHrn)),i=new n.UrlBuilder(e.baseUrl+r),o={method:"GET",headers:{}};return e.request(i,o)},t.listUsingGET=function(e,t){var r=new n.UrlBuilder(e.baseUrl+"/v1/schema");r.appendQuery("sort",t.sort),r.appendQuery("order",t.order),r.appendQuery("from",t.from),r.appendQuery("limit",t.limit);var i={method:"GET",headers:{}};return e.request(r,i)},t.updateSchemaPermissionUsingPOST=function(e,t){var r="/v1/schema/{schemaHrn}/permission".replace("{schemaHrn}",n.UrlBuilder.toString(t.schemaHrn)),i=new n.UrlBuilder(e.baseUrl+r),o={},a={method:"POST",headers:o};return o["Content-Type"]="application/json",void 0!==t.updatePermissionRequest&&(a.body=JSON.stringify(t.updatePermissionRequest)),e.request(i,a)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.data=e}return e.addResolver=function(t){e.resolvers.add(t)},e.removeResolver=function(e){return this.resolvers.delete(e)},e.fromString=function(t){if(t.startsWith("http:")||t.startsWith("https:"))return new e({partition:"catalog-url",service:"datastore",region:"",account:"",resource:encodeURIComponent(t)});var r=t.split(":");if(r.length<6||"hrn"!==r[0])throw new Error("Invalid HRN");return new e({partition:r[1],service:r[2],region:r[3],account:r[4],resource:r.slice(5).join(":")})},e.resolveBuiltin=function(e){if("datastore"===e.service)switch(e.partition){case"here":return"https://"+e.resource+".catalogs.datastore.api.here.com";case"here-dev":return"https://"+e.resource+".catalogs.datastore.sit.api.here.com";case"catalog-url":return decodeURIComponent(e.resource)}else if("schema"===e.service){if("catalog-url"===e.partition)return decodeURIComponent(e.resource);if("here"===e.partition||"here-dev"===e.partition){var t=e.resource.split(":");if(t.length<3)throw new Error("HRN resource must consist of three parameters");var r="here"===e.partition?"https://repo.platform.here.com/artifactory/open-location-platform":"https://artifactory.in.here.com/artifactory/here-olp-sit",n=t[0].replace(/\./g,"/"),i="";switch(t[3]){case"proto":case"java":i=".jar";break;case"ds":i=".zip"}var o=t[1]+(void 0===t[3]?"":"_"+t[3]),a=t[2];return r+"/"+n+"/"+o+"/"+a+"/"+o+"-"+a+i}}},e.prototype.toString=function(){return"hrn:"+this.data.partition+":"+this.data.service+":"+(void 0===this.data.region?"":this.data.region)+":"+(void 0===this.data.account?"":this.data.account)+":"+this.data.resource},e.prototype.resolve=function(){var t,r=this;if(e.resolvers.forEach(function(e){void 0===t&&(t=e(r.data))}),void 0===t&&(t=e.resolveBuiltin(this.data)),void 0===t)throw new Error("No resolver found for HRN, cannot resolve");return t},e.resolvers=new Set,e}();t.HRN=n},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(59),s=r(79),u=function(){function e(e){this.m_modelConstructor=e}return e.prototype.create=function(e,t){return new this.m_modelConstructor(e,t)},e}();t.TileFactory=u;var l=function(e){function t(t,r){var n=e.call(this,r.id)||this;if(n.m_tileFactory=t,n.m_options=r,n.m_isReady=!1,r.decoder)n.m_decoder=r.decoder;else{if(!r.concurrentDecoderServiceName)throw new Error("TileDataSource["+n.name+"]: unable to create, missing decoder or concurrentDecoderServiceName");n.m_decoder=a.ConcurrentDecoderFacade.getTileDecoder(r.concurrentDecoderServiceName,r.concurrentDecoderScriptUrl)}return n.cacheable=!0,n}return n(t,e),t.prototype.dispose=function(){this.decoder.dispose()},t.prototype.ready=function(){return this.m_isReady},Object.defineProperty(t.prototype,"decoder",{get:function(){return this.m_decoder},enumerable:!0,configurable:!0}),t.prototype.connect=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return!0!==this.m_options.useWorker?[3,2]:[4,Promise.all([this.m_options.dataProvider.connect(),this.m_decoder.connect()])];case 1:return e.sent(),[3,4];case 2:return[4,this.m_options.dataProvider.connect()];case 3:e.sent(),e.label=4;case 4:return this.m_isReady=!0,[2]}})})},t.prototype.setTheme=function(e,t){void 0!==e&&(this.m_decoder.configure(e,t),this.mapView.markTilesDirty(this))},t.prototype.dataProvider=function(){return this.m_options.dataProvider},t.prototype.getTilingScheme=function(){return this.m_options.tilingScheme},t.prototype.getTile=function(e){var t=this.m_tileFactory.create(this,e);return t.tileLoader=new s.TileLoader(this,e,this.m_options.dataProvider,this.decoder),this.updateTile(t),t},t.prototype.getTileInfo=function(e){var t=this;return new Promise(function(r,n){var i=new s.TileInfoLoader(t,e,t.m_options.dataProvider,t.decoder);i.loadAndDecode().then(function(e){e===a.TileLoaderState.Ready?r(i.tileInfo):n(new Error("TileDataSource#getInfoTile wrong final state: "+e))})})},t.prototype.updateTile=function(e){var t=this,r=e.tileLoader;void 0!==r&&r.loadAndDecode().then(function(){r.decodedTile&&t.decodedTileHasGeometry(r.decodedTile)?(e.setDecodedTile(r.decodedTile),t.requestUpdate()):e.forceHasGeometry(!0)})},t.prototype.decodedTileHasGeometry=function(e){return e.geometries.length||void 0!==e.poiGeometries&&e.poiGeometries.length||void 0!==e.textGeometries&&e.textGeometries.length||void 0!==e.textPathGeometries&&e.textPathGeometries.length},t}(a.DataSource);t.TileDataSource=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(62),o=i.MSAASampling.Level_1,a=i.MSAASampling.Level_4,s=function(){function e(e,t,r){void 0===r&&(r={msaaEnabled:!1}),this.m_readBuffer=new n.WebGLRenderTarget(e,t),this.m_msaaPass=new i.MSAARenderPass,this.m_msaaPass.enabled=void 0!==r&&!0===r.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===r.dynamicMsaaSamplingLevel?o:r.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===r.staticMsaaSamplingLevel?a:r.staticMsaaSamplingLevel}return e.prototype.render=function(e,t,r,n){if(e.getPixelRatio()>1.1)e.render(t,r);else{this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=n?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!0,this.m_msaaPass.render(e,t,r,void 0,this.m_readBuffer)):e.render(t,r,void 0)}},e.prototype.setSize=function(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t)},Object.defineProperty(e.prototype,"dynamicMsaaSamplingLevel",{get:function(){return this.m_dynamicMsaaSamplingLevel},set:function(e){this.m_dynamicMsaaSamplingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"msaaEnabled",{get:function(){return this.m_msaaPass.enabled},set:function(e){this.m_msaaPass.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"staticMsaaSamplingLevel",{get:function(){return this.m_staticMsaaSamplingLevel},set:function(e){this.m_staticMsaaSamplingLevel=e},enumerable:!0,configurable:!0}),e}();t.MapRenderingManager=s},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(1),u={type:"update"},l=function(e){function t(t){var r=e.call(this)||this;return r.name=t,r.enabled=!0,r.cacheable=!1,r}return n(t,e),t.prototype.dispose=function(){},t.prototype.ready=function(){return!0},Object.defineProperty(t.prototype,"mapView",{get:function(){if(void 0===this.m_mapView)throw new Error("This DataSource was not added to MapView");return this.m_mapView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projection",{get:function(){return this.mapView.projection},enumerable:!0,configurable:!0}),t.prototype.connect=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2]})})},t.prototype.attached=function(e){this.m_mapView=e},t.prototype.detached=function(e){s.assert(this.m_mapView===e),this.m_mapView=void 0},t.prototype.setTheme=function(e,t){},t.prototype.setLanguages=function(e){},t.prototype.updateTile=function(e){},t.prototype.shouldPreloadTiles=function(){return!1},Object.defineProperty(t.prototype,"minZoomLevel",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxZoomLevel",{get:function(){return 20},enumerable:!0,configurable:!0}),t.prototype.getDisplayZoomLevel=function(e){return a.Math.clamp(e,this.minZoomLevel,this.maxZoomLevel)},t.prototype.shouldRender=function(e,t){return t.level===e},t.prototype.shouldRenderText=function(e,t){return!0},t.prototype.requestUpdate=function(){this.dispatchEvent(u)},t}(a.EventDispatcher);t.DataSource=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isLoading=function(e){return void 0!==e.loadingPromise}}(t.ImageItem||(t.ImageItem={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),o=r(12),a=r(1),s=r(0),u=r(17),l=r(69),c=a.LoggerManager.instance.create("PoiRenderer"),d=1,h=function(){function e(e,t,r,n){this.mapView=e,this.scene=t,this.imageItem=r,this.renderOrder=n,this.color=u.ColorCache.instance.getColor("#000000")}return e.prototype.init=function(){void 0===this.boxBuffer&&this.setup()},e.prototype.reset=function(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.reset()},e.prototype.update=function(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.updateBufferGeometry()},e.prototype.setup=function(){var e=new l.IconTexture(this.imageItem),t=new s.Texture(e.image.imageData,s.UVMapping,void 0,void 0,s.LinearFilter,s.LinearFilter,s.RGBAFormat);t.needsUpdate=!0,t.premultiplyAlpha=!0,t.generateMipmaps=!1,this.m_material=new i.IconMaterial({map:t}),this.boxBuffer=new o.BoxBuffer(this.m_material,this.renderOrder);var r=this.boxBuffer.mesh;r.frustumCulled=!1,this.scene.add(r),this.mapView.update()},e}(),f=function(){function e(e,t){this.mapView=e,this.sceneSet=t,this.batches=[],this.m_batchMap=new Map,d=window.devicePixelRatio}return e.prototype.registerPoi=function(e){var t=e.imageItem,r=e.imageTexture,n=e.imageTextureName;if(void 0===t||void 0===n||void 0===r)return-1;var i,o,a=e.renderOrder,s=r.image,u=this.m_batchMap.get(s);if(void 0===u&&(u=new Map,this.m_batchMap.set(s,u)),void 0!==(i=u.get(a)))return i;i=this.batches.length;var l=this.sceneSet.getScene(a);return void 0===l?-1:((o=new h(this.mapView,l,t,a)).init(),u.set(a,i),this.batches.push(o),i)},e.prototype.addPoi=function(e,t,r){var n=this.registerPoi(e);return a.assert(n>=0),n<0?-1:(a.assert(void 0!==e.uvBox),void 0===this.batches[n].boxBuffer&&this.batches[n].init(),this.batches[n].boxBuffer.addBox(t,e.uvBox,this.batches[n].color,r,e.textElement.renderDistance,e.textElement),n)},e.prototype.getBatch=function(e){if(e>=0)return a.assert(e<this.batches.length),this.batches[e]},e.prototype.reset=function(){d=window.devicePixelRatio;try{for(var e=n(this.batches),t=e.next();!t.done;t=e.next()){t.value.reset()}}catch(e){r={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}var r,i},e.prototype.update=function(){try{for(var e=n(this.batches),t=e.next();!t.done;t=e.next()){t.value.update()}}catch(e){r={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}var r,i},e.prototype.pickTextElements=function(e,t){try{for(var r=n(this.batches),i=r.next();!i.done;i=r.next()){var o=i.value;void 0===o.boxBuffer&&o.init(),o.boxBuffer.pickBoxes(e,t)}}catch(e){a={error:e}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(a)throw a.error}}var a,s},e}(),p=function(){function e(e,t){this.mapView=e,this.sceneSet=t,this.m_tempScreenBox=new a.Math2D.Box,this.m_renderBuffer=new f(e,t)}return e.prototype.prepareRender=function(e){return void 0===e.poiRenderBatch&&this.preparePoi(e),void 0!==e.poiRenderBatch},e.prototype.computeScreenBox=function(e,t,r,n,i){return!!this.computeIconScreenBox(e,t,r,i)&&n.isVisible(i)},e.prototype.isSpaceAvailable=function(e,t){return!e.isAllocated(t)},e.prototype.reset=function(){this.m_renderBuffer.reset()},e.prototype.renderPoi=function(e,t,r,n,i,o){a.assert(void 0!==e.poiRenderBatch),this.computeIconScreenBox(e,t,n,this.m_tempScreenBox)&&(i&&r.allocate(this.m_tempScreenBox),this.m_renderBuffer.addPoi(e,this.m_tempScreenBox,o))},e.prototype.poiIsRenderable=function(e){return void 0!==e.poiRenderBatch},e.prototype.update=function(){this.m_renderBuffer.update()},e.prototype.pickTextElements=function(e,t){this.m_renderBuffer.pickTextElements(e,t)},e.prototype.computeIconScreenBox=function(e,t,r,n){if(a.assert(void 0!==e.poiRenderBatch),void 0===this.m_renderBuffer.getBatch(e.poiRenderBatch))return!1;var i=e.computedWidth*r,o=e.computedHeight*r,s=e.technique,u=t.x+(void 0!==s.iconXOffset?s.iconXOffset:0),l=t.y+(void 0!==s.iconYOffset?s.iconYOffset:0);return n.x=u-i/2,n.y=l-o/2,n.w=i,n.h=o,!0},e.prototype.preparePoi=function(t){var r=this;if(void 0===t.poiRenderBatch&&!1!==t.isValid){var n=this.mapView.poiManager.getImageTexture(t.imageTextureName);if(void 0===n)return void 0===e.m_missingTextureName.get(t.imageTextureName)&&(e.m_missingTextureName.set(t.imageTextureName,!0),c.error("PoiRenderer#preparePoi: No imageTexture with name '"+t.imageTextureName+"' found")),void(t.isValid=!1);var i=n.image,o=this.mapView.imageCache.findImageByName(i);if(void 0===o)return c.error("PoiRenderer#init: No imageItem found with name '"+i+"'"),void(t.isValid=!1);if(!o.loaded){if(void 0!==o.loadingPromise)return;var a=o.url,s=this.mapView.imageCache.loadImage(o);if(s instanceof Promise)return void s.then(function(e){void 0!==e?r.setupPoiInfo(t,n,e):c.error("PoiRenderer#preparePoi: Failed to load imageItem: '"+a)}).catch(function(e){c.error("PoiRenderer#preparePoi: Failed to load imageItem: '"+a,e),t.isValid=!1});o=s}this.setupPoiInfo(t,n,o)}},e.prototype.setupPoiInfo=function(e,t,r){if(a.assert(void 0===e.uvBox),void 0===r||void 0===r.imageData)return c.error("PoiRenderer#setupPoiInfo: No imageItem/imageData found"),e.poiRenderBatch=-1,void(e.isValid=!1);var n,i,o=e.technique,s=r.imageData.width,u=r.imageData.height,l=void 0!==t.width?t.width:s,h=void 0!==t.height?t.height:u,f=0,p=1,m=void 0!==o.iconScale?o.iconScale:1,y=void 0!==o.iconScale?o.iconScale:1,v=void 0!==t.width?t.width:s,g=void 0!==t.height?t.height:u,b=void 0!==t.xOffset?t.xOffset:0,_=void 0!==t.yOffset?t.yOffset:0;n=b/s,i=(b+v)/s;f=(u-_)/u,p=(u-_-g)/u,void 0!==o.screenWidth&&(y=m=o.screenWidth/s),void 0!==o.screenHeight&&(y=o.screenHeight/u,void 0===o.screenWidth&&(m=y)),e.computedWidth=l*m*d,e.computedHeight=h*y*d,e.uvBox={s0:n,t0:p,s1:i,t1:f},e.imageItem=r,e.imageTexture=t,e.poiRenderBatch=this.m_renderBuffer.registerPoi(e),e.isValid=!0,a.assert(void 0!==e.poiRenderBatch)},e.m_missingTextureName=new Map,e}();t.PoiRenderer=p},function(e,t,r){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o="object"==typeof e&&"object"==typeof e.versions&&void 0!==e.versions.node,a=function(e){function t(t){var r=e.call(this)||this;return r.value=t,r}return n(t,e),t.prototype.set=function(e,r){this.value=e,this.dispatchEvent({type:t.SET_EVENT_TYPE,name:r,value:e})},t.SET_EVENT_TYPE="set",t}(i.EventDispatcher),s=function(){function e(){(this.m_optionsMap=new Map,!o&&"undefined"!=typeof window&&window)&&(window.__debugContext=this)}return e.prototype.setValue=function(e,t){var r=this.m_optionsMap.get(e);r?r.set(t,e):(r=new a(t),this.m_optionsMap.set(e,r))},e.prototype.getValue=function(e){var t=this.m_optionsMap.get(e);return t?t.value:void 0},e.prototype.hasOption=function(e){return void 0!==this.m_optionsMap.get(e)},e.prototype.addEventListener=function(e,t){var r=this.m_optionsMap.get(e);if(!r)throw Error("Unknown option: "+e);r.addEventListener(a.SET_EVENT_TYPE,t)},e.prototype.hasEventListener=function(e,t){var r=this.m_optionsMap.get(e);if(r)return r.hasEventListener(a.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)},e.prototype.removeEventListener=function(e,t){var r=this.m_optionsMap.get(e);if(!r)throw Error("Unknown option: "+e);r.removeEventListener(a.SET_EVENT_TYPE,t)},Object.defineProperty(e.prototype,"options",{get:function(){return this.m_optionsMap},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.m_optionsMap.forEach(function(e){e.set(void 0,"")})},e}();t.DebugContext=s,t.debugContext=new s}).call(this,r(26))},function(e,t,r){"use strict";var n=r(152),i=r(153);n.prototype.bbox=i.bbox,n.prototype.geoJSON=i.geoJSON,n.Rectangle=r(33),e.exports=n},function(e,t,r){"use strict";var n=r(33);function i(e){if(!(this instanceof i))return new i(e);var t=3,r=6;isNaN(e)||(t=Math.floor(e/2),r=e);var o={x:0,y:0,w:0,h:0,id:"root",nodes:[]};this.root=o;var a=function(e){for(var t,r=e.slice(),n=[];r.length;)(t=r.pop()).nodes?r=r.concat(t.nodes):t.leaf&&n.push(t);return n},s=function(e,r,i){var o,s,u,l=[],c=[],f=[];if(!e||!n.overlapRectangle(e,i))return f;var p={x:e.x,y:e.y,w:e.w,h:e.h,target:r};for(c.push(i.nodes.length),l.push(i);l.length>0;){if(o=l.pop(),s=c.pop()-1,"target"in p)for(;s>=0;){if(u=o.nodes[s],n.overlapRectangle(p,u)){if(p.target&&"leaf"in u&&u.leaf===p.target||!p.target&&("leaf"in u||n.containsRectangle(u,p))){f="nodes"in u?a(o.nodes.splice(s,1)):o.nodes.splice(s,1),n.makeMBR(o.nodes,o),delete p.target;break}"nodes"in u&&(0,c.push(s),l.push(o),o=u,s=u.nodes.length)}s--}else if("nodes"in p){o.nodes.splice(s+1,1),o.nodes.length>0&&n.makeMBR(o.nodes,o);for(var m=0;m<p.nodes.length;m++)h(p.nodes[m],o);p.nodes=[],0===l.length&&o.nodes.length<=1?(p.nodes=d(o,!0,p.nodes,o),o.nodes=[],l.push(o),c.push(1)):l.length>0&&o.nodes.length<t?(p.nodes=d(o,!0,p.nodes,o),o.nodes=[]):delete p.nodes}else n.makeMBR(o.nodes,o);1}return f},u=function(e){for(var t=c(e);e.length>0;)l(e,t[0],t[1]);return t},l=function(e,r,i){for(var o,a,s,u=n.squarifiedRatio(r.w,r.h,r.nodes.length+1),l=n.squarifiedRatio(i.w,i.h,i.nodes.length+1),c=e.length-1;c>=0;c--){var d=e[c],h={};h.x=Math.min(r.x,d.x),h.y=Math.min(r.y,d.y),h.w=Math.max(r.x+r.w,d.x+d.w)-h.x,h.h=Math.max(r.y+r.h,d.y+d.h)-h.y;var f=Math.abs(n.squarifiedRatio(h.w,h.h,r.nodes.length+2)-u),p={};p.x=Math.min(i.x,d.x),p.y=Math.min(i.y,d.y),p.w=Math.max(i.x+i.w,d.x+d.w)-p.x,p.h=Math.max(i.y+i.h,d.y+d.h)-p.y;var m=Math.abs(n.squarifiedRatio(p.w,p.h,i.nodes.length+2)-l);(!a||!o||Math.abs(m-f)<o)&&(a=c,o=Math.abs(m-f),s=m<f?i:r)}var y=e.splice(a,1)[0];r.nodes.length+e.length+1<=t?(r.nodes.push(y),n.expandRectangle(r,y)):i.nodes.length+e.length+1<=t?(i.nodes.push(y),n.expandRectangle(i,y)):(s.nodes.push(y),n.expandRectangle(s,y))},c=function(e){for(var t,r,n=e.length-1,i=0,o=e.length-1,a=0,s=e.length-2;s>=0;s--){var u=e[s];u.x>e[i].x?i=s:u.x+u.w<e[n].x+e[n].w&&(n=s),u.y>e[a].y?a=s:u.y+u.h<e[o].y+e[o].h&&(o=s)}return Math.abs(e[n].x+e[n].w-e[i].x)>Math.abs(e[o].y+e[o].h-e[a].y)?n>i?(t=e.splice(n,1)[0],r=e.splice(i,1)[0]):(r=e.splice(i,1)[0],t=e.splice(n,1)[0]):o>a?(t=e.splice(o,1)[0],r=e.splice(a,1)[0]):(r=e.splice(a,1)[0],t=e.splice(o,1)[0]),[{x:t.x,y:t.y,w:t.w,h:t.h,nodes:[t]},{x:r.x,y:r.y,w:r.w,h:r.h,nodes:[r]}]},d=function(e,t,r,i){var o=[];if(!n.overlapRectangle(e,i))return r;for(o.push(i.nodes);o.length>0;)for(var a=o.pop(),s=a.length-1;s>=0;s--){var u=a[s];n.overlapRectangle(e,u)&&("nodes"in u?o.push(u.nodes):"leaf"in u&&(t?r.push(u):r.push(u.leaf)))}return r},h=function(e,t){var i;if(0===t.nodes.length)return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,void t.nodes.push(e);for(var o,a=function(e,t){var r,i=-1,o=[],a=!0;o.push(t);for(var s=t.nodes;a||-1!==i;){a?a=!1:(o.push(s[i]),s=s[i].nodes,i=-1);for(var u=s.length-1;u>=0;u--){var l=s[u];if("leaf"in l){i=-1;break}var c=n.squarifiedRatio(l.w,l.h,l.nodes.length+1),d=Math.max(l.x+l.w,e.x+e.w)-Math.min(l.x,e.x),h=Math.max(l.y+l.h,e.y+e.h)-Math.min(l.y,e.y),f=n.squarifiedRatio(d,h,l.nodes.length+2);(i<0||Math.abs(f-c)<r)&&(r=Math.abs(f-c),i=u)}}return o}(e,t),s=e;a.length>0;){if(i&&"nodes"in i&&0===i.nodes.length){o=i,i=a.pop();for(var l=0;l<i.nodes.length;l++)if(i.nodes[l]===o||0===i.nodes[l].nodes.length){i.nodes.splice(l,1);break}}else i=a.pop();if("leaf"in s||"nodes"in s||Array.isArray(s)){if(Array.isArray(s)){for(var c=0;c<s.length;c++)n.expandRectangle(i,s[c]);i.nodes=i.nodes.concat(s)}else n.expandRectangle(i,s),i.nodes.push(s);if(i.nodes.length<=r)s={x:i.x,y:i.y,w:i.w,h:i.h};else{var d=u(i.nodes);s=d,a.length<1&&(i.nodes.push(d[0]),a.push(i),s=d[1])}}else n.expandRectangle(i,s),s={x:i.x,y:i.y,w:i.w,h:i.h}}};this.insertSubtree=h,this.getTree=function(){return o},this.setTree=function(e,t){return t||(t=o),function(e,t){return e.nodes=t.nodes,e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e}(t,e)},this.search=function(e,t,r){return d(e,t,r=r||[],o)};this.remove=function(e,t){return t&&"function"!=typeof t?function(e,t){return s(e,t,o)}(e,t):function(e){for(var t,r=1,n=[];r>0;)r=(t=s(e,!1,o)).length,n=n.concat(t);return n}(e)},this.insert=function(e,t){return h({x:e.x,y:e.y,w:e.w,h:e.h,leaf:t},o)}}i.prototype.toJSON=function(e){return JSON.stringify(this.root,!1,e)},i.fromJSON=function(e){var t=new i;return t.setTree(JSON.parse(e)),t},e.exports=i,"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"object"==typeof e&&"[object Array]"==={}.toString.call(e)})},function(e,t,r){"use strict";var n=r(33),i=function(e,t){if(t&&t.bbox)return{leaf:t,x:t.bbox[0],y:t.bbox[1],w:t.bbox[2]-t.bbox[0],h:t.bbox[3]-t.bbox[1]};for(var r=e.length,n=0,i=new Array(r);n<r;)i[n]=[e[n][0],e[n][1]],n++;var o=i[0];r=i.length,n=1;for(var a={min:[].concat(o),max:[].concat(o)};n<r;)i[n][0]<a.min[0]?a.min[0]=i[n][0]:i[n][0]>a.max[0]&&(a.max[0]=i[n][0]),i[n][1]<a.min[1]?a.min[1]=i[n][1]:i[n][1]>a.max[1]&&(a.max[1]=i[n][1]),n++;var s={x:a.min[0],y:a.min[1],w:a.max[0]-a.min[0],h:a.max[1]-a.min[1]};return t&&(s.leaf=t),s},o={point:function(e,t){return t.insertSubtree({x:e.geometry.coordinates[0],y:e.geometry.coordinates[1],w:0,h:0,leaf:e},t.root)},multiPointLineString:function(e,t){return t.insertSubtree(i(e.geometry.coordinates,e),t.root)},multiLineStringPolygon:function(e,t){return t.insertSubtree(i(Array.prototype.concat.apply([],e.geometry.coordinates),e),t.root)},multiPolygon:function(e,t){return t.insertSubtree(i(Array.prototype.concat.apply([],Array.prototype.concat.apply([],e.geometry.coordinates)),e),t.root)},makeRec:function(e){return n(e.x,e.y,e.w,e.h)},geometryCollection:function(e,t){if(e.bbox)return t.insertSubtree({leaf:e,x:e.bbox[0],y:e.bbox[1],w:e.bbox[2]-e.bbox[0],h:e.bbox[3]-e.bbox[1]},t.root);for(var r,n=e.geometry.geometries,a=0,s=n.length,u=[];a<s;){switch((r=n[a]).type){case"Point":u.push(o.makeRec({x:r.coordinates[0],y:r.coordinates[1],w:0,h:0}));break;case"MultiPoint":case"LineString":u.push(o.makeRec(i(r.coordinates)));break;case"MultiLineString":case"Polygon":u.push(o.makeRec(i(Array.prototype.concat.apply([],r.coordinates))));break;case"MultiPolygon":u.push(o.makeRec(i(Array.prototype.concat.apply([],Array.prototype.concat.apply([],r.coordinates)))));break;case"GeometryCollection":s=(n=n.concat(r.geometries)).length}a++}var l=u[0];for(a=1,s=u.length;a<s;)l.expand(u[a]),a++;return t.insertSubtree({leaf:e,x:l.x(),y:l.y(),h:l.h(),w:l.w()},t.root)}};t.geoJSON=function(e){var t,r;if(Array.isArray(e))t=e.slice();else if(e.features&&Array.isArray(e.features))t=e.features.slice();else{if(!(e instanceof Object))throw"this isn't what we're looking for";t=[e]}for(var n=t.length,i=0;i<n;){if("Feature"===(r=t[i]).type)switch(r.geometry.type){case"Point":o.point(r,this);break;case"MultiPoint":case"LineString":o.multiPointLineString(r,this);break;case"MultiLineString":case"Polygon":o.multiLineStringPolygon(r,this);break;case"MultiPolygon":o.multiPolygon(r,this);break;case"GeometryCollection":o.geometryCollection(r,this)}i++}},t.bbox=function(){var e,t,r,n;switch(arguments.length){case 1:e=arguments[0][0][0],t=arguments[0][0][1],r=arguments[0][1][0],n=arguments[0][1][1];break;case 2:e=arguments[0][0],t=arguments[0][1],r=arguments[1][0],n=arguments[1][1];break;case 4:e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3]}return this.search({x:e,y:t,w:r-e,h:n-t})}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(t,r){return e.call(this,t,r)||this}return n(t,e),t.prototype.getLengths=function(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths},t}(i.LineCurve);t.SimpleLineCurve=o;var a=function(){function e(e,t,r){this.path=e,this.index=t,this.t=r}return Object.defineProperty(e.prototype,"curve",{get:function(){return this.path.curves[this.index]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"point",{get:function(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point},enumerable:!0,configurable:!0}),e}();t.PathParam=a;var s=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.getLengths=function(){if(this.m_cache)return this.m_cache;var e=0,t=new Array;return t.push(0),this.curves.forEach(function(r){var n=r;e+=n.v1.distanceTo(n.v2),t.push(e)}),this.m_cache=t,t},t.prototype.getParamAt=function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;++n)if(!(r[n]<t)){var i=r[n]-t,o=this.curves[n].getLength();return new a(this,n,0===o?0:1-i/o)}return null},t}(i.Path);t.SimplePath=s},function(e,t,r){"use strict";(function(e){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a,s=r(2),u=r(4),l=r(3),c=r(1),d=r(0),h=r(60),f=r(61),p=r(73),m=r(35),y=r(65),v=r(75),g=r(20),b=r(71),_=r(70),x=r(159),w=r(160),T=r(76),S=r(19),O=r(77),E=r(16),P=r(162),C=!0;!function(e){e.Update="update",e.Render="render",e.AfterRender="didrender",e.FirstFrame="first-render",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored"}(a=t.MapViewEventNames||(t.MapViewEventNames={}));var A=c.LoggerManager.instance.create("MapView"),I="./resources/fonts/Default_FontCatalog.json",M=15722977,L=new d.Vector3(0,0,-1),j=40,F=140,R=10,D=1,B=20,U=20,k={type:a.Render},G={type:a.AfterRender},V={type:a.FirstFrame},q={type:a.FrameComplete},N={type:a.ThemeLoaded},z={type:a.AnimationStarted},H={type:a.AnimationFinished},W={type:a.MovementStarted},X={type:a.MovementFinished},Q={type:a.ContextLost},Y={type:a.ContextRestored};t.MapViewDefaults={projection:u.mercatorProjection,maxVisibleDataSourceTiles:20,extendedFrustumCulling:!0,tileCacheSize:40,tileCacheMemorySize:419430400,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2};var K=function(r){function K(e){var n=r.call(this)||this;n.defaultFontCatalog=I,n.defaultTextMaterialConstructor=l.TextMaterial,n.m_zoomLevelBias=1,n.m_screenProjector=new x.ScreenProjector,n.m_screenCollisions=new _.ScreenCollisions,n.m_visibleTileSetLock=!1,n.m_minZoomLevel=D,n.m_maxZoomLevel=B,n.m_minCameraHeight=U,n.m_screenCamera=new d.OrthographicCamera(-1,1,1,-1),n.m_tempVector3=new d.Vector3,n.m_scene=new d.Scene,n.m_fog=new v.MapViewFog(n.m_scene),n.m_worldCenter=new d.Vector3,n.m_mapTilesRoot=new d.Object3D,n.m_animationCount=0,n.m_drawing=!1,n.m_updatePending=!1,n.m_snapshot=0,n.m_defaultTextColor=new d.Color(0,0,0),n.m_overlayTextElements=[],n.m_forceCameraAspect=void 0,n.m_tileDataSources=[],n.m_connectedDataSources=new Set,n.m_raycaster=new d.Raycaster,n.m_plane=new d.Plane(new d.Vector3(0,0,1)),n.m_logStatsFrames=100,n.m_firstFrameRendered=!1,n.m_firstFrameComplete=!1,n.m_imageCache=new y.MapViewImageCache(n),n.m_poiManager=new b.PoiManager(n),n.m_lastTileIds="",n.m_debugGlyphTextureCache=!1,n.onWebGLContextLost=function(e){n.dispatchEvent(Q),A.log("WebGL context lost",e)},n.onWebGLContextRestored=function(e){n.dispatchEvent(Y),void 0!==n.m_theme&&void 0!==n.m_theme.clearColor?n.m_renderer.setClearColor(new d.Color(n.m_theme.clearColor)):n.m_renderer.setClearColor(M),n.update(),A.log("WebGL context restored",e)},n.m_options=i({},e),void 0!==n.m_options.minZoomLevel&&(n.m_minZoomLevel=n.m_options.minZoomLevel),void 0!==n.m_options.maxZoomLevel&&(n.m_maxZoomLevel=n.m_options.maxZoomLevel),void 0!==n.m_options.minCameraHeight&&(n.m_minCameraHeight=n.m_options.minCameraHeight),void 0!==n.m_options.fontCatalog&&(n.defaultFontCatalog=n.m_options.fontCatalog),void 0!==n.m_options.textMaterialConstructor&&(n.defaultTextMaterialConstructor=n.m_options.textMaterialConstructor),void 0!==n.m_options.decoderUrl&&(p.ConcurrentDecoderFacade.defaultScriptUrl=n.m_options.decoderUrl),void 0!==n.m_options.decoderCount&&(p.ConcurrentDecoderFacade.defaultWorkerCount=n.m_options.decoderCount),n.m_visibleTileSetOptions=i({},t.MapViewDefaults),void 0!==e.projection&&(n.m_visibleTileSetOptions.projection=e.projection),void 0!==e.extendedFrustumCulling&&(n.m_visibleTileSetOptions.extendedFrustumCulling=e.extendedFrustumCulling),void 0!==e.maxVisibleDataSourceTiles&&(n.m_visibleTileSetOptions.maxVisibleDataSourceTiles=e.maxVisibleDataSourceTiles),void 0!==e.tileCacheSize&&(n.m_visibleTileSetOptions.tileCacheSize=e.tileCacheSize),void 0!==e.tileCacheMemorySize&&(n.m_visibleTileSetOptions.tileCacheMemorySize=e.tileCacheMemorySize),void 0!==e.quadTreeSearchDistanceUp&&(n.m_visibleTileSetOptions.quadTreeSearchDistanceUp=e.quadTreeSearchDistanceUp),void 0!==e.quadTreeSearchDistanceDown&&(n.m_visibleTileSetOptions.quadTreeSearchDistanceDown=e.quadTreeSearchDistanceDown),e.fov=u.MathUtils.clamp(void 0===e.fov?j:e.fov,R,F),n.m_options.enableStatistics=!0===n.m_options.enableStatistics,n.m_languages=n.m_options.languages||E.MapViewUtils.getBrowserLanguages(),C||void 0===n.m_options.collisionDebugCanvas||null===n.m_options.collisionDebugCanvas||(n.m_collisionDebugCanvas=n.m_options.collisionDebugCanvas,n.m_screenCollisions=new _.ScreenCollisionsDebug(n.m_collisionDebugCanvas)),n.handleRequestAnimationFrame=n.renderFunc.bind(n),n.m_pickHandler=new g.PickHandler(n,!0===n.m_options.enableRoadPicking),n.m_stats=new T.Statistics("MapView",n.m_options.enableStatistics),n.setupStats(),n.m_stagedRenderTimer=new T.MultiStageTimer(n.m_stats,"stagedRenderTimer",["render.setup","render.culling","render.text.render","render.draw","render.text.post","render.cleanup"]),n.m_renderer=new d.WebGLRenderer({canvas:n.canvas,antialias:!1!==n.m_options.enableNativeWebglAntialias,alpha:n.m_options.alpha,preserveDrawingBuffer:!0===n.m_options.preserveDrawingBuffer}),n.m_renderer.autoClear=!1,n.m_renderer.info.autoReset=!1,n.setupRenderer();var o=n.canvas,a=o.clientWidth,s=o.clientHeight,c=a/s;n.m_options.fov=n.limitFov(n.m_options.fov,c),n.m_camera=new d.PerspectiveCamera(n.m_options.fov,c,.1,4e6),n.setupCamera(),n.m_movementDetector=new h.CameraMovementDetector(n.m_options.movementThrottleTimeout,function(){return n.movementStarted()},function(){return n.movementFinished()});var m=n.m_options.customAntialiasSettings;return n.mapRenderingManager=new f.MapRenderingManager(a,s,m),n.m_visibleTiles=new P.VisibleTileSet(n.m_camera,n.m_visibleTileSetOptions),n.initTheme(),n.drawFrame(),n.canvas.addEventListener("webglcontextlost",n.onWebGLContextLost),n.canvas.addEventListener("webglcontextrestored",n.onWebGLContextRestored),n}return n(K,r),Object.defineProperty(K.prototype,"textElementsRenderer",{get:function(){return this.m_textElementsRenderer},enumerable:!0,configurable:!0}),K.prototype.dispose=function(){this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);try{for(var e=o(this.m_tileDataSources),t=e.next();!t.done;t=e.next()){t.value.dispose()}}catch(e){r={error:e}}finally{try{t&&!t.done&&(n=e.return)&&n.call(e)}finally{if(r)throw r.error}}var r,n;this.m_visibleTiles.clearTileCache(),this.m_renderer.dispose(),this.m_imageCache.clear(),this.m_movementDetector.dispose()},K.prototype.getCacheSize=function(){return this.m_visibleTiles.getDataSourceCacheSize()},K.prototype.setCacheSize=function(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.updateImages(),this.updateLighting(),this.updateTextRenderer(),this.updateSkyBackground(),this.update()},Object.defineProperty(K.prototype,"extendedFrustumCulling",{get:function(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling},set:function(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"lockVisibleTileSet",{get:function(){return this.m_visibleTileSetLock},set:function(e){this.m_visibleTileSetLock=e},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"pointOfView",{get:function(){return this.m_pointOfView},set:function(e){this.m_pointOfView=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"theme",{get:function(){return this.m_theme},set:function(e){this.m_theme=e,this.updateDataSources(),this.updateImages(),this.updateLighting(),this.updateTextRenderer(),this.updateSkyBackground(),this.m_fog.reset(e),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"forceCameraAspect",{get:function(){return this.m_forceCameraAspect},set:function(e){this.m_forceCameraAspect=e},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"languages",{get:function(){return this.m_languages},set:function(e){var t=this;this.m_languages=e,this.m_tileDataSources.forEach(function(e){e.setLanguages(t.m_languages)}),this.update()},enumerable:!0,configurable:!0}),K.prototype.addEventListener=function(e,t){r.prototype.addEventListener.call(this,e,t)},K.prototype.removeEventListener=function(e,t){r.prototype.removeEventListener.call(this,e,t)},Object.defineProperty(K.prototype,"canvas",{get:function(){return this.m_options.canvas},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"collisionDebugCanvas",{get:function(){return this.m_collisionDebugCanvas},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"scene",{get:function(){return this.m_scene},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"camera",{get:function(){return this.m_camera},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"renderer",{get:function(){return this.m_renderer},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"clearColor",{get:function(){return this.m_renderer.getClearColor().getHex()},set:function(e){this.m_renderer.setClearColor(e)},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"defaultTextColor",{get:function(){return this.m_defaultTextColor},set:function(e){this.m_defaultTextColor.set(e)},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"projection",{get:function(){return this.m_visibleTileSetOptions.projection},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"geoCenter",{get:function(){return this.projection.unprojectPoint(this.m_worldCenter)},set:function(e){this.projection.projectPoint(e,this.m_worldCenter),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"worldCenter",{get:function(){return this.m_worldCenter},set:function(e){this.m_worldCenter.copy(e),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"worldRootObject",{get:function(){return this.m_mapTilesRoot},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"pickHandler",{get:function(){return this.m_pickHandler},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"imageCache",{get:function(){return this.m_imageCache},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"poiManager",{get:function(){return this.m_poiManager},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"minCameraHeight",{get:function(){return this.m_minCameraHeight},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"minZoomLevel",{get:function(){return this.m_minZoomLevel},set:function(e){this.m_minZoomLevel=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"maxZoomLevel",{get:function(){return this.m_maxZoomLevel},set:function(e){this.m_maxZoomLevel=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"zoomLevelBias",{get:function(){return this.m_zoomLevelBias},set:function(e){this.m_zoomLevelBias=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"zoomLevel",{get:function(){var e=Math.abs(this.camera.position.z),t=E.MapViewUtils.calculateZoomLevelFromHeight(e,this);return Math.floor(t)},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"fov",{get:function(){return this.m_camera.fov},set:function(e){e=this.limitFov(e,this.m_camera.aspect),this.m_camera.fov=e,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"viewportHeight",{get:function(){return this.canvas.height},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"dataSources",{get:function(){return this.m_tileDataSources},enumerable:!0,configurable:!0}),K.prototype.getDataSource=function(e){try{for(var t=o(this.m_tileDataSources),r=t.next();!r.done;r=t.next()){var n=r.value;if(e===n.name)return n}}catch(e){i={error:e}}finally{try{r&&!r.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}}var i,a},K.prototype.addDataSource=function(e){var t=this;return this.m_tileDataSources.push(e),e.attached(this),e.connect().then(function(){-1===t.m_tileDataSources.indexOf(e)||(e.addEventListener(a.Update,function(){t.update()}),e.setTheme(t.m_theme,t.m_languages),t.m_connectedDataSources.add(e.name),t.dispatchEvent({type:a.DataSourceConnect,dataSourceName:e.name}),t.update())}).catch(function(r){t.dispatchEvent({type:a.DataSourceConnect,dataSourceName:e.name,error:r})})},K.prototype.removeDataSource=function(e){var t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detached(this),this.m_visibleTiles.removeDataSource(e.name),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.update())},Object.defineProperty(K.prototype,"visibleTileSet",{get:function(){return this.m_visibleTiles},enumerable:!0,configurable:!0}),K.prototype.addOverlayText=function(e){void 0!==this.m_overlayTextElements&&(this.m_overlayTextElements=this.m_overlayTextElements.concat(e)),this.updateTextRenderer(),this.update()},K.prototype.clearOverlayText=function(){this.m_overlayTextElements=[]},K.prototype.setCameraGeolocationAndZoom=function(e,t,r,n){void 0!==r&&void 0!==n&&E.MapViewUtils.setRotation(this,r,n),this.geoCenter=e,this.camera.position.set(0,0,0),E.MapViewUtils.zoomOnTargetPosition(this,0,0,t),this.update()},Object.defineProperty(K.prototype,"animating",{get:function(){return this.m_animationCount>0},enumerable:!0,configurable:!0}),K.prototype.beginAnimation=function(){0==this.m_animationCount++&&(this.m_updatePending||(this.m_updatePending=!0,this.drawFrame()),z.time=Date.now(),this.dispatchEvent(z))},K.prototype.endAnimation=function(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(H.time=Date.now(),this.dispatchEvent(H))},Object.defineProperty(K.prototype,"cameraIsMoving",{get:function(){return this.m_movementDetector.cameraIsMoving},enumerable:!0,configurable:!0}),K.prototype.getScreenPosition=function(e){var t=new d.Vector3;this.projection.projectPoint(e,t);var r=this.m_screenProjector.project(t);if(void 0!==r){var n=this.canvas,i=n.width,o=n.height;r.x=(r.x+i/2)/window.window.devicePixelRatio,r.y=(o-(r.y+o/2))/window.window.devicePixelRatio}return r},K.prototype.getGeoCoordinatesAt=function(e,t){this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera);var r=new d.Vector3,n=this.m_raycaster.ray.intersectPlane(this.m_plane,r);return n?(n.add(this.m_worldCenter),this.projection.unprojectPoint(n)):null},K.prototype.getNormalizedScreenCoordinates=function(e,t){var r=this.canvas,n=r.clientWidth,i=r.clientHeight;return new d.Vector3(e/n*2-1,-t/i*2+1,0)},K.prototype.intersectMapObjects=function(e,t){return this.m_pickHandler.intersectMapObjects(e,t)},K.prototype.resize=function(e,t){this.m_renderer.setSize(e,t,!1),this.m_renderer.setPixelRatio(window.window.devicePixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update()},K.prototype.update=function(){this.m_updatePending||(this.m_updatePending=!0,this.animating||this.drawFrame())},Object.defineProperty(K.prototype,"updatePending",{get:function(){return this.m_updatePending},enumerable:!0,configurable:!0}),K.prototype.requestUpdateIfNeeded=function(){this.update()},K.prototype.clearTileCache=function(e){this.m_visibleTiles.clearTileCache(e)},K.prototype.forEachVisibleTile=function(e){this.m_visibleTiles.forEachVisibleTile(e)},K.prototype.forEachCachedTile=function(e){this.m_visibleTiles.forEachCachedTile(e)},K.prototype.markTilesDirty=function(e){this.m_visibleTiles.markTilesDirty(e)},Object.defineProperty(K.prototype,"fog",{get:function(){return this.m_fog},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"debugGlyphTextureCache",{set:function(e){this.m_debugGlyphTextureCache=e},enumerable:!0,configurable:!0}),K.prototype.updateDataSources=function(){var e=this;this.m_tileDataSources.forEach(function(t){t.setTheme(e.m_theme,e.m_languages)})},K.prototype.updateCameras=function(){var e=this.canvas,t=e.width,r=e.height;this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:t/r,this.m_camera.fov=this.limitFov(this.m_camera.fov,this.m_camera.aspect);var n=Math.max(.1,.1*this.m_camera.position.z),i=50*n+200;if(void 0!==this.m_options.farPlaneEvaluator){this.camera.getWorldDirection(this.m_tempVector3);var o=d.Math.radToDeg(this.m_tempVector3.angleTo(L)),a=this.m_options.farPlaneEvaluator(this,o,n,i);n=Math.max(.1,a.near),i=Math.max(n+200,a.far)}this.m_camera.near=n,this.m_camera.far=i,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.m_screenCamera.left=t/-2,this.m_screenCamera.right=t/2,this.m_screenCamera.bottom=r/-2,this.m_screenCamera.top=r/2,this.m_screenCamera.updateProjectionMatrix(),this.m_screenCamera.updateMatrixWorld(!1),this.m_screenProjector.update(this.m_camera,this.m_worldCenter,t,r),this.m_screenCollisions.update(t,r)},K.prototype.drawFrame=function(){this.m_drawing||(void 0!==this.m_animationFrameHandle&&cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame))},K.prototype.renderFunc=function(e){this.render(e)},K.prototype.getEnabledTileDataSources=function(){var e,t,r=[];try{for(var n=o(this.m_tileDataSources),i=n.next();!i.done;i=n.next()){var a=i.value;a.enabled&&(a.ready()&&this.m_connectedDataSources.has(a.name)&&r.push(a))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},K.prototype.render=function(e){var t=this;if(!this.m_drawing){for(this.m_renderer.info.reset(),this.m_stagedRenderTimer.start(),this.m_updatePending=!1,++this.m_snapshot,this.m_drawing=!0,this.m_renderer.setPixelRatio(window.window.devicePixelRatio),k.time=e,this.dispatchEvent(k),this.updateCameras(),this.m_fog.update(this.m_camera),this.m_renderer.clear(),m.resetDepthBasedPolygonOffsetIndex();this.m_mapTilesRoot.children.length>0;)this.m_mapTilesRoot.remove(this.m_mapTilesRoot.children[0]);var r=d.Math.clamp(this.zoomLevel,this.m_minZoomLevel,this.m_maxZoomLevel);this.m_stagedRenderTimer.stage="render.culling",this.lockVisibleTileSet||this.m_visibleTiles.updateRenderList(this.m_worldCenter,r,this.zoomLevel,this.getEnabledTileDataSources()),this.m_visibleTiles.dataSourceTileList.forEach(function(e){var r=e.zoomLevel;e.renderedTiles.forEach(function(e){t.renderTileObjects(e,r)})}),this.checkCameraMoved();var n=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_camera;if(this.prepareRenderTextElements(e),this.m_stagedRenderTimer.stage="render.draw",this.m_stats.enabled){var i=c.PerformanceTimer.now();if(void 0!==this.m_previousFrameTimeStamp){var o=i-this.m_previousFrameTimeStamp;this.m_stats.getTimer("render.frameTime").setValue(o),this.m_stats.getTimer("render.fps").setValue(1e3/o)}this.m_previousFrameTimeStamp=i}void 0!==this.m_skyBackground&&this.m_skyBackground.update(this.m_camera);var a=!(this.animating||this.m_updatePending);this.mapRenderingManager.render(this.m_renderer,this.m_scene,n,a),this.finishRenderTextElements(),this.m_stagedRenderTimer.stage="render.cleanup",G.time=e,this.dispatchEvent(G),this.m_firstFrameRendered||(this.m_firstFrameRendered=!0,V.time=e,this.dispatchEvent(V)),this.m_firstFrameComplete||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_updatePending||this.animating||void 0===this.m_textElementsRenderer||this.m_textElementsRenderer.loading||(this.m_firstFrameComplete=!0,q.time=e,this.dispatchEvent(q)),this.m_visibleTiles.disposePendingTiles(),this.m_stagedRenderTimer.stop(),this.m_drawing=!1,this.m_stats.enabled&&this.m_snapshot%this.m_logStatsFrames==0&&this.m_stats.log(),(this.animating||this.m_updatePending)&&this.drawFrame()}},K.prototype.renderTileObjects=function(e,t){if(e.willRender(t))try{for(var r=o(e.objects),n=r.next();!n.done;n=r.next()){var i=n.value;i.position.copy(e.center),void 0!==i.displacement&&i.position.add(i.displacement),i.position.sub(this.m_worldCenter),this.m_mapTilesRoot.add(i)}}catch(e){a={error:e}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(a)throw a.error}}var a,s;e.didRender()},K.prototype.prepareRenderTextElements=function(e){(this.checkIfTextElementsChanged()||this.checkIfTilesChanged())&&void 0!==this.m_textElementsRenderer&&this.m_textElementsRenderer.placeAllTileLabels(),this.m_stagedRenderTimer.stage="render.text.render";var t=void 0!==this.m_pointOfView;if(void 0!==this.m_textElementsRenderer&&!t){var r;this.m_textElementsRenderer.debugGlyphTextureCache=this.m_debugGlyphTextureCache,this.camera.getWorldDirection(this.m_tempVector3);var n=d.Math.radToDeg(this.m_tempVector3.angleTo(L));if(void 0!==this.m_options.labelVisibilityEvaluator)r=this.m_options.labelVisibilityEvaluator(this,n);else r=n<(void 0===this.m_options.maxLabelAngle?90:this.m_options.maxLabelAngle);this.m_textElementsRenderer.reset(),r&&(this.m_textElementsRenderer.renderUserTextElements(e,this.m_snapshot),this.m_textElementsRenderer.renderAllTileText(e,this.m_snapshot)),this.m_textElementsRenderer.renderOverlay(this.m_overlayTextElements),this.m_textElementsRenderer.update(this.m_renderer)}},K.prototype.finishRenderTextElements=function(){this.m_stagedRenderTimer.stage="render.text.post",void 0===this.m_pointOfView&&this.m_textElementsRenderer&&(this.m_textElementsRenderer.end(),this.m_screenCamera.far=this.camera.far,this.m_textElementsRenderer.renderText(this.m_renderer,this.m_screenCamera))},K.prototype.initTheme=function(){var e=this;void 0!==this.m_options.theme&&("string"==typeof this.m_options.theme?O.ThemeLoader.loadAsync(this.m_options.theme):Promise.resolve(this.m_options.theme)).then(function(t){e.m_theme=t,N.time=Date.now(),e.dispatchEvent(N),e.updateDataSources(),e.updateImages(),e.updateLighting(),e.updateSkyBackground(),e.m_fog.reset(t),e.updateTextRenderer(),e.update()})},K.prototype.setupCamera=function(){var e=this.canvas,t=e.clientWidth,r=e.clientHeight;this.m_scene.add(this.m_camera),this.m_camera.position.set(0,0,3e3),this.m_camera.lookAt(new d.Vector3(0,0,0)),this.m_visibleTiles=new P.VisibleTileSet(this.m_camera,this.m_visibleTileSetOptions),this.resize(t,r),this.geoCenter=new u.GeoCoordinates(52.518611,13.376111,0),this.m_screenCamera.position.z=1,this.m_screenCamera.near=0},K.prototype.updateSkyBackground=function(){if(void 0!==this.m_theme){var e=this.m_theme;if(this.m_skyBackground instanceof w.SkyBackground&&void 0!==e.sky)this.updateSkyBackgroundColors(e.sky,e.clearColor);else{if(void 0===this.m_skyBackground&&void 0!==e.sky)return void this.addNewSkyBackground(e.sky,e.clearColor);this.m_skyBackground instanceof w.SkyBackground&&void 0===e.sky&&this.removeSkyBackGround()}}},K.prototype.addNewSkyBackground=function(e,t){var r=void 0===e.groundColor?t:e.groundColor;this.m_skyBackground=new w.SkyBackground(new d.Color(e.colorTop),new d.Color(e.colorBottom),new d.Color(r),this.camera,e.monomialPower),this.m_scene.background=this.m_skyBackground.texture},K.prototype.removeSkyBackGround=function(){this.m_scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.texture.dispose(),this.m_skyBackground=void 0)},K.prototype.updateSkyBackgroundColors=function(e,t){var r=void 0===e.groundColor?t:e.groundColor;void 0!==this.m_skyBackground&&this.m_skyBackground.updateColors(new d.Color(e.colorTop),new d.Color(e.colorBottom),new d.Color(r))},K.prototype.updateLighting=function(){var e=this;if(this.m_theme){var t=this.m_theme;void 0!==t.clearColor&&this.m_renderer.setClearColor(new d.Color(t.clearColor)),this.m_createdLights&&this.m_createdLights.forEach(function(t){e.m_scene.remove(t)}),void 0!==t.lights&&(this.m_createdLights=[],t.lights.forEach(function(t){var r=s.createLight(t);r?(e.m_scene.add(r),e.m_createdLights.push(r)):A.log("MapView: failed to create light "+t.name+" of type "+t.type)}))}},K.prototype.movementStarted=function(){void 0!==this.m_textElementsRenderer&&this.m_textElementsRenderer.movementStarted(),W.time=Date.now(),this.dispatchEvent(W)},K.prototype.movementFinished=function(){var t=this;void 0!==this.m_textElementsRenderer&&this.m_textElementsRenderer.movementFinished(),X.time=Date.now(),this.dispatchEvent(X),this.animating||e(function(){return t.update()})},K.prototype.checkCameraMoved=function(){return this.m_movementDetector.checkCameraMoved(this)},K.prototype.checkIfTextElementsChanged=function(){var e=!1;return this.m_visibleTiles.dataSourceTileList.forEach(function(t){t.renderedTiles.forEach(function(t){t.textElementsChanged&&(t.textElementsChanged=!1,e=!0)})}),e},K.prototype.checkIfTilesChanged=function(){var e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach(function(e){var r=e.dataSource;e.renderedTiles.forEach(function(e){t.push(r.name+"-"+e.tileKey.mortonCode())})}),t.sort();var r=t.join("#");return r!==this.m_lastTileIds&&(this.m_lastTileIds=r,!0)},K.prototype.updateImages=function(){var e=this;if(this.m_theme){var t=this.m_theme;this.m_imageCache.clear(),this.poiManager.clear(),void 0!==t.images&&t.images.forEach(function(t){e.m_imageCache.addImage(t.name,t.url,!0===t.preload),"string"==typeof t.atlas&&e.poiManager.addTextureAtlas(t.name,t.atlas)}),void 0!==t.imageTextures&&t.imageTextures.forEach(function(t){e.poiManager.addImageTexture(t)})}},Object.defineProperty(K.prototype,"statistics",{get:function(){if(void 0===this.m_stats)throw new Error("Statistics are not initialized.");return this.m_stats},enumerable:!0,configurable:!0}),K.prototype.setupStats=function(){this.m_stats.createTimer("render.frameTime",!0),this.m_stats.createTimer("render.fps",!0),this.m_stats.createTimer("render.setup",!0),this.m_stats.createTimer("render.culling",!0),this.m_stats.createTimer("render.text.render",!0),this.m_stats.createTimer("render.draw",!0),this.m_stats.createTimer("render.text.post",!0),this.m_stats.createTimer("render.cleanup",!0),this.m_stats.createTimer("decoding",!0),this.m_stats.createTimer("geometryCreation",!0),this.m_stagedRenderTimer=new T.MultiStageTimer(this.m_stats,"stagedRenderTimer",["render.setup","render.culling","render.text.render","render.draw","render.text.post","render.cleanup"])},K.prototype.setupRenderer=function(){this.m_renderer.setClearColor(M),this.m_scene.add(this.m_mapTilesRoot)},K.prototype.updateTextRenderer=function(){void 0!==this.m_theme&&(void 0===this.m_textElementsRenderer&&(this.m_textElementsRenderer=new S.TextElementsRenderer(this,this.m_screenCollisions,this.m_screenProjector,this.m_theme,this.m_options.maxNumVisibleLabels,this.m_options.numSecondChanceLabels,this.m_options.maxDistanceRatioForLabels,this.m_options.labelStartScaleDistance,this.defaultTextMaterialConstructor)),this.m_textElementsRenderer.placeAllTileLabels())},K.prototype.limitFov=function(e,t){e=u.MathUtils.clamp(void 0===e?j:e,R,F);var r=u.MathUtils.radToDeg(E.MapViewUtils.calculateHorizontalFovByVerticalFov(u.MathUtils.degToRad(e),t));return(r>F||r<R)&&(r=u.MathUtils.clamp(r,R,F),e=u.MathUtils.radToDeg(E.MapViewUtils.calculateVerticalFovByHorizontalFov(u.MathUtils.degToRad(r),t))),e},K}(d.EventDispatcher);t.MapView=K}).call(this,r(72).setImmediate)},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i=1,o={},a=!1,s=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){c(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?function(){var t="setImmediate$"+Math.random()+"$",r=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&c(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),n=function(r){e.postMessage(t+r,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){c(e.data)},n=function(t){e.port2.postMessage(t)}}():s&&"onreadystatechange"in s.createElement("script")?function(){var e=s.documentElement;n=function(t){var r=s.createElement("script");r.onreadystatechange=function(){c(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():n=function(e){setTimeout(c,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var a={callback:e,args:t};return o[i]=a,n(i),i++},u.clearImmediate=l}function l(e){delete o[e]}function c(e){if(a)setTimeout(c,0,e);else{var t=o[e];if(t){a=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{l(e),a=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(34),r(26))},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=r(2),u=r(1),l=r(158),c=u.LoggerManager.instance.create("ConcurrentWorkerSet");function d(e){return e&&"number"==typeof e.level&&e.type===u.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=d;var h=function(){function e(e){var t=this;this.m_options=e,this.m_workerChannelLogger=u.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=function(e){if(s.isResponseMessage(e.data)){var r=e.data;if(null===r.messageId)return void c.error("["+t.m_options.scriptUrl+"]: Bad ResponseMessage: no messageId");var n=t.m_requests.get(r.messageId);if(void 0===n)return void c.error("["+t.m_options.scriptUrl+"]: Bad ResponseMessage: invalid messageId");n.resolver(r.error,r.response)}else if(s.isInitializedMessage(e.data)){var i=t.getReadyPromise(e.data.service);++i.count===t.m_workerPromises.length&&i.resolve()}else if(d(e.data))switch(e.data.level){case u.LogLevel.Trace:(o=t.m_workerChannelLogger).trace.apply(o,a(e.data.message));break;case u.LogLevel.Debug:(l=t.m_workerChannelLogger).debug.apply(l,a(e.data.message));break;case u.LogLevel.Log:(h=t.m_workerChannelLogger).log.apply(h,a(e.data.message));break;case u.LogLevel.Info:(f=t.m_workerChannelLogger).info.apply(f,a(e.data.message));break;case u.LogLevel.Warn:(p=t.m_workerChannelLogger).warn.apply(p,a(e.data.message));break;case u.LogLevel.Error:(m=t.m_workerChannelLogger).error.apply(m,a(e.data.message))}else t.eventHandler(e);var o,l,h,f,p,m},this.start()}return e.prototype.addReference=function(){this.m_referenceCount+=1},e.prototype.removeReference=function(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()},e.prototype.start=function(e){var t=this;if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");for(var r=u.getOptionValue(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?Math.max(1,navigator.hardwareConcurrency):void 0,4),n=function(e){var r=l.WorkerLoader.startWorker(i.m_options.scriptUrl);r.then(function(e){e.addEventListener("message",t.onWorkerMessage),t.m_workers.push(e)}).catch(function(t){c.error("failed to load worker "+e+": "+t)}),i.m_workerPromises.push(r)},i=this,o=0;o<r;++o)n(o);this.m_stopped=!1},e.prototype.stop=function(){return n(this,void 0,void 0,function(){var e=this;return i(this,function(t){switch(t.label){case 0:return this.m_stopped=!0,[4,this.waitForAllResponses().then(function(){e.terminateWorkers()})];case 1:return t.sent(),[2]}})})},e.prototype.destroy=function(){this.m_stopped=!0,this.m_requests.forEach(function(e){e.resolver(new Error("worker destroyed"))}),this.m_requests.clear(),this.terminateWorkers(),this.m_eventListeners.clear()},e.prototype.connect=function(e){return this.ensureStarted(),this.getReadyPromise(e).promise},e.prototype.addEventListener=function(e,t){this.m_eventListeners.set(e,t)},e.prototype.removeEventListener=function(e){this.m_eventListeners.delete(e)},e.prototype.invokeRequest=function(e,t,r){var n=this;this.ensureStarted();var i,o=this.m_nextMessageId++,a=new Promise(function(e,t){i=function(r,i){n.m_requests.delete(o),void 0!==r?t(new Error(r.toString())):e(i)}});this.m_requests.set(o,{promise:a,resolver:i});var u={service:e,type:s.DecodedTileMessageName.Request,messageId:o,request:t};return this.postMessage(u,r),a},e.prototype.postMessage=function(e,t){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");var r=Math.floor(Math.random()*this.m_workers.length);this.m_workers[r].postMessage(e,t)},e.prototype.broadcastMessage=function(e,t){this.ensureStarted(),this.m_workers.forEach(function(r){return r.postMessage(e,t)})},e.prototype.eventHandler=function(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)},e.prototype.ensureStarted=function(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")},e.prototype.waitForAllResponses=function(){return n(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return e=new Array,this.m_requests.forEach(function(t){e.push(t.promise)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},e.prototype.dispatchEvent=function(e,t){var r=this.m_eventListeners.get(e);void 0!==r&&r(t)},e.prototype.terminateWorkers=function(){var e=this;this.m_workerPromises.forEach(function(t){t.then(function(t){t.removeEventListener("message",e.onWorkerMessage),t.terminate()}).catch(function(){})}),this.m_workers=[],this.m_workerPromises=[],this.m_readyPromises.clear()},e.prototype.getReadyPromise=function(e){var t=this,r=this.m_readyPromises.get(e);if(void 0!==r)return r;var n={count:0,promise:void 0,resolve:function(){},reject:function(e){n.error=e},error:void 0};return n.promise=new Promise(function(e,r){var i=n;void 0!==i.error?r(i.error):i.count===t.m_workerPromises.length&&e(),i.resolve=e,i.reject=r}),this.m_readyPromises.set(e,n),n},e}();t.ConcurrentWorkerSet=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),i=r(1).LoggerManager.instance.create("WorkerLoader"),o=function(){function e(){}return e.startWorker=function(t){var r=this;return t.startsWith("blob:")?this.startWorkerImmediately(t):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(t):this.startWorkerImmediately(t).catch(function(n){return i.log("#startWorker: worker construction failed, attempting load with blob"),r.directlyFallbackToBlobBasedLoading=!0,e.startWorkerBlob(t)})},e.startWorkerImmediately=function(e){try{var t=new Worker(e);return this.waitWorkerInitialized(t)}catch(e){return Promise.reject(e)}},e.startWorkerBlob=function(e){var t=this;return this.fetchScriptSourceToBlobUrl(e).then(function(e){return t.startWorkerImmediately(e)})},e.fetchScriptSourceToBlobUrl=function(e){var t=this,r=this.sourceLoaderCache.get(e);return void 0!==r?r:(r=n.fetch(e,{responseType:"text"}).then(function(e){return e.text()}).catch(function(e){throw new Error("WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: "+e)}).then(function(r){t.sourceLoaderCache.delete(e);var n=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(n)}),this.sourceLoaderCache.set(e,r),r)},e.waitWorkerInitialized=function(e){return new Promise(function(t,r){var n=function(r){e.removeEventListener("message",n),e.removeEventListener("error",i),t(e),setTimeout(function(){e.dispatchEvent(r)},0)},i=function(t){e.removeEventListener("message",n),e.removeEventListener("error",i),r(new Error("#waitWorkerInitialized: Error event before first message."))};e.addEventListener("message",n),e.addEventListener("error",i)})},e.directlyFallbackToBlobBasedLoading=!1,e.sourceLoaderCache=new Map,e}();t.WorkerLoader=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(){this.m_projectionViewMatrix=new n.Matrix4,this.m_viewMatrix=new n.Matrix4,this.m_cameraPosition=new n.Vector3,this.m_center=new n.Vector3,this.m_width=0,this.m_height=0,this.m_nearClipPlane=0,this.m_farClipPlane=0}return Object.defineProperty(e.prototype,"width",{get:function(){return this.m_width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.m_height},enumerable:!0,configurable:!0}),e.prototype.projectVector=function(e){return e.x-=this.m_center.x+this.m_cameraPosition.x,e.y-=this.m_center.y+this.m_cameraPosition.y,e.z-=this.m_center.z+this.m_cameraPosition.z,e.applyMatrix4(this.m_projectionViewMatrix),e},e.prototype.project=function(e,t){void 0===t&&(t=new n.Vector2);var r=this.projectVector(e.clone());if(r.z>0&&r.z<1)return t.set(r.x*this.m_width/2,r.y*this.m_height/2),t},e.prototype.update=function(e,t,r,i){this.m_width=r,this.m_height=i,e instanceof n.PerspectiveCamera&&(this.m_nearClipPlane=e.near,this.m_farClipPlane=e.far),this.m_center.copy(t),this.m_viewMatrix.makeRotationFromQuaternion(e.quaternion),this.m_viewMatrix.transpose(),this.m_cameraPosition.copy(e.position),this.m_projectionViewMatrix.multiplyMatrices(e.projectionMatrix,this.m_viewMatrix)},e}();t.ScreenProjector=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(161),o=function(){function e(e,t,r,o,a){void 0===a&&(a=i.DEFAULT_MONOMIAL_POWER),this.m_topColor=e,this.m_bottomColor=t,this.m_groundColor=r,this.m_monomialPower=a,this.m_gradient=new i.SkyGradientTexture(e,t,r,a),this.m_farClipPlaneDividedVertically=new n.Line3,this.m_groundPlane=new n.Plane(new n.Vector3(0,0,1)),this.m_bottomMidFarPoint=new n.Vector3,this.m_topMidFarPoint=new n.Vector3,this.m_horizonPosition=new n.Vector3,this.m_farClipPlaneCorners=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],this.update(o)}return Object.defineProperty(e.prototype,"topColor",{get:function(){return this.m_topColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomColor",{get:function(){return this.m_bottomColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundColor",{get:function(){return this.m_groundColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monomialPower",{get:function(){return this.m_monomialPower},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_gradient.texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizon",{get:function(){return this.m_horizonPosition},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.setHorizonPosition(e),this.updateTexturePosition()},e.prototype.updateColors=function(e,t,r){this.m_topColor=e,this.m_bottomColor=t,this.m_groundColor=r,this.m_gradient.update(e,t,r)},e.prototype.setHorizonPosition=function(e){this.setFarPlaneCornersFromCamera(e,this.m_farClipPlaneCorners);var t=this.m_farClipPlaneCorners[0],r=this.m_farClipPlaneCorners[1],n=this.m_farClipPlaneCorners[2],i=this.m_farClipPlaneCorners[3];this.setMidPoint(t,r,this.m_bottomMidFarPoint),this.setMidPoint(n,i,this.m_topMidFarPoint),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint),this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)},e.prototype.updateTexturePosition=function(){var e,t=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance();0===this.m_horizonPosition.length()?e=1:e=t-1/this.m_gradient.texture.image.height;this.m_bottomMidFarPoint.z<=0?this.m_gradient.updateYOffset(-e):this.m_gradient.updateYOffset(t)},e.prototype.setMidPoint=function(e,t,r){r.set((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)},e.prototype.setFarPlaneCornersFromCamera=function(e,t){var r=0;function n(n,i,o){t[r++].set(n,i,o).unproject(e)}n(-1,-1,1),n(1,-1,1),n(-1,1,1),n(1,1,1)},e}();t.SkyBackground=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.DEFAULT_TEXTURE_HEIGHT=512;t.DEFAULT_MONOMIAL_POWER=1;var i=function(){function e(e,r,n,i,o){void 0===o&&(o=t.DEFAULT_TEXTURE_HEIGHT),this.m_topColor=e,this.m_bottomColor=r,this.m_groundColor=n,this.m_monomialPower=i,this.m_height=o,this.m_texture=this.createTexture()}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_texture},enumerable:!0,configurable:!0}),e.prototype.updateYOffset=function(e){this.m_texture.offset.set(0,e)},e.prototype.update=function(e,r,n,i){void 0===i&&(i=t.DEFAULT_TEXTURE_HEIGHT),this.m_topColor=e,this.m_bottomColor=r,this.m_groundColor=n,this.updateTextureColors()},e.prototype.updateTextureColors=function(){var e=this.m_texture.image.data;this.fillTextureData(e),this.m_texture.needsUpdate=!0},e.prototype.createTexture=function(){var e=1*this.m_height,t=new Uint8Array(3*e);this.fillTextureData(t);var r=new n.DataTexture(t,1,this.m_height,n.RGBFormat);return r.needsUpdate=!0,r.unpackAlignment=1,r},e.prototype.fillTextureData=function(e){var t=1*this.m_height,r=this.m_topColor,i=this.m_bottomColor,o=this.m_groundColor;e[0]=255*o.r,e[1]=255*o.g,e[2]=255*o.b;for(var a=new n.Color,s=1;s<t;s++){var u=a.copy(i).lerp(r,Math.pow(s/t,this.m_monomialPower)).multiplyScalar(255),l=u.r,c=u.g,d=u.b,h=3*s;e[h]=l,e[h+1]=c,e[h+2]=d}},e}();t.SkyGradientTexture=i},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(163),o=r(4),a=r(15),s=r(0),u=function(){return function(e,t){this.tile=e,this.area=t}}();t.TileEntry=u;var l=function(){return function(e,t){this.tileKey=e,this.area=t}}(),c=function(){function e(e){var t=this;this.disposedTiles=[],this.tileCache=new a.LRUCache(e.tileCacheSize),this.tileCache.evictionCallback=function(e,r){t.disposedTiles.push(r)}}return e.prototype.disposeTiles=function(){this.disposedTiles.forEach(function(e){e.dispose()}),this.disposedTiles.length=0},e.prototype.get=function(e){return this.tileCache.get(e)},e}(),d=function(){function e(e,t){this.camera=e,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_dataSourceCache=new Map,this.m_viewProjectionMatrix=new s.Matrix4,this.m_frustum=new s.Frustum,this.m_mapTileCuller=new i.MapTileCuller(e),this.options=t}return e.prototype.getDataSourceCacheSize=function(){return this.options.tileCacheSize},e.prototype.setDataSourceCacheSize=function(e){this.options.tileCacheSize=e,this.m_dataSourceCache.forEach(function(t){t.tileCache.setCapacity(e)})},e.prototype.getNumberOfVisibleTiles=function(){return this.options.maxVisibleDataSourceTiles},e.prototype.setNumberOfVisibleTiles=function(e){this.options.maxVisibleDataSourceTiles=e},e.prototype.updateRenderList=function(e,t,r,i){var a=this;this.m_viewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.m_frustum.setFromMatrix(this.m_viewProjectionMatrix);var u=o.TileKey.fromRowColumnLevel(0,0,0),c=new s.Box3,d=[],h=!0;this.options.extendedFrustumCulling&&this.m_mapTileCuller.setup();var f,p,m=function(n){var i=n.getDisplayZoomLevel(r),o=n.getTilingScheme(),f=[new l(u,0)],p=[],m=new Map;for(m.set(u.mortonCode(),1/0);f.length>0;){if(void 0!==(x=f.pop())){var v=m.get(x.tileKey.mortonCode());if(void 0===v)throw new Error("Unexpected tile key");v<=0||x.tileKey.level>i||(n.shouldRender(i,x.tileKey)&&p.push(x),o.getSubTileKeys(x.tileKey).forEach(function(t){var r=0;if(void 0===m.get(t.mortonCode())){var n=o.getGeoBox(t);if(a.options.projection.projectBox(n,c),c.min.sub(e),c.max.sub(e),(!a.options.extendedFrustumCulling||a.m_mapTileCuller.frustumIntersectsTileBox(c))&&a.m_frustum.intersectsBox(c)){var i=[new s.Vector3(c.min.x,c.min.y,0).applyMatrix4(a.m_viewProjectionMatrix),new s.Vector3(c.max.x,c.min.y,0).applyMatrix4(a.m_viewProjectionMatrix),new s.Vector3(c.max.x,c.max.y,0).applyMatrix4(a.m_viewProjectionMatrix),new s.Vector3(c.min.x,c.max.y,0).applyMatrix4(a.m_viewProjectionMatrix)];i.push(i[0]);for(var u=i.length,d=u-1,h=0;h<u;d=h++)r+=i[d].x*i[h].y-i[h].x*i[d].y;r=Math.abs(.5*r)}m.set(t.mortonCode(),r)}r>0&&f.push(new l(t,r))}))}}p.sort(function(e,t){var r=t.area-e.area,n=.001*(e.area+t.area);return Math.abs(r)<n?t.tileKey.mortonCode()-e.tileKey.mortonCode():r});for(var g=[],b=!0,_=0;_<p.length&&g.length<y.options.maxVisibleDataSourceTiles;_++){var x=p[_];if(n.shouldRender(i,x.tileKey)){var w=y.getTile(n,x.tileKey);void 0!==w&&(w.prepareForRender(),b=b&&w.hasGeometry,g.push(w))}}d.push({dataSource:n,storageLevel:t,zoomLevel:i,allVisibleTileLoaded:b,visibleTiles:g,renderedTiles:g}),h=h&&b},y=this;try{for(var v=n(i),g=v.next();!g.done;g=v.next()){m(g.value)}}catch(e){f={error:e}}finally{try{g&&!g.done&&(p=v.return)&&p.call(v)}finally{if(f)throw f.error}}return this.dataSourceTileList=d,this.allVisibleTilesLoaded=h,this.fillMissingTilesFromCache(),d},e.prototype.getTile=function(e,t){if(!e.cacheable)return e.getTile(t);var r=this.getOrCreateCache(e).tileCache,n=r.get(t.mortonCode());return void 0!==n?n:(void 0!==(n=e.getTile(t))&&r.set(t.mortonCode(),n),n)},e.prototype.removeDataSource=function(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter(function(t){return t.dataSource.name!==e}),this.m_dataSourceCache.delete(e)},e.prototype.clearTileCache=function(e){if(void 0!==e){var t=this.m_dataSourceCache.get(e);t&&t.tileCache.evictAll()}else this.m_dataSourceCache.forEach(function(e){e.tileCache.evictAll()})},e.prototype.markTilesDirty=function(e){var t=this;if(void 0===e)this.dataSourceTileList.forEach(function(e){t.markDataSourceTilesDirty(e)});else{var r=this.dataSourceTileList.find(function(t){return t.dataSource===e});if(void 0===r)return;this.markDataSourceTilesDirty(r)}},e.prototype.disposePendingTiles=function(){this.m_dataSourceCache.forEach(function(e){e.disposeTiles()})},e.prototype.forEachVisibleTile=function(e){try{for(var t=n(this.dataSourceTileList),r=t.next();!r.done;r=t.next()){r.value.visibleTiles.forEach(e)}}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=t.return)&&o.call(t)}finally{if(i)throw i.error}}var i,o},e.prototype.forEachCachedTile=function(e){this.m_dataSourceCache.forEach(function(t){t.tileCache.forEach(function(t){e(t)})})},e.prototype.fillMissingTilesFromCache=function(){var e=this;this.dataSourceTileList.forEach(function(t){var r,n=t.dataSource,i=n.getTilingScheme(),a=t.zoomLevel,s=new Map,u=new Set;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.BOTH=2]="BOTH"}(r||(r={}));var l=e.m_dataSourceCache.get(n.name),c=e.options.quadTreeSearchDistanceUp>0&&void 0!==l&&a>n.minZoomLevel,d=e.options.quadTreeSearchDistanceDown>0&&void 0!==l&&a<n.maxZoomLevel;if(d||c){var h=d&&c?r.BOTH:d?r.DOWN:r.UP,f=new Map;if(t.visibleTiles.forEach(function(e){var t=e.tileKey.mortonCode();e.hasGeometry?s.set(t,e):f.set(t,h)}),0!==f.size){for(var p=function(){var t=new Map;f.forEach(function(n,c){if(n===r.BOTH||n===r.UP){var d=o.TileKey.parentMortonCode(c);if(!u.has(d)&&!s.get(d)){u.add(d);var h=l.get(d);if(void 0!==h&&h.hasGeometry)return void s.set(d,h);var f=h?h.tileKey:o.TileKey.fromMortonCode(d);Math.abs(a-f.level)<e.options.quadTreeSearchDistanceUp&&t.set(d,r.UP)}}if(n===r.BOTH||n===r.DOWN){var p=o.TileKey.fromMortonCode(c);i.getSubTileKeys(p).forEach(function(n){var i=n.mortonCode(),o=l.get(i);(u.add(i),void 0!==o&&o.hasGeometry)?s.set(i,o):Math.abs(n.level-a)<e.options.quadTreeSearchDistanceDown&&t.set(i,r.DOWN)})}}),f=t};void 0!==l&&0!==f.size;)p();t.renderedTiles=Array.from(s.values())}}})},e.prototype.getOrCreateCache=function(e){var t=e.name,r=this.m_dataSourceCache.get(t);return void 0===r&&(r=new c(this.options),this.m_dataSourceCache.set(t,r)),r},e.prototype.markDataSourceTilesDirty=function(e){var t=this.m_dataSourceCache.get(e.dataSource.name),r=new Set;e.visibleTiles.forEach(function(e){r.add(e.tileKey.mortonCode()),e.reload()}),e.renderedTiles.forEach(function(e){var t=e.tileKey.mortonCode();r.has(t)||(r.add(t),e.reload())}),void 0!==t&&t.tileCache.forEach(function(e,n){r.has(n)||(e.dispose(),t.tileCache.delete(n))})},e}();t.VisibleTileSet=d},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(){function e(e){this.m_camera=e,this.m_globalFrustumMin=new i.Vector3,this.m_globalFrustumMax=new i.Vector3,this.m_frustumCorners=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3]}return e.prototype.setup=function(){var e,t,r=this.getFrustumCorners(),i=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);try{for(var o=n(r),a=o.next();!a.done;a=o.next()){var s=a.value;s.applyMatrix4(i),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,s.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,s.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,s.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,s.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,s.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,s.z)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.frustumIntersectsTileBox=function(e){var t=this.m_globalFrustumMin,r=this.m_globalFrustumMax;return!(r.x<e.min.x||r.y<e.min.y||r.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)},e.prototype.getFrustumCorners=function(){var e=this.m_frustumCorners,t=new i.Camera;t.projectionMatrix.copy(this.m_camera.projectionMatrix);var r=0;function n(n,i,o){e[r++].set(n,i,o).unproject(t)}return n(-1,-1,-1),n(1,-1,-1),n(-1,1,-1),n(1,1,-1),n(-1,-1,1),n(1,-1,1),n(-1,1,1),n(1,1,1),e},e}();t.MapTileCuller=o},function(e,t,r){"use strict";(function(e){var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=r(3),a=r(12),s=r(1),u=r(0),l=r(17),c=r(35),d=r(18),h=r(19),f=r(16);!function(e){e[e.Initialized=0]="Initialized",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Decoding=3]="Decoding",e[e.Ready=4]="Ready",e[e.Canceled=5]="Canceled",e[e.Failed=6]="Failed",e[e.Disposed=7]="Disposed"}(t.TileLoaderState||(t.TileLoaderState={}));var p=function(){function t(e,t){this.dataSource=e,this.tileKey=t,this.objects=[],this.dependencies=new Array,this.boundingBox=new u.Box3,this.center=new u.Vector3,this.m_disposed=!1,this.m_forceHasGeometry=void 0,this.m_preparedTextPaths=new Array,this.m_userTextElements=[],this.m_textElementGroups=new s.GroupedPriorityList,this.m_placedTextElements=new s.GroupedPriorityList,this.m_numVertices=0,this.m_memoryUsage=void 0,this.m_textElementsChanged=!1,this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.projection.projectBox(this.geoBox,this.boundingBox),this.boundingBox.getCenter(this.center)}return Object.defineProperty(t.prototype,"projection",{get:function(){return this.dataSource.projection},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapView",{get:function(){return this.dataSource.mapView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"placedTextElements",{get:function(){return this.m_placedTextElements},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryUsage",{get:function(){if(void 0!==this.m_memoryUsage)return this.m_memoryUsage;var e=0;return void 0!==this.decodedTile&&(e+=f.MapViewUtils.estimateObjectSize(this.decodedTile)),e+=f.MapViewUtils.estimateObjectSize(this.textElementGroups),e+=f.MapViewUtils.estimateObjectSize(this.objects),e+=f.MapViewUtils.estimateObjectSize(this.preparedTextPaths),this.roadIntersectionData&&(e+=f.MapViewUtils.estimateObjectSize(this.roadIntersectionData)),this.m_memoryUsage=e,2*e},enumerable:!0,configurable:!0}),t.prototype.getUsageStatistics=function(){return{estimatedMemoryUsage:this.memoryUsage,numVertices:this.m_numVertices,numColors:l.ColorCache.instance.size,numObjects:this.objects.length,numGeometries:void 0!==this.m_decodedTile?this.m_decodedTile.geometries.length:0,numMaterials:this.getMaterialsCount()}},Object.defineProperty(t.prototype,"userTextElements",{get:function(){return this.m_userTextElements},enumerable:!0,configurable:!0}),t.prototype.addUserTextElement=function(e){this.m_userTextElements.push(e),this.textElementsChanged=!0},t.prototype.removeUserTextElement=function(e){var t=this.m_userTextElements.indexOf(e);return t>=0&&(this.m_userTextElements.splice(t,1),this.textElementsChanged=!0,!0)},t.prototype.addTextElement=function(e){this.textElementGroups.add(e),this.textElementsChanged=!0},t.prototype.removeTextElement=function(e){return!!this.textElementGroups.remove(e)&&(this.textElementsChanged=!0,!0)},Object.defineProperty(t.prototype,"textElementGroups",{get:function(){return this.m_textElementGroups},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textElementsChanged",{get:function(){return this.m_textElementsChanged},set:function(e){this.m_textElementsChanged=e},enumerable:!0,configurable:!0}),t.prototype.prepareForRender=function(){var t=this;if(this.m_decodedTile&&!this.m_disposed){var r=this.m_decodedTile;void 0!==r.tileInfo&&(this.roadIntersectionData=this.dataSource.mapView.pickHandler.registerTile(this)),this.m_decodedTile=void 0,e(function(){var e=t.mapView.statistics,n=0;e.enabled&&(n=s.PerformanceTimer.now()),t.createGeometries(r),e.enabled&&e.getTimer("geometryCreation").setValue(s.PerformanceTimer.now()-n),t.dataSource.requestUpdate()})}},t.prototype.willRender=function(e){return!0},t.prototype.didRender=function(){},t.prototype.createGeometries=function(e){this.clear(),this.preparePois(e),this.createTextElements(e),this.createObjects(e,this.objects),this.countVertices()},Object.defineProperty(t.prototype,"decodedTile",{get:function(){return this.m_decodedTile},enumerable:!0,configurable:!0}),t.prototype.setDecodedTile=function(e){this.m_decodedTile=e,this.invalidateUsageInfoCache();var t=this.dataSource.mapView.statistics;t.enabled&&t.getTimer("decoding").setValue(e.decodeTime)},t.prototype.shouldDisposeObjectGeometry=function(e){return!0},t.prototype.shouldDisposeObjectMaterial=function(e){return!0},Object.defineProperty(t.prototype,"disposed",{get:function(){return this.m_disposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasGeometry",{get:function(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry},enumerable:!0,configurable:!0}),t.prototype.forceHasGeometry=function(e){this.m_forceHasGeometry=e},Object.defineProperty(t.prototype,"tileLoader",{get:function(){return this.m_tileLoader},set:function(e){this.m_tileLoader=e},enumerable:!0,configurable:!0}),t.prototype.reload=function(){this.dataSource.updateTile(this)},t.prototype.clear=function(){var e=this,t=function(t){void 0!==t.geometry&&e.shouldDisposeObjectGeometry(t)&&t.geometry.dispose(),void 0!==t.material&&e.shouldDisposeObjectMaterial(t)&&(t.material instanceof Array?t.material.forEach(function(e){return e.dispose()}):t.material.dispose())};this.objects.forEach(function(e){e.traverse(function(e){t(e)}),t(e)}),this.objects.length=0,this.m_preparedTextPaths&&(this.m_preparedTextPaths=[]),this.placedTextElements.clear(),this.textElementGroups.clear(),this.userTextElements.length=0,this.invalidateUsageInfoCache()},t.prototype.dispose=function(){this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.dispose(),this.m_tileLoader=void 0),this.clear(),this.userTextElements.length=0,this.m_disposed=!0)},Object.defineProperty(t.prototype,"preparedTextPaths",{get:function(){return this.m_preparedTextPaths},enumerable:!0,configurable:!0}),t.prototype.prepareTextPaths=function(e){for(var t=new Array,r=Math.PI/8,n=e.slice(),i=new u.Vector2,o=new u.Vector2,a=new u.Vector2;n.length>0;){var s=n.pop();if(void 0===s)break;for(var l=-1,c=0;c<s.path.length-2;c+=2){i.set(s.path[c],s.path[c+1]),o.set(s.path[c+2],s.path[c+3]);var d=o.sub(i).normalize();if(c>0){var h=Math.atan2(a.x*d.y-d.x*a.y,d.dot(a));if(Math.abs(h)>r){l=c;break}}a.set(d.x,d.y)}if(l>0){var f={path:s.path.slice(0,l+2),text:s.text,pathLengthSqr:s.pathLengthSqr,technique:s.technique,featureId:s.featureId};t.push(f);var p={path:s.path.slice(l),text:s.text,pathLengthSqr:s.pathLengthSqr,technique:s.technique,featureId:s.featureId};n.push(p)}else t.push(s)}return t},t.prototype.createTextElements=function(e){var t,r,i,o,s,c,f=new Map,p=0,m=0;if(void 0!==e.textPathGeometries&&(p+=e.textPathGeometries.length),void 0!==e.textGeometries&&(p+=e.textGeometries.length),void 0!==e.textPathGeometries){this.m_preparedTextPaths=this.prepareTextPaths(e.textPathGeometries);var y=0;try{for(var v=n(this.preparedTextPaths),g=v.next();!g.done;g=v.next()){var b=g.value;"text"===(P=e.techniques[b.technique]).name&&(b.pathLengthSqr>y&&(y=b.pathLengthSqr))}}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}try{for(var _=n(this.preparedTextPaths),x=_.next();!x.done;x=_.next()){b=x.value;if("text"===(P=e.techniques[b.technique]).name){void 0!==P.color&&f.set(b.technique,l.ColorCache.instance.getColor(P.color));for(var w=[],T=0;T<b.path.length;T+=2)w.push(new u.Vector2(b.path[T],b.path[T+1]));var S=(void 0!==P.priority?P.priority:0)+.1*(p-m)/p+(y>0?.9*b.pathLengthSqr/y:0);(R=new d.TextElement(b.text,w,S,void 0!==P.scale?P.scale:1,void 0!==P.xOffset?P.xOffset:0,void 0!==P.yOffset?P.yOffset:0,b.featureId,P.style)).bold=P.bold,R.oblique=P.oblique,R.color=f.get(b.technique),R.minZoomLevel=P.minZoomLevel,R.distanceScale=void 0!==P.distanceScale?P.distanceScale:h.DEFAULT_TEXT_DISTANCE_SCALE,void 0!==P.tracking&&(R.tracking=P.tracking),R.mayOverlap=!0===P.mayOverlap,R.reserveSpace=!1!==P.reserveSpace,void 0===P.hAlignment||P.hAlignment!==a.TextHorizontalAlignmentStrings.Left&&P.hAlignment!==a.TextHorizontalAlignmentStrings.Center&&P.hAlignment!==a.TextHorizontalAlignmentStrings.Right||(R.horizontalAlignment=a.TextHorizontalAlignment[P.hAlignment]),void 0===P.vAlignment||P.vAlignment!==a.TextVerticalAlignmentStrings.Above&&P.vAlignment!==a.TextVerticalAlignmentStrings.Center&&P.vAlignment!==a.TextVerticalAlignmentStrings.Below||(R.verticalAlignment=a.TextVerticalAlignment[P.vAlignment]),this.addTextElement(R),m++}}}catch(e){i={error:e}}finally{try{x&&!x.done&&(o=_.return)&&o.call(_)}finally{if(i)throw i.error}}}if(void 0!==e.textGeometries)try{for(var O=n(e.textGeometries),E=O.next();!E.done;E=O.next()){var P,C=E.value;if(void 0!==C.technique&&void 0!==C.stringCatalog)if("text"===(P=e.techniques[C.technique]).name){void 0!==P.color&&f.set(C.technique,l.ColorCache.instance.getColor(P.color));var A=new u.BufferAttribute(new Float32Array(C.positions.buffer),C.positions.itemCount),I=A.count;if(!(I<1)){S=(void 0!==P.priority?P.priority:0)+.1*(p-m)/p;var M=.1/I;for(T=0;T<I;++T){var L=A.getX(T),j=A.getY(T),F=C.stringCatalog[C.texts[T]];if(void 0!==F){var R,D=S+M*(I-T)/I;(R=new d.TextElement(F,new u.Vector2(L,j),D,P.scale||1,P.xOffset||0,P.yOffset||0,C.featureId,P.style)).color=f.get(C.technique),R.minZoomLevel=P.minZoomLevel,R.mayOverlap=!0===P.mayOverlap,R.reserveSpace=!1!==P.reserveSpace,this.addTextElement(R),m++}}}}}}catch(e){s={error:e}}finally{try{E&&!E.done&&(c=O.return)&&c.call(O)}finally{if(s)throw s.error}}},t.prototype.registerTileObject=function(e){var t=e.userData||{};t.tileKey=this.tileKey,t.dataSource=this.dataSource.name},t.prototype.createObjects=function(e,t){var r,a,s=[];try{for(var l=n(e.geometries),d=l.next();!d.done;d=l.next())for(var h,p=d.value,m=p.groups,y=m.length,v=function(r){for(var a=m[r++],l=a.start,d=a.technique,v=e.techniques[d],b=a.count;r<y&&m[r].technique===d&&l+b===m[r].start;++r)b+=m[r].count;var _=i.getObjectConstructor(v);if(void 0===_)return h=r,"continue";var x=s[d];if(void 0===x){if(void 0===(x=i.createMaterial({technique:e.techniques[d],level:g.tileKey.level,fog:null!==g.mapView.scene.fog})))return h=r,"continue";s[d]=x}var w=new u.BufferGeometry;if(p.vertexAttributes.forEach(function(e){var t=i.getBufferAttribute(e);w.addAttribute(e.name,t)}),void 0!==p.interleavedVertexAttributes&&p.interleavedVertexAttributes.forEach(function(e){var t=i.getArrayConstructor(e.type),r=new u.InterleavedBuffer(new t(e.buffer),e.stride);e.attributes.forEach(function(e){var t=new u.InterleavedBufferAttribute(r,e.itemSize,e.offset,!1);w.addAttribute(e.name,t)})}),p.index&&w.setIndex(i.getBufferAttribute(p.index)),!w.getAttribute("normal")&&i.isStandardTechnique(v)&&w.computeVertexNormals(),w.addGroup(l,b),"solid-line"===v.name||"dashed-line"===v.name){var T=x;if(T.uniforms.opacity.value=x.opacity,!1!==v.clipping){var S=T.uniforms.tileSize,O=new u.Vector3;g.boundingBox.getSize(O),S.value.x=O.x,S.value.y=O.y,T.defines.TILE_CLIP=1}}var E="extruded-polygon"===v.name&&void 0!==p.edgeIndex,P="fill"===v.name&&void 0!==p.outlineIndicesAttributes;(E||P)&&(x.polygonOffset=!0,x.polygonOffsetFactor=.25,x.polygonOffsetUnits=.1);var C=new _(w,x);if(C.frustumCulled=!1,void 0!==v.renderOrder)C.renderOrder=v.renderOrder;else{if(void 0===v._renderOrderAuto)throw new Error("Technique has no renderOrderAuto");C.renderOrder=v._renderOrderAuto}if(void 0!==a.renderOrderOffset&&(C.renderOrder+=a.renderOrderOffset),void 0!==p.uuid&&(C.userData.geometryId=p.uuid),"solid-line"!==v.name&&"dashed-line"!==v.name||(C.onBeforeRender=function(e,t,r,n,i){i.transparent=!0},C.onAfterRender=function(e,t,r,n,i){i.transparent=!1}),void 0!==p.featureIds&&p.featureIds.length>0){var A={geometryType:p.type,ids:p.featureIds,starts:p.featureStarts};C.userData.feature=A,void 0!==p.objInfos&&(C.userData.feature.objInfos=p.objInfos)}var I,M,L="extruded-polygon"===v.name&&c.isRenderDepthPrePassEnabled(v);if(L){var j=c.createDepthPrePassMesh(C);t.push(j),c.applyDepthBasedPolygonOffset(c.DEFAULT_DEPTH_BASED_POLYGON_OFFSET_MULTIPLIER,j,C)}if(g.registerTileObject(C),t.push(C),"extruded-polygon"===v.name&&void 0!==p.edgeIndex){var F=new u.BufferGeometry;F.addAttribute("position",w.getAttribute("position")),F.addAttribute("color",w.getAttribute("color")),F.setIndex(i.getBufferAttribute(p.edgeIndex));var R=v,D=void 0!==R.lineColor?R.lineColor:o.EdgeMaterial.DEFAULT_COLOR,B=void 0!==R.lineColorMix?R.lineColorMix:o.EdgeMaterial.DEFAULT_COLOR_MIX,U=void 0!==R.lineFadeDistance?R.lineFadeDistance:o.EdgeMaterial.DEFAULT_FADE_DIST,k={color:D,colorMix:B,fadeDistance:U},G=new o.EdgeMaterial(k),V=new u.LineSegments(F,G);V.renderOrder=G.transparent&&!L?-1:C.renderOrder+.1,V.onBeforeRender=function(e,t,r,n,i){i.fadeDistance=f.MapViewUtils.calculateDepthFromClipDistance(U,r)},g.registerTileObject(V),t.push(V)}if(P&&void 0!==p.outlineIndicesAttributes){var q=function(e){var r=new u.BufferGeometry;r.addAttribute("position",w.getAttribute("position")),void 0!==e&&r.setIndex(i.getBufferAttribute(e));var n=v,a=void 0!==n.lineColor?n.lineColor:o.EdgeMaterial.DEFAULT_COLOR,s=o.EdgeMaterial.DEFAULT_COLOR_MIX,l=i.getPropertyValue(n.lineFadeDistance,g.tileKey.level),c={color:a,colorMix:s,fadeDistance:l=void 0!==l?l:o.EdgeMaterial.DEFAULT_FADE_DIST},d=new o.EdgeMaterial(c),h=new u.LineSegments(r,d);h.renderOrder=C.renderOrder+.1,h.onBeforeRender=function(e,t,r,n,i){i.fadeDistance=f.MapViewUtils.calculateDepthFromClipDistance(l,r)},h.onAfterRender=function(e,t,r,n,i){i.transparent=!1},g.registerTileObject(h),t.push(h)};try{for(var N=n(p.outlineIndicesAttributes),z=N.next();!z.done;z=N.next()){q(z.value)}}catch(e){I={error:e}}finally{try{z&&!z.done&&(M=N.return)&&M.call(N)}finally{if(I)throw I.error}}}h=r},g=this,b=0;b<y;)v(b),b=h}catch(e){r={error:e}}finally{try{d&&!d.done&&(a=l.return)&&a.call(l)}finally{if(r)throw r.error}}},t.prototype.invalidateUsageInfoCache=function(){this.m_numVertices=0,this.m_memoryUsage=void 0},t.prototype.countVertices=function(){var e=this;this.objects.filter(function(e){return e instanceof u.Mesh}).forEach(function(t){var r=t;r.geometry instanceof u.BufferGeometry&&(void 0!==r.geometry.index&&null!==r.geometry.index?e.m_numVertices+=r.geometry.index.count:e.m_numVertices+=r.geometry.getAttribute("position").count/3),r.geometry instanceof u.Geometry&&(e.m_numVertices=r.geometry.vertices.length)})},t.prototype.preparePois=function(e){void 0!==e.poiGeometries&&this.mapView.poiManager.addPois(this,e)},t.prototype.getMaterialsCount=function(){var e=0;return this.objects.forEach(function(t){t.material&&(Array.isArray(t.material)?e+=t.material.length:e+=1)}),e},t}();t.Tile=p}).call(this,r(72).setImmediate)},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=r(1),a=r(78),s=o.LoggerManager.instance.create("TileDataAccessor"),u=function(){function e(e,t,r){this.tile=e,this.visitor=t,this.m_wantsPoints=!0,this.m_wantsLines=!0,this.m_wantsAreas=!0,this.m_wantsObject3D=!0;var n=!0===r.wantsAll;this.m_wantsPoints=n||!(!1===r.wantsPoints),this.m_wantsLines=n||!(!1===r.wantsLines),this.m_wantsAreas=n||!(!1===r.wantsAreas),this.m_wantsObject3D=n||!(!1===r.wantsObject3D)}return e.prototype.visitAll=function(){var e,t,r=this.tile.objects;try{for(var i=n(r),o=i.next();!o.done;o=i.next()){var a=o.value;this.visitObject(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.visitObject=function(e){var t=void 0!==e.userData?e.userData.feature:void 0;if(void 0!==t&&(void 0===t.ids||1!==t.ids.length||this.visitor.wantsFeature(t.ids[0]))){var r=t.geometryType;if(void 0!==r){switch(o.assert(void 0!==t.ids,"featureData.ids missing"),o.assert(Array.isArray(t.ids),"featureData.ids is not an array"),o.assert(void 0!==t.starts,"featureData.starts missing"),o.assert(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.ids&&void 0!==t.starts&&o.assert(t.ids.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),r){case i.GeometryType.Point:case i.GeometryType.Text:if(!this.m_wantsPoints)return;break;case i.GeometryType.SolidLine:case i.GeometryType.ExtrudedLine:case i.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case i.GeometryType.Polygon:case i.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case i.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:s.warn("#visitObject: invalid geometryType")}if("Mesh"===e.type){var n=e;this.visitMesh(n,t)}else s.warn("#visitObject: visiting object failed, not of type 'Mesh'",e)}else s.warn("#visitObject: visiting object failed, no geometryType",e)}},e.prototype.getBufferGeometry=function(e){var t=e.geometry;if("BufferGeometry"===t.type){var r=t;if(r.getAttribute("position"))return r;s.warn("#visitLines: BufferGeometry has no position attribute")}else s.warn("#visitObject: object does not have BufferGeometry")},e.prototype.getGeometryAccessor=function(e,t,r){switch(e){case i.GeometryType.Point:case i.GeometryType.Text:return;case i.GeometryType.SolidLine:case i.GeometryType.ExtrudedLine:case i.GeometryType.TextPath:return new a.BufferedGeometryLineAccessor(t,e,r);case i.GeometryType.Polygon:case i.GeometryType.ExtrudedPolygon:return;case i.GeometryType.Object3D:return new a.BufferedGeometryObject3dAccessor(t,e,r);default:s.warn("#getGeometryAccessor: invalid geometryType")}},e.prototype.getIndexedGeometryAccessor=function(e,t,r){switch(e){case i.GeometryType.Point:case i.GeometryType.Text:return;case i.GeometryType.SolidLine:case i.GeometryType.ExtrudedLine:case i.GeometryType.TextPath:return new a.IndexedBufferedGeometryLineAccessor(t,e,r);case i.GeometryType.Polygon:case i.GeometryType.ExtrudedPolygon:case i.GeometryType.Object3D:return;default:s.warn("#getIndexedGeometryAccessor: invalid geometryType")}},e.prototype.visitMesh=function(e,t){var r=t.ids,n=t.starts,u=t.geometryType;if(void 0!==r&&void 0!==n&&void 0!==u)for(var l,c=0;c<r.length;c++){var d=r[c];if(this.visitor.wantsFeature(d)){var h,f=n[c];if(void 0===l){var p=this.getBufferGeometry(e);if(void 0===p)continue;if(void 0===(l=null!==p.index?this.getIndexedGeometryAccessor(u,e,p):this.getGeometryAccessor(u,e,p))){s.warn("#visitObject: no accessor geometryType",u);continue}}switch(h=c<n.length-1?n[c+1]:l.getCount(),l.setRange(f,h),u){case i.GeometryType.Point:case i.GeometryType.Text:this.visitor.visitPoint(d);break;case i.GeometryType.SolidLine:case i.GeometryType.ExtrudedLine:case i.GeometryType.TextPath:o.assert(a.isLineAccessor(l)),this.visitor.visitLine(d,l);break;case i.GeometryType.Polygon:case i.GeometryType.ExtrudedPolygon:this.visitor.visitArea(d);break;case i.GeometryType.Object3D:o.assert(a.isObject3dAccessor(l)),this.visitor.visitObject3D(d,l);break;default:s.warn("#visitObject: invalid geometryType")}}}},e}();t.TileDataAccessor=u},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),s=r(4),u=r(84),l=r(1),c=r(167),d=r(0),h=r(182);var f=function(){return function(e,t){void 0===t&&(t=[]),this.format=e,this.elements=t}}(),p=function(){function e(e){this.latitudeScale=1/4096*e.latitudeSpan,this.longitudeScale=1/4096*e.longitudeSpan,this.latitudeShift=e.south,this.longitudeShift=e.west}return e.prototype.decode=function(e,t,r,n){return n&&(n.y+=e,n.x+=t,e=n.y,t=n.x),new s.GeoCoordinates(e*this.latitudeScale+this.latitudeShift,t*this.longitudeScale+this.longitudeShift,r)},e}();t.DEFAULT_SOLID_LANDMARK_TECHNIQUE={name:"standard",renderOrder:1e3,color:"#f7f9f9",roughness:1.95,metalness:.85,emissive:"#f7f9f9",emissiveIntensity:.6,vertexColors:!1},t.DEFAULT_TEXTURED_LANDMARK_TECHNIQUE={name:"standard-textured",renderOrder:1e3,color:"#f7f9f9",roughness:1,metalness:.2,emissive:"#f7f9f9",emissiveIntensity:.1,wrapS:"repeat",wrapT:"repeat"};var m=function(){function e(e,r,n,u,h){var m=this;this.m_tileKey=e,this.m_projection=r,this.m_techniques=[],this.m_geometries=[],this.m_geoBox=s.hereTilingScheme.getGeoBox(this.m_tileKey),this.m_tileBounds=this.m_projection.projectBox(this.m_geoBox,new d.Box3),this.m_center=new d.Vector3,this.m_tileBounds.getCenter(this.m_center),this.m_protoTile=c.LandmarkTile.decode(new Uint8Array(n));var y=new p(this.m_geoBox);if(void 0!==this.m_protoTile.meshFeature&&void 0!==this.m_protoTile.meshFeature.geometry){var v=this.m_protoTile.meshFeature.material,g=void 0!==v&&!0===h.renderTextures,b=u.getMatchingTechniques(new a.MapEnv({$layer:"landmark",$enableLandmarkTextures:g,$hasTexture:!0}));if(b.length>0){var _=b[0];a.isStandardTexturedTechnique(_)&&!1!==_.renderTexture||(g=!1)}var x=g?t.DEFAULT_TEXTURED_LANDMARK_TECHNIQUE:t.DEFAULT_SOLID_LANDMARK_TECHNIQUE,w=b.length>0?i({},x,b[0]):i({},x);(a.isStandardTechnique(w)||a.isStandardTexturedTechnique(w)||a.isLandmarkTechnique(w))&&(w.alphaTest=l.getOptionValue(w.alphaTest,h.materialAlphaTest),w.opacity=l.getOptionValue(w.opacity,h.materialOpacity),w.transparent=l.getOptionValue(w.transparent,h.materialTransparent),w.depthTest=l.getOptionValue(w.depthTest,h.materialDepthTest),w.enableDepthPrePass=l.getOptionValue(w.enableDepthPrePass,h.enableDepthPrePass)),this.m_techniques=g&&void 0!==v?v.map(function(e){var t=i({},w),r=e.texture;return r&&void 0!==r.id&&r.id.length>0&&(t.texture={buffer:Uint8Array.from(r.id).buffer,format:"image/png"}),t}):[w];var T=new Map,S=[],O=0,E=h.gatherFeatureIds,P=E?new Array:void 0,C=E?new Array:void 0;this.m_protoTile.meshFeature.geometry.forEach(function(e){if(void 0!==e.object&&void 0!==e.bufferData){var t=y.decode(e.centerLat,e.centerLon,0),n=new d.Vector3;r.projectPoint(t,n);var i=r.getScaleFactor(n);n.sub(m.m_center);var a=e.bufferData;e.object.forEach(function(e){if(void 0!==e.bufferAttribute){if(void 0!==P&&void 0!==C){var t=e.landmarkId;P.push(t),C.push(O)}var r,s,u=g?e.materialIndex:0;try{for(var l=o(e.bufferAttribute),d=l.next();!d.done;d=l.next()){var h=d.value,p=a[h.bufferDataIndex],m=h.face;if(void 0!==m&&(p.type===c.Type.POSITION&&(S.push({start:O,count:m.length,technique:u}),O+=m.length),g||p.type!==c.Type.TEX_COORD)){var y=T.get(p.type);switch(void 0===y&&(y=new f(p.format),T.set(p.type,y)),p.format){case c.Format.FLOAT_1:break;case c.Format.FLOAT_2:if(void 0===p.float32Array)return;if(void 0===(w=p.float32Array.data))return;for(var v=0;v<m.length;v+=3)for(var b=0;b<3;++b){var _=w[2*(E=m[v+b])],x=w[2*E+1];y.elements.push(_,x)}break;case c.Format.FLOAT_3:if(void 0===p.float32Array)return;var w;if(void 0===(w=p.float32Array.data))return;for(v=0;v<m.length;v+=3)for(b=0;b<3;++b){_=w[3*(E=m[v+b])],x=w[3*E+1];var E,A=w[3*E+2];p.type===c.Type.POSITION&&(_=_*i+n.x,x=x*i+n.y,A=A*i+n.z),y.elements.push(_,x,A)}break;case c.Format.FLOAT_4:case c.Format.UINT32_1:}}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(r)throw r.error}}}})}});var A={type:a.GeometryType.Object3D,vertexAttributes:[],index:{name:"index",buffer:new Uint32Array([]).buffer,itemCount:1,type:"uint32"},groups:S,featureIds:P,featureStarts:C};T.forEach(function(e,t){var r={name:function(e){switch(e){case c.Type.POSITION:return"position";case c.Type.NORMAL:return"normal";case c.Type.TEX_COORD:return"uv";case c.Type.COLOR:return"color";default:throw new Error("invalid buffer attribute type")}}(t),buffer:new Float32Array(e.elements).buffer,itemCount:function(e){switch(e){case c.Format.FLOAT_1:return 1;case c.Format.FLOAT_2:return 2;case c.Format.FLOAT_3:return 3;case c.Format.FLOAT_4:return 4;case c.Format.UINT32_1:return 1}throw new Error("unexpected format")}(e.format),type:"float"};A.vertexAttributes.push(r)}),this.m_geometries.push(A)}}return e.prototype.getDecodedTile=function(){return{techniques:this.m_techniques,geometries:this.m_geometries}},e}();t.LandmarkDecoder=m;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.m_decoderOptions=h.DEFAULT_LANDMARK_DECODER_OPTIONS,t}return n(t,e),t.prototype.connect=function(){return Promise.resolve()},t.prototype.decodeThemedTile=function(e,t,r,n){var i=l.PerformanceTimer.now(),o=new m(t,n,e,r,this.m_decoderOptions).getDecodedTile();return o.decodeTime=l.PerformanceTimer.now()-i,Promise.resolve(o)},t.prototype.configure=function(t,r,n){e.prototype.configure.call(this,t,r,n),void 0!==n&&(this.m_decoderOptions=l.mergeWithOptions(this.m_decoderOptions,n))},t}(u.ThemedTileDecoder);t.LandmarkTileDecoder=y;var v=function(){return function(e){u.TileDecoderService.start(e||h.LANDMARK_TILE_DECODER_SERVICE_ID,new y)}}();t.default=v},function(e,t,r){"use strict";var n=r(85),i=n.Reader,o=n.util,a=n.roots.default||(n.roots.default={});a.Texture=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=o.newBuffer([]),e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.Texture;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.id=e.bytes();break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("id"))throw o.ProtocolError("missing required 'id'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.Texture)return e;var t=new a.Texture;return null!=e.id&&("string"==typeof e.id?o.base64.decode(e.id,t.id=o.newBuffer(o.base64.length(e.id)),0):e.id.length&&(t.id=e.id)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.id=t.bytes===String?"":[]),null!=e.id&&e.hasOwnProperty("id")&&(r.id=t.bytes===String?o.base64.encode(e.id,0,e.id.length):t.bytes===Array?Array.prototype.slice.call(e.id):e.id),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.Material=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t;return e.prototype.texture=null,e.prototype.rgba=0,Object.defineProperty(e.prototype,"value",{get:o.oneOfGetter(t=["texture","rgba"]),set:o.oneOfSetter(t)}),e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.Material;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.texture=a.Texture.decode(e,e.uint32());break;case 2:n.rgba=e.uint32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.Material)return e;var t=new a.Material;if(null!=e.texture){if("object"!=typeof e.texture)throw TypeError(".Material.texture: object expected");t.texture=a.Texture.fromObject(e.texture)}return null!=e.rgba&&(t.rgba=e.rgba>>>0),t},e.toObject=function(e,t){t||(t={});var r={};return null!=e.texture&&e.hasOwnProperty("texture")&&(r.texture=a.Texture.toObject(e.texture,t),t.oneofs&&(r.value="texture")),null!=e.rgba&&e.hasOwnProperty("rgba")&&(r.rgba=e.rgba,t.oneofs&&(r.value="rgba")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.UInt8Array=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.data=o.newBuffer([]),e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.UInt8Array;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.data=e.bytes();break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("data"))throw o.ProtocolError("missing required 'data'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.UInt8Array)return e;var t=new a.UInt8Array;return null!=e.data&&("string"==typeof e.data?o.base64.decode(e.data,t.data=o.newBuffer(o.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.data=t.bytes===String?"":[]),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?o.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.UInt16Array=function(){function e(e){if(this.data=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.data=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.UInt16Array;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:if(n.data&&n.data.length||(n.data=[]),2==(7&o))for(var s=e.uint32()+e.pos;e.pos<s;)n.data.push(e.uint32());else n.data.push(e.uint32());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.UInt16Array)return e;var t=new a.UInt16Array;if(e.data){if(!Array.isArray(e.data))throw TypeError(".UInt16Array.data: array expected");t.data=[];for(var r=0;r<e.data.length;++r)t.data[r]=e.data[r]>>>0}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.data=[]),e.data&&e.data.length){r.data=[];for(var n=0;n<e.data.length;++n)r.data[n]=e.data[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.UInt32Array=function(){function e(e){if(this.data=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.data=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.UInt32Array;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:if(n.data&&n.data.length||(n.data=[]),2==(7&o))for(var s=e.uint32()+e.pos;e.pos<s;)n.data.push(e.uint32());else n.data.push(e.uint32());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.UInt32Array)return e;var t=new a.UInt32Array;if(e.data){if(!Array.isArray(e.data))throw TypeError(".UInt32Array.data: array expected");t.data=[];for(var r=0;r<e.data.length;++r)t.data[r]=e.data[r]>>>0}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.data=[]),e.data&&e.data.length){r.data=[];for(var n=0;n<e.data.length;++n)r.data[n]=e.data[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.Float32Array=function(){function e(e){if(this.data=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.data=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.Float32Array;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:if(n.data&&n.data.length||(n.data=[]),2==(7&o))for(var s=e.uint32()+e.pos;e.pos<s;)n.data.push(e.float());else n.data.push(e.float());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.Float32Array)return e;var t=new a.Float32Array;if(e.data){if(!Array.isArray(e.data))throw TypeError(".Float32Array.data: array expected");t.data=[];for(var r=0;r<e.data.length;++r)t.data[r]=Number(e.data[r])}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.data=[]),e.data&&e.data.length){r.data=[];for(var n=0;n<e.data.length;++n)r.data[n]=t.json&&!isFinite(e.data[n])?String(e.data[n]):e.data[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.Type=function(){var e={},t=Object.create(e);return t[e[0]="POSITION"]=0,t[e[1]="NORMAL"]=1,t[e[2]="TEX_COORD"]=2,t[e[3]="COLOR"]=3,t}(),a.Format=function(){var e={},t=Object.create(e);return t[e[1]="FLOAT_1"]=1,t[e[2]="FLOAT_2"]=2,t[e[3]="FLOAT_3"]=3,t[e[4]="FLOAT_4"]=4,t[e[5]="UINT32_1"]=5,t}(),a.BufferData=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t;return e.prototype.type=0,e.prototype.format=1,e.prototype.uint8Array=null,e.prototype.uint16Array=null,e.prototype.uint32Array=null,e.prototype.float32Array=null,Object.defineProperty(e.prototype,"data",{get:o.oneOfGetter(t=["uint8Array","uint16Array","uint32Array","float32Array"]),set:o.oneOfSetter(t)}),e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.BufferData;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.type=e.int32();break;case 2:n.format=e.int32();break;case 3:n.uint8Array=a.UInt8Array.decode(e,e.uint32());break;case 4:n.uint16Array=a.UInt16Array.decode(e,e.uint32());break;case 5:n.uint32Array=a.UInt32Array.decode(e,e.uint32());break;case 6:n.float32Array=a.Float32Array.decode(e,e.uint32());break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("type"))throw o.ProtocolError("missing required 'type'",{instance:n});if(!n.hasOwnProperty("format"))throw o.ProtocolError("missing required 'format'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.BufferData)return e;var t=new a.BufferData;switch(e.type){case"POSITION":case 0:t.type=0;break;case"NORMAL":case 1:t.type=1;break;case"TEX_COORD":case 2:t.type=2;break;case"COLOR":case 3:t.type=3}switch(e.format){case"FLOAT_1":case 1:t.format=1;break;case"FLOAT_2":case 2:t.format=2;break;case"FLOAT_3":case 3:t.format=3;break;case"FLOAT_4":case 4:t.format=4;break;case"UINT32_1":case 5:t.format=5}if(null!=e.uint8Array){if("object"!=typeof e.uint8Array)throw TypeError(".BufferData.uint8Array: object expected");t.uint8Array=a.UInt8Array.fromObject(e.uint8Array)}if(null!=e.uint16Array){if("object"!=typeof e.uint16Array)throw TypeError(".BufferData.uint16Array: object expected");t.uint16Array=a.UInt16Array.fromObject(e.uint16Array)}if(null!=e.uint32Array){if("object"!=typeof e.uint32Array)throw TypeError(".BufferData.uint32Array: object expected");t.uint32Array=a.UInt32Array.fromObject(e.uint32Array)}if(null!=e.float32Array){if("object"!=typeof e.float32Array)throw TypeError(".BufferData.float32Array: object expected");t.float32Array=a.Float32Array.fromObject(e.float32Array)}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.type=t.enums===String?"POSITION":0,r.format=t.enums===String?"FLOAT_1":1),null!=e.type&&e.hasOwnProperty("type")&&(r.type=t.enums===String?a.Type[e.type]:e.type),null!=e.format&&e.hasOwnProperty("format")&&(r.format=t.enums===String?a.Format[e.format]:e.format),null!=e.uint8Array&&e.hasOwnProperty("uint8Array")&&(r.uint8Array=a.UInt8Array.toObject(e.uint8Array,t),t.oneofs&&(r.data="uint8Array")),null!=e.uint16Array&&e.hasOwnProperty("uint16Array")&&(r.uint16Array=a.UInt16Array.toObject(e.uint16Array,t),t.oneofs&&(r.data="uint16Array")),null!=e.uint32Array&&e.hasOwnProperty("uint32Array")&&(r.uint32Array=a.UInt32Array.toObject(e.uint32Array,t),t.oneofs&&(r.data="uint32Array")),null!=e.float32Array&&e.hasOwnProperty("float32Array")&&(r.float32Array=a.Float32Array.toObject(e.float32Array,t),t.oneofs&&(r.data="float32Array")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.BufferAttribute=function(){function e(e){if(this.face=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.bufferDataIndex=0,e.prototype.face=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.BufferAttribute;e.pos<r;){var s=e.uint32();switch(s>>>3){case 3:n.bufferDataIndex=e.uint32();break;case 4:if(n.face&&n.face.length||(n.face=[]),2==(7&s))for(var u=e.uint32()+e.pos;e.pos<u;)n.face.push(e.uint32());else n.face.push(e.uint32());break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("bufferDataIndex"))throw o.ProtocolError("missing required 'bufferDataIndex'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.BufferAttribute)return e;var t=new a.BufferAttribute;if(null!=e.bufferDataIndex&&(t.bufferDataIndex=e.bufferDataIndex>>>0),e.face){if(!Array.isArray(e.face))throw TypeError(".BufferAttribute.face: array expected");t.face=[];for(var r=0;r<e.face.length;++r)t.face[r]=e.face[r]>>>0}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.face=[]),t.defaults&&(r.bufferDataIndex=0),null!=e.bufferDataIndex&&e.hasOwnProperty("bufferDataIndex")&&(r.bufferDataIndex=e.bufferDataIndex),e.face&&e.face.length){r.face=[];for(var n=0;n<e.face.length;++n)r.face[n]=e.face[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.Object=function(){function e(t){if(this.bufferAttribute=[],t)for(var r=e.keys(t),n=0;n<r.length;++n)null!=t[r[n]]&&(this[r[n]]=t[r[n]])}return e.prototype.landmarkId=0,e.prototype.materialIndex=0,e.prototype.bufferAttribute=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.Object;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.landmarkId=e.int32();break;case 2:n.materialIndex=e.uint32();break;case 5:n.bufferAttribute&&n.bufferAttribute.length||(n.bufferAttribute=[]),n.bufferAttribute.push(a.BufferAttribute.decode(e,e.uint32()));break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("landmarkId"))throw o.ProtocolError("missing required 'landmarkId'",{instance:n});if(!n.hasOwnProperty("materialIndex"))throw o.ProtocolError("missing required 'materialIndex'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.Object)return e;var t=new a.Object;if(null!=e.landmarkId&&(t.landmarkId=0|e.landmarkId),null!=e.materialIndex&&(t.materialIndex=e.materialIndex>>>0),e.bufferAttribute){if(!Array.isArray(e.bufferAttribute))throw TypeError(".Object.bufferAttribute: array expected");t.bufferAttribute=[];for(var r=0;r<e.bufferAttribute.length;++r){if("object"!=typeof e.bufferAttribute[r])throw TypeError(".Object.bufferAttribute: object expected");t.bufferAttribute[r]=a.BufferAttribute.fromObject(e.bufferAttribute[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.bufferAttribute=[]),t.defaults&&(r.landmarkId=0,r.materialIndex=0),null!=e.landmarkId&&e.hasOwnProperty("landmarkId")&&(r.landmarkId=e.landmarkId),null!=e.materialIndex&&e.hasOwnProperty("materialIndex")&&(r.materialIndex=e.materialIndex),e.bufferAttribute&&e.bufferAttribute.length){r.bufferAttribute=[];for(var n=0;n<e.bufferAttribute.length;++n)r.bufferAttribute[n]=a.BufferAttribute.toObject(e.bufferAttribute[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.Geometry=function(){function e(e){if(this.bufferData=[],this.object=[],this.boundingBox=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.bufferData=o.emptyArray,e.prototype.object=o.emptyArray,e.prototype.centerLat=0,e.prototype.centerLon=0,e.prototype.elevation=0,e.prototype.boundingBox=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.Geometry;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.bufferData&&n.bufferData.length||(n.bufferData=[]),n.bufferData.push(a.BufferData.decode(e,e.uint32()));break;case 2:n.object&&n.object.length||(n.object=[]),n.object.push(a.Object.decode(e,e.uint32()));break;case 4:n.centerLat=e.int32();break;case 5:n.centerLon=e.int32();break;case 6:n.elevation=e.double();break;case 7:if(n.boundingBox&&n.boundingBox.length||(n.boundingBox=[]),2==(7&s))for(var u=e.uint32()+e.pos;e.pos<u;)n.boundingBox.push(e.double());else n.boundingBox.push(e.double());break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("centerLat"))throw o.ProtocolError("missing required 'centerLat'",{instance:n});if(!n.hasOwnProperty("centerLon"))throw o.ProtocolError("missing required 'centerLon'",{instance:n});if(!n.hasOwnProperty("elevation"))throw o.ProtocolError("missing required 'elevation'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.Geometry)return e;var t=new a.Geometry;if(e.bufferData){if(!Array.isArray(e.bufferData))throw TypeError(".Geometry.bufferData: array expected");t.bufferData=[];for(var r=0;r<e.bufferData.length;++r){if("object"!=typeof e.bufferData[r])throw TypeError(".Geometry.bufferData: object expected");t.bufferData[r]=a.BufferData.fromObject(e.bufferData[r])}}if(e.object){if(!Array.isArray(e.object))throw TypeError(".Geometry.object: array expected");t.object=[];for(r=0;r<e.object.length;++r){if("object"!=typeof e.object[r])throw TypeError(".Geometry.object: object expected");t.object[r]=a.Object.fromObject(e.object[r])}}if(null!=e.centerLat&&(t.centerLat=0|e.centerLat),null!=e.centerLon&&(t.centerLon=0|e.centerLon),null!=e.elevation&&(t.elevation=Number(e.elevation)),e.boundingBox){if(!Array.isArray(e.boundingBox))throw TypeError(".Geometry.boundingBox: array expected");t.boundingBox=[];for(r=0;r<e.boundingBox.length;++r)t.boundingBox[r]=Number(e.boundingBox[r])}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.bufferData=[],r.object=[],r.boundingBox=[]),t.defaults&&(r.centerLat=0,r.centerLon=0,r.elevation=0),e.bufferData&&e.bufferData.length){r.bufferData=[];for(var n=0;n<e.bufferData.length;++n)r.bufferData[n]=a.BufferData.toObject(e.bufferData[n],t)}if(e.object&&e.object.length){r.object=[];for(n=0;n<e.object.length;++n)r.object[n]=a.Object.toObject(e.object[n],t)}if(null!=e.centerLat&&e.hasOwnProperty("centerLat")&&(r.centerLat=e.centerLat),null!=e.centerLon&&e.hasOwnProperty("centerLon")&&(r.centerLon=e.centerLon),null!=e.elevation&&e.hasOwnProperty("elevation")&&(r.elevation=t.json&&!isFinite(e.elevation)?String(e.elevation):e.elevation),e.boundingBox&&e.boundingBox.length){r.boundingBox=[];for(n=0;n<e.boundingBox.length;++n)r.boundingBox[n]=t.json&&!isFinite(e.boundingBox[n])?String(e.boundingBox[n]):e.boundingBox[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.MeshFeature=function(){function e(e){if(this.material=[],this.geometry=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.material=o.emptyArray,e.prototype.geometry=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.MeshFeature;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.material&&n.material.length||(n.material=[]),n.material.push(a.Material.decode(e,e.uint32()));break;case 2:n.geometry&&n.geometry.length||(n.geometry=[]),n.geometry.push(a.Geometry.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.MeshFeature)return e;var t=new a.MeshFeature;if(e.material){if(!Array.isArray(e.material))throw TypeError(".MeshFeature.material: array expected");t.material=[];for(var r=0;r<e.material.length;++r){if("object"!=typeof e.material[r])throw TypeError(".MeshFeature.material: object expected");t.material[r]=a.Material.fromObject(e.material[r])}}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(".MeshFeature.geometry: array expected");t.geometry=[];for(r=0;r<e.geometry.length;++r){if("object"!=typeof e.geometry[r])throw TypeError(".MeshFeature.geometry: object expected");t.geometry[r]=a.Geometry.fromObject(e.geometry[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.material=[],r.geometry=[]),e.material&&e.material.length){r.material=[];for(var n=0;n<e.material.length;++n)r.material[n]=a.Material.toObject(e.material[n],t)}if(e.geometry&&e.geometry.length){r.geometry=[];for(n=0;n<e.geometry.length;++n)r.geometry[n]=a.Geometry.toObject(e.geometry[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.LandmarkTile=function(){function e(e){if(this.dependency=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.meshFeature=null,e.prototype.dependency=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.LandmarkTile;e.pos<r;){var s=e.uint32();switch(s>>>3){case 4:n.meshFeature=a.MeshFeature.decode(e,e.uint32());break;case 5:n.dependency&&n.dependency.length||(n.dependency=[]),n.dependency.push(a.LandmarkTile.TileDependency.decode(e,e.uint32()));break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("meshFeature"))throw o.ProtocolError("missing required 'meshFeature'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.LandmarkTile)return e;var t=new a.LandmarkTile;if(null!=e.meshFeature){if("object"!=typeof e.meshFeature)throw TypeError(".LandmarkTile.meshFeature: object expected");t.meshFeature=a.MeshFeature.fromObject(e.meshFeature)}if(e.dependency){if(!Array.isArray(e.dependency))throw TypeError(".LandmarkTile.dependency: array expected");t.dependency=[];for(var r=0;r<e.dependency.length;++r){if("object"!=typeof e.dependency[r])throw TypeError(".LandmarkTile.dependency: object expected");t.dependency[r]=a.LandmarkTile.TileDependency.fromObject(e.dependency[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.dependency=[]),t.defaults&&(r.meshFeature=null),null!=e.meshFeature&&e.hasOwnProperty("meshFeature")&&(r.meshFeature=a.MeshFeature.toObject(e.meshFeature,t)),e.dependency&&e.dependency.length){r.dependency=[];for(var n=0;n<e.dependency.length;++n)r.dependency[n]=a.LandmarkTile.TileDependency.toObject(e.dependency[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.FeatureDependency=function(){function e(e){if(this.pvid=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.pvid=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.LandmarkTile.FeatureDependency;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:if(n.pvid&&n.pvid.length||(n.pvid=[]),2==(7&o))for(var s=e.uint32()+e.pos;e.pos<s;)n.pvid.push(e.int32());else n.pvid.push(e.int32());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.LandmarkTile.FeatureDependency)return e;var t=new a.LandmarkTile.FeatureDependency;if(e.pvid){if(!Array.isArray(e.pvid))throw TypeError(".LandmarkTile.FeatureDependency.pvid: array expected");t.pvid=[];for(var r=0;r<e.pvid.length;++r)t.pvid[r]=0|e.pvid[r]}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.pvid=[]),e.pvid&&e.pvid.length){r.pvid=[];for(var n=0;n<e.pvid.length;++n)r.pvid[n]=e.pvid[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e.TileDependency=function(){function e(e){if(this.dependency=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.fromTile=0,e.prototype.dependency=o.emptyArray,e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.LandmarkTile.TileDependency;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.fromTile=e.uint32();break;case 2:n.dependency&&n.dependency.length||(n.dependency=[]),n.dependency.push(a.LandmarkTile.FeatureDependency.decode(e,e.uint32()));break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("fromTile"))throw o.ProtocolError("missing required 'fromTile'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof a.LandmarkTile.TileDependency)return e;var t=new a.LandmarkTile.TileDependency;if(null!=e.fromTile&&(t.fromTile=e.fromTile>>>0),e.dependency){if(!Array.isArray(e.dependency))throw TypeError(".LandmarkTile.TileDependency.dependency: array expected");t.dependency=[];for(var r=0;r<e.dependency.length;++r){if("object"!=typeof e.dependency[r])throw TypeError(".LandmarkTile.TileDependency.dependency: object expected");t.dependency[r]=a.LandmarkTile.FeatureDependency.fromObject(e.dependency[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.dependency=[]),t.defaults&&(r.fromTile=0),null!=e.fromTile&&e.hasOwnProperty("fromTile")&&(r.fromTile=e.fromTile),e.dependency&&e.dependency.length){r.dependency=[];for(var n=0;n<e.dependency.length;++n)r.dependency[n]=a.LandmarkTile.FeatureDependency.toObject(e.dependency[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e}(),e.exports=a},function(e,t,r){"use strict";var n=t;function i(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=r(86),n.BufferWriter=r(177),n.Reader=r(87),n.BufferReader=r(178),n.util=r(7),n.rpc=r(179),n.roots=r(181),n.configure=i,n.Writer._configure(n.BufferWriter),i()},function(e,t,r){"use strict";e.exports=function(e,t){var r=new Array(arguments.length-1),n=0,i=2,o=!0;for(;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,a(e))}})}},function(e,t,r){"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=new Array(64),o=new Array(123),a=0;a<64;)o[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,r){for(var n,o=null,a=[],s=0,u=0;t<r;){var l=e[t++];switch(u){case 0:a[s++]=i[l>>2],n=(3&l)<<4,u=1;break;case 1:a[s++]=i[n|l>>4],n=(15&l)<<2,u=2;break;case 2:a[s++]=i[n|l>>6],a[s++]=i[63&l],u=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return u&&(a[s++]=i[n],a[s++]=61,1===u&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};n.decode=function(e,t,r){for(var n,i=r,a=0,s=0;s<e.length;){var u=e.charCodeAt(s++);if(61===u&&a>1)break;if(void 0===(u=o[u]))throw Error("invalid encoding");switch(a){case 0:n=u,a=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,a=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,a=3;break;case 3:t[r++]=(3&n)<<6|u,a=0}}if(1===a)throw Error("invalid encoding");return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,r){"use strict";function n(){this._listeners={}}e.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},function(e,t,r){"use strict";function n(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function s(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?a:s,e.readFloatBE=n?s:a}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>3.4028234663852886e38)e((i<<31|2139095040)>>>0,r,n);else if(t<1.1754943508222875e-38)e((i<<31|Math.round(t/1.401298464324817e-45))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,a=8388607&n;return 255===o?a?NaN:i*(1/0):0===o?1.401298464324817e-45*i*a:i*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function s(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?a:s,e.readDoubleBE=n?s:a}():function(){function t(e,t,r,n,i,o){var a=n<0?1:0;if(a&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>1.7976931348623157e308)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+r);else{var s;if(n<2.2250738585072014e-308)e((s=n/5e-324)>>>0,i,o+t),e((a<<31|s/4294967296)>>>0,i,o+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(s=n*Math.pow(2,-u))>>>0,i,o+t),e((a<<31|u+1023<<20|1048576*s&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),a=e(n,i+r),s=2*(a>>31)+1,u=a>>>20&2047,l=4294967296*(1048575&a)+o;return 2047===u?l?NaN:s*(1/0):0===u?5e-324*s*l:s*Math.pow(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,s,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=n(n)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){"use strict";var n=t;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],a=0;t<r;)(n=e[t++])<128?o[a++]=n:n>191&&n<224?o[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(n>>10),o[a++]=56320+(1023&n)):o[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},n.write=function(e,t,r){for(var n,i,o=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=r||8192,i=n>>>1,o=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(o=e(n),a=0);var s=t.call(o,a,a+=r);return 7&a&&(a=1+(7|a)),s}}},function(e,t,r){"use strict";e.exports=i;var n=r(7);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?o:new i((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){"use strict";e.exports=a;var n=r(86);(a.prototype=Object.create(n.prototype)).constructor=a;var i=r(7),o=i.Buffer;function a(){n.call(this)}a.alloc=function(e){return(a.alloc=i._Buffer_allocUnsafe)(e)};var s=o&&o.prototype instanceof Uint8Array&&"set"===o.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]};function u(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write(e,r)}a.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s,t,e),this},a.prototype.string=function(e){var t=o.byteLength(e);return this.uint32(t),t&&this._push(u,t,e),this}},function(e,t,r){"use strict";e.exports=o;var n=r(87);(o.prototype=Object.create(n.prototype)).constructor=o;var i=r(7);function o(e){n.call(this,e)}i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice),o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},function(e,t,r){"use strict";t.Service=r(180)},function(e,t,r){"use strict";e.exports=i;var n=r(7);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return n.asPromise(e,s,t,r,i,o);if(s.rpcImpl)try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(e,r){if(e)return s.emit("error",e,t),a(e);if(null!==r){if(!(r instanceof i))try{r=i[s.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return s.emit("error",e,t),a(e)}return s.emit("data",r,t),a(null,r)}s.end(!0)})}catch(e){return s.emit("error",e,t),void setTimeout(function(){a(e)},0)}else setTimeout(function(){a(Error("already ended"))},0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LANDMARK_TILE_DECODER_SERVICE_ID="landmark-tile-decoder",t.DEFAULT_LANDMARK_DECODER_OPTIONS={gatherFeatureIds:!1,renderTextures:!1,enableDepthPrePass:!0,materialAlphaTest:.35,materialTransparent:!1,materialDepthTest:!0,materialOpacity:.8}},function(e,t,r){var n,i,o;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */i=[],void 0===(o="function"==typeof(n=function(){"use strict";function e(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var r={},n={};function i(e,t){var i,o,s;return t?(s=0<=(e>>>=0)&&e<256)&&(o=n[e])?o:(i=a(e,(0|e)<0?-1:0,!0),s&&(n[e]=i),i):(s=-128<=(e|=0)&&e<128)&&(o=r[e])?o:(i=a(e,e<0?-1:0,!1),s&&(r[e]=i),i)}function o(e,t){if(isNaN(e)||!isFinite(e))return t?m:p;if(t){if(e<0)return m;if(e>=d)return _}else{if(e<=-h)return x;if(e+1>=h)return b}return e<0?o(-e,t).neg():a(e%c|0,e/c|0,t)}function a(t,r,n){return new e(t,r,n)}e.fromInt=i,e.fromNumber=o,e.fromBits=a;var s=Math.pow;function u(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return p;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return u(e.substring(1),t,r).neg();for(var i=o(s(r,8)),a=p,l=0;l<e.length;l+=8){var c=Math.min(8,e.length-l),d=parseInt(e.substring(l,l+c),r);if(c<8){var h=o(s(r,c));a=a.mul(h).add(o(d))}else a=(a=a.mul(i)).add(o(d))}return a.unsigned=t,a}function l(t){return t instanceof e?t:"number"==typeof t?o(t):"string"==typeof t?u(t):a(t.low,t.high,t.unsigned)}e.fromString=u,e.fromValue=l;var c=4294967296,d=c*c,h=d/2,f=i(1<<24),p=i(0);e.ZERO=p;var m=i(0,!0);e.UZERO=m;var y=i(1);e.ONE=y;var v=i(1,!0);e.UONE=v;var g=i(-1);e.NEG_ONE=g;var b=a(-1,2147483647,!1);e.MAX_VALUE=b;var _=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=_;var x=a(0,-2147483648,!1);e.MIN_VALUE=x;var w=e.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*c+(this.low>>>0):this.high*c+(this.low>>>0)},w.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var t=o(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=o(s(e,6),this.unsigned),a=this,u="";;){var l=a.div(i),c=(a.sub(l.mul(i)).toInt()>>>0).toString(e);if((a=l).isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1==(1&this.low)},w.isEven=function(){return 0==(1&this.low)},w.equals=function(e){return t(e)||(e=l(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},w.eq=w.equals,w.notEquals=function(e){return!this.eq(e)},w.neq=w.notEquals,w.lessThan=function(e){return this.comp(e)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(e){return this.comp(e)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(e){return this.comp(e)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(e){return this.comp(e)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(e){if(t(e)||(e=l(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(y)},w.neg=w.negate,w.add=function(e){t(e)||(e=l(e));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,u=65535&e.high,c=e.low>>>16,d=0,h=0,f=0,p=0;return f+=(p+=o+(65535&e.low))>>>16,h+=(f+=i+c)>>>16,d+=(h+=n+u)>>>16,d+=r+s,a((f&=65535)<<16|(p&=65535),(d&=65535)<<16|(h&=65535),this.unsigned)},w.subtract=function(e){return t(e)||(e=l(e)),this.add(e.neg())},w.sub=w.subtract,w.multiply=function(e){if(this.isZero())return p;if(t(e)||(e=l(e)),e.isZero())return p;if(this.eq(x))return e.isOdd()?x:p;if(e.eq(x))return this.isOdd()?x:p;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(f)&&e.lt(f))return o(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,s=65535&this.low,u=e.high>>>16,c=65535&e.high,d=e.low>>>16,h=65535&e.low,m=0,y=0,v=0,g=0;return v+=(g+=s*h)>>>16,y+=(v+=i*h)>>>16,v&=65535,y+=(v+=s*d)>>>16,m+=(y+=n*h)>>>16,y&=65535,m+=(y+=i*d)>>>16,y&=65535,m+=(y+=s*c)>>>16,m+=r*h+n*d+i*c+s*u,a((v&=65535)<<16|(g&=65535),(m&=65535)<<16|(y&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(e){if(t(e)||(e=l(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?m:p;var r,n,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return m;if(e.gt(this.shru(1)))return v;i=m}else{if(this.eq(x))return e.eq(y)||e.eq(g)?x:e.eq(x)?y:(r=this.shr(1).div(e).shl(1)).eq(p)?e.isNegative()?y:g:(n=this.sub(e.mul(r)),i=r.add(n.div(e)));if(e.eq(x))return this.unsigned?m:p;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=p}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),u=a<=48?1:s(2,a-48),c=o(r),d=c.mul(e);d.isNegative()||d.gt(n);)d=(c=o(r-=u,this.unsigned)).mul(e);c.isZero()&&(c=y),i=i.add(c),n=n.sub(d)}return i},w.div=w.divide,w.modulo=function(e){return t(e)||(e=l(e)),this.sub(this.div(e).mul(e))},w.mod=w.modulo,w.not=function(){return a(~this.low,~this.high,this.unsigned)},w.and=function(e){return t(e)||(e=l(e)),a(this.low&e.low,this.high&e.high,this.unsigned)},w.or=function(e){return t(e)||(e=l(e)),a(this.low|e.low,this.high|e.high,this.unsigned)},w.xor=function(e){return t(e)||(e=l(e)),a(this.low^e.low,this.high^e.high,this.unsigned)},w.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):a(0,this.low<<e-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):a(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0==(e&=63))return this;var r=this.high;return e<32?a(this.low>>>e|r<<32-e,r>>>e,this.unsigned):a(32===e?r:r>>>e-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},w.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},w.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e})?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i,o=r(2),a=r(27),s=r(1),u=r(83),l=r(0),c=r(37),d=r(36),h=Math.pow(2,16),f=s.LoggerManager.instance.create("OmvDecodedTileEmitter"),p=function(){function e(e){this.type=e,this.positions=[],this.colors=[],this.indices=[],this.edgeIndices=[],this.outlineIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.featureIds=[],this.featureStarts=[]}return e.prototype.addText=function(e){var t=this.stringCatalog.indexOf(e);return t<0&&(t=this.stringCatalog.length,this.stringCatalog.push(e)),t},e}();!function(e){e[e.Simple=0]="Simple",e[e.Complex=1]="Complex"}(i=t.LineType||(t.LineType={}));var m=function(){function e(e,t,r,n){this.m_decodeInfo=e,this.m_evaluator=t,this.m_gatherFeatureIds=r,this.m_languages=n,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_poiGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_dashedLines=[],this.m_geometryCommands=new c.GeometryCommands,this.m_currEdgeStart=new l.Vector2,this.m_currEdgeGoal=new l.Vector2,this.m_prevEdgeStart=new l.Vector2,this.m_prevEdgeGoal=new l.Vector2,this.m_tmpOutlineIndices=[]}return e.computeLineLengthSqr=function(e){for(var t=0,r=e.length-3,n=0;n<r;n+=2){var i=e[n+2]-e[n],o=e[n+3]-e[n+1];t+=i*i+o*o}return t},e.prototype.processPointFeature=function(e,t,r,i,a){var s=this;if(t.geometry){var u,h,f=t.geometry,p=new l.Vector3,m=function(t){if(void 0===t)return"continue";var n=t._index;if(void 0===n)throw new Error("OmvDecodedTileEmitter#processPointFeature: Internal error - No technique index");var i=y.findOrCreateMeshBuffers(n,o.GeometryType.Point);if(void 0===i)return"continue";var u,l=i.positions,h=i.texts,m=i.featureIds,v=i.imageTextures,g="text"===t.name||"labeled-icon"===t.name,b="labeled-icon"===t.name;if(b){var _=t;if(u=_.imageTexture,"string"==typeof _.imageTextureField){var x=r.lookup(_.imageTextureField);u=x,"string"==typeof _.imageTexturePrefix&&(u=_.imageTexturePrefix+u),"string"==typeof _.imageTexturePostfix&&(u+=_.imageTexturePostfix)}}y.m_geometryCommands.accept(f,y.m_decodeInfo.tileKey,y.m_decodeInfo.geoBox,e.extent,{visitCommand:function(e){if(c.isMoveToCommand(e)){var n=s.m_decodeInfo.projection.projectPoint(e,p).sub(s.m_decodeInfo.center),o=n.x,f=n.y;if(g){var y=t,_=y.label,x=y.useAbbreviation,w=y.useIsoCode,T="string"==typeof _?r.lookup(_):d.OmvDecoder.getFeatureName(r,x,w,s.m_languages);T&&"string"==typeof T?(h.push(i.addText(T)),l.push(o,f,0)):h.push(-1)}else l.push(o,f,0);s.m_gatherFeatureIds&&m.push(a),b&&(void 0===u?v.push(-1):v.push(i.addText(u)))}}})},y=this;try{for(var v=n(i),g=v.next();!g.done;g=v.next()){m(g.value)}}catch(e){u={error:e}}finally{try{g&&!g.done&&(h=v.return)&&h.call(v)}finally{if(u)throw u.error}}}},e.prototype.processLineFeature=function(t,r,s,u,h){var p=this;if(r.geometry){var m,y=[],v=new l.Vector3;this.m_geometryCommands.accept(r.geometry,this.m_decodeInfo.tileKey,this.m_decodeInfo.geoBox,t.extent,{visitCommand:function(e){c.isMoveToCommand(e)?(p.m_decodeInfo.projection.projectPoint(e,v).sub(p.m_decodeInfo.center),m=[v.x,v.y],y.push(m)):c.isLineToCommand(e)&&(p.m_decodeInfo.projection.projectPoint(e,v).sub(p.m_decodeInfo.center),m.push(v.x,v.y))}});var g,b,_=this.m_decodeInfo.tileKey.level>=11,x=function(t){if(void 0===t)return"continue";var r=t._index;if(void 0===r)throw new Error("OmvDecodedTileEmitter#processLineFeature: Internal error - No technique idx");var u,l,c,m,v=t.name;if("line"===v)O(w.m_simpleLines,t,r,w.m_gatherFeatureIds,i.Simple);else if("solid-line"===v)O(w.m_solidLines,t,r,w.m_gatherFeatureIds,i.Complex);else if("dashed-line"===v)O(w.m_dashedLines,t,r,w.m_gatherFeatureIds,i.Complex);else if("text"===v||"line-marker"===v){var g=t,b=g.label,x=g.useAbbreviation,T=g.useIsoCode,S="string"==typeof b?s.lookup(b):d.OmvDecoder.getFeatureName(s,x,T,w.m_languages);if("text"===v){if(void 0===S)return"continue";try{for(var E=n(y),P=E.next();!P.done;P=E.next()){var C=P.value,A=e.computeLineLengthSqr(C);w.m_textPathGeometries.push({technique:r,path:C,pathLengthSqr:A,text:String(S),featureId:h})}}catch(e){u={error:e}}finally{try{P&&!P.done&&(l=E.return)&&l.call(E)}finally{if(u)throw u.error}}}else{var I=t,M=I.imageTexture;if("string"==typeof I.imageTextureField)M=s.lookup(I.imageTextureField),"string"==typeof I.imageTexturePrefix&&(M=I.imageTexturePrefix+M),"string"==typeof I.imageTexturePostfix&&(M+=I.imageTexturePostfix);try{for(var L=n(y),j=L.next();!j.done;j=L.next()){C=j.value;w.m_poiGeometries.push({technique:r,positions:{name:"position",type:"float",buffer:new Float32Array(C).buffer,itemCount:2},texts:[0],stringCatalog:[String(S),M],imageTextures:[1],featureId:h})}}catch(e){c={error:e}}finally{try{j&&!j.done&&(m=L.return)&&m.call(L)}finally{if(c)throw c.error}}}}else if("extruded-line"===v){var F=w.findOrCreateMeshBuffers(r,o.GeometryType.ExtrudedLine);if(void 0===F)return"continue";var R=F.positions,D=F.indices,B=F.groups,U=F.featureIds,k=F.featureStarts,G=D.length,V=t,q=o.getPropertyValue(V.lineWidth,w.m_decodeInfo.tileKey.level);if(void 0===q)return"continue";var N=_&&(void 0===V.caps||"Circle"===V.caps);y.forEach(function(e){a.triangulateLine(e,q,R,D,N),p.m_gatherFeatureIds&&U&&k&&(U.push(h),k.push(G))});var z=D.length-G;B.push({start:G,count:z,technique:r,featureId:h})}else f.warn("OmvDecodedTileEmitter#processLineFeature: Invalid line technique\n                     "+v+" for layer: "+s.entries.$layer+" ")},w=this;try{for(var T=n(u),S=T.next();!S.done;S=T.next()){x(S.value)}}catch(e){g={error:e}}finally{try{S&&!S.done&&(b=T.return)&&b.call(T)}finally{if(g)throw g.error}}}function O(e,t,r,n,u){void 0===u&&(u=i.Complex);var l,c=t.renderOrderBiasProperty?s.lookup(t.renderOrderBiasProperty):0,d=e.find(function(e){return e.technique===r&&e.renderOrderOffset===c});if(void 0===d){l=new a.Lines;var f={type:u===i.Complex?o.GeometryType.SolidLine:o.GeometryType.Line,technique:r,renderOrderOffset:void 0!==c?Number(c):void 0,lines:l};n&&(f.featureIds=!0===t.transient?void 0:[h],f.featureStarts=!0===t.transient?void 0:[0]),e.push(f)}else l=d.lines,n&&d.featureIds&&d.featureStarts&&(d.featureIds.push(h),d.featureStarts.push(l.indices.length));y.forEach(function(e){l.add(e,u===i.Simple)})}},e.prototype.processPolygonFeature=function(e,t,r,n,i){var a=this;if(t.geometry){var s=n[0]._index;if(void 0===s)throw new Error("OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index");var h=this.findOrCreateMeshBuffers(s,o.GeometryType.Polygon);if(void 0!==h){var p=h.positions,m=h.colors,y=h.indices,v=h.edgeIndices,g=h.outlineIndices,b=h.groups,_=n[0],x=_,w=_;if(void 0!==_){var T,S=new l.Vector3,O=new Array;this.m_geometryCommands.accept(t.geometry,this.m_decodeInfo.tileKey,this.m_decodeInfo.geoBox,e.extent,{visitCommand:function(e){if(c.isMoveToCommand(e)){var t=a.m_decodeInfo.projection.projectPoint(e,S).sub(a.m_decodeInfo.center),r=t.x,n=t.y;T=[r,n]}else if(c.isLineToCommand(e)){var i=a.m_decodeInfo.projection.projectPoint(e,S).sub(a.m_decodeInfo.center);r=i.x,n=i.y;T.push(r,n)}else c.isClosePathCommand(e)&&O.push(new d.Ring(T))}});var E=0,P=0,C="extruded-polygon"===_.name&&"true"===r.lookup("extrude"),A="fill"===_.name,I=new l.Color(16711680);if(C){var M=new l.Vector3;this.m_decodeInfo.tileBounds.getCenter(M),M.x+=O[0].contour[0],M.y+=O[0].contour[1];var L=this.m_decodeInfo.projection.getScaleFactor(M);E=r.lookup("min_height")*L,P=r.lookup("height")*L}var j=y.length,F=p.length,R=new l.Box3;this.m_decodeInfo.projection.projectBox(this.m_decodeInfo.geoBox,R);for(var D,B=R.max.sub(this.m_decodeInfo.center).x,U=void 0!==x.maxSlope?x.maxSlope:.9,k=void 0===x.footprint||x.footprint,G=void 0!==x.lineWidth?x.lineWidth:0,V=o.getPropertyValue(w.lineWidth,this.m_decodeInfo.tileKey.level),q=0;q<O.length;){var N=p.length/3,z=D=O[q++].contour;C&&this.addExtrudedWalls(y,N,D,G>0,v,B,k,U),void 0!==V&&V>0&&A&&this.addOutlineEdges(y,N,D,B,g);for(var H=[];q<O.length&&O[q].isInnerRing;++q){H.push(z.length/2),D=O[q].contour;var W=z.length,X=z.length/2;if(z=z.concat(D),C&&this.addExtrudedWalls(y,W+N,D,G>0,v,B,k,U),void 0!==V&&V>0&&A){var Q=N+X;this.addOutlineEdges(y,Q,D,B,g)}}try{for(var Y=u.default(z,H),K=0;K<z.length;K+=2)p.push(z[K],z[K+1],E),C&&p.push(z[K],z[K+1],P);var Z=C?2:1;for(K=0;K<Y.length;K+=3){var J=N+Y[K+0]*Z,$=N+Y[K+1]*Z,ee=N+Y[K+2]*Z;if(y.push(J,$,ee),C){var te=N+Y[K+0]*Z+1,re=N+Y[K+1]*Z+1,ne=N+Y[K+2]*Z+1;y.push(te,re,ne)}}}catch(e){f.error("cannot triangulate geometry",e)}}0!==this.m_tmpOutlineIndices.length&&(g.push(this.m_tmpOutlineIndices),this.m_tmpOutlineIndices=[]);var ie=(p.length-F)/3,oe=y.length-j;if("extruded-polygon"===_.name){var ae=r.lookup("color"),se="string"==typeof ae?new l.Color(ae):I;for(K=0;K<ie;++K)m.push(se.r,se.g,se.b)}oe>0&&b.push({start:j,count:oe,technique:s,featureId:i})}}}},e.prototype.getDecodedTile=function(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines),this.processLines(this.m_dashedLines);var e={techniques:this.m_evaluator.techniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(e.textGeometries=this.m_textGeometries),this.m_poiGeometries.length>0&&(e.poiGeometries=this.m_poiGeometries),this.m_textPathGeometries.length>0&&(e.textPathGeometries=this.m_textPathGeometries),e},e.prototype.addExtrudedWalls=function(e,t,r,n,i,o,a,s){for(var u=0;u<r.length;u+=2){var l=t+u,c=t+u+1,d=t+(u+2)%r.length,h=t+(u+3)%r.length;if(e.push(l,c,h,h,d,l),n){var f=r[u],p=r[u+1],m=r[(u+2)%r.length],y=r[(u+3)%r.length];Math.abs(f)<o&&Math.abs(p)<o?(a&&i.push(l,d),i.push(c,h),0!==u?(this.m_currEdgeStart.set(f,p),this.m_currEdgeGoal.set(m,y),this.m_prevEdgeStart.set(r[u-2],r[u-1]),this.m_prevEdgeGoal.set(this.m_currEdgeStart.x,this.m_currEdgeStart.y),this.m_prevEdgeGoal.sub(this.m_prevEdgeStart).normalize().dot(this.m_currEdgeGoal.sub(this.m_currEdgeStart).normalize())<=s&&i.push(l,c)):s>0&&i.push(l,c)):Math.abs(m)<o&&Math.abs(y)<o?(a&&i.push(l,d),i.push(c,h)):Math.abs(f)>=o&&Math.abs(p)<o&&Math.abs(y)>=o&&Math.abs(m)<o?(a&&i.push(l,d),i.push(c,h)):Math.abs(p)>=o&&Math.abs(f)<o&&Math.abs(m)>=o&&Math.abs(y)<o&&(a&&i.push(l,d),i.push(c,h))}}},e.prototype.addOutlineEdges=function(e,t,r,n,i){for(var o=0;o<r.length;o+=2){var a=t+o/2,s=t+(o+2)%r.length/2;this.m_tmpOutlineIndices.length>h&&(i.push(this.m_tmpOutlineIndices),this.m_tmpOutlineIndices=[]),this.addOutlineEdge(this.m_tmpOutlineIndices,r,o,a,s,n)}},e.prototype.addOutlineEdge=function(e,t,r,n,i,o){var a=t[r],s=t[r+1],u=t[(r+2)%t.length],l=t[(r+3)%t.length];Math.abs(a)<o&&Math.abs(s)<o?e.push(n,i):Math.abs(u)<o&&Math.abs(l)<o?e.push(n,i):Math.abs(a)>=o&&Math.abs(s)<o&&Math.abs(l)>=o&&Math.abs(u)<o?e.push(n,i):Math.abs(s)>=o&&Math.abs(a)<o&&Math.abs(u)>=o&&Math.abs(l)<o&&e.push(n,i)},e.prototype.createGeometries=function(){var e=this;this.m_meshBuffers.forEach(function(t,r){if(0!==t.positions.length){if(!e.m_evaluator.techniques||e.m_evaluator.techniques.length<=r)throw new Error("Invalid technique index");var i=e.m_evaluator.techniques[r];if(void 0!==i){var o=new Float32Array(t.positions);if(t.texts.length>0&&"text"===i.name)e.m_textGeometries.push({positions:{name:"position",type:"float",buffer:o.buffer,itemCount:3},texts:t.texts,technique:r,featureId:t.featureIds?t.featureIds[0]:void 0,stringCatalog:t.stringCatalog});else if(t.texts.length>0&&"labeled-icon"===i.name)e.m_poiGeometries.push({positions:{name:"position",type:"float",buffer:o.buffer,itemCount:3},texts:t.texts,technique:r,featureId:t.featureIds?t.featureIds[0]:void 0,stringCatalog:t.stringCatalog,imageTextures:t.imageTextures});else{0===t.groups.length&&t.groups.push({start:0,count:o.length/3,technique:r});var a,s,u={type:t.type,vertexAttributes:[{name:"position",buffer:o.buffer,itemCount:3,type:"float"}],groups:t.groups};if(t.colors.length>0){var l=new Float32Array(t.colors);if(l.length!==o.length)throw new Error("length of colors buffer is different than the length of the position buffer");u.vertexAttributes.push({name:"color",buffer:l.buffer,itemCount:3,type:"float"})}if(t.indices.length>0&&(u.index={name:"index",buffer:new Uint32Array(t.indices).buffer,itemCount:1,type:"uint32"}),t.edgeIndices.length>0&&(u.edgeIndex={name:"edgeIndex",buffer:new Uint32Array(t.edgeIndices).buffer,itemCount:1,type:"uint32"}),e.m_gatherFeatureIds&&(u.featureIds=t.featureIds,u.featureStarts=t.featureStarts),t.outlineIndices.length>0){void 0===u.outlineIndicesAttributes&&(u.outlineIndicesAttributes=[]);try{for(var c=n(t.outlineIndices),d=c.next();!d.done;d=c.next()){var h=d.value;u.outlineIndicesAttributes.push({name:"edgeIndicesArray",buffer:new Uint32Array(h).buffer,itemCount:1,type:"uint32"})}}catch(e){a={error:e}}finally{try{d&&!d.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}}e.m_geometries.push(u)}}}})},e.prototype.processLines=function(e){var t=this;e.forEach(function(e){var r=e.lines,n=r.vertices,i=r.indices,s=e.renderOrderOffset,u=e.technique,l=new Float32Array(n).buffer,c=new Uint32Array(i).buffer,d={type:"float",stride:12,buffer:l,attributes:a.LINE_VERTEX_ATTRIBUTE_DESCRIPTORS},h={type:o.GeometryType.SolidLine,index:{buffer:c,itemCount:1,type:"uint32",name:"index"},interleavedVertexAttributes:[d],groups:[{start:0,count:i.length,technique:u,renderOrderOffset:s}],vertexAttributes:[]};t.m_gatherFeatureIds&&(h.featureIds=e.featureIds,h.featureStarts=e.featureStarts),t.m_geometries.push(h)})},e.prototype.processSimpleLines=function(e){var t=this;e.forEach(function(e){var r=e.lines,n=r.vertices,i=r.indices,a=e.renderOrderOffset,s=e.technique,u=new Float32Array(n).buffer,l=new Uint32Array(i).buffer,c={buffer:u,itemCount:3,type:"float",name:"position"},d={type:o.GeometryType.Line,index:{buffer:l,itemCount:1,type:"uint32",name:"index"},vertexAttributes:[c],groups:[{start:0,count:i.length,technique:s,renderOrderOffset:a}]};t.m_gatherFeatureIds&&(d.featureIds=e.featureIds,d.featureStarts=e.featureStarts),t.m_geometries.push(d)})},e.prototype.findOrCreateMeshBuffers=function(e,t){var r=this.m_meshBuffers.get(e);return void 0!==r?r.type!==t?void f.error('MeshBuffer has been created with wrong type "'+o.GeometryType[t]+'"\n                instead of "'+o.GeometryType[r.type]+'"'):r:(r=new p(t),this.m_meshBuffers.set(e,r),r)},e}();t.OmvDecodedTileEmitter=m},function(e,t,r){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=r(0),a=r(37),s=r(36),u=function(){function e(e,t,r,n,o){this.m_decodeInfo=e,this.m_evaluator=t,this.m_storeExtendedTags=r,this.m_gatherRoadSegments=n,this.m_languages=o,this.geometryCommands=new a.GeometryCommands,this.m_tileInfo=new i.ExtendedTileInfo(e.tileKey,this.m_storeExtendedTags),this.m_tileInfoWriter=new i.ExtendedTileInfoWriter(this.m_tileInfo,this.m_storeExtendedTags,this.m_languages)}return e.prototype.processPointFeature=function(e,t,r,i,s){var u=this;if(t.geometry){var l,c,d=new o.Vector3,h=this.m_tileInfoWriter,f=function(n){if(void 0===n)return"continue";var i=h.addTechnique(n);p.geometryCommands.accept(t.geometry,p.m_decodeInfo.tileKey,p.m_decodeInfo.geoBox,e.extent,{visitCommand:function(e){if(a.isMoveToCommand(e)){var t=u.m_decodeInfo.projection.projectPoint(e,d).sub(u.m_decodeInfo.center),o=t.x,l=t.y;h.addFeature(u.m_tileInfo.pointGroup,n,r,s,i,!1),h.addFeaturePoint(u.m_tileInfo.pointGroup,o,l)}}})},p=this;try{for(var m=n(i),y=m.next();!y.done;y=m.next()){f(y.value)}}catch(e){l={error:e}}finally{try{y&&!y.done&&(c=m.return)&&c.call(m)}finally{if(l)throw l.error}}}},e.prototype.processLineFeature=function(e,t,r,i,s){var u=this;if(t.geometry){var l,c,d,h,f,p=this.m_tileInfoWriter,m=[],y=new o.Vector3;this.geometryCommands.accept(t.geometry,this.m_decodeInfo.tileKey,this.m_decodeInfo.geoBox,e.extent,{visitCommand:function(e){a.isMoveToCommand(e)?(u.m_decodeInfo.projection.projectPoint(e,y).sub(u.m_decodeInfo.center),l=[y.x,y.y],m.push(l)):a.isLineToCommand(e)&&(u.m_decodeInfo.projection.projectPoint(e,y).sub(u.m_decodeInfo.center),l.push(y.x,y.y))}});try{for(var v=n(i),g=v.next();!g.done;g=v.next()){var b=g.value;if(void 0!==b){var _=p.addTechnique(b);try{for(var x=n(m),w=x.next();!w.done;w=x.next()){var T=w.value;p.addFeature(this.m_tileInfo.lineGroup,b,r,s,_,!1),p.addFeaturePoints(this.m_tileInfo.lineGroup,T)}}catch(e){h={error:e}}finally{try{w&&!w.done&&(f=x.return)&&f.call(x)}finally{if(h)throw h.error}}}}}catch(e){c={error:e}}finally{try{g&&!g.done&&(d=v.return)&&d.call(v)}finally{if(c)throw c.error}}if(this.m_gatherRoadSegments){var S=r.lookup("segmentId");if(void 0!==S){var O=r.lookup("startOffset"),E=r.lookup("endOffset");p.addRoadSegments(this.m_tileInfo.lineGroup,S,void 0!==O?O:0,void 0!==E?E:1)}}}},e.prototype.processPolygonFeature=function(e,t,r,i,u){var l=this;if(t.geometry){if(0===i.length)throw new Error("OmvTileInfoEmitter#processPolygonFeature: Internal error - No technique index");var c,d,h,f,p,m=this.m_tileInfoWriter,y=new o.Vector3,v=new Array;this.geometryCommands.accept(t.geometry,this.m_decodeInfo.tileKey,this.m_decodeInfo.geoBox,e.extent,{visitCommand:function(e){if(a.isMoveToCommand(e)){var t=l.m_decodeInfo.projection.projectPoint(e,y).sub(l.m_decodeInfo.center),r=t.x,n=t.y;c=[r,n]}else if(a.isLineToCommand(e)){var i=l.m_decodeInfo.projection.projectPoint(e,y).sub(l.m_decodeInfo.center);r=i.x,n=i.y;c.push(r,n)}else a.isClosePathCommand(e)&&v.push(new s.Ring(c))}});try{for(var g=n(i),b=g.next();!b.done;b=g.next()){var _=b.value;if(void 0!==_){var x=m.addTechnique(_);m.addFeature(this.m_tileInfo.polygonGroup,_,r,u,x,!0)}}}catch(e){d={error:e}}finally{try{b&&!b.done&&(h=g.return)&&h.call(g)}finally{if(d)throw d.error}}try{for(var w=n(v),T=w.next();!T.done;T=w.next()){var S=T.value;m.addRingPoints(this.m_tileInfo.polygonGroup,S.contour,S.isOuterRing)}}catch(e){f={error:e}}finally{try{T&&!T.done&&(p=w.return)&&p.call(w)}finally{if(f)throw f.error}}}},e.prototype.getTileInfo=function(){return this.m_tileInfoWriter.finish(),this.m_tileInfo},e}();t.OmvTileInfoEmitter=u},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(89),a=i.LoggerManager.instance.create("OmvTomTomFeatureModifier"),s=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.doProcessFeature=function(t,r,n,i,o){return this.rewriteEnvironment(n,i),e.prototype.doProcessFeature.call(this,t,r,n,i,o)},t.prototype.rewriteEnvironment=function(e,t){this.isWood(e)?this.updateEnvironment(t,"landuse","wood"):this.isHospital(e)?this.updateEnvironment(t,"landuse","hospital"):this.isCemetery(e)?this.updateEnvironment(t,"landuse","cemetery"):this.isIndustrial(e)?this.updateEnvironment(t,"landuse","industrial"):this.isPark(e)?this.updateEnvironment(t,"landuse","park"):this.isBuiltup(e)?this.updateEnvironment(t,"landuse","builtup"):this.isWater(e)?this.updateEnvironment(t,"water"):this.isRoadLabel(e)?this.updateEnvironment(t,"road_label"):this.isRoadPath(e)?this.updateEnvironment(t,"road","path"):this.isRoadStreet(e)?this.updateEnvironment(t,"road","street"):this.isRoadPrimary(e)?this.updateEnvironment(t,"road","primary"):this.isRoadSecondary(e)?this.updateEnvironment(t,"road","secondary"):this.isRailway(e)?this.updateEnvironment(t,"road","major_rail"):this.isFerry(e)?this.updateEnvironment(t,"road","ferry"):this.isAeroway(e)?this.updateEnvironment(t,"aeroway"):this.isBorder(e)?this.updateEnvironment(t,"admin"):this.isCountryLabel(e)?this.updateEnvironment(t,"country_label"):this.isCountyLabel(e)?this.updateEnvironment(t,"county_label"):this.isRegionLabel(e)?this.updateEnvironment(t,"region_label"):this.isStateLabel(e)?this.updateEnvironment(t,"state_label"):this.isPlaceLabel(e)?this.updateEnvironment(t,"place_label"):this.isWaterLabel(e)?this.updateEnvironment(t,"water_label"):this.isMarineLabel(e)?this.updateEnvironment(t,"marine_label"):this.isPoiLabel(e)?this.updateEnvironment(t,"poi_label"):this.isBuilding(e)?(this.updateEnvironment(t,"building"),t.entries.color="#AAAAAA",t.entries.extrude="true",t.entries.min_height="2",t.entries.height="20"):a.info("Not yet rewritten layer: ##"+t.entries.$layer+"## "),this.isTunnel(e)&&(t.entries.structure="tunnel"),this.isBridge(e)&&(t.entries.structure="bridge")},t.prototype.updateEnvironment=function(e,t,r,n){e.entries.$layer=t,void 0!==r&&(e.entries.class=r),void 0!==n&&(e.entries.structure=n)},t.prototype.isWood=function(e){return"Woodland"===e.name||"Moor or heathland"===e.name},t.prototype.isHospital=function(e){return"Hospital"===e.name},t.prototype.isCemetery=function(e){return"Cemetery"===e.name},t.prototype.isIndustrial=function(e){return e.name.indexOf("Industrial")>=0||"Airport"===e.name},t.prototype.isPark=function(e){return"Park"===e.name||"City park"===e.name||"National park"===e.name||"Regional park"===e.name||e.name.indexOf("grass")>=0||e.name.indexOf("greens")>=0},t.prototype.isBuiltup=function(e){return"Built-up area"===e.name||"Town paved area"===e.name||"Shopping"===e.name||"University"===e.name||"Stadium"===e.name||e.name.indexOf("ground")>0},t.prototype.isWater=function(e){return"Other water"===e.name||"Ocean or sea"===e.name||"Ocean"===e.name||"Lake"===e.name||"Sea"===e.name||"Town swimming pool"===e.name||"River"===e.name},t.prototype.isRoadLabel=function(e){return e.name.indexOf("road label")>=0},t.prototype.isRoadPath=function(e){return e.name.indexOf("path")>0||"Parking road"===e.name||"Town walkway"===e.name||"Pedestrian road"===e.name||"Walkway road"===e.name||"Town carriageway divider"===e.name||"Runway"===e.name||"Non public road"===e.name},t.prototype.isRoadStreet=function(e){return e.name.indexOf("Minor local road")>=0||e.name.indexOf("minor local road")>=0||e.name.indexOf("Toll local road")>=0||e.name.indexOf("Local road")>=0},t.prototype.isRoadPrimary=function(e){return e.name.indexOf("Major local road")>=0||e.name.indexOf("Major road")>=0||e.name.indexOf("major road")>=0||e.name.indexOf("Motorway")>=0||e.name.indexOf("motorway")>=0||e.name.indexOf("International road")>=0||e.name.indexOf("international road")>=0},t.prototype.isRoadSecondary=function(e){return e.name.indexOf("connecting road")>=0||e.name.indexOf("Connecting road")>=0||e.name.indexOf("secondary road")>=0||e.name.indexOf("Secondary road")>=0},t.prototype.isRailway=function(e){return"Railway"===e.name},t.prototype.isFerry=function(e){return"Ferry road"===e.name},t.prototype.isBorder=function(e){return e.name.indexOf("border")>0},t.prototype.isCountryLabel=function(e){return"Country name"===e.name||"Country label"===e.name},t.prototype.isStateLabel=function(e){return"City"===e.name||e.name.indexOf("city")>0},t.prototype.isRegionLabel=function(e){return"Town"===e.name},t.prototype.isCountyLabel=function(e){return"Village"===e.name},t.prototype.isPlaceLabel=function(e){return"Park"===e.name||"Railway station"===e.name||"Airport POI"===e.name||"Town greens"===e.name},t.prototype.isWaterLabel=function(e){return"Ocean name"===e.name||"River label"===e.name||e.name.indexOf("water label")>0},t.prototype.isMarineLabel=function(e){return e.name.indexOf("water label")>0},t.prototype.isPoiLabel=function(e){return"National park name"===e.name||"Landmark label"===e.name||e.name.indexOf("label")>=0},t.prototype.isAeroway=function(e){return"Airport"===e.name},t.prototype.isBuilding=function(e){return e.name.indexOf("building")>=0},t.prototype.isTunnel=function(e){return e.name.indexOf("tunnel")>=0},t.prototype.isBridge=function(e){return e.name.indexOf("bridge")>=0},t}(o.OmvGenericFeatureModifier);t.OmvTomTomFeatureModifier=s}]);